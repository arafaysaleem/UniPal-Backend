<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:159,&quot;tests&quot;:599,&quot;passes&quot;:122,&quot;pending&quot;:0,&quot;failures&quot;:477,&quot;start&quot;:&quot;2022-06-20T10:49:13.777Z&quot;,&quot;end&quot;:&quot;2022-06-20T10:49:36.617Z&quot;,&quot;duration&quot;:22840,&quot;testsRegistered&quot;:599,&quot;passPercent&quot;:20.36727879799666,&quot;pendingPercent&quot;:0,&quot;other&quot;:29,&quot;hasOther&quot;:true,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;aa356994-a57d-4235-9f72-625e425559b4&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2c058784-c89a-46c9-be37-dc54f63a7308&quot;,&quot;title&quot;:&quot;Activities API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Activities API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activities API \&quot;before each\&quot; hook in \&quot;Activities API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0a148aae-0f33-4e06-87cb-575e5a6879a1&quot;,&quot;parentUUID&quot;:&quot;2c058784-c89a-46c9-be37-dc54f63a7308&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;36e44b67-c543-4875-9609-11ad950efb41&quot;,&quot;title&quot;:&quot;GET /activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all activities request successful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 1: Get all activities request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingActivity)); // contain all params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:58:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;dc2d414f-fc4c-43bf-ba40-4cdc5185a630&quot;,&quot;parentUUID&quot;:&quot;36e44b67-c543-4875-9609-11ad950efb41&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all activities request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 2: Get all activities request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;public&#x27;;\nlet res = await request(this.app)\n    .get(`${baseRoute}?privacy=${privacy}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].privacy).to.be.equal(privacy);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:73:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;5e5d4f14-2548-401e-aeea-5be7dd1bd1b1&quot;,&quot;parentUUID&quot;:&quot;36e44b67-c543-4875-9609-11ad950efb41&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all activities request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 3: Get all activities request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:692,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ActivityModel = require(&#x27;../../src/models/activity.model&#x27;);\nconst modelStub = sinon.stub(ActivityModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty activity list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;6dbee928-eb27-45bb-958f-846960a56f23&quot;,&quot;parentUUID&quot;:&quot;36e44b67-c543-4875-9609-11ad950efb41&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all activities request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 4: Get all activities request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;all&#x27;; // &lt;-- invalid privacy value\nlet res = await request(this.app)\n    .get(`${baseRoute}?privacy=${privacy}&amp;week=2`) // &lt;-- `week` is an incorrect query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;privacy&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:106:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;b51ecc23-41bd-42e4-82ae-de06664e426b&quot;,&quot;parentUUID&quot;:&quot;36e44b67-c543-4875-9609-11ad950efb41&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all activities request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 5: Get all activities request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a062422f-6e55-4ab8-b97d-34f56ba8f104&quot;,&quot;parentUUID&quot;:&quot;36e44b67-c543-4875-9609-11ad950efb41&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a062422f-6e55-4ab8-b97d-34f56ba8f104&quot;],&quot;failures&quot;:[&quot;dc2d414f-fc4c-43bf-ba40-4cdc5185a630&quot;,&quot;5e5d4f14-2548-401e-aeea-5be7dd1bd1b1&quot;,&quot;6dbee928-eb27-45bb-958f-846960a56f23&quot;,&quot;b51ecc23-41bd-42e4-82ae-de06664e426b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:765,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;10d8aab4-084a-4056-aae3-c71e796572f9&quot;,&quot;title&quot;:&quot;GET /activities/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a activity request successful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id Scenario 1: Get a activity request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.activity_id).to.be.eql(existingActivity.activity_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:135:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;ef20c20a-7603-4f12-9a41-02a1c922f082&quot;,&quot;parentUUID&quot;:&quot;10d8aab4-084a-4056-aae3-c71e796572f9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a activity request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id Scenario 2: Get a activity request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownActivityId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:148:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;088b3de0-8399-42b4-8438-c406d114c37c&quot;,&quot;parentUUID&quot;:&quot;10d8aab4-084a-4056-aae3-c71e796572f9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id Scenario 3: Get a activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingActivity.activity_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9fd6b0a9-a23e-4c89-a423-76f244f05775&quot;,&quot;parentUUID&quot;:&quot;10d8aab4-084a-4056-aae3-c71e796572f9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9fd6b0a9-a23e-4c89-a423-76f244f05775&quot;],&quot;failures&quot;:[&quot;ef20c20a-7603-4f12-9a41-02a1c922f082&quot;,&quot;088b3de0-8399-42b4-8438-c406d114c37c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7e936c18-1df6-42f4-9d01-3e6d31d4ce20&quot;,&quot;title&quot;:&quot;GET /activities/:id/attendees&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get an activity&#x27;s attendees request successful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 1: Get an activity&#x27;s attendees request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivity.activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].activity_id).to.be.equal(existingActivity.activity_id); // should match initially sent id\nexpect(resBody[0]).to.include.keys([&#x27;student_erp&#x27;, &#x27;first_name&#x27;,\n    &#x27;last_name&#x27;, &#x27;profile_picture_url&#x27;, &#x27;involvement_type&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:175:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;cba8a83f-278d-40b1-9b6a-5a9584566372&quot;,&quot;parentUUID&quot;:&quot;7e936c18-1df6-42f4-9d01-3e6d31d4ce20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get an activity&#x27;s attendees request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 2: Get an activity&#x27;s attendees request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst involvement_type = &#x27;going&#x27;;\nconst query = `involvement_type=${involvement_type}`;\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivity.activity_id}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].involvement_type).to.be.equal(involvement_type);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:193:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;ecfe87e8-8d1d-46c6-92f2-a0a8746709f6&quot;,&quot;parentUUID&quot;:&quot;7e936c18-1df6-42f4-9d01-3e6d31d4ce20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get an activity&#x27;s attendees request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 3: Get an activity&#x27;s attendees request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownActivityId}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:207:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;5c2daf91-ad2b-4e45-addb-5bd0db630957&quot;,&quot;parentUUID&quot;:&quot;7e936c18-1df6-42f4-9d01-3e6d31d4ce20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get an activity&#x27;s attendees request is unsuccessful due to zero attendees&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 4: Get an activity&#x27;s attendees request is unsuccessful due to zero attendees&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:578,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ActivityModel = require(&#x27;../../src/models/activity.model&#x27;);\nconst modelStub = sinon.stub(ActivityModel, &#x27;findAllAttendeesByActivity&#x27;).callsFake(() =&gt; []); // return empty activity attendees list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingActivity.activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;09243d1a-1b60-4ab1-967d-d2ddfa1dc4a6&quot;,&quot;parentUUID&quot;:&quot;7e936c18-1df6-42f4-9d01-3e6d31d4ce20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get an activity&#x27;s attendees is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 5: Get an activity&#x27;s attendees is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingActivity.activity_id}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;151ac3c9-dfc9-4d7c-a8c9-bb2cda922ee2&quot;,&quot;parentUUID&quot;:&quot;7e936c18-1df6-42f4-9d01-3e6d31d4ce20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;151ac3c9-dfc9-4d7c-a8c9-bb2cda922ee2&quot;],&quot;failures&quot;:[&quot;cba8a83f-278d-40b1-9b6a-5a9584566372&quot;,&quot;ecfe87e8-8d1d-46c6-92f2-a0a8746709f6&quot;,&quot;5c2daf91-ad2b-4e45-addb-5bd0db630957&quot;,&quot;09243d1a-1b60-4ab1-967d-d2ddfa1dc4a6&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:611,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;03fce5b9-4364-43e0-b05a-5a2db3110c79&quot;,&quot;title&quot;:&quot;POST /activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create an activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 1: Create an activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newActivity.organizer_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;activity_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// affirm\nconst newId = res.body.body.activity_id;\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\ndelete res.body.body.happens_at;\ndelete data.happens_at;\nexpect(res.body.body).to.be.eql({\n    activity_id: newId,\n    num_of_attendees: 0,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:262:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;2357c046-db54-4c1e-9293-eabcd1dc194a&quot;,&quot;parentUUID&quot;:&quot;03fce5b9-4364-43e0-b05a-5a2db3110c79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create an activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 2: Create an activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // admin to create other&#x27;s activities i.e. token erp != newActivity.organizer_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;activity_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// affirm\nconst newId = res.body.body.activity_id;\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\ndelete res.body.body.happens_at;\ndelete data.happens_at;\nexpect(res.body.body).to.be.eql({\n    activity_id: newId,\n    num_of_attendees: 0,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:305:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;04106e70-8823-4466-a247-b30b19e85481&quot;,&quot;parentUUID&quot;:&quot;03fce5b9-4364-43e0-b05a-5a2db3110c79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create an activity request is unsuccessful due to unknown activity_type_id&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 3: Create an activity request is unsuccessful due to unknown activity_type_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.activity_type_id = unknownActivityTypeId; // &lt;-- non-existent activity_type_id\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_type_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:349:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;a72862bf-9c19-493d-9e56-91992ce9ce44&quot;,&quot;parentUUID&quot;:&quot;03fce5b9-4364-43e0-b05a-5a2db3110c79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create an activity request is unsuccessful due to unknown activity_status_id&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 4: Create an activity request is unsuccessful due to unknown activity_status_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.activity_status_id = unknownActivityStatusId; // &lt;-- non-existent activity_status_id\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_status_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:372:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;364ffcd0-55cf-46a9-88ac-ca5888dda155&quot;,&quot;parentUUID&quot;:&quot;03fce5b9-4364-43e0-b05a-5a2db3110c79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create an activity request is unsuccessful due to unknown campus_spot_id&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 5: Create an activity request is unsuccessful due to unknown campus_spot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.campus_spot_id = unknownCampusSpotId; // &lt;-- non-existent campus_spot_id\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;campus_spot_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:395:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;0c675307-8c31-4dfc-a83b-e95aa2427ac2&quot;,&quot;parentUUID&quot;:&quot;03fce5b9-4364-43e0-b05a-5a2db3110c79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create an activity request is unsuccessful due to unknown organizer_erp&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 6: Create an activity request is unsuccessful due to unknown organizer_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.organizer_erp = unknownOrganizerERP; // &lt;-- non-existent organizer_erp\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;organizer_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:418:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;8485c6b0-40cf-4048-805c-854e175337a4&quot;,&quot;parentUUID&quot;:&quot;03fce5b9-4364-43e0-b05a-5a2db3110c79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Create an activity request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 7: Create an activity request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_numbersfd: newActivityMonth // &lt;-- a valid param is &#x27;month_number&#x27; &amp; &#x27;group_size&#x27; is required\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;month_number&#x27;, &#x27;group_size&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:438:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;e8cbde3f-5095-4f04-85e9-458a79ee416f&quot;,&quot;parentUUID&quot;:&quot;03fce5b9-4364-43e0-b05a-5a2db3110c79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Create an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 8: Create an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.organizer_erp = adminERP; // &lt;-- can be any other non-admin ERP as well, just different from userToken erp\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t create others activities unless admin i.e. token erp != invalidActivity.organizer_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:462:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;ca95dad7-10dc-40c2-986a-e43391fe9eb5&quot;,&quot;parentUUID&quot;:&quot;03fce5b9-4364-43e0-b05a-5a2db3110c79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Create an activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 9: Create an activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2ade80d4-8191-4ad0-be4d-f864fcab59f1&quot;,&quot;parentUUID&quot;:&quot;03fce5b9-4364-43e0-b05a-5a2db3110c79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2ade80d4-8191-4ad0-be4d-f864fcab59f1&quot;],&quot;failures&quot;:[&quot;2357c046-db54-4c1e-9293-eabcd1dc194a&quot;,&quot;04106e70-8823-4466-a247-b30b19e85481&quot;,&quot;a72862bf-9c19-493d-9e56-91992ce9ce44&quot;,&quot;364ffcd0-55cf-46a9-88ac-ca5888dda155&quot;,&quot;0c675307-8c31-4dfc-a83b-e95aa2427ac2&quot;,&quot;8485c6b0-40cf-4048-805c-854e175337a4&quot;,&quot;e8cbde3f-5095-4f04-85e9-458a79ee416f&quot;,&quot;ca95dad7-10dc-40c2-986a-e43391fe9eb5&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:107,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7069e08d-0f06-476b-b29a-8880dd557efd&quot;,&quot;title&quot;:&quot;PATCH /activities/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update an activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 1: Update an activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingActivity.organizer_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.month_number).to.be.equal(newActivityMonth);\n\n// cleanup\ndata.month_number = existingActivity.month_number;\nres = await request(app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:504:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;979ce02e-509c-4cd7-8c2b-0c8a1c07731a&quot;,&quot;parentUUID&quot;:&quot;7069e08d-0f06-476b-b29a-8880dd557efd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update an activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 2: Update an activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // admin to edit other profiles i.e. token erp != existingActivity.organizer_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.month_number).to.be.equal(newActivityMonth);\n\n// cleanup\ndata.month_number = existingActivity.month_number;\nres = await request(app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:538:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;068f3014-09f5-4327-b74b-899f81af5dd9&quot;,&quot;parentUUID&quot;:&quot;7069e08d-0f06-476b-b29a-8880dd557efd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update an activity request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 3: Update an activity request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // use admin token for no permission side effects\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:571:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;b0839522-a47f-4918-b382-fc2f62ba8d7c&quot;,&quot;parentUUID&quot;:&quot;7069e08d-0f06-476b-b29a-8880dd557efd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update an activity request is unsuccessful due to unknown activity_type_id&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 4: Update an activity request is unsuccessful due to unknown activity_type_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type_id: unknownActivityTypeId }; // &lt;-- Non-existent activity_type_id\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // use admin token for no permission side effects\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_type_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:588:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;e8f154c9-5b12-4bba-837c-5ec690e0a7f1&quot;,&quot;parentUUID&quot;:&quot;7069e08d-0f06-476b-b29a-8880dd557efd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update an activity request is unsuccessful due to unknown activity_status_id&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 5: Update an activity request is unsuccessful due to unknown activity_status_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status_id: unknownActivityStatusId }; // &lt;-- Non-existent activity_status_id\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // use admin token for no permission side effects\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_status_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:605:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;617caecb-92cb-466c-8b63-596c0d703e7c&quot;,&quot;parentUUID&quot;:&quot;7069e08d-0f06-476b-b29a-8880dd557efd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update an activity request is unsuccessful due to unknown campus_spot_id&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 6: Update an activity request is unsuccessful due to unknown campus_spot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot_id: unknownCampusSpotId }; // &lt;-- Non-existent campus_spot_id\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // use admin token for no permission side effects\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;campus_spot_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:622:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;36bb1952-5531-49c3-9cf1-f01eeab7db21&quot;,&quot;parentUUID&quot;:&quot;7069e08d-0f06-476b-b29a-8880dd557efd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Update an activity request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 7: Update an activity request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    month_numbersds: newActivityMonth, // &lt;-- an valid parameter name should be &#x27;month_number&#x27;\n    group_size: -2 // &lt;-- a valid &#x27;group_size&#x27; has to be positive only\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;group_size&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:642:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;9a226a3d-c445-4755-9f3d-a0381866f831&quot;,&quot;parentUUID&quot;:&quot;7069e08d-0f06-476b-b29a-8880dd557efd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Update an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 8: Update an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedActivityId}`) // &lt;-- has a different organizer_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others activities i.e. token erp != unOwnedActivity.organizer_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:662:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;1d7287de-dc1b-4221-befd-a5ca4a1e7bcf&quot;,&quot;parentUUID&quot;:&quot;7069e08d-0f06-476b-b29a-8880dd557efd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Update an activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 9: Update an activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;24979ec9-d3d4-4477-873f-a3fb33afa549&quot;,&quot;parentUUID&quot;:&quot;7069e08d-0f06-476b-b29a-8880dd557efd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;24979ec9-d3d4-4477-873f-a3fb33afa549&quot;],&quot;failures&quot;:[&quot;979ce02e-509c-4cd7-8c2b-0c8a1c07731a&quot;,&quot;068f3014-09f5-4327-b74b-899f81af5dd9&quot;,&quot;b0839522-a47f-4918-b382-fc2f62ba8d7c&quot;,&quot;e8f154c9-5b12-4bba-837c-5ec690e0a7f1&quot;,&quot;617caecb-92cb-466c-8b63-596c0d703e7c&quot;,&quot;36bb1952-5531-49c3-9cf1-f01eeab7db21&quot;,&quot;9a226a3d-c445-4755-9f3d-a0381866f831&quot;,&quot;1d7287de-dc1b-4221-befd-a5ca4a1e7bcf&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:67,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;13976a52-7019-460f-9801-259f33aff583&quot;,&quot;title&quot;:&quot;DELETE /activities/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete an activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 1: Delete an activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.activity_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // using his own token i.e. token erp == newActivity.organizer_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:704:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;2dc41248-4831-4d6e-acfb-da5c2713b969&quot;,&quot;parentUUID&quot;:&quot;13976a52-7019-460f-9801-259f33aff583&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete an activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 2: Delete an activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.activity_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // admin can delete other&#x27;s activities even if token erp != newActivity.organizer_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:743:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;78bafe05-8a54-4e6e-b4f3-85eda812ad0d&quot;,&quot;parentUUID&quot;:&quot;13976a52-7019-460f-9801-259f33aff583&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete an activity request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 3: Delete an activity request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:775:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;1678b14a-4001-49c8-b59f-8b5846282a5a&quot;,&quot;parentUUID&quot;:&quot;13976a52-7019-460f-9801-259f33aff583&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 4: Delete an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unOwnedActivityId}`) // &lt;-- has a different organizer_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user can&#x27;t delete others activities i.e. token erp != unOwnedActivity.organizer_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:788:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;8cd045f8-0641-478f-9193-90ed1cd2cdee&quot;,&quot;parentUUID&quot;:&quot;13976a52-7019-460f-9801-259f33aff583&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete an activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 5: Delete an activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivity.activity_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a7ce4a5f-a54f-40d4-bff5-22662bfcb0e9&quot;,&quot;parentUUID&quot;:&quot;13976a52-7019-460f-9801-259f33aff583&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a7ce4a5f-a54f-40d4-bff5-22662bfcb0e9&quot;],&quot;failures&quot;:[&quot;2dc41248-4831-4d6e-acfb-da5c2713b969&quot;,&quot;78bafe05-8a54-4e6e-b4f3-85eda812ad0d&quot;,&quot;1678b14a-4001-49c8-b59f-8b5846282a5a&quot;,&quot;8cd045f8-0641-478f-9193-90ed1cd2cdee&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:31,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;cd482aa9-b2f4-41b0-96bf-be0e201cef8f&quot;,&quot;title&quot;:&quot;Activity Attendees API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityAttendee.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityAttendee.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Activity Attendees API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API \&quot;before each\&quot; hook in \&quot;Activity Attendees API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8951e973-c331-4ec4-b9d0-fdfac6b4ab54&quot;,&quot;parentUUID&quot;:&quot;cd482aa9-b2f4-41b0-96bf-be0e201cef8f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6dc0fb93-c3f8-456c-b629-6f0bbb5193de&quot;,&quot;title&quot;:&quot;POST /activities/:id/attendees&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityAttendee.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityAttendee.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create an activity attendee request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 1: Create an activity attendee request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_erp, involvement_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n// affirm\nconst query = `involvement_type=${involvement_type}`;\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkStudentERP = activity =&gt; activity.student_erp === data.student_erp;\nexpect(res.body.body.some(checkStudentERP)).to.be.true;\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${activity_id}/${subRoute}/${data.student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:45:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;f44ad35c-4d75-4f10-92dd-7c18fb49c019&quot;,&quot;parentUUID&quot;:&quot;6dc0fb93-c3f8-456c-b629-6f0bbb5193de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create an activity attendee request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 2: Create an activity attendee request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_erp: unknownStudentERP, involvement_type }; // &lt;-- Non-existent student_erp\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;student_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:78:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;ba615c8c-f9c4-47c5-9e91-31cbd8a513e1&quot;,&quot;parentUUID&quot;:&quot;6dc0fb93-c3f8-456c-b629-6f0bbb5193de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create an activity attendee request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 3: Create an activity attendee request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    involvement_type: &#x27;not going&#x27;, // &lt;-- not a valid involvement_type\n    erp: &#x27;12345&#x27; // &lt;-- a valid parameter name should be &#x27;student_erp&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;involvement_type&#x27;, &#x27;student_erp&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:98:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;64e086a9-b23e-4448-b3ed-b41f7a4fdc7a&quot;,&quot;parentUUID&quot;:&quot;6dc0fb93-c3f8-456c-b629-6f0bbb5193de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create an activity attendee request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 4: Create an activity attendee request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_erp: adminERP, involvement_type }; // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:116:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;ab42e8bb-b436-491a-b2a5-4a469bfc8f79&quot;,&quot;parentUUID&quot;:&quot;6dc0fb93-c3f8-456c-b629-6f0bbb5193de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create an activity attendee request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 5: Create an activity attendee request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_erp, involvement_type };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;712cfd8a-1181-44c8-a506-fe70ceac6492&quot;,&quot;parentUUID&quot;:&quot;6dc0fb93-c3f8-456c-b629-6f0bbb5193de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;712cfd8a-1181-44c8-a506-fe70ceac6492&quot;],&quot;failures&quot;:[&quot;f44ad35c-4d75-4f10-92dd-7c18fb49c019&quot;,&quot;ba615c8c-f9c4-47c5-9e91-31cbd8a513e1&quot;,&quot;64e086a9-b23e-4448-b3ed-b41f7a4fdc7a&quot;,&quot;ab42e8bb-b436-491a-b2a5-4a469bfc8f79&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ea2b4581-519a-438e-8a3e-ea314d8a1a63&quot;,&quot;title&quot;:&quot;PATCH /activities/:id/attendees/:student_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityAttendee.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityAttendee.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update an activity attendee request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 1: Update an activity attendee request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- userToken.erp == student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nconst query = `involvement_type=${involvement_type}`;\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst studentERPs = res.body.body.map(o =&gt; (o.student_erp));\nexpect(studentERPs).to.include(student_erp);\n\n// cleanup\ndata.involvement_type = existingActivityAttendee.involvement_type;\nres = await request(app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:156:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;a42b1c0e-3bd1-4481-a6cb-5f14c4e75596&quot;,&quot;parentUUID&quot;:&quot;ea2b4581-519a-438e-8a3e-ea314d8a1a63&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update an activity attendee request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 2: Update an activity attendee request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nconst query = `involvement_type=${involvement_type}`;\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst studentERPs = res.body.body.map(o =&gt; (o.student_erp));\nexpect(studentERPs).to.include(student_erp);\n\n// cleanup\ndata.involvement_type = existingActivityAttendee.involvement_type;\nres = await request(app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:192:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;481a17bd-39b4-4b30-8176-4ad0af9a7548&quot;,&quot;parentUUID&quot;:&quot;ea2b4581-519a-438e-8a3e-ea314d8a1a63&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update an activity attendee request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 3: Update an activity attendee request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownActivityId}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:227:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;6e75c6a3-bfef-4174-9a15-eba409311a9d&quot;,&quot;parentUUID&quot;:&quot;ea2b4581-519a-438e-8a3e-ea314d8a1a63&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update an activity attendee request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 4: Update an activity attendee request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${unknownStudentERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:244:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;4a6d692c-c8bc-4869-9ef9-279c7294cdb4&quot;,&quot;parentUUID&quot;:&quot;ea2b4581-519a-438e-8a3e-ea314d8a1a63&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update an activity attendee request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 5: Update an activity attendee request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    involvement_type: &#x27;not going&#x27;, // &lt;-- not a valid involvement_type\n    erp: &#x27;12345&#x27; // &lt;-- an invalid update parameter i.e. not allowed\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;involvement_type&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include.members([&#x27;Invalid updates!&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:264:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;3f87ceed-a4c5-482e-9d25-5ea7030806ad&quot;,&quot;parentUUID&quot;:&quot;ea2b4581-519a-438e-8a3e-ea314d8a1a63&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update an activity attendee request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 6: Update an activity attendee request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${adminERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:284:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;0fc8cec5-eefa-4a52-bce1-ab9990a39f25&quot;,&quot;parentUUID&quot;:&quot;ea2b4581-519a-438e-8a3e-ea314d8a1a63&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Update an activity attendee request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 7: Update an activity attendee request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4f780f5e-458f-49ed-aa39-f4418dc3fde6&quot;,&quot;parentUUID&quot;:&quot;ea2b4581-519a-438e-8a3e-ea314d8a1a63&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4f780f5e-458f-49ed-aa39-f4418dc3fde6&quot;],&quot;failures&quot;:[&quot;a42b1c0e-3bd1-4481-a6cb-5f14c4e75596&quot;,&quot;481a17bd-39b4-4b30-8176-4ad0af9a7548&quot;,&quot;6e75c6a3-bfef-4174-9a15-eba409311a9d&quot;,&quot;4a6d692c-c8bc-4869-9ef9-279c7294cdb4&quot;,&quot;3f87ceed-a4c5-482e-9d25-5ea7030806ad&quot;,&quot;0fc8cec5-eefa-4a52-bce1-ab9990a39f25&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:43,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;dca26629-41f4-47e4-ae35-9f03744f10f1&quot;,&quot;title&quot;:&quot;DELETE /activities/:id/attendees/:student_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityAttendee.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityAttendee.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete an activity attendee request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 1: Delete an activity attendee request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { student_erp, involvement_type };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp == student_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:323:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;62c7d2f6-23ce-442f-8948-d1f8b56dfe61&quot;,&quot;parentUUID&quot;:&quot;dca26629-41f4-47e4-ae35-9f03744f10f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete an activity attendee request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 2: Delete an activity attendee request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { student_erp, involvement_type };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp != student_erp but still bypass ownerCheck\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:356:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;188519a4-8a44-43c0-8800-de7ac2aae62f&quot;,&quot;parentUUID&quot;:&quot;dca26629-41f4-47e4-ae35-9f03744f10f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete an activity attendee request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 3: Delete an activity attendee request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownActivityId}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:386:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;8a9ca4cc-1951-4436-88df-c73ca00eb1a9&quot;,&quot;parentUUID&quot;:&quot;dca26629-41f4-47e4-ae35-9f03744f10f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete an activity attendee request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 4: Delete an activity attendee request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityId}/${subRoute}/${unknownStudentERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:399:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;13a398d7-577f-431b-b4fc-f6d6c6d35c1f&quot;,&quot;parentUUID&quot;:&quot;dca26629-41f4-47e4-ae35-9f03744f10f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete an activity attendee request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 5: Delete an activity attendee request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityId}/${subRoute}/${adminERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:412:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;490b122a-467e-41f6-9521-a120bbbca3bf&quot;,&quot;parentUUID&quot;:&quot;dca26629-41f4-47e4-ae35-9f03744f10f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Delete an activity attendee request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 6: Delete an activity attendee request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityId}/${subRoute}/${student_erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5b9aa214-3ead-4ec5-a5d7-83f790e957e6&quot;,&quot;parentUUID&quot;:&quot;dca26629-41f4-47e4-ae35-9f03744f10f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5b9aa214-3ead-4ec5-a5d7-83f790e957e6&quot;],&quot;failures&quot;:[&quot;62c7d2f6-23ce-442f-8948-d1f8b56dfe61&quot;,&quot;188519a4-8a44-43c0-8800-de7ac2aae62f&quot;,&quot;8a9ca4cc-1951-4436-88df-c73ca00eb1a9&quot;,&quot;13a398d7-577f-431b-b4fc-f6d6c6d35c1f&quot;,&quot;490b122a-467e-41f6-9521-a120bbbca3bf&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:36,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;3a719feb-b6d5-4b64-b1a4-835ce60e7471&quot;,&quot;title&quot;:&quot;Activity Statuses API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Activity Statuses API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API \&quot;before each\&quot; hook in \&quot;Activity Statuses API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;78983219-d1f1-4312-8fa8-18d047a80860&quot;,&quot;parentUUID&quot;:&quot;3a719feb-b6d5-4b64-b1a4-835ce60e7471&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8afbe073-2c6e-4dd2-b088-b5808e3c864c&quot;,&quot;title&quot;:&quot;GET /activity-statuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all activity statuses request successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses Scenario 1: Get all activity statuses request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;activity_status_id&#x27;, &#x27;activity_status&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:34:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;63f5231d-bfa9-45da-9b70-d9b64abdd884&quot;,&quot;parentUUID&quot;:&quot;8afbe073-2c6e-4dd2-b088-b5808e3c864c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all activity statuses request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses Scenario 2: Get all activity statuses request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:532,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ActivityStatusModel = require(&#x27;../../src/models/activityStatus.model&#x27;);\nconst modelStub = sinon.stub(ActivityStatusModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty activity_status list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity statuses not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;04b75859-f926-4237-940c-318d587fb6cc&quot;,&quot;parentUUID&quot;:&quot;8afbe073-2c6e-4dd2-b088-b5808e3c864c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;63f5231d-bfa9-45da-9b70-d9b64abdd884&quot;,&quot;04b75859-f926-4237-940c-318d587fb6cc&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:537,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a23f2689-e5b4-4c78-8b60-aa8c3bf3a40d&quot;,&quot;title&quot;:&quot;GET /activity-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a activity status request successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses/:id Scenario 1: Get a activity status request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;activity_status_id&#x27;, &#x27;activity_status&#x27;]);\nexpect(resBody.activity_status_id).to.be.eql(existingActivityStatus.activity_status_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:69:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;cf335e26-0234-4878-a1d3-819c5bafb27f&quot;,&quot;parentUUID&quot;:&quot;a23f2689-e5b4-4c78-8b60-aa8c3bf3a40d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a activity status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses/:id Scenario 2: Get a activity status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownActivityStatusId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity status not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:83:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;c844e2bf-adab-42df-8db2-63b57454d72e&quot;,&quot;parentUUID&quot;:&quot;a23f2689-e5b4-4c78-8b60-aa8c3bf3a40d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a activity status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses/:id Scenario 3: Get a activity status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingActivityStatus.activity_status_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e312514c-06c5-484f-8141-eabb0a3c37ce&quot;,&quot;parentUUID&quot;:&quot;a23f2689-e5b4-4c78-8b60-aa8c3bf3a40d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e312514c-06c5-484f-8141-eabb0a3c37ce&quot;],&quot;failures&quot;:[&quot;cf335e26-0234-4878-a1d3-819c5bafb27f&quot;,&quot;c844e2bf-adab-42df-8db2-63b57454d72e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f1af5dd7-9b8f-468d-89d3-4f919ada5af4&quot;,&quot;title&quot;:&quot;POST /activity-statuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a activity status request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API POST /activity-statuses Scenario 1: Create a activity status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;activity_status_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.activity_status_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    activity_status_id: newId,\n    activity_status: activity_status\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:116:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;f3207dd0-1108-4e78-aad4-07eec31d3a99&quot;,&quot;parentUUID&quot;:&quot;f1af5dd7-9b8f-468d-89d3-4f919ada5af4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a activity status request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API POST /activity-statuses Scenario 2: Create a activity status request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    activity_statuses: activity_status // &lt;-- a valid parameter name should be &#x27;activity_status&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;activity_status&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:153:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;e0b6ba9b-f81a-4aba-915a-8102d7449601&quot;,&quot;parentUUID&quot;:&quot;f1af5dd7-9b8f-468d-89d3-4f919ada5af4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a activity status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API POST /activity-statuses Scenario 3: Create a activity status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:171:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;8c9e8007-8fb6-4030-9f2f-aa000d503f84&quot;,&quot;parentUUID&quot;:&quot;f1af5dd7-9b8f-468d-89d3-4f919ada5af4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a activity status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API POST /activity-statuses Scenario 4: Create a activity status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;916eb7b4-c533-40f5-a282-2982fe90bbe8&quot;,&quot;parentUUID&quot;:&quot;f1af5dd7-9b8f-468d-89d3-4f919ada5af4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;916eb7b4-c533-40f5-a282-2982fe90bbe8&quot;],&quot;failures&quot;:[&quot;f3207dd0-1108-4e78-aad4-07eec31d3a99&quot;,&quot;e0b6ba9b-f81a-4aba-915a-8102d7449601&quot;,&quot;8c9e8007-8fb6-4030-9f2f-aa000d503f84&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:35,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1a405bf0-7b6f-404e-8d65-7e0b53db16af&quot;,&quot;title&quot;:&quot;PATCH /activity-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a activity status request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 1: Update a activity status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status: newActivityStatus };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    activity_status_id: existingActivityStatus.activity_status_id,\n    activity_status: newActivityStatus\n});\n\n// cleanup\ndata.activity_status = existingActivityStatus.activity_status;\nres = await request(app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:209:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;729a8e5b-2c55-4a4f-98e0-5a2e90512f14&quot;,&quot;parentUUID&quot;:&quot;1a405bf0-7b6f-404e-8d65-7e0b53db16af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a activity status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 2: Update a activity status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status: newActivityStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownActivityStatusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity status not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:245:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;c898d988-f95c-42e4-94b9-c15155f6dd43&quot;,&quot;parentUUID&quot;:&quot;1a405bf0-7b6f-404e-8d65-7e0b53db16af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a activity status request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 3: Update a activity status request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    activity_statuses: newActivityStatus // &lt;-- a valid parameter name should be &#x27;activity_status&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;activity_status&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:264:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;eb2a3f6f-d4c6-4510-99b0-72472f740caa&quot;,&quot;parentUUID&quot;:&quot;1a405bf0-7b6f-404e-8d65-7e0b53db16af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a activity status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 4: Update a activity status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status: newActivityStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:282:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;499a9178-eab8-4c82-bb1a-0e05d1b2a41e&quot;,&quot;parentUUID&quot;:&quot;1a405bf0-7b6f-404e-8d65-7e0b53db16af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a activity status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 5: Update a activity status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status: newActivityStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a389b9ad-c227-43ad-8ea4-a4dc598e110e&quot;,&quot;parentUUID&quot;:&quot;1a405bf0-7b6f-404e-8d65-7e0b53db16af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a389b9ad-c227-43ad-8ea4-a4dc598e110e&quot;],&quot;failures&quot;:[&quot;729a8e5b-2c55-4a4f-98e0-5a2e90512f14&quot;,&quot;c898d988-f95c-42e4-94b9-c15155f6dd43&quot;,&quot;eb2a3f6f-d4c6-4510-99b0-72472f740caa&quot;,&quot;499a9178-eab8-4c82-bb1a-0e05d1b2a41e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:32,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f175a0cf-a062-4785-b60f-27df007b1d4f&quot;,&quot;title&quot;:&quot;DELETE /activity-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a activity status request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API DELETE /activity-statuses/:id Scenario 1: Delete a activity status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { activity_status };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.activity_status_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity status has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:318:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;ceff5b17-0598-4047-a4a4-4f0fcbe85874&quot;,&quot;parentUUID&quot;:&quot;f175a0cf-a062-4785-b60f-27df007b1d4f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a activity status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API DELETE /activity-statuses/:id Scenario 2: Delete a activity status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownActivityStatusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity status not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:350:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;5e9d9b19-3576-4da7-818b-b9996b436a94&quot;,&quot;parentUUID&quot;:&quot;f175a0cf-a062-4785-b60f-27df007b1d4f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a activity status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API DELETE /activity-statuses/:id Scenario 3: Delete a activity status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:363:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;715413b9-8edd-4f7b-806b-dc14ee2a1722&quot;,&quot;parentUUID&quot;:&quot;f175a0cf-a062-4785-b60f-27df007b1d4f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a activity status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API DELETE /activity-statuses/:id Scenario 4: Delete a activity status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityStatus.activity_status_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3296d0df-87d4-4b5a-b929-297976ea4b7e&quot;,&quot;parentUUID&quot;:&quot;f175a0cf-a062-4785-b60f-27df007b1d4f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3296d0df-87d4-4b5a-b929-297976ea4b7e&quot;],&quot;failures&quot;:[&quot;ceff5b17-0598-4047-a4a4-4f0fcbe85874&quot;,&quot;5e9d9b19-3576-4da7-818b-b9996b436a94&quot;,&quot;715413b9-8edd-4f7b-806b-dc14ee2a1722&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;80683534-93e7-4f22-900f-5f00a1806d92&quot;,&quot;title&quot;:&quot;Activity Types API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Activity Types API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Types API \&quot;before each\&quot; hook in \&quot;Activity Types API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;94d45ca1-9955-4f1b-94ab-e6f799646a60&quot;,&quot;parentUUID&quot;:&quot;80683534-93e7-4f22-900f-5f00a1806d92&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;85e9b31c-4465-4bd0-8b4a-dce3e2eb550a&quot;,&quot;title&quot;:&quot;GET /activity-types&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all activity types request successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types Scenario 1: Get all activity types request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;activity_type_id&#x27;, &#x27;activity_type&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:34:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;8f2150cb-cdca-472b-a3b6-01ee888b3f5c&quot;,&quot;parentUUID&quot;:&quot;85e9b31c-4465-4bd0-8b4a-dce3e2eb550a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all activity types request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types Scenario 2: Get all activity types request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:593,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ActivityTypeModel = require(&#x27;../../src/models/activityType.model&#x27;);\nconst modelStub = sinon.stub(ActivityTypeModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty activity_type list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity types not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;aac75a81-6a75-4fdb-994d-d0dc75b3f470&quot;,&quot;parentUUID&quot;:&quot;85e9b31c-4465-4bd0-8b4a-dce3e2eb550a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;8f2150cb-cdca-472b-a3b6-01ee888b3f5c&quot;,&quot;aac75a81-6a75-4fdb-994d-d0dc75b3f470&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:598,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6b79cd39-8474-4226-9220-6622c0d8fa93&quot;,&quot;title&quot;:&quot;GET /activity-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a activity type request successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types/:id Scenario 1: Get a activity type request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;activity_type_id&#x27;, &#x27;activity_type&#x27;]);\nexpect(resBody.activity_type_id).to.be.eql(existingActivityType.activity_type_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:69:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;dd5bee30-8aa9-4ac4-92ed-9cebb7072388&quot;,&quot;parentUUID&quot;:&quot;6b79cd39-8474-4226-9220-6622c0d8fa93&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a activity type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types/:id Scenario 2: Get a activity type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownActivityTypeId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity type not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:83:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;76e5a404-6285-4a65-bf69-c3a829783bd7&quot;,&quot;parentUUID&quot;:&quot;6b79cd39-8474-4226-9220-6622c0d8fa93&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a activity type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types/:id Scenario 3: Get a activity type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingActivityType.activity_type_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0144032f-82db-4a44-95c0-e360652ba290&quot;,&quot;parentUUID&quot;:&quot;6b79cd39-8474-4226-9220-6622c0d8fa93&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0144032f-82db-4a44-95c0-e360652ba290&quot;],&quot;failures&quot;:[&quot;dd5bee30-8aa9-4ac4-92ed-9cebb7072388&quot;,&quot;76e5a404-6285-4a65-bf69-c3a829783bd7&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:40,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;e493b9cc-a224-46e5-a555-e71b4efb321a&quot;,&quot;title&quot;:&quot;POST /activity-types&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a activity type request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API POST /activity-types Scenario 1: Create a activity type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;activity_type_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.activity_type_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    activity_type_id: newId,\n    activity_type: activity_type\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:116:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;f991ea7a-a2d4-4b54-a113-21e09e743cde&quot;,&quot;parentUUID&quot;:&quot;e493b9cc-a224-46e5-a555-e71b4efb321a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a activity type request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Types API POST /activity-types Scenario 2: Create a activity type request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    activity_types: activity_type // &lt;-- a valid parameter name should be &#x27;activity_type&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;activity_type&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:153:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;977c0270-a49e-470b-9123-332d7e315b43&quot;,&quot;parentUUID&quot;:&quot;e493b9cc-a224-46e5-a555-e71b4efb321a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a activity type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Types API POST /activity-types Scenario 3: Create a activity type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:171:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;b9a34241-89d6-4980-ba7c-82b065574149&quot;,&quot;parentUUID&quot;:&quot;e493b9cc-a224-46e5-a555-e71b4efb321a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a activity type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Types API POST /activity-types Scenario 4: Create a activity type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9cefdddf-30d2-42fa-a751-340fc1bd8616&quot;,&quot;parentUUID&quot;:&quot;e493b9cc-a224-46e5-a555-e71b4efb321a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9cefdddf-30d2-42fa-a751-340fc1bd8616&quot;],&quot;failures&quot;:[&quot;f991ea7a-a2d4-4b54-a113-21e09e743cde&quot;,&quot;977c0270-a49e-470b-9123-332d7e315b43&quot;,&quot;b9a34241-89d6-4980-ba7c-82b065574149&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:41,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b2f54042-8d4a-4faf-8206-30a2a4df3bab&quot;,&quot;title&quot;:&quot;PATCH /activity-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a activity type request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 1: Update a activity type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type: newActivityType };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    activity_type_id: existingActivityType.activity_type_id,\n    activity_type: newActivityType\n});\n\n// cleanup\ndata.activity_type = existingActivityType.activity_type;\nres = await request(app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:209:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;23dd3d35-9367-40bb-a303-e5a7df7d6e38&quot;,&quot;parentUUID&quot;:&quot;b2f54042-8d4a-4faf-8206-30a2a4df3bab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a activity type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 2: Update a activity type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type: newActivityType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownActivityTypeId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity type not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:245:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;b11328d4-aef3-4354-a639-1ddb3b1dad84&quot;,&quot;parentUUID&quot;:&quot;b2f54042-8d4a-4faf-8206-30a2a4df3bab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a activity type request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 3: Update a activity type request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    activity_types: newActivityType // &lt;-- a valid parameter name should be &#x27;activity_type&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;activity_type&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:264:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;87a52d6f-f58e-4730-875d-f55bdc5530b5&quot;,&quot;parentUUID&quot;:&quot;b2f54042-8d4a-4faf-8206-30a2a4df3bab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a activity type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 4: Update a activity type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type: newActivityType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:282:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;680ab721-55b1-45c1-9b17-5a05348c7b6a&quot;,&quot;parentUUID&quot;:&quot;b2f54042-8d4a-4faf-8206-30a2a4df3bab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a activity type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 5: Update a activity type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type: newActivityType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;77c6fbc3-4ea3-4146-adb5-191bea47cbe1&quot;,&quot;parentUUID&quot;:&quot;b2f54042-8d4a-4faf-8206-30a2a4df3bab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;77c6fbc3-4ea3-4146-adb5-191bea47cbe1&quot;],&quot;failures&quot;:[&quot;23dd3d35-9367-40bb-a303-e5a7df7d6e38&quot;,&quot;b11328d4-aef3-4354-a639-1ddb3b1dad84&quot;,&quot;87a52d6f-f58e-4730-875d-f55bdc5530b5&quot;,&quot;680ab721-55b1-45c1-9b17-5a05348c7b6a&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:69,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;95875d2b-adcb-4a9e-a669-2b44f369cef8&quot;,&quot;title&quot;:&quot;DELETE /activity-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a activity type request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API DELETE /activity-types/:id Scenario 1: Delete a activity type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { activity_type };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.activity_type_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity type has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:318:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;4fea3f97-aec2-4c72-b604-3c9748f32d8c&quot;,&quot;parentUUID&quot;:&quot;95875d2b-adcb-4a9e-a669-2b44f369cef8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a activity type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API DELETE /activity-types/:id Scenario 2: Delete a activity type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownActivityTypeId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity type not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:350:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;6f90e91f-6747-40ca-8f11-1f9a39d37642&quot;,&quot;parentUUID&quot;:&quot;95875d2b-adcb-4a9e-a669-2b44f369cef8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a activity type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Types API DELETE /activity-types/:id Scenario 3: Delete a activity type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:363:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;1f22e68e-ffd2-4195-8e8b-95e9963abf39&quot;,&quot;parentUUID&quot;:&quot;95875d2b-adcb-4a9e-a669-2b44f369cef8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a activity type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Types API DELETE /activity-types/:id Scenario 4: Delete a activity type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityType.activity_type_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;03bc9d2c-df57-41f6-8f87-3d3a47ca18fa&quot;,&quot;parentUUID&quot;:&quot;95875d2b-adcb-4a9e-a669-2b44f369cef8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;03bc9d2c-df57-41f6-8f87-3d3a47ca18fa&quot;],&quot;failures&quot;:[&quot;4fea3f97-aec2-4c72-b604-3c9748f32d8c&quot;,&quot;6f90e91f-6747-40ca-8f11-1f9a39d37642&quot;,&quot;1f22e68e-ffd2-4195-8e8b-95e9963abf39&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:50,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;635c4cbf-107e-46da-ba52-a340d7147632&quot;,&quot;title&quot;:&quot;Authentication API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Authentication API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API \&quot;before each\&quot; hook in \&quot;Authentication API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: done() called multiple times in hook &lt;Authentication API \&quot;before each\&quot; hook in \&quot;Authentication API\&quot;&gt; of file D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js; in addition, done() received error: DatabaseException [Database Error]: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21) {\n  isOperational: false,\n  code: &#x27;DatabaseException&#x27;,\n  status: 500,\n  data: undefined,\n  uncaught: true\n}&quot;,&quot;estack&quot;:&quot;Error: done() called multiple times in hook &lt;Authentication API \&quot;before each\&quot; hook in \&quot;Authentication API\&quot;&gt; of file D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js; in addition, done() received error: DatabaseException [Database Error]: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21) {\n  isOperational: false,\n  code: &#x27;DatabaseException&#x27;,\n  status: 500,\n  data: undefined,\n  uncaught: true\n}\n    at process.emit (node:events:539:35)\n    at process.emit (node:domain:475:12)\n    at process._fatalException (node:internal/process/execution:167:25)&quot;},&quot;uuid&quot;:&quot;4b761869-1d96-4c58-94dc-edd4c9ebe3ac&quot;,&quot;parentUUID&quot;:&quot;635c4cbf-107e-46da-ba52-a340d7147632&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0d379c67-f242-435b-b027-d96ef10812a0&quot;,&quot;title&quot;:&quot;POST /auth/register&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;POST /auth/register\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register \&quot;before each\&quot; hook in \&quot;POST /auth/register\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;studentBody = {\n    erp: newERP,\n    first_name: \&quot;Abdur Rafay\&quot;,\n    last_name: \&quot;Saleem\&quot;,\n    gender: \&quot;male\&quot;,\n    contact: \&quot;+923009999999\&quot;,\n    birthday: \&quot;1999-09-18\&quot;,\n    password: \&quot;123\&quot;,\n    profile_picture_url: \&quot;https://i.pinimg.com/564x/8d/e3/89/8de389c84e919d3577f47118e2627d95.jpg\&quot;,\n    graduation_year: 2022,\n    uni_email: newEmail,\n    campus_id: 1,\n    program_id: 1,\n    is_active: 1\n};&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;657845e2-0eb4-48ea-a7c4-69f996a2d8c7&quot;,&quot;parentUUID&quot;:&quot;0d379c67-f242-435b-b027-d96ef10812a0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Register request is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register Scenario 1: Register request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:119,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nstudentBody.erp = newERP;\nstudentBody.uni_email = newEmail;\nconst app = this.app;\n// act\nlet res = await request(app).post(`${baseRoute}/register`).send(studentBody);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.token).to.exist;\nexpect(resBody.role).to.be.equal(&#x27;api_user&#x27;);\ndelete studentBody.password; // omit token and password\nconst studentFields = Object.keys(studentBody);\nconst studentFieldsCheck = field =&gt; resBody[field] === studentBody[field]; // deep compare two objects\nexpect(studentFields.every(studentFieldsCheck)).to.be.true;\n// cleanup\nconst deleteRoute = `/api/${Config.API_VERSION}/students/${studentBody.erp}`;\nconst adminToken = jwt.sign({erp: adminERP}, Config.SECRET_JWT);\nres = await request(app)\n    .delete(deleteRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:55:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;10618285-504d-49fc-a8dc-37a7ab15c073&quot;,&quot;parentUUID&quot;:&quot;0d379c67-f242-435b-b027-d96ef10812a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Register request is unsuccessful due to duplicate student&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register Scenario 2: Register request is unsuccessful due to duplicate student&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nstudentBody.erp = existingERP;\nstudentBody.uni_email = existingEmail;\n// act\nconst res = await request(this.app).post(`${baseRoute}/register`).send(studentBody);\n    \n// assert\nexpect(res.status).to.be.equal(409);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DuplicateEntryException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 409&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 409\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:83:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;409&quot;}]},&quot;uuid&quot;:&quot;80b7a166-e937-4c9e-9449-65dae55f6edb&quot;,&quot;parentUUID&quot;:&quot;0d379c67-f242-435b-b027-d96ef10812a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Register request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register Scenario 3: Register request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nstudentBody.erp = &#x27;abdfe&#x27;;\n// act\nconst res = await request(this.app).post(`${baseRoute}/register`).send(studentBody);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e816119b-2862-432a-9c19-7da57f03f97d&quot;,&quot;parentUUID&quot;:&quot;0d379c67-f242-435b-b027-d96ef10812a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e816119b-2862-432a-9c19-7da57f03f97d&quot;],&quot;failures&quot;:[&quot;10618285-504d-49fc-a8dc-37a7ab15c073&quot;,&quot;80b7a166-e937-4c9e-9449-65dae55f6edb&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:193,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0cb669cf-c5a1-49ad-8ecd-4bacaf2cc119&quot;,&quot;title&quot;:&quot;POST /auth/register-admin&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;POST /auth/register-admin\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register-admin \&quot;before each\&quot; hook in \&quot;POST /auth/register-admin\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminBody = {\n    erp: newERP,\n    first_name: \&quot;Abdur Rafay\&quot;,\n    last_name: \&quot;Saleem\&quot;,\n    gender: \&quot;male\&quot;,\n    contact: \&quot;+923009999999\&quot;,\n    birthday: \&quot;1999-09-18\&quot;,\n    password: \&quot;123\&quot;,\n    profile_picture_url: \&quot;https://i.pinimg.com/564x/8d/e3/89/8de389c84e919d3577f47118e2627d95.jpg\&quot;,\n    graduation_year: 2022,\n    uni_email: newEmail,\n    campus_id: 1,\n    program_id: 1,\n    is_active: 1\n};&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b888beb8-cdaa-40c0-9cfd-a1786d655803&quot;,&quot;parentUUID&quot;:&quot;0cb669cf-c5a1-49ad-8ecd-4bacaf2cc119&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Register request is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register-admin Scenario 1: Register request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nadminBody.erp = newERP;\nadminBody.uni_email = newEmail;\nconst app = this.app;\n// act\nlet res = await request(app).post(`${baseRoute}/register-admin`).send(adminBody);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.token).to.exist;\nexpect(resBody.role).to.be.equal(&#x27;admin&#x27;);\ndelete adminBody.password; // omit token, role and password\nconst adminFields = Object.keys(adminBody);\nconst adminFieldsCheck = field =&gt; resBody[field] === adminBody[field]; // deep compare two objects\nexpect(adminFields.every(adminFieldsCheck)).to.be.true;\n// cleanup\nconst deleteRoute = `/api/${Config.API_VERSION}/students/${adminBody.erp}`;\nconst adminToken = jwt.sign({erp: adminERP}, Config.SECRET_JWT);\nres = await request(app)\n    .delete(deleteRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:135:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;34554ac7-ca4c-469a-9ab9-118ce8fcb0db&quot;,&quot;parentUUID&quot;:&quot;0cb669cf-c5a1-49ad-8ecd-4bacaf2cc119&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Register request is unsuccessful due to duplicate student&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register-admin Scenario 2: Register request is unsuccessful due to duplicate student&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nadminBody.erp = existingERP;\nadminBody.uni_email = existingEmail;\n// act\nconst res = await request(this.app).post(`${baseRoute}/register-admin`).send(adminBody);\n    \n// assert\nexpect(res.status).to.be.equal(409);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DuplicateEntryException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 409&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 409\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:163:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;409&quot;}]},&quot;uuid&quot;:&quot;66a80235-f252-4ff4-93a9-85a9e4ba222b&quot;,&quot;parentUUID&quot;:&quot;0cb669cf-c5a1-49ad-8ecd-4bacaf2cc119&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Register request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register-admin Scenario 3: Register request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nadminBody.erp = &#x27;abdfe&#x27;;\n// act\nconst res = await request(this.app).post(`${baseRoute}/register-admin`).send(adminBody);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5cae380f-c5ad-4964-9747-f6c6c327b565&quot;,&quot;parentUUID&quot;:&quot;0cb669cf-c5a1-49ad-8ecd-4bacaf2cc119&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5cae380f-c5ad-4964-9747-f6c6c327b565&quot;],&quot;failures&quot;:[&quot;34554ac7-ca4c-469a-9ab9-118ce8fcb0db&quot;,&quot;66a80235-f252-4ff4-93a9-85a9e4ba222b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:94,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;113e2565-61c4-4263-8453-f4ac1ed6ce49&quot;,&quot;title&quot;:&quot;POST /auth/login&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Login request is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/login Scenario 1: Login request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst studentBody = {\n    erp: existingERP,\n    first_name: \&quot;Abdur Rafay\&quot;,\n    last_name: \&quot;Saleem\&quot;,\n    gender: \&quot;male\&quot;,\n    contact: \&quot;+923009999999\&quot;,\n    email: &#x27;arafaysaleem@gmail.com&#x27;,\n    birthday: \&quot;1999-09-18\&quot;,\n    profile_picture_url: \&quot;https://i.pinimg.com/564x/8d/e3/89/8de389c84e919d3577f47118e2627d95.jpg\&quot;,\n    graduation_year: 2022,\n    uni_email: existingEmail,\n    hobbies: [1, 2, 3],\n    interests: [1, 2, 3],\n    campus_id: 1,\n    program_id: 1,\n    favourite_campus_hangout_spot: \&quot;CED\&quot;,\n    favourite_campus_activity: \&quot;Lifting\&quot;,\n    current_status: 1,\n    is_active: 1,\n    role: \&quot;api_user\&quot;\n};\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;\n};\n// act\nlet res = await request(this.app).post(`${baseRoute}/login`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys(&#x27;token&#x27;);\ndelete resBody.token;\nexpect(resBody).to.be.eql(studentBody);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:217:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;e772609d-e98c-47c6-901d-73038c6e5a25&quot;,&quot;parentUUID&quot;:&quot;113e2565-61c4-4263-8453-f4ac1ed6ce49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Login request is unsuccessful due to missing student&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/login Scenario 2: Login request is unsuccessful due to missing student&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    password: &#x27;123&#x27;\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/login`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:236:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;f5588efa-14b5-439a-8e29-9fcb1d0d678f&quot;,&quot;parentUUID&quot;:&quot;113e2565-61c4-4263-8453-f4ac1ed6ce49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Login request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/login Scenario 3: Login request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    email: existingEmail, // &lt;-- email is an unrecognized parameter\n    password: &#x27;123&#x27;\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/login`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;84839a00-c2e7-4463-80d0-6fa5441cc67b&quot;,&quot;parentUUID&quot;:&quot;113e2565-61c4-4263-8453-f4ac1ed6ce49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;84839a00-c2e7-4463-80d0-6fa5441cc67b&quot;],&quot;failures&quot;:[&quot;e772609d-e98c-47c6-901d-73038c6e5a25&quot;,&quot;f5588efa-14b5-439a-8e29-9fcb1d0d678f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7321a581-ba7d-46f0-b2f0-ffb898549138&quot;,&quot;title&quot;:&quot;POST /auth/refresh-token&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Refresh token is successful and return a new token&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 1: Refresh token is successful and return a new token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst secretKey = Config.SECRET_JWT;\nconst old_token = jwt.sign({ erp: existingERP }, secretKey, {\n    expiresIn: \&quot;1\&quot; // &lt;-- immediately expire the token (in 1ms)\n});\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;,\n    old_token: old_token\n};\n// wait for token to expire (in 1ms)\nawait sleep(1);\n// act\nlet res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.token).to.exist;\nexpect(res.body.body.token).to.be.not.equal(old_token);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:280:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;1fca1ed6-34c7-47d1-8f5c-6327adc96013&quot;,&quot;parentUUID&quot;:&quot;7321a581-ba7d-46f0-b2f0-ffb898549138&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Refresh token is successful and returns same token&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 2: Refresh token is successful and returns same token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst secretKey = Config.SECRET_JWT;\nconst old_token = jwt.sign({ erp: existingERP }, secretKey); // &lt;-- unexpired token\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;,\n    old_token: old_token\n};\n// act\nlet res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.token).to.exist;\nexpect(res.body.body.token).to.be.equal(old_token);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:300:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;ea83d957-a10c-4d0e-8210-ae0d98a379ab&quot;,&quot;parentUUID&quot;:&quot;7321a581-ba7d-46f0-b2f0-ffb898549138&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Refresh token is unsuccessful due to unregisted erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 3: Refresh token is unsuccessful due to unregisted erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    password: &#x27;123&#x27;,\n    old_token: \&quot;e.e.e\&quot; // &lt;-- token doesn&#x27;t matter if erp is unregistered\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;ERP not registered&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:318:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;51eec22a-8351-4404-9019-8ddc0b91d06c&quot;,&quot;parentUUID&quot;:&quot;7321a581-ba7d-46f0-b2f0-ffb898549138&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Refresh token is unsuccessful due to incorrect password&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 4: Refresh token is unsuccessful due to incorrect password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;incOrr3ct&#x27;, // &lt;-- incorrect password\n    old_token: \&quot;e.e.e\&quot; // &lt;-- token doesn&#x27;t matter if password is incorrect\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;Incorrect password&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:337:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;ad98e247-c16c-4456-9764-0e211827531f&quot;,&quot;parentUUID&quot;:&quot;7321a581-ba7d-46f0-b2f0-ffb898549138&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Refresh token is unsuccessful due to incorrect old token&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 5: Refresh token is unsuccessful due to incorrect old token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// This test performs the same if the token has a valid format, but is\n// signed for a different erp\n// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;,\n    old_token: \&quot;e.e.e\&quot; // &lt;-- incorrect token\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;TokenVerificationException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;Invalid Token&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:359:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;c0b2e795-7f78-4437-8c2f-a344d6933cbd&quot;,&quot;parentUUID&quot;:&quot;7321a581-ba7d-46f0-b2f0-ffb898549138&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Refresh token request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 6: Refresh token request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;,\n    token: \&quot;e.e.e\&quot; // &lt;-- a valid parameter name should be &#x27;old_token&#x27;\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;old_token&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a29f0ef6-02f7-454f-9293-a612a6c6c0f9&quot;,&quot;parentUUID&quot;:&quot;7321a581-ba7d-46f0-b2f0-ffb898549138&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a29f0ef6-02f7-454f-9293-a612a6c6c0f9&quot;],&quot;failures&quot;:[&quot;1fca1ed6-34c7-47d1-8f5c-6327adc96013&quot;,&quot;ea83d957-a10c-4d0e-8210-ae0d98a379ab&quot;,&quot;51eec22a-8351-4404-9019-8ddc0b91d06c&quot;,&quot;ad98e247-c16c-4456-9764-0e211827531f&quot;,&quot;c0b2e795-7f78-4437-8c2f-a344d6933cbd&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:68,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;dac17594-fb5e-4c84-aea5-b921bf5f2029&quot;,&quot;title&quot;:&quot;PATCH /auth/change-password&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Change password is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API PATCH /auth/change-password Scenario 1: Change password is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nlet app = this.app;\nconst data = {\n    erp: existingERP,\n    old_password,\n    new_password\n};\n// act\nlet res = await request(app).patch(`${baseRoute}/change-password`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// cleanup\ndata.old_password = new_password;\ndata.new_password = old_password;\nres = await request(app).patch(`${baseRoute}/change-password`).send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:403:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;fe98cee3-9311-474a-b10f-80edae2a0181&quot;,&quot;parentUUID&quot;:&quot;dac17594-fb5e-4c84-aea5-b921bf5f2029&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Change password is unsuccessful due to unregisted erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API PATCH /auth/change-password Scenario 2: Change password is unsuccessful due to unregisted erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    old_password,\n    new_password\n};\n// act\nconst res = await request(this.app).patch(`${baseRoute}/change-password`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;ERP not registered&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:427:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;f58e2e96-ea4f-425e-97b7-bdc555b9b8e8&quot;,&quot;parentUUID&quot;:&quot;dac17594-fb5e-4c84-aea5-b921bf5f2029&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Change password is unsuccessful due to incorrect old password&quot;,&quot;fullTitle&quot;:&quot;Authentication API PATCH /auth/change-password Scenario 3: Change password is unsuccessful due to incorrect old password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    old_password: &#x27;incOrr3ct&#x27;, // &lt;-- incorrect password\n    new_password\n};\n// act\nconst res = await request(this.app).patch(`${baseRoute}/change-password`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;Incorrect old password&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:446:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;6a152b18-ac4e-472f-8b7c-4d2e824911e1&quot;,&quot;parentUUID&quot;:&quot;dac17594-fb5e-4c84-aea5-b921bf5f2029&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Change password request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API PATCH /auth/change-password Scenario 6: Change password request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;, // &lt;-- a valid parameter name should be &#x27;old_password&#x27;\n    new_password\n};\n// act\nconst res = await request(this.app).patch(`${baseRoute}/change-password`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;old_password&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1121389f-358b-4584-a1c4-9ae54a1642fd&quot;,&quot;parentUUID&quot;:&quot;dac17594-fb5e-4c84-aea5-b921bf5f2029&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1121389f-358b-4584-a1c4-9ae54a1642fd&quot;],&quot;failures&quot;:[&quot;fe98cee3-9311-474a-b10f-80edae2a0181&quot;,&quot;f58e2e96-ea4f-425e-97b7-bdc555b9b8e8&quot;,&quot;6a152b18-ac4e-472f-8b7c-4d2e824911e1&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ff83a3be-5e81-49ae-856b-37caa4e58505&quot;,&quot;title&quot;:&quot;ENDPOINT /auth/forgot/&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9d6f5ac2-c0f3-4f9a-a3cf-22e5a85acb10&quot;,&quot;title&quot;:&quot;POST /send-otp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;POST /send-otp\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp \&quot;before all\&quot; hook in \&quot;POST /send-otp\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:469,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;decache(&#x27;../../src/server&#x27;);\nconst sendgrid = require(&#x27;../../src/utils/sendgrid.utils&#x27;);\nsendOTPEmailStub = sinon.stub(sendgrid, &#x27;sendOTPEmail&#x27;).callsFake((_, __) =&gt; {});\nconst authRepository = require(&#x27;../../src/repositories/auth.repository&#x27;);\ngenerateOTPStub = sinon.stub(authRepository, &#x27;generateOTP&#x27;).callsFake(() =&gt; otp);\napp = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cc460c3c-c4bc-46d5-a77e-3a24e867b5f1&quot;,&quot;parentUUID&quot;:&quot;9d6f5ac2-c0f3-4f9a-a3cf-22e5a85acb10&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;POST /send-otp\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp \&quot;after all\&quot; hook in \&quot;POST /send-otp\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sendOTPEmailStub.restore();\ngenerateOTPStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bdec3764-f79e-43d4-8301-3d1d90d9310a&quot;,&quot;parentUUID&quot;:&quot;9d6f5ac2-c0f3-4f9a-a3cf-22e5a85acb10&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Forgot password is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp Scenario 1: Forgot password is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP\n};\n    \n// act\nlet res = await request(app).post(`${baseRoute}/forgot/send-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;OTP generated and sent via email&#x27;);\nexpect(generateOTPStub.calledOnce).to.be.true;\nexpect(sendOTPEmailStub.calledOnce).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:504:42)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;c5c5f229-e6a5-4b39-bd61-f34b07ca5155&quot;,&quot;parentUUID&quot;:&quot;9d6f5ac2-c0f3-4f9a-a3cf-22e5a85acb10&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Forgot password is unsuccessful due to unregisted erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp Scenario 2: Forgot password is unsuccessful due to unregisted erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP // &lt;-- no account registered on this erp\n};\n    \n// act\nconst res = await request(app).post(`${baseRoute}/forgot/send-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;ERP not registered&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:521:42)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;eb6a97ea-d891-4402-aa9d-a498c3cfac55&quot;,&quot;parentUUID&quot;:&quot;9d6f5ac2-c0f3-4f9a-a3cf-22e5a85acb10&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Forgot password request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp Scenario 3: Forgot password request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    esrp: existingERP // &lt;-- a valid parameter name should be &#x27;erp&#x27;\n};\n    \n// act\nconst res = await request(app).post(`${baseRoute}/forgot/send-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3b7d52ef-5341-4e32-9a3a-3eb5e2fab88f&quot;,&quot;parentUUID&quot;:&quot;9d6f5ac2-c0f3-4f9a-a3cf-22e5a85acb10&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3b7d52ef-5341-4e32-9a3a-3eb5e2fab88f&quot;],&quot;failures&quot;:[&quot;c5c5f229-e6a5-4b39-bd61-f34b07ca5155&quot;,&quot;eb6a97ea-d891-4402-aa9d-a498c3cfac55&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:47,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9eb3fc0c-8597-4f5b-b9ee-372bfdac7efe&quot;,&quot;title&quot;:&quot;POST /verify-otp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Verify OTP is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 1: Verify OTP is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    otp\n};\n    \n// act\nlet res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;OTP verified succesfully&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:559:42)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;c4d321bf-2269-497d-bf27-cb9cabb1809a&quot;,&quot;parentUUID&quot;:&quot;9eb3fc0c-8597-4f5b-b9ee-372bfdac7efe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Verify OTP is unsuccessful due to invalid otp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 2: Verify OTP is unsuccessful due to invalid otp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst authRepository = require(&#x27;../../src/repositories/auth.repository&#x27;);\nawait authRepository.saveOTP(existingERP, otp, 1);\n\nconst data = {\n    erp: existingERP,\n    otp: 5678 // &lt;-- Invalid OTP code, should be &#x27;1234&#x27;\n};\n    \n// act\nconst res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;OTPVerificationException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;OTP verification failed&#x27;);\n// cleanup\nawait authRepository.removeExpiredOTP(existingERP);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error&quot;,&quot;estack&quot;:&quot;Database Error\n    at DatabaseService.#handleUnknownErrors (src\\db\\db-service.js:89:15)\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:78:38\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\n    at async OTPModel.create (src\\models\\otp.model.js:38:24)\n    at async AuthRepository.saveOTP (src\\repositories\\auth.repository.js:164:24)\n    at async Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:567:17)&quot;},&quot;uuid&quot;:&quot;e4077e2c-f1bc-4123-a103-f224d761607a&quot;,&quot;parentUUID&quot;:&quot;9eb3fc0c-8597-4f5b-b9ee-372bfdac7efe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Verify OTP is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 3: Verify OTP is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    otp: otp\n};\n    \n// act\nconst res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;OTPVerificationException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;No OTP found for this ERP&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:599:42)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;719b5cf1-3675-46a6-ae17-ecdd7549252a&quot;,&quot;parentUUID&quot;:&quot;9eb3fc0c-8597-4f5b-b9ee-372bfdac7efe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Verify OTP is unsuccessful due to expired otp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 4: Verify OTP is unsuccessful due to expired otp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst authRepository = require(&#x27;../../src/repositories/auth.repository&#x27;);\nawait authRepository.saveOTP(existingERP, otp, -1); // create expired otp\n\nconst data = {\n    erp: existingERP,\n    otp: otp\n};\n    \n// act\nconst res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;OTPExpiredException&#x27;);\n// cleanup\nawait authRepository.removeExpiredOTP(existingERP);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error&quot;,&quot;estack&quot;:&quot;Database Error\n    at DatabaseService.#handleUnknownErrors (src\\db\\db-service.js:89:15)\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:78:38\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\n    at async OTPModel.create (src\\models\\otp.model.js:38:24)\n    at async AuthRepository.saveOTP (src\\repositories\\auth.repository.js:164:24)\n    at async Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:609:17)&quot;},&quot;uuid&quot;:&quot;c4a6992a-1c96-4ad9-a49a-d1e53ac5d49e&quot;,&quot;parentUUID&quot;:&quot;9eb3fc0c-8597-4f5b-b9ee-372bfdac7efe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Verify OTP request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 5: Verify OTP request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    otp: &#x27;12345678&#x27; // &lt;-- otp should be 4 digits in length\n};\n    \n// act\nconst res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;otp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;59aa05fb-a991-4a3b-84d1-9ea3ce8a2a47&quot;,&quot;parentUUID&quot;:&quot;9eb3fc0c-8597-4f5b-b9ee-372bfdac7efe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;59aa05fb-a991-4a3b-84d1-9ea3ce8a2a47&quot;],&quot;failures&quot;:[&quot;c4d321bf-2269-497d-bf27-cb9cabb1809a&quot;,&quot;e4077e2c-f1bc-4123-a103-f224d761607a&quot;,&quot;719b5cf1-3675-46a6-ae17-ecdd7549252a&quot;,&quot;c4a6992a-1c96-4ad9-a49a-d1e53ac5d49e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:117,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;54ce0d5b-beef-409c-a874-78ae023a46bd&quot;,&quot;title&quot;:&quot;POST /reset-password&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Reset Password is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /reset-password Scenario 1: Reset Password is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst app = this.app;\nconst old_password = &#x27;123&#x27;;\nconst new_password = &#x27;256&#x27;;\nconst data = {\n    erp: existingERP,\n    new_password\n};\n    \n// act\nlet res = await request(app).patch(`${baseRoute}/forgot/reset-password`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Password reset successfully&#x27;);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// cleanup\ndata.new_password = old_password;\nres = await request(app).patch(`${baseRoute}/forgot/reset-password`).send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:664:42)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;472d031c-155a-47e6-b746-986d3e34e5b1&quot;,&quot;parentUUID&quot;:&quot;54ce0d5b-beef-409c-a874-78ae023a46bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Reset Password is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /reset-password Scenario 2: Reset Password is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    new_password: &#x27;---&#x27; // &lt;-- doesnn&#x27;t matter since if erp is unregistered\n};\n    \n// act\nconst res = await request(this.app).patch(`${baseRoute}/forgot/reset-password`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;ERP not registered&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:687:42)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;e3213c53-2e90-46cb-89a9-6097167cabfd&quot;,&quot;parentUUID&quot;:&quot;54ce0d5b-beef-409c-a874-78ae023a46bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Reset Password request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /reset-password Scenario 3: Reset Password request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;12345678&#x27; // &lt;-- correct paramter name should be &#x27;new_password&#x27;\n};\n    \n// act\nconst res = await request(this.app).patch(`${baseRoute}/forgot/reset-password`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;new_password&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;80470b52-9086-4123-ba29-67e895208ce0&quot;,&quot;parentUUID&quot;:&quot;54ce0d5b-beef-409c-a874-78ae023a46bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;80470b52-9086-4123-ba29-67e895208ce0&quot;],&quot;failures&quot;:[&quot;472d031c-155a-47e6-b746-986d3e34e5b1&quot;,&quot;e3213c53-2e90-46cb-89a9-6097167cabfd&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:80,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a9926011-3318-4438-8c3e-fd183040ead8&quot;,&quot;title&quot;:&quot;Campuses API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Campuses API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Campuses API \&quot;before each\&quot; hook in \&quot;Campuses API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a9eff5d0-a7bd-4fb9-9c8d-2bf363b68132&quot;,&quot;parentUUID&quot;:&quot;a9926011-3318-4438-8c3e-fd183040ead8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;99ded7bc-0e4f-4290-9424-4c1bdfc5b876&quot;,&quot;title&quot;:&quot;GET /campuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all campuses request successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses Scenario 1: Get all campuses request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;campus_id&#x27;, &#x27;campus&#x27;, &#x27;location_url&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:35:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;bb48c7b5-3550-4465-a3ba-c085a9ebc65e&quot;,&quot;parentUUID&quot;:&quot;99ded7bc-0e4f-4290-9424-4c1bdfc5b876&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all campuses request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses Scenario 2: Get all campuses request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:447,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst CampusModel = require(&#x27;../../src/models/campus.model&#x27;);\nconst modelStub = sinon.stub(CampusModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty campus list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campuses not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;83dac412-2bfb-4a52-b80d-0770eb9b8953&quot;,&quot;parentUUID&quot;:&quot;99ded7bc-0e4f-4290-9424-4c1bdfc5b876&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;bb48c7b5-3550-4465-a3ba-c085a9ebc65e&quot;,&quot;83dac412-2bfb-4a52-b80d-0770eb9b8953&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:454,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9907544b-38b7-456b-b419-e48a42dfde69&quot;,&quot;title&quot;:&quot;GET /campuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a campus request successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses/:id Scenario 1: Get a campus request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;campus_id&#x27;, &#x27;campus&#x27;, &#x27;location_url&#x27;]);\nexpect(resBody.campus_id).to.be.eql(existingCampus.campus_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:70:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;10607f3f-7c82-47ae-baf9-b2a006838de0&quot;,&quot;parentUUID&quot;:&quot;9907544b-38b7-456b-b419-e48a42dfde69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a campus request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses/:id Scenario 2: Get a campus request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownCampusId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:84:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;f057f75b-2d9e-439b-bfc7-f65edf2c3f20&quot;,&quot;parentUUID&quot;:&quot;9907544b-38b7-456b-b419-e48a42dfde69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a campus request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses/:id Scenario 3: Get a campus request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingCampus.campus_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;878053b8-6002-48dc-82b6-c275acbedd80&quot;,&quot;parentUUID&quot;:&quot;9907544b-38b7-456b-b419-e48a42dfde69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;878053b8-6002-48dc-82b6-c275acbedd80&quot;],&quot;failures&quot;:[&quot;10607f3f-7c82-47ae-baf9-b2a006838de0&quot;,&quot;f057f75b-2d9e-439b-bfc7-f65edf2c3f20&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;919350b4-9b43-475e-b80e-d141c31f327a&quot;,&quot;title&quot;:&quot;POST /campuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a campus request is successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API POST /campuses Scenario 1: Create a campus request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus, location_url };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;campus_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.campus_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    campus_id: newId,\n    campus: campus,\n    location_url: location_url\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:118:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;90683246-c6e4-4c55-b16b-62e767ed790c&quot;,&quot;parentUUID&quot;:&quot;919350b4-9b43-475e-b80e-d141c31f327a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a campus request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Campuses API POST /campuses Scenario 2: Create a campus request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    campuses: campus, // &lt;-- a valid parameter name should be &#x27;campus&#x27;\n    location_url: &#x27;https://maps.app.goo.gl/LvH61VeZZVfyggHw6&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;campus&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:157:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;193a80a5-4cae-4759-a274-f07a314dc2f8&quot;,&quot;parentUUID&quot;:&quot;919350b4-9b43-475e-b80e-d141c31f327a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a campus request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campuses API POST /campuses Scenario 3: Create a campus request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus, location_url };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:175:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;a130fab5-649a-4af8-a6b0-387a894a6e23&quot;,&quot;parentUUID&quot;:&quot;919350b4-9b43-475e-b80e-d141c31f327a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a campus request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campuses API POST /campuses Scenario 4: Create a campus request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus, location_url };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4235dd97-d1e1-4acd-83b4-7dd3d7fa0f78&quot;,&quot;parentUUID&quot;:&quot;919350b4-9b43-475e-b80e-d141c31f327a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4235dd97-d1e1-4acd-83b4-7dd3d7fa0f78&quot;],&quot;failures&quot;:[&quot;90683246-c6e4-4c55-b16b-62e767ed790c&quot;,&quot;193a80a5-4cae-4759-a274-f07a314dc2f8&quot;,&quot;a130fab5-649a-4af8-a6b0-387a894a6e23&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:41,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;5ac853ce-5f00-40bc-9166-c4731231ae6a&quot;,&quot;title&quot;:&quot;PATCH /campuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a campus request is successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 1: Update a campus request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus: newCampus };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    campus_id: existingCampus.campus_id,\n    campus: newCampus,\n    location_url: existingCampus.location_url\n});\n\n// cleanup\ndata.campus = existingCampus.campus;\nres = await request(app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:213:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;8884fbef-a760-49fb-a920-c35387688576&quot;,&quot;parentUUID&quot;:&quot;5ac853ce-5f00-40bc-9166-c4731231ae6a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a campus request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 2: Update a campus request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus: newCampus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownCampusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:251:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;77e9b911-3289-428d-b436-18cf217a0f04&quot;,&quot;parentUUID&quot;:&quot;5ac853ce-5f00-40bc-9166-c4731231ae6a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a campus request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 3: Update a campus request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    campuses: newCampus // &lt;-- an valid parameter name should be &#x27;campus&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectParams).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:270:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;6c56a285-0ed9-40e5-b402-2105ff50c926&quot;,&quot;parentUUID&quot;:&quot;5ac853ce-5f00-40bc-9166-c4731231ae6a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a campus request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 4: Update a campus request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus: newCampus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:288:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;8bcec86e-d3c0-4b86-8ca5-a7c9edafc02b&quot;,&quot;parentUUID&quot;:&quot;5ac853ce-5f00-40bc-9166-c4731231ae6a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a campus request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 5: Update a campus request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus: newCampus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f16e1c7d-91f4-4255-8d3e-1cf6491baa67&quot;,&quot;parentUUID&quot;:&quot;5ac853ce-5f00-40bc-9166-c4731231ae6a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f16e1c7d-91f4-4255-8d3e-1cf6491baa67&quot;],&quot;failures&quot;:[&quot;8884fbef-a760-49fb-a920-c35387688576&quot;,&quot;77e9b911-3289-428d-b436-18cf217a0f04&quot;,&quot;6c56a285-0ed9-40e5-b402-2105ff50c926&quot;,&quot;8bcec86e-d3c0-4b86-8ca5-a7c9edafc02b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:46,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1d02c1b7-accb-4c95-8f0a-83fadb6af0b8&quot;,&quot;title&quot;:&quot;DELETE /campuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a campus request is successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API DELETE /campuses/:id Scenario 1: Delete a campus request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { campus, location_url };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.campus_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:325:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;ce7a311f-0ee6-4519-bbd4-6af3139c8b39&quot;,&quot;parentUUID&quot;:&quot;1d02c1b7-accb-4c95-8f0a-83fadb6af0b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a campus request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campuses API DELETE /campuses/:id Scenario 2: Delete a campus request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownCampusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:357:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;87092ff3-402e-4fbe-9fc4-5a50c71a7e46&quot;,&quot;parentUUID&quot;:&quot;1d02c1b7-accb-4c95-8f0a-83fadb6af0b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a campus request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campuses API DELETE /campuses/:id Scenario 3: Delete a campus request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:370:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;561ff06e-998b-487d-ae13-9003f4a77342&quot;,&quot;parentUUID&quot;:&quot;1d02c1b7-accb-4c95-8f0a-83fadb6af0b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a campus request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campuses API DELETE /campuses/:id Scenario 4: Delete a campus request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingCampus.campus_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0650aaf9-ddfe-4120-9daf-0fc3a85327c0&quot;,&quot;parentUUID&quot;:&quot;1d02c1b7-accb-4c95-8f0a-83fadb6af0b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0650aaf9-ddfe-4120-9daf-0fc3a85327c0&quot;],&quot;failures&quot;:[&quot;ce7a311f-0ee6-4519-bbd4-6af3139c8b39&quot;,&quot;87092ff3-402e-4fbe-9fc4-5a50c71a7e46&quot;,&quot;561ff06e-998b-487d-ae13-9003f4a77342&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:44,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b3493234-d809-4e1a-8ac6-9505a79943a3&quot;,&quot;title&quot;:&quot;Campus Spots API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Campus Spots API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API \&quot;before each\&quot; hook in \&quot;Campus Spots API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;db72880b-8b75-4bb6-b138-37802369106c&quot;,&quot;parentUUID&quot;:&quot;b3493234-d809-4e1a-8ac6-9505a79943a3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;05d94e4d-abd8-497e-8d02-d96d86489202&quot;,&quot;title&quot;:&quot;GET /campus-spots&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all campus spots request successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots Scenario 1: Get all campus spots request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;campus_spot_id&#x27;, &#x27;campus_spot&#x27;, &#x27;campus_id&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:36:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;50b40767-1548-48b0-9aed-570a1568c2d2&quot;,&quot;parentUUID&quot;:&quot;05d94e4d-abd8-497e-8d02-d96d86489202&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all campus spots request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots Scenario 2: Get all campus spots request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:497,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst CampusSpotModel = require(&#x27;../../src/models/campusSpot.model&#x27;);\nconst modelStub = sinon.stub(CampusSpotModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty campus_spot list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spots not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;00d8c28b-c25d-4328-834e-792fbc4b59f0&quot;,&quot;parentUUID&quot;:&quot;05d94e4d-abd8-497e-8d02-d96d86489202&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;50b40767-1548-48b0-9aed-570a1568c2d2&quot;,&quot;00d8c28b-c25d-4328-834e-792fbc4b59f0&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:507,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;e139bfa1-3f30-48c5-8d6c-88d2baf5c11b&quot;,&quot;title&quot;:&quot;GET /campus-spots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a campus spot request successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots/:id Scenario 1: Get a campus spot request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;campus_spot_id&#x27;, &#x27;campus_spot&#x27;, &#x27;campus_id&#x27;]);\nexpect(resBody.campus_spot_id).to.be.equal(existingCampusSpot.campus_spot_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:71:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;5da16452-b7e8-4b1d-924f-75ec57e2b4e3&quot;,&quot;parentUUID&quot;:&quot;e139bfa1-3f30-48c5-8d6c-88d2baf5c11b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a campus spot request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots/:id Scenario 2: Get a campus spot request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownCampusSpotId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spot not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:85:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;50fef2ed-3bb2-418b-bdf4-26f07263035a&quot;,&quot;parentUUID&quot;:&quot;e139bfa1-3f30-48c5-8d6c-88d2baf5c11b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a campus spot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots/:id Scenario 3: Get a campus spot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingCampusSpot.campus_spot_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;73ef4144-f510-41b2-8ebb-124bbe3ad73d&quot;,&quot;parentUUID&quot;:&quot;e139bfa1-3f30-48c5-8d6c-88d2baf5c11b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;73ef4144-f510-41b2-8ebb-124bbe3ad73d&quot;],&quot;failures&quot;:[&quot;5da16452-b7e8-4b1d-924f-75ec57e2b4e3&quot;,&quot;50fef2ed-3bb2-418b-bdf4-26f07263035a&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b3f4af17-ad4b-438f-8efe-fd389cacafed&quot;,&quot;title&quot;:&quot;POST /campus-spots&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a campus spot request is successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 1: Create a campus spot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot, campus_id };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;campus_spot_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.campus_spot_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    campus_spot_id: newId,\n    campus_spot,\n    campus_id\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:119:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;b19b88a8-9a2d-41c9-b6c1-4051bbb17e34&quot;,&quot;parentUUID&quot;:&quot;b3f4af17-ad4b-438f-8efe-fd389cacafed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a campus spot request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 2: Create a campus spot request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot, campus_id: unknownCampusId }; // &lt;-- Non-existent campus_id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;campus_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:155:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;f0b61ce5-af64-4345-8eff-7f144af8d046&quot;,&quot;parentUUID&quot;:&quot;b3f4af17-ad4b-438f-8efe-fd389cacafed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a campus spot request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 3: Create a campus spot request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    campus_spots: campus_spot // &lt;-- a valid parameter name should be &#x27;campus_spot&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;campus_spot&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:174:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;2efe657f-21ff-4add-9683-3df83b30c9c6&quot;,&quot;parentUUID&quot;:&quot;b3f4af17-ad4b-438f-8efe-fd389cacafed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a campus spot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 4: Create a campus spot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot, campus_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:192:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;921a4e45-7f08-45e8-88c8-a2898b5e4627&quot;,&quot;parentUUID&quot;:&quot;b3f4af17-ad4b-438f-8efe-fd389cacafed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a campus spot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 5: Create a campus spot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot, campus_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;529d1f90-f1a6-4a47-ac0b-9594ee5f738a&quot;,&quot;parentUUID&quot;:&quot;b3f4af17-ad4b-438f-8efe-fd389cacafed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;529d1f90-f1a6-4a47-ac0b-9594ee5f738a&quot;],&quot;failures&quot;:[&quot;b19b88a8-9a2d-41c9-b6c1-4051bbb17e34&quot;,&quot;f0b61ce5-af64-4345-8eff-7f144af8d046&quot;,&quot;2efe657f-21ff-4add-9683-3df83b30c9c6&quot;,&quot;921a4e45-7f08-45e8-88c8-a2898b5e4627&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:58,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;02c9f017-bd24-4294-97d8-d4142cbd8ff6&quot;,&quot;title&quot;:&quot;PATCH /campus-spots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a campus spot request is successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 1: Update a campus spot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot: newCampusSpot };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    campus_spot_id: existingCampusSpot.campus_spot_id,\n    campus_id: existingCampusSpot.campus_id,\n    campus_spot: newCampusSpot\n});\n\n// cleanup\ndata.campus_spot = existingCampusSpot.campus_spot;\nres = await request(app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:230:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;6782cc86-a5cd-490f-a3bf-8400ce8339b8&quot;,&quot;parentUUID&quot;:&quot;02c9f017-bd24-4294-97d8-d4142cbd8ff6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a campus spot request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 2: Update a campus spot request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot: newCampusSpot };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownCampusSpotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spot not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:267:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;d8c5622f-13e9-48e3-8637-7e27c5df10f0&quot;,&quot;parentUUID&quot;:&quot;02c9f017-bd24-4294-97d8-d4142cbd8ff6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a campus spot request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 3: Update a campus spot request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    campus_spots: newCampusSpot // &lt;-- a valid parameter name should be &#x27;campus_spot&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;campus_spot&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:286:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;826d671e-2170-452a-9696-e78d4d12a1c9&quot;,&quot;parentUUID&quot;:&quot;02c9f017-bd24-4294-97d8-d4142cbd8ff6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a campus spot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 4: Update a campus spot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot: newCampusSpot };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:304:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;4f25801e-861c-4a49-8f06-73b6d7facbea&quot;,&quot;parentUUID&quot;:&quot;02c9f017-bd24-4294-97d8-d4142cbd8ff6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a campus spot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 5: Update a campus spot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot: newCampusSpot };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c159fb47-b1e6-401c-80ac-9947a57497e5&quot;,&quot;parentUUID&quot;:&quot;02c9f017-bd24-4294-97d8-d4142cbd8ff6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c159fb47-b1e6-401c-80ac-9947a57497e5&quot;],&quot;failures&quot;:[&quot;6782cc86-a5cd-490f-a3bf-8400ce8339b8&quot;,&quot;d8c5622f-13e9-48e3-8637-7e27c5df10f0&quot;,&quot;826d671e-2170-452a-9696-e78d4d12a1c9&quot;,&quot;4f25801e-861c-4a49-8f06-73b6d7facbea&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;54dcd635-c7df-41bd-909c-03a9bf4f2036&quot;,&quot;title&quot;:&quot;DELETE /campus-spots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a campus spot request is successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API DELETE /campus-spots/:id Scenario 1: Delete a campus spot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { campus_spot, campus_id };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.campus_spot_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spot has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:341:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;31339b16-cea0-4bb9-b3ab-83a1c1660364&quot;,&quot;parentUUID&quot;:&quot;54dcd635-c7df-41bd-909c-03a9bf4f2036&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a campus spot request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API DELETE /campus-spots/:id Scenario 2: Delete a campus spot request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownCampusSpotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spot not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:373:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;e8fd8930-db5b-4f69-8954-d8f97c95c186&quot;,&quot;parentUUID&quot;:&quot;54dcd635-c7df-41bd-909c-03a9bf4f2036&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a campus spot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API DELETE /campus-spots/:id Scenario 3: Delete a campus spot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:386:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;56ca35f7-0cc7-4178-8d43-a3a62386ba50&quot;,&quot;parentUUID&quot;:&quot;54dcd635-c7df-41bd-909c-03a9bf4f2036&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a campus spot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API DELETE /campus-spots/:id Scenario 4: Delete a campus spot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingCampusSpot.campus_spot_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1eebd983-d7d0-486a-bf09-14b06c8bd44e&quot;,&quot;parentUUID&quot;:&quot;54dcd635-c7df-41bd-909c-03a9bf4f2036&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1eebd983-d7d0-486a-bf09-14b06c8bd44e&quot;],&quot;failures&quot;:[&quot;31339b16-cea0-4bb9-b3ab-83a1c1660364&quot;,&quot;e8fd8930-db5b-4f69-8954-d8f97c95c186&quot;,&quot;56ca35f7-0cc7-4178-8d43-a3a62386ba50&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;4ec94abd-d5ef-4776-b812-72b3d719c2b1&quot;,&quot;title&quot;:&quot;Classes API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Classes API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Classes API \&quot;before each\&quot; hook in \&quot;Classes API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6c885b73-4b4c-45f8-9c55-151cde842119&quot;,&quot;parentUUID&quot;:&quot;4ec94abd-d5ef-4776-b812-72b3d719c2b1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;43c8af43-933e-42b9-a17f-04b631bd4f92&quot;,&quot;title&quot;:&quot;GET /classes&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all classes request successful&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 1: Get all classes request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingClass)); // contain all params\nconst exampleClass = resBody[0];\nexpect(exampleClass.classroom).to.not.be.undefined;\nexpect(exampleClass.classroom).to.include.all.keys(Object.keys(existingClass.classroom)); // contain all params\n\nexpect(exampleClass.classroom.campus).to.not.be.undefined;\nexpect(exampleClass.classroom.campus).to.include.all.keys(Object.keys(existingClass.classroom.campus)); // contain all params\nexpect(exampleClass.subject).to.not.be.undefined;\nexpect(exampleClass.subject).to.include.all.keys(Object.keys(existingClass.subject)); // contain all params\nexpect(exampleClass.teacher).to.not.be.undefined;\nexpect(exampleClass.teacher).to.include.all.keys(Object.keys(existingClass.teacher)); // contain all params\nexpect(exampleClass.timeslot_1).to.not.be.undefined;\nexpect(exampleClass.timeslot_1).to.include.all.keys(Object.keys(existingClass.timeslot_1)); // contain all params\nexpect(exampleClass.timeslot_2).to.not.be.undefined;\nexpect(exampleClass.timeslot_2).to.include.all.keys(Object.keys(existingClass.timeslot_2)); // contain all params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:73:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;b7991652-745a-4912-81e7-4759b8d6bf29&quot;,&quot;parentUUID&quot;:&quot;43c8af43-933e-42b9-a17f-04b631bd4f92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all classes request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 2: Get all classes request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst subject_code = &#x27;HUM201&#x27;;\nconst term_id = 2;\nlet res = await request(this.app)\n    .get(`${baseRoute}?term_id=${term_id}&amp;subject_code=${subject_code}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst termCheck = (t_id) =&gt; term_id === t_id;\nconst subjectCheck = (s_code) =&gt; subject_code === s_code;\nconst queryCheck = (classRow) =&gt; termCheck(classRow.term_id) &amp;&amp; subjectCheck(classRow.subject.subject_code);\nexpect(resBody.every(queryCheck)).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:109:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;11e8b695-019a-4162-bd12-911aecbffa73&quot;,&quot;parentUUID&quot;:&quot;43c8af43-933e-42b9-a17f-04b631bd4f92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all classes request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 3: Get all classes request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:550,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst PostModel = require(&#x27;../../src/models/class.model&#x27;);\nconst modelStub = sinon.stub(PostModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty class list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classes not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;1a4b575f-c372-4d96-a7ad-99e68a554cd7&quot;,&quot;parentUUID&quot;:&quot;43c8af43-933e-42b9-a17f-04b631bd4f92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all classes request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 4: Get all classes request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst term_id = &#x27;Spring 2021&#x27;; // &lt;-- invalid term_id value\nlet res = await request(this.app)\n    .get(`${baseRoute}?term_id=${term_id}&amp;campus=MAIN`) // &lt;-- `campus` is an incorrect query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;term_id&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:147:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;9cc50811-ebdb-49a1-afe5-ab7bfe92d58c&quot;,&quot;parentUUID&quot;:&quot;43c8af43-933e-42b9-a17f-04b631bd4f92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all classes request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 5: Get all classes request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c79560f9-f414-4fbb-9930-72658b42744f&quot;,&quot;parentUUID&quot;:&quot;43c8af43-933e-42b9-a17f-04b631bd4f92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c79560f9-f414-4fbb-9930-72658b42744f&quot;],&quot;failures&quot;:[&quot;b7991652-745a-4912-81e7-4759b8d6bf29&quot;,&quot;11e8b695-019a-4162-bd12-911aecbffa73&quot;,&quot;1a4b575f-c372-4d96-a7ad-99e68a554cd7&quot;,&quot;9cc50811-ebdb-49a1-afe5-ab7bfe92d58c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:586,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;5ee30e6d-de32-4006-8421-b067abc04656&quot;,&quot;title&quot;:&quot;GET /classes/:term_id/:class_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a class request successful&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes/:term_id/:class_erp Scenario 1: Get a class request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.class_erp).to.be.eql(existingClass.class_erp); // should match initially sent id\nexpect(resBody).to.include.all.keys(Object.keys(existingClass)); // contain all params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:178:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;61194807-9be3-4b8e-9bc2-8c69f1a345a5&quot;,&quot;parentUUID&quot;:&quot;5ee30e6d-de32-4006-8421-b067abc04656&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a class request is unsuccessful due to unknown class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes/:term_id/:class_erp Scenario 2: Get a class request is unsuccessful due to unknown class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}/${unknownClassERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:192:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;0d39b023-8544-414a-8ff0-a9e4f125113e&quot;,&quot;parentUUID&quot;:&quot;5ee30e6d-de32-4006-8421-b067abc04656&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a class request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes/:term_id/:class_erp Scenario 3: Get a class request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTermId}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:205:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;73a4cda7-9fc8-4b56-9c30-32edc4dfad40&quot;,&quot;parentUUID&quot;:&quot;5ee30e6d-de32-4006-8421-b067abc04656&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a class request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes/:term_id/:class_erp Scenario 3: Get a class request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${subRoute}/${existingClass.class_erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;50dca04e-37e5-4128-aeb8-9f4a176604a2&quot;,&quot;parentUUID&quot;:&quot;5ee30e6d-de32-4006-8421-b067abc04656&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;50dca04e-37e5-4128-aeb8-9f4a176604a2&quot;],&quot;failures&quot;:[&quot;61194807-9be3-4b8e-9bc2-8c69f1a345a5&quot;,&quot;0d39b023-8544-414a-8ff0-a9e4f125113e&quot;,&quot;73a4cda7-9fc8-4b56-9c30-32edc4dfad40&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:32,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f6d8f5a8-1a51-458d-b346-655be2d6c8b5&quot;,&quot;title&quot;:&quot;POST /classes&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a class request is successful&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 1: Create a class request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newClass };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = data.class_erp;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${data.term_id}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.class_erp).to.be.equal(newId);\nexpect(res.body.body.term_id).to.be.equal(data.term_id);\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${data.term_id}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:249:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;b44ddc2a-0cf7-4520-a662-4c158e10465c&quot;,&quot;parentUUID&quot;:&quot;f6d8f5a8-1a51-458d-b346-655be2d6c8b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a class request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 2: Create a class request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newClass };\ndelete data.term_id; // term_id is required\ndata.subject_code = &#x27;000&#x27;; // &lt;-- a valid subject code should be &#x27;XXX999&#x27;\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;term_id&#x27;, &#x27;subject_code&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:284:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;9e79a1af-fc70-4f33-8e3a-4159bd1b4840&quot;,&quot;parentUUID&quot;:&quot;f6d8f5a8-1a51-458d-b346-655be2d6c8b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a class request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 3: Create a class request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.term_id = unknownTermId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;term_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:303:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;00c161cc-1e17-4010-a77a-f21e1ad821f7&quot;,&quot;parentUUID&quot;:&quot;f6d8f5a8-1a51-458d-b346-655be2d6c8b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a class request is unsuccessful due to unknown subject_code&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 4: Create a class request is unsuccessful due to unknown subject_code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.subject_code = unknownSubjectCode; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;subject_code&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:321:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;7791cb2b-0d51-44d4-bef6-34fcd79ab32b&quot;,&quot;parentUUID&quot;:&quot;f6d8f5a8-1a51-458d-b346-655be2d6c8b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a class request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 5: Create a class request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.teacher_id = unknownTeacherId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;teacher_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:339:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;47f01b01-95a3-4087-9d05-99348cb24882&quot;,&quot;parentUUID&quot;:&quot;f6d8f5a8-1a51-458d-b346-655be2d6c8b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a class request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 6: Create a class request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.classroom_id = unknownClassroomId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;classroom_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:357:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;a1dc0677-0816-4b69-8124-43f571b79cf1&quot;,&quot;parentUUID&quot;:&quot;f6d8f5a8-1a51-458d-b346-655be2d6c8b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Create a class request is unsuccessful due to unknown timeslot_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 7: Create a class request is unsuccessful due to unknown timeslot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.timeslot_1 = unknownTimeslotId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;timeslot_1&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:375:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;0dddbe83-3129-462b-856c-806dd6d50a36&quot;,&quot;parentUUID&quot;:&quot;f6d8f5a8-1a51-458d-b346-655be2d6c8b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Create a class request is unsuccessful due to unknown parent_class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 8: Create a class request is unsuccessful due to unknown parent_class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.parent_class_erp = unknownClassERP; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;parent_class_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:393:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;5bb46450-ec26-4563-a4aa-3ab41ae9a5f0&quot;,&quot;parentUUID&quot;:&quot;f6d8f5a8-1a51-458d-b346-655be2d6c8b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Create a class request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 9: Create a class request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newClass };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:410:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;07aa331a-38ac-4fd8-a68e-10bf70e07add&quot;,&quot;parentUUID&quot;:&quot;f6d8f5a8-1a51-458d-b346-655be2d6c8b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Create a class request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 10: Create a class request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newClass };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2ba14dc2-374a-4004-b77d-fe1b6b687c21&quot;,&quot;parentUUID&quot;:&quot;f6d8f5a8-1a51-458d-b346-655be2d6c8b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2ba14dc2-374a-4004-b77d-fe1b6b687c21&quot;],&quot;failures&quot;:[&quot;b44ddc2a-0cf7-4520-a662-4c158e10465c&quot;,&quot;9e79a1af-fc70-4f33-8e3a-4159bd1b4840&quot;,&quot;00c161cc-1e17-4010-a77a-f21e1ad821f7&quot;,&quot;7791cb2b-0d51-44d4-bef6-34fcd79ab32b&quot;,&quot;47f01b01-95a3-4087-9d05-99348cb24882&quot;,&quot;a1dc0677-0816-4b69-8124-43f571b79cf1&quot;,&quot;0dddbe83-3129-462b-856c-806dd6d50a36&quot;,&quot;5bb46450-ec26-4563-a4aa-3ab41ae9a5f0&quot;,&quot;07aa331a-38ac-4fd8-a68e-10bf70e07add&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:85,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a9accbf0-307a-4568-9b98-c1b0288c4c82&quot;,&quot;title&quot;:&quot;POST /classes/bulk&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;POST /classes/bulk\&quot;&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk \&quot;before each\&quot; hook in \&quot;POST /classes/bulk\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;newClasses = [\n    {\n        class_erp: &#x27;8996&#x27;,\n        semester: \&quot;CS-3\&quot;,\n        classroom_id: 1,\n        subject_code: \&quot;CSE555\&quot;,\n        teacher_id: 5,\n        timeslot_1: 2,\n        timeslot_2: 2,\n        day_1: \&quot;monday\&quot;,\n        day_2: \&quot;wednesday\&quot;,\n        term_id: 1,\n        parent_class_erp: \&quot;\&quot;\n    },\n    {\n        class_erp: &#x27;8997&#x27;,\n        semester: \&quot;CS-3\&quot;,\n        classroom_id: 4,\n        subject_code: \&quot;CSE555\&quot;,\n        teacher_id: 5,\n        timeslot_1: 3,\n        timeslot_2: 3,\n        day_1: \&quot;monday\&quot;,\n        day_2: \&quot;wednesday\&quot;,\n        term_id: 1,\n        parent_class_erp: \&quot;8996\&quot;\n    },\n    {\n        class_erp: &#x27;8998&#x27;,\n        semester: \&quot;ACF-2\&quot;,\n        classroom_id: 3,\n        subject_code: \&quot;HUM201\&quot;,\n        teacher_id: 1,\n        timeslot_1: 2,\n        timeslot_2: 2,\n        day_1: \&quot;tuesday\&quot;,\n        day_2: \&quot;thursday\&quot;,\n        term_id: 1,\n        parent_class_erp: \&quot;\&quot;\n    },\n    {\n        class_erp: &#x27;8999&#x27;,\n        semester: \&quot;ECO-2\&quot;,\n        classroom_id: 5,\n        subject_code: \&quot;HUM201\&quot;,\n        teacher_id: 2,\n        timeslot_1: 2,\n        timeslot_2: 2,\n        day_1: \&quot;tuesday\&quot;,\n        day_2: \&quot;thursday\&quot;,\n        term_id: 1,\n        parent_class_erp: \&quot;\&quot;\n    }\n];&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;40f877f7-95e0-4c55-99ec-af9fa1ac474e&quot;,&quot;parentUUID&quot;:&quot;a9accbf0-307a-4568-9b98-c1b0288c4c82&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create many classes request is successful&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 1: Create many classes request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classes: [...newClasses] };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(newClasses.length); // as many affected as classes sent\nconst term_id = data.classes[0].term_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}?term_id=${term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nconst classERPs = data.classes.map(classRow =&gt; (classRow.class_erp));\nconst responseERPs = res.body.body.map(classRow =&gt; (classRow.class_erp));\nexpect(responseERPs).to.include.all.members(classERPs);\n// cleanup\nfor (const class_erp of classERPs.reverse()) { // reversing so that FK references get removed first\n    res = await request(app)\n        .delete(`${baseRoute}/${term_id}/${class_erp}`)\n        .auth(adminToken, { type: &#x27;bearer&#x27; });\n    expect(res.status).to.be.equal(200);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:506:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;26c27744-640d-4d2c-8783-b42f7bcbe995&quot;,&quot;parentUUID&quot;:&quot;a9accbf0-307a-4568-9b98-c1b0288c4c82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create many classes request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 2: Create many classes request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classes: [...newClasses] };\ndelete data.classes[0].term_id; // term_id is required\ndata.classes[0].subject_code = &#x27;000&#x27;; // &lt;-- a valid subject code should be &#x27;XXX999&#x27;\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param.split(&#x27;.&#x27;)[1]));\nexpect(incorrectParams).to.include.all.members([&#x27;term_id&#x27;, &#x27;subject_code&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:544:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;43296a1d-9256-47c9-9a15-8907a955f08f&quot;,&quot;parentUUID&quot;:&quot;a9accbf0-307a-4568-9b98-c1b0288c4c82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create many classes request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 3: Create many classes request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].term_id = unknownTermId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;term_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:563:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;3bda11af-d91d-486a-9253-82b59eb08bb7&quot;,&quot;parentUUID&quot;:&quot;a9accbf0-307a-4568-9b98-c1b0288c4c82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create many classes request is unsuccessful due to unknown subject_code&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 4: Create many classes request is unsuccessful due to unknown subject_code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].subject_code = unknownSubjectCode; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;subject_code&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:581:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;f76e1022-c58a-4e8c-9679-9f86c6257007&quot;,&quot;parentUUID&quot;:&quot;a9accbf0-307a-4568-9b98-c1b0288c4c82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create many classes request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 5: Create many classes request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].teacher_id = unknownTeacherId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;teacher_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:599:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;016c4dbe-2050-4393-b25b-0a1f9120d87a&quot;,&quot;parentUUID&quot;:&quot;a9accbf0-307a-4568-9b98-c1b0288c4c82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create many classes request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 6: Create many classes request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].classroom_id = unknownClassroomId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;classroom_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:617:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;8e24a1ad-ce7e-420c-ae3d-794c40d172b2&quot;,&quot;parentUUID&quot;:&quot;a9accbf0-307a-4568-9b98-c1b0288c4c82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Create many classes request is unsuccessful due to unknown timeslot_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 7: Create many classes request is unsuccessful due to unknown timeslot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].timeslot_1 = unknownTimeslotId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;timeslot_1&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:635:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;179b7808-756e-416b-83c2-9906f7de1b4a&quot;,&quot;parentUUID&quot;:&quot;a9accbf0-307a-4568-9b98-c1b0288c4c82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Create many classes request is unsuccessful due to unknown parent_class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 8: Create many classes request is unsuccessful due to unknown parent_class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].parent_class_erp = unknownClassERP; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;parent_class_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:653:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;a06dac3b-29c4-4a85-8bb8-a712edc5ab98&quot;,&quot;parentUUID&quot;:&quot;a9accbf0-307a-4568-9b98-c1b0288c4c82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Create many classes request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 9: Create many classes request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:670:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;d5e024db-a87c-45e0-813b-233b8288a3a0&quot;,&quot;parentUUID&quot;:&quot;a9accbf0-307a-4568-9b98-c1b0288c4c82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Create many classes request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 10: Create many classes request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9a27194c-d1f5-439b-9ffb-3fc9f74a8eb6&quot;,&quot;parentUUID&quot;:&quot;a9accbf0-307a-4568-9b98-c1b0288c4c82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9a27194c-d1f5-439b-9ffb-3fc9f74a8eb6&quot;],&quot;failures&quot;:[&quot;26c27744-640d-4d2c-8783-b42f7bcbe995&quot;,&quot;43296a1d-9256-47c9-9a15-8907a955f08f&quot;,&quot;3bda11af-d91d-486a-9253-82b59eb08bb7&quot;,&quot;f76e1022-c58a-4e8c-9679-9f86c6257007&quot;,&quot;016c4dbe-2050-4393-b25b-0a1f9120d87a&quot;,&quot;8e24a1ad-ce7e-420c-ae3d-794c40d172b2&quot;,&quot;179b7808-756e-416b-83c2-9906f7de1b4a&quot;,&quot;a06dac3b-29c4-4a85-8bb8-a712edc5ab98&quot;,&quot;d5e024db-a87c-45e0-813b-233b8288a3a0&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:71,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;703e2dc6-c587-4591-914e-e6b8c5100e71&quot;,&quot;title&quot;:&quot;PATCH /classes/:term_id/:class_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a class request is successful&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 1: Update a class request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.classroom.classroom_id).to.be.equal(newClassroom);\n\n// cleanup\ndata.classroom_id = existingClass.classroom.classroom_id;\nres = await request(app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:709:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;f72d8e34-53a6-48f1-a9a3-0d0a66d23ed3&quot;,&quot;parentUUID&quot;:&quot;703e2dc6-c587-4591-914e-e6b8c5100e71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a class request is unsuccessful due to unknown class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 2: Update a class request is unsuccessful due to unknown class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${unknownClassERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:742:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;2ed03a00-06a1-4cb8-9293-6b6d5bdbc67d&quot;,&quot;parentUUID&quot;:&quot;703e2dc6-c587-4591-914e-e6b8c5100e71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a class request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 3: Update a class request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTermId}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:759:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;fee72b95-2ccd-461d-9b1e-27223504d62b&quot;,&quot;parentUUID&quot;:&quot;703e2dc6-c587-4591-914e-e6b8c5100e71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a class request is unsuccessful due to unknown subject_code&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 4: Update a class request is unsuccessful due to unknown subject_code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject_code: unknownSubjectCode };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;subject_code&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:776:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;3948ae64-ab99-46b8-bba1-cd5f71c30d0c&quot;,&quot;parentUUID&quot;:&quot;703e2dc6-c587-4591-914e-e6b8c5100e71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a class request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 5: Update a class request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { teacher_id: unknownTeacherId };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;teacher_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:793:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;5704f96f-f155-44b4-8fbd-6f7966433ce9&quot;,&quot;parentUUID&quot;:&quot;703e2dc6-c587-4591-914e-e6b8c5100e71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a class request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 6: Update a class request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: unknownClassroomId };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;classroom_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:810:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;2d4680c8-f540-4c28-8b0b-21931062deb2&quot;,&quot;parentUUID&quot;:&quot;703e2dc6-c587-4591-914e-e6b8c5100e71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Update a class request is unsuccessful due to unknown timeslot_id&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 7: Update a class request is unsuccessful due to unknown timeslot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { timeslot_1: unknownTimeslotId };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;timeslot_1&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:827:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;80bc89ad-20f9-4af4-96d6-9d6fa909819b&quot;,&quot;parentUUID&quot;:&quot;703e2dc6-c587-4591-914e-e6b8c5100e71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Update a class request is unsuccessful due to unknown parent_class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 8: Update a class request is unsuccessful due to unknown parent_class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { parent_class_erp: unknownClassERP };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;parent_class_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:844:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;0b8f1b9b-e759-4780-8be6-8bce6798872a&quot;,&quot;parentUUID&quot;:&quot;703e2dc6-c587-4591-914e-e6b8c5100e71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Update a class request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 9: Update a class request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    classroom: newClassroom, // &lt;-- an valid parameter name should be &#x27;classroom_id&#x27;\n    subject_code: &#x27;123&#x27; // &lt;-- a valid &#x27;subject_code&#x27; follows format &#x27;XXX999&#x27; only\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;subject_code&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:864:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;ae3cd66e-a447-479b-a3ea-254c04e1b66e&quot;,&quot;parentUUID&quot;:&quot;703e2dc6-c587-4591-914e-e6b8c5100e71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Update a class request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 10: Update a class request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\n\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change classes\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:884:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;acc9c20b-af62-42db-b39d-ac2922c644a8&quot;,&quot;parentUUID&quot;:&quot;703e2dc6-c587-4591-914e-e6b8c5100e71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 11: Update a class request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 11: Update a class request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6da9d6e1-54e5-49a6-9c69-b152e6f3b932&quot;,&quot;parentUUID&quot;:&quot;703e2dc6-c587-4591-914e-e6b8c5100e71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6da9d6e1-54e5-49a6-9c69-b152e6f3b932&quot;],&quot;failures&quot;:[&quot;f72d8e34-53a6-48f1-a9a3-0d0a66d23ed3&quot;,&quot;2ed03a00-06a1-4cb8-9293-6b6d5bdbc67d&quot;,&quot;fee72b95-2ccd-461d-9b1e-27223504d62b&quot;,&quot;3948ae64-ab99-46b8-bba1-cd5f71c30d0c&quot;,&quot;5704f96f-f155-44b4-8fbd-6f7966433ce9&quot;,&quot;2d4680c8-f540-4c28-8b0b-21931062deb2&quot;,&quot;80bc89ad-20f9-4af4-96d6-9d6fa909819b&quot;,&quot;0b8f1b9b-e759-4780-8be6-8bce6798872a&quot;,&quot;ae3cd66e-a447-479b-a3ea-254c04e1b66e&quot;,&quot;acc9c20b-af62-42db-b39d-ac2922c644a8&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:80,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;42373d05-658f-47a1-b9fd-311d2f5e2382&quot;,&quot;title&quot;:&quot;DELETE /classes/:term_id/:class_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a subject request is successful&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 1: Delete a subject request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { ...newClass };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = data.class_erp;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${subRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${subRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:932:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;71f45148-b6f9-4769-8ae2-cf1d9ac341c2&quot;,&quot;parentUUID&quot;:&quot;42373d05-658f-47a1-b9fd-311d2f5e2382&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a subject request is unsuccessful due to unknown class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 2: Delete a subject request is unsuccessful due to unknown class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${subRoute}/${unknownClassERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:964:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;6e0024a4-6c3b-4b44-aea9-d58d67fa07fd&quot;,&quot;parentUUID&quot;:&quot;42373d05-658f-47a1-b9fd-311d2f5e2382&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a subject request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 3: Delete a subject request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTermId}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:977:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;15fc107c-ad30-420a-92b3-ae6bea4a1a92&quot;,&quot;parentUUID&quot;:&quot;42373d05-658f-47a1-b9fd-311d2f5e2382&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 4: Delete a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:990:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;2503fd4b-550e-4253-9f47-4bb2b772f234&quot;,&quot;parentUUID&quot;:&quot;42373d05-658f-47a1-b9fd-311d2f5e2382&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 5: Delete a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${subRoute}/${existingClass.class_erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bbabd5dc-bba1-40e7-929f-0a72e6b5da9b&quot;,&quot;parentUUID&quot;:&quot;42373d05-658f-47a1-b9fd-311d2f5e2382&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bbabd5dc-bba1-40e7-929f-0a72e6b5da9b&quot;],&quot;failures&quot;:[&quot;71f45148-b6f9-4769-8ae2-cf1d9ac341c2&quot;,&quot;6e0024a4-6c3b-4b44-aea9-d58d67fa07fd&quot;,&quot;15fc107c-ad30-420a-92b3-ae6bea4a1a92&quot;,&quot;2503fd4b-550e-4253-9f47-4bb2b772f234&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:34,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ecea6ef4-8caf-4ffe-ab65-4d56083a1020&quot;,&quot;title&quot;:&quot;Classrooms API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Classrooms API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Classrooms API \&quot;before each\&quot; hook in \&quot;Classrooms API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d1bbe94c-e946-4719-8d4d-b2450dfaa35a&quot;,&quot;parentUUID&quot;:&quot;ecea6ef4-8caf-4ffe-ab65-4d56083a1020&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;288cf867-cd5b-4358-a6cf-57c84c6c1d1e&quot;,&quot;title&quot;:&quot;GET /classrooms&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all classrooms request successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms Scenario 1: Get all classrooms request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingClassroom));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:36:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;a97c054f-2f43-4431-8073-f51d9717b3b6&quot;,&quot;parentUUID&quot;:&quot;288cf867-cd5b-4358-a6cf-57c84c6c1d1e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all classrooms request unsuccessful due to zero classrooms&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms Scenario 2: Get all classrooms request unsuccessful due to zero classrooms&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:604,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ClassroomModel = require(&#x27;../../src/models/classroom.model&#x27;);\nconst modelStub = sinon.stub(ClassroomModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty classroom list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classrooms not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;6d20d752-1bd1-47c7-8479-e53a46fb6f67&quot;,&quot;parentUUID&quot;:&quot;288cf867-cd5b-4358-a6cf-57c84c6c1d1e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms Scenario 3: Get a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:70:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;e2635710-80fb-4fd8-a156-cf2aecb546df&quot;,&quot;parentUUID&quot;:&quot;288cf867-cd5b-4358-a6cf-57c84c6c1d1e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all classrooms request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms Scenario 4: Get all classrooms request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f8a61c51-1cab-400b-83c1-1ddfc8ad884c&quot;,&quot;parentUUID&quot;:&quot;288cf867-cd5b-4358-a6cf-57c84c6c1d1e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f8a61c51-1cab-400b-83c1-1ddfc8ad884c&quot;],&quot;failures&quot;:[&quot;a97c054f-2f43-4431-8073-f51d9717b3b6&quot;,&quot;6d20d752-1bd1-47c7-8479-e53a46fb6f67&quot;,&quot;e2635710-80fb-4fd8-a156-cf2aecb546df&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:626,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c72512f1-88f5-4779-abb7-49a433526c38&quot;,&quot;title&quot;:&quot;GET /classrooms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a classroom request successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms/:id Scenario 1: Get a classroom request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingClassroom));\nexpect(resBody.classroom_id).to.be.equal(existingClassroom.classroom_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:96:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;5a0d924b-88f1-4f52-b2fe-2f4b27e8adf1&quot;,&quot;parentUUID&quot;:&quot;c72512f1-88f5-4779-abb7-49a433526c38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms/:id Scenario 2: Get a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownClassroomId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classroom not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:110:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;2f0af23d-bd91-48bb-ba38-ed7b1c74aa13&quot;,&quot;parentUUID&quot;:&quot;c72512f1-88f5-4779-abb7-49a433526c38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms/:id Scenario 3: Get a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:123:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;55ad15b0-4399-4dff-bca1-093e766742d2&quot;,&quot;parentUUID&quot;:&quot;c72512f1-88f5-4779-abb7-49a433526c38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a classroom request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms/:id Scenario 4: Get a classroom request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingClassroom.classroom_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;63894ca2-fae3-498f-a1af-237d8a0580f6&quot;,&quot;parentUUID&quot;:&quot;c72512f1-88f5-4779-abb7-49a433526c38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;63894ca2-fae3-498f-a1af-237d8a0580f6&quot;],&quot;failures&quot;:[&quot;5a0d924b-88f1-4f52-b2fe-2f4b27e8adf1&quot;,&quot;2f0af23d-bd91-48bb-ba38-ed7b1c74aa13&quot;,&quot;55ad15b0-4399-4dff-bca1-093e766742d2&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:28,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;60d3531d-3979-475b-ac43-f9e99ec23757&quot;,&quot;title&quot;:&quot;POST /classrooms&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a classroom request is successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 1: Create a classroom request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom, campus_id };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;classroom_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.classroom_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    classroom_id: newId,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:157:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;d657cba1-d05b-4095-aaec-46e67d6c90ed&quot;,&quot;parentUUID&quot;:&quot;60d3531d-3979-475b-ac43-f9e99ec23757&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a classroom request is unsuccessful due to unknown campus_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 2: Create a classroom request is unsuccessful due to unknown campus_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom, campus_id: unknownCampusId };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;campus_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:192:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;18894621-e2d7-4c9b-a8e3-7420b98c4a91&quot;,&quot;parentUUID&quot;:&quot;60d3531d-3979-475b-ac43-f9e99ec23757&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a classroom request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 3: Create a classroom request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    classrooms: classroom, // &lt;-- a valid parameter name is &#x27;classroom&#x27;\n    campus_id\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;classroom&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:212:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;db5bacac-e1b0-4027-93b6-75daabd7a73a&quot;,&quot;parentUUID&quot;:&quot;60d3531d-3979-475b-ac43-f9e99ec23757&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 4: Create a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom, campus_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:230:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;946a21f7-62b8-4030-92ca-727c2f8f36ba&quot;,&quot;parentUUID&quot;:&quot;60d3531d-3979-475b-ac43-f9e99ec23757&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a classroom request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 5: Create a classroom request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom, campus_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;47546a71-7b33-4f60-ba91-fac01ccb8655&quot;,&quot;parentUUID&quot;:&quot;60d3531d-3979-475b-ac43-f9e99ec23757&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;47546a71-7b33-4f60-ba91-fac01ccb8655&quot;],&quot;failures&quot;:[&quot;d657cba1-d05b-4095-aaec-46e67d6c90ed&quot;,&quot;18894621-e2d7-4c9b-a8e3-7420b98c4a91&quot;,&quot;db5bacac-e1b0-4027-93b6-75daabd7a73a&quot;,&quot;946a21f7-62b8-4030-92ca-727c2f8f36ba&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:58,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;2a7bdea4-4c5c-4319-b305-c82a04d40d90&quot;,&quot;title&quot;:&quot;PATCH /classrooms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a classroom request is successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 1: Update a classroom request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom: newClassroomName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    classroom_id: existingClassroom.classroom_id,\n    classroom: newClassroomName,\n    campus_id: existingClassroom.campus_id\n});\n\n// cleanup\ndata.classroom = existingClassroom.classroom;\nres = await request(app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:268:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;afe9695d-ff4f-4159-b26c-9cc69a26f3c1&quot;,&quot;parentUUID&quot;:&quot;2a7bdea4-4c5c-4319-b305-c82a04d40d90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 2: Update a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom: newClassroomName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownClassroomId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classroom not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:306:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;2792f47d-5c6b-4d5f-be81-ba2b3ab3ca71&quot;,&quot;parentUUID&quot;:&quot;2a7bdea4-4c5c-4319-b305-c82a04d40d90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a classroom request is unsuccessful due to unknown campus_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 3: Update a classroom request is unsuccessful due to unknown campus_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_id: unknownCampusId };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;campus_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:323:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;7ef8689e-4376-4566-b937-fa28811b1bd2&quot;,&quot;parentUUID&quot;:&quot;2a7bdea4-4c5c-4319-b305-c82a04d40d90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a classroom request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 4: Update a classroom request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    classrooms: newClassroomName // &lt;-- a invalid update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:342:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;5b0a3933-bcf6-403d-8293-66ff6e09b4b0&quot;,&quot;parentUUID&quot;:&quot;2a7bdea4-4c5c-4319-b305-c82a04d40d90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 5: Update a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom: newClassroomName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:360:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;3c3dc181-be8f-454c-b85b-32890b6ae119&quot;,&quot;parentUUID&quot;:&quot;2a7bdea4-4c5c-4319-b305-c82a04d40d90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a classroom request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 6: Update a classroom request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom: newClassroomName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;945047b6-8e5d-46f3-9df6-b8af856bba67&quot;,&quot;parentUUID&quot;:&quot;2a7bdea4-4c5c-4319-b305-c82a04d40d90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;945047b6-8e5d-46f3-9df6-b8af856bba67&quot;],&quot;failures&quot;:[&quot;afe9695d-ff4f-4159-b26c-9cc69a26f3c1&quot;,&quot;2792f47d-5c6b-4d5f-be81-ba2b3ab3ca71&quot;,&quot;7ef8689e-4376-4566-b937-fa28811b1bd2&quot;,&quot;5b0a3933-bcf6-403d-8293-66ff6e09b4b0&quot;,&quot;3c3dc181-be8f-454c-b85b-32890b6ae119&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:65,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;e6bc0593-51b3-4482-96d7-96f794f83e2b&quot;,&quot;title&quot;:&quot;DELETE /classrooms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a classroom request is successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API DELETE /classrooms/:id Scenario 1: Delete a classroom request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { classroom, campus_id };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.classroom_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classroom has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:397:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;527f2027-6149-4a95-9790-e47e8e875c84&quot;,&quot;parentUUID&quot;:&quot;e6bc0593-51b3-4482-96d7-96f794f83e2b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API DELETE /classrooms/:id Scenario 2: Delete a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownClassroomId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classroom not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:429:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;fb28ff51-63f9-4eb0-9e32-78e89bce7170&quot;,&quot;parentUUID&quot;:&quot;e6bc0593-51b3-4482-96d7-96f794f83e2b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API DELETE /classrooms/:id Scenario 3: Delete a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:442:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;7b19ad7d-8381-4974-9804-8664c7f44957&quot;,&quot;parentUUID&quot;:&quot;e6bc0593-51b3-4482-96d7-96f794f83e2b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a classroom request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API DELETE /classrooms/:id Scenario 4: Delete a classroom request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingClassroom.classroom_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;05892a45-4923-4430-8e48-eabb652e3214&quot;,&quot;parentUUID&quot;:&quot;e6bc0593-51b3-4482-96d7-96f794f83e2b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;05892a45-4923-4430-8e48-eabb652e3214&quot;],&quot;failures&quot;:[&quot;527f2027-6149-4a95-9790-e47e8e875c84&quot;,&quot;fb28ff51-63f9-4eb0-9e32-78e89bce7170&quot;,&quot;7b19ad7d-8381-4974-9804-8664c7f44957&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:49,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c5e7a9fa-155c-4c23-92e9-cf426b10772c&quot;,&quot;title&quot;:&quot;Hangout requests API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Hangout requests API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API \&quot;before each\&quot; hook in \&quot;Hangout requests API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8945d5e0-c310-4e1a-8f97-340c7a8d5a3f&quot;,&quot;parentUUID&quot;:&quot;c5e7a9fa-155c-4c23-92e9-cf426b10772c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;61413496-d4dc-4ee8-8ab1-612b979ea46e&quot;,&quot;title&quot;:&quot;GET /hangout-requests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all hangout requests is successful (Sent)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 1: Get all hangout requests is successful (Sent)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // userToken.erp === sender_erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = hangoutRequest =&gt; hangoutRequest.sender.erp === sender_erp;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([\n    &#x27;hangout_request_id&#x27;,\n    &#x27;sender&#x27;,\n    &#x27;receiver&#x27;,\n    &#x27;purpose&#x27;,\n    &#x27;request_status&#x27;,\n    &#x27;meetup_at&#x27;,\n    &#x27;meetup_spot_id&#x27;,\n    &#x27;accepted_at&#x27;\n]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingHangoutRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingHangoutRequest.receiver));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:58:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;b0947d8a-a55d-4884-9d18-635d8e69b619&quot;,&quot;parentUUID&quot;:&quot;61413496-d4dc-4ee8-8ab1-612b979ea46e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all hangout requests is successful (Receiver)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 2: Get all hangout requests is successful (Receiver)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = adminERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?receiver_erp=${receiver_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // adminToken.erp === receiver_erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = hangoutRequest =&gt; hangoutRequest.receiver.erp === receiver_erp;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([\n    &#x27;hangout_request_id&#x27;,\n    &#x27;sender&#x27;,\n    &#x27;receiver&#x27;,\n    &#x27;purpose&#x27;,\n    &#x27;request_status&#x27;,\n    &#x27;meetup_at&#x27;,\n    &#x27;meetup_spot_id&#x27;,\n    &#x27;accepted_at&#x27;\n]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingHangoutRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingHangoutRequest.receiver));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:88:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;11884a8e-e8b3-4dd4-9f92-2c9f9893d9fc&quot;,&quot;parentUUID&quot;:&quot;61413496-d4dc-4ee8-8ab1-612b979ea46e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all hangout requests unsuccessful due to no (sent) hangout requests&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 3: Get all hangout requests unsuccessful due to no (sent) hangout requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = user2ERP;\nconst fakeToken = jwt.sign({erp: sender_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}`)\n    .auth(fakeToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:119:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;cf5dc51e-5ba9-449b-ab09-eae993ac6155&quot;,&quot;parentUUID&quot;:&quot;61413496-d4dc-4ee8-8ab1-612b979ea46e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all hangout requests unsuccessful due to no (received) hangout requests&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 4: Get all hangout requests unsuccessful due to no (received) hangout requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = user2ERP;\nconst fakeToken = jwt.sign({erp: receiver_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?receiver_erp=${receiver_erp}`)\n    .auth(fakeToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:134:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;e77235a5-c77d-46ac-ac3f-3bcb3b864a29&quot;,&quot;parentUUID&quot;:&quot;61413496-d4dc-4ee8-8ab1-612b979ea46e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all hangout requests is incorrect due to multiple query params&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 5: Get all hangout requests is incorrect due to multiple query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\nconst receiver_erp = user2ERP;\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}&amp;receiver_erp=${receiver_erp}`) // &lt;-- can&#x27;t specify both sender_erp and receiver_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;receiver_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Can\\&#x27;t specify both sender and receiver erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:149:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;614ffe86-e39b-487b-b328-367ea250eea3&quot;,&quot;parentUUID&quot;:&quot;61413496-d4dc-4ee8-8ab1-612b979ea46e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get all hangout requests is incorrect due to no query params&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 6: Get all hangout requests is incorrect due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}`) // &lt;-- either specify sender_erp or receiver_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Either sender or receiver erp is required&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:165:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;1ba7647f-80d6-4d04-915c-dd6025f4d54b&quot;,&quot;parentUUID&quot;:&quot;61413496-d4dc-4ee8-8ab1-612b979ea46e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Get all hangout requests is incorrect due to unknown query params&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 7: Get all hangout requests is incorrect due to unknown query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = &#x27;123&#x27;; // a valid erp is 5 digits\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}&amp;request_status=accepted`) // &lt;-- &#x27;request_status&#x27; is invalid query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;sender_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:182:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;5b1383fc-c48a-48f8-807d-b0569052ef15&quot;,&quot;parentUUID&quot;:&quot;61413496-d4dc-4ee8-8ab1-612b979ea46e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Get request is forbidden due to querying other&#x27;s sent hangout requests&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 8: Get request is forbidden due to querying other&#x27;s sent hangout requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp !== sender_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:201:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;b66439e6-98ba-42c3-92cf-ac0588680cca&quot;,&quot;parentUUID&quot;:&quot;61413496-d4dc-4ee8-8ab1-612b979ea46e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Get request is forbidden due to querying other&#x27;s received hangout requests&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 9: Get request is forbidden due to querying other&#x27;s received hangout requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?receiver_erp=${receiver_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp !== receiver_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:217:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;7b2c1307-1156-4fb3-8a3b-7083b563e406&quot;,&quot;parentUUID&quot;:&quot;61413496-d4dc-4ee8-8ab1-612b979ea46e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Get all hangout requests is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 10: Get all hangout requests is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b29715a1-0d7c-4d66-b438-e3d8c9389228&quot;,&quot;parentUUID&quot;:&quot;61413496-d4dc-4ee8-8ab1-612b979ea46e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b29715a1-0d7c-4d66-b438-e3d8c9389228&quot;],&quot;failures&quot;:[&quot;b0947d8a-a55d-4884-9d18-635d8e69b619&quot;,&quot;11884a8e-e8b3-4dd4-9f92-2c9f9893d9fc&quot;,&quot;cf5dc51e-5ba9-449b-ab09-eae993ac6155&quot;,&quot;e77235a5-c77d-46ac-ac3f-3bcb3b864a29&quot;,&quot;614ffe86-e39b-487b-b328-367ea250eea3&quot;,&quot;1ba7647f-80d6-4d04-915c-dd6025f4d54b&quot;,&quot;5b1383fc-c48a-48f8-807d-b0569052ef15&quot;,&quot;b66439e6-98ba-42c3-92cf-ac0588680cca&quot;,&quot;7b2c1307-1156-4fb3-8a3b-7083b563e406&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:151,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1757879a-d2c5-4ccb-8b3d-f3768f4a7d6e&quot;,&quot;title&quot;:&quot;POST /hangout-requests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a hangout request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 1: Create a hangout request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp, receiver_erp, purpose, meetup_at, meetup_spot_id };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // token erp === sender_erp in body\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.hangout_request_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // token erp === sender_erp in body\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.hangout_request_id).to.be.equal(newId);\nexpect(res.body.body.sender.erp).to.be.equal(data.sender_erp);\nexpect(res.body.body.receiver.erp).to.be.equal(data.receiver_erp);\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // sender deletes it\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:254:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;1ad30406-1c58-4389-b853-e5db20237790&quot;,&quot;parentUUID&quot;:&quot;1757879a-d2c5-4ccb-8b3d-f3768f4a7d6e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a hangout request is unsuccessful due to unknown receiver_erp&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 2: Create a hangout request is unsuccessful due to unknown receiver_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: existingHangoutRequest.sender.erp,\n    receiver_erp: unknownStudentERP,\n    purpose,\n    meetup_at,\n    meetup_spot_id\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === existingHangoutRequest.sender.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;receiver_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:293:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;e4ff7651-a06c-435e-a55c-b8add9cb43ac&quot;,&quot;parentUUID&quot;:&quot;1757879a-d2c5-4ccb-8b3d-f3768f4a7d6e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a hangout request is incorrect due to wrong key name in the body&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 3: Create a hangout request is incorrect due to wrong key name in the body&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { // missing receiver_erp,\n    meetup_at: &#x27;not going&#x27;, // &lt;-- not a valid meetup_at\n    purpose,\n    meetup_spot_id,\n    send_erp: &#x27;12345&#x27; // &lt;-- a valid parameter name should be &#x27;sender_erp&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;receiver_erp&#x27;, &#x27;meetup_at&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:315:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;8db3cec3-2ce1-4261-8e57-1cec5672f5eb&quot;,&quot;parentUUID&quot;:&quot;1757879a-d2c5-4ccb-8b3d-f3768f4a7d6e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a hangout request is incorrect due to hangout request to oneself&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 4: Create a hangout request is incorrect due to hangout request to oneself&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: sender_erp,\n    receiver_erp: sender_erp,\n    purpose,\n    meetup_at,\n    meetup_spot_id\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === data.sender_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;receiver_erp&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Sender and receiver ERP can\\&#x27;t be the same&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:339:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;312e2046-f4c0-427a-8354-663761a8c968&quot;,&quot;parentUUID&quot;:&quot;1757879a-d2c5-4ccb-8b3d-f3768f4a7d6e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a hangout request is forbidden due to unowned hangout request&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 5: Create a hangout request is forbidden due to unowned hangout request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp: adminERP, receiver_erp, purpose, meetup_at, meetup_spot_id }; // adminERP instead of userERP\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- data.sender_erp !== userToken.erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:359:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;816ae282-fbaf-42ed-9321-d2ebf1391783&quot;,&quot;parentUUID&quot;:&quot;1757879a-d2c5-4ccb-8b3d-f3768f4a7d6e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a hangout request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 6: Create a hangout request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp, receiver_erp, purpose, meetup_at, meetup_spot_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;076e75d0-259b-48ab-b282-141e0507faeb&quot;,&quot;parentUUID&quot;:&quot;1757879a-d2c5-4ccb-8b3d-f3768f4a7d6e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;076e75d0-259b-48ab-b282-141e0507faeb&quot;],&quot;failures&quot;:[&quot;1ad30406-1c58-4389-b853-e5db20237790&quot;,&quot;e4ff7651-a06c-435e-a55c-b8add9cb43ac&quot;,&quot;8db3cec3-2ce1-4261-8e57-1cec5672f5eb&quot;,&quot;312e2046-f4c0-427a-8354-663761a8c968&quot;,&quot;816ae282-fbaf-42ed-9321-d2ebf1391783&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:95,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;79ded372-9a67-4fb6-b6fc-7a0227ebead2&quot;,&quot;title&quot;:&quot;PATCH /hangout-requests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a hangout request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API PATCH /hangout-requests/:id Scenario 1: Update a hangout request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { request_status, accepted_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminToken.erp == existingHangoutRequest.receiver.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${hangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst hangoutRequest = {\n    ...existingHangoutRequest\n};\nhangoutRequest.accepted_at = data.accepted_at;\nhangoutRequest.request_status = data.request_status;\nexpect(res.body.body).to.be.eql(hangoutRequest);\n\n// cleanup\ndata.request_status = existingHangoutRequest.request_status;\ndata.accepted_at = existingHangoutRequest.accepted_at;\nres = await request(app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminToken.erp == existingHangoutRequest.receiver.erp\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:399:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;257095fb-fb0d-4c94-8fc2-459a7577b2bd&quot;,&quot;parentUUID&quot;:&quot;79ded372-9a67-4fb6-b6fc-7a0227ebead2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a hangout request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API PATCH /hangout-requests/:id Scenario 2: Update a hangout request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    request_status: &#x27;ignored&#x27;, // &lt;-- not a valid request_status\n    accepted_at, // can&#x27;t specify accepted at unless request_status === &#x27;accepted/reject&#x27;\n    sender_erp: &#x27;12345&#x27; // &lt;-- an invalid update parameter i.e. not allowed\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;request_status&#x27;, &#x27;accepted_at&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include.members([&#x27;Invalid updates!&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:442:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;f4500cb5-2294-45ab-9e2c-577233f8e439&quot;,&quot;parentUUID&quot;:&quot;79ded372-9a67-4fb6-b6fc-7a0227ebead2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a hangout request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API PATCH /hangout-requests/:id Scenario 3: Update a hangout request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { request_status, accepted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- userToken.erp !== existingHangoutRequest.receiver.erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:462:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;f31477f1-13a3-4964-9c58-eae3cabd0184&quot;,&quot;parentUUID&quot;:&quot;79ded372-9a67-4fb6-b6fc-7a0227ebead2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a hangout request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API PATCH /hangout-requests/:id Scenario 4: Update a hangout request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { request_status, accepted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cf271e86-3e77-49de-9feb-8c38e6171df0&quot;,&quot;parentUUID&quot;:&quot;79ded372-9a67-4fb6-b6fc-7a0227ebead2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cf271e86-3e77-49de-9feb-8c38e6171df0&quot;],&quot;failures&quot;:[&quot;257095fb-fb0d-4c94-8fc2-459a7577b2bd&quot;,&quot;f4500cb5-2294-45ab-9e2c-577233f8e439&quot;,&quot;f31477f1-13a3-4964-9c58-eae3cabd0184&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:56,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0d1042ce-fb42-47e6-b75b-94a806729ff3&quot;,&quot;title&quot;:&quot;DELETE /hangout-requests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a hangout request is successful (Sender cancels)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API DELETE /hangout-requests/:id Scenario 1: Delete a hangout request is successful (Sender cancels)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { sender_erp, receiver_erp, purpose, meetup_at, meetup_spot_id };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\nconst newId = res.body.body.hangout_request_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp === sender_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hangout request has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hangout request not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:503:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;079cb03f-41c0-4fb6-8984-12ab7cda4876&quot;,&quot;parentUUID&quot;:&quot;0d1042ce-fb42-47e6-b75b-94a806729ff3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a hangout request is unsuccessful due to unknown id&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API DELETE /hangout-requests/:id Scenario 2: Delete a hangout request is unsuccessful due to unknown id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownHangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hangout request not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:536:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;5ef56eca-a821-4e75-97ac-aebb91ea0fbd&quot;,&quot;parentUUID&quot;:&quot;0d1042ce-fb42-47e6-b75b-94a806729ff3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a hangout request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API DELETE /hangout-requests/:id Scenario 3: Delete a hangout request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst forbiddenToken = jwt.sign({erp: receiver_erp}, Config.SECRET_JWT);\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${hangoutRequestId}`)\n    .auth(forbiddenToken, { type: &#x27;bearer&#x27; }); // forbiddenToken.erp !== receiver_erp or sender_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:552:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;672af6eb-f1e5-468e-9f07-bf1abd0e14eb&quot;,&quot;parentUUID&quot;:&quot;0d1042ce-fb42-47e6-b75b-94a806729ff3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a hangout request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API DELETE /hangout-requests/:id Scenario 4: Delete a hangout request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${hangoutRequestId}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0e7fbdf6-e51c-41d1-82ef-6a25267a2dfe&quot;,&quot;parentUUID&quot;:&quot;0d1042ce-fb42-47e6-b75b-94a806729ff3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0e7fbdf6-e51c-41d1-82ef-6a25267a2dfe&quot;],&quot;failures&quot;:[&quot;079cb03f-41c0-4fb6-8984-12ab7cda4876&quot;,&quot;5ef56eca-a821-4e75-97ac-aebb91ea0fbd&quot;,&quot;672af6eb-f1e5-468e-9f07-bf1abd0e14eb&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:58,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d1cba1b3-f6ac-4823-a4fe-9d06ce57f058&quot;,&quot;title&quot;:&quot;Healthcheck&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\healthCheck.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\healthCheck.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Healthcheck\&quot;&quot;,&quot;fullTitle&quot;:&quot;Healthcheck \&quot;before each\&quot; hook in \&quot;Healthcheck\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;originalDateNow = Date.now;\nDate.now = () =&gt; { return now; };&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1c91ef81-fcac-48ba-8690-a1d4129509f0&quot;,&quot;parentUUID&quot;:&quot;d1cba1b3-f6ac-4823-a4fe-9d06ce57f058&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Healthcheck\&quot;&quot;,&quot;fullTitle&quot;:&quot;Healthcheck \&quot;after each\&quot; hook in \&quot;Healthcheck\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;Date.now = originalDateNow;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;da6cdfc3-5fa0-4678-8a12-248e64ba4e84&quot;,&quot;parentUUID&quot;:&quot;d1cba1b3-f6ac-4823-a4fe-9d06ce57f058&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns OK, uptime and timestamp, if server is healthy&quot;,&quot;fullTitle&quot;:&quot;Healthcheck returns OK, uptime and timestamp, if server is healthy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const res = await request(app).get(`/api/${Config.API_VERSION}/health`, null);\n// status check\nexpect(res.status).to.be.equal(200);\n// error check\nexpect(res.body.headers.error).to.be.equal(0);\n\n// params check\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys(\&quot;health\&quot;, \&quot;uptime\&quot;, \&quot;timestamp\&quot;);\n// health check\nexpect(resBody.health).to.be.equal(&#x27;OK&#x27;);\n// uptime check\nconst uptime = Number.parseFloat(resBody.uptime);\nexpect(uptime).to.be.gt(0);\n// timestamp check\nconst timestamp = new Date(now).toJSON();\nexpect(resBody.timestamp).to.be.equal(timestamp);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3659e540-42d5-47f7-a566-7b86dd12a081&quot;,&quot;parentUUID&quot;:&quot;d1cba1b3-f6ac-4823-a4fe-9d06ce57f058&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3659e540-42d5-47f7-a566-7b86dd12a081&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;42be1c95-fcea-4064-8eed-86ca9f6dfbfd&quot;,&quot;title&quot;:&quot;Hobbies API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Hobbies API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Hobbies API \&quot;before each\&quot; hook in \&quot;Hobbies API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a56218e7-b596-4a20-8f87-b0aab9213303&quot;,&quot;parentUUID&quot;:&quot;42be1c95-fcea-4064-8eed-86ca9f6dfbfd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b86a2456-587d-4533-b706-e92802325aa3&quot;,&quot;title&quot;:&quot;GET /hobbies&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all hobbies request successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies Scenario 1: Get all hobbies request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;hobby_id&#x27;, &#x27;hobby&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:34:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;e12acb5c-8f13-4010-bc60-1dba1aff05ec&quot;,&quot;parentUUID&quot;:&quot;b86a2456-587d-4533-b706-e92802325aa3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all hobbies request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies Scenario 2: Get all hobbies request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:480,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst HobbyModel = require(&#x27;../../src/models/hobby.model&#x27;);\nconst modelStub = sinon.stub(HobbyModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty hobby list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobbies not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;b7a4ead1-be4e-4080-8ba4-dd47af7fd079&quot;,&quot;parentUUID&quot;:&quot;b86a2456-587d-4533-b706-e92802325aa3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;e12acb5c-8f13-4010-bc60-1dba1aff05ec&quot;,&quot;b7a4ead1-be4e-4080-8ba4-dd47af7fd079&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:494,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0024f013-2904-4a6c-9391-4f2cc41b4f37&quot;,&quot;title&quot;:&quot;GET /hobbies/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a hobby request successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies/:id Scenario 1: Get a hobby request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;hobby_id&#x27;, &#x27;hobby&#x27;]);\nexpect(resBody.hobby_id).to.be.eql(existingHobby.hobby_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:70:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;7ec18352-c8e8-4bef-b712-4f4ca6170171&quot;,&quot;parentUUID&quot;:&quot;0024f013-2904-4a6c-9391-4f2cc41b4f37&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a hobby request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies/:id Scenario 2: Get a hobby request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownHobbyId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobby not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:84:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;9a7a25d4-790a-4ff4-a481-bb43d9b5c06e&quot;,&quot;parentUUID&quot;:&quot;0024f013-2904-4a6c-9391-4f2cc41b4f37&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a hobby request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies/:id Scenario 3: Get a hobby request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingHobby.hobby_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2788913e-9e60-48e5-bd71-c200663db688&quot;,&quot;parentUUID&quot;:&quot;0024f013-2904-4a6c-9391-4f2cc41b4f37&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2788913e-9e60-48e5-bd71-c200663db688&quot;],&quot;failures&quot;:[&quot;7ec18352-c8e8-4bef-b712-4f4ca6170171&quot;,&quot;9a7a25d4-790a-4ff4-a481-bb43d9b5c06e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;268cb122-ceb9-466f-92b7-98e07fb26faa&quot;,&quot;title&quot;:&quot;POST /hobbies&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a hobby request is successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API POST /hobbies Scenario 1: Create a hobby request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;hobby_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.hobby_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    hobby_id: newId,\n    hobby: hobby\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:117:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;9cc83cfd-18cb-4a4c-89bd-61de120c94bf&quot;,&quot;parentUUID&quot;:&quot;268cb122-ceb9-466f-92b7-98e07fb26faa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a hobby request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Hobbies API POST /hobbies Scenario 2: Create a hobby request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    hobbies: hobby // &lt;-- a valid parameter name should be &#x27;hobby&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;hobby&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;da4e90e8-f9ee-4b88-98a7-2f02e1ec0929&quot;,&quot;parentUUID&quot;:&quot;268cb122-ceb9-466f-92b7-98e07fb26faa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a hobby request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hobbies API POST /hobbies Scenario 3: Create a hobby request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:172:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;798e2e91-9908-480a-ad2d-83d7b3b66e4f&quot;,&quot;parentUUID&quot;:&quot;268cb122-ceb9-466f-92b7-98e07fb26faa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a hobby request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hobbies API POST /hobbies Scenario 4: Create a hobby request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e1cd00ab-bc88-4708-83a5-b400fe769bb9&quot;,&quot;parentUUID&quot;:&quot;268cb122-ceb9-466f-92b7-98e07fb26faa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e1cd00ab-bc88-4708-83a5-b400fe769bb9&quot;],&quot;failures&quot;:[&quot;9cc83cfd-18cb-4a4c-89bd-61de120c94bf&quot;,&quot;da4e90e8-f9ee-4b88-98a7-2f02e1ec0929&quot;,&quot;798e2e91-9908-480a-ad2d-83d7b3b66e4f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:43,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f361ea3f-bd34-47f6-aaef-9fe6f080b5d3&quot;,&quot;title&quot;:&quot;PATCH /hobbies/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a hobby request is successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 1: Update a hobby request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby: newHobby };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    hobby_id: existingHobby.hobby_id,\n    hobby: newHobby\n});\n\n// cleanup\ndata.hobby = existingHobby.hobby;\nres = await request(app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:210:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;abf8f303-54b8-45a1-a95e-e7490aa42169&quot;,&quot;parentUUID&quot;:&quot;f361ea3f-bd34-47f6-aaef-9fe6f080b5d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a hobby request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 2: Update a hobby request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby: newHobby };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownHobbyId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobby not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:247:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;11478f8c-3968-4532-9295-511935b3a073&quot;,&quot;parentUUID&quot;:&quot;f361ea3f-bd34-47f6-aaef-9fe6f080b5d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a hobby request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 3: Update a hobby request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    hobbies: newHobby // &lt;-- a valid parameter name should be &#x27;hobby&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;hobby&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:266:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;1759833d-1ec3-49c0-95a3-82c628637578&quot;,&quot;parentUUID&quot;:&quot;f361ea3f-bd34-47f6-aaef-9fe6f080b5d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a hobby request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 4: Update a hobby request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby: newHobby };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:284:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;7fb5631e-b52b-4dd3-bb4c-0b0a58a1c51e&quot;,&quot;parentUUID&quot;:&quot;f361ea3f-bd34-47f6-aaef-9fe6f080b5d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a hobby request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 5: Update a hobby request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby: newHobby };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0c10c2b8-981c-4c49-b3ea-d89e6b2dd9fc&quot;,&quot;parentUUID&quot;:&quot;f361ea3f-bd34-47f6-aaef-9fe6f080b5d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0c10c2b8-981c-4c49-b3ea-d89e6b2dd9fc&quot;],&quot;failures&quot;:[&quot;abf8f303-54b8-45a1-a95e-e7490aa42169&quot;,&quot;11478f8c-3968-4532-9295-511935b3a073&quot;,&quot;1759833d-1ec3-49c0-95a3-82c628637578&quot;,&quot;7fb5631e-b52b-4dd3-bb4c-0b0a58a1c51e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:43,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;8ab2148c-f798-4b98-8f59-601be5f7c46c&quot;,&quot;title&quot;:&quot;DELETE /hobbies/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a hobby request is successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API DELETE /hobbies/:id Scenario 1: Delete a hobby request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { hobby };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.hobby_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobby has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:320:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;11d3a75a-dc2c-4885-abe2-51d9a881219b&quot;,&quot;parentUUID&quot;:&quot;8ab2148c-f798-4b98-8f59-601be5f7c46c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a hobby request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API DELETE /hobbies/:id Scenario 2: Delete a hobby request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownHobbyId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobby not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:352:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;0d2851fa-0fd8-4108-8c5d-229cbcdac5e6&quot;,&quot;parentUUID&quot;:&quot;8ab2148c-f798-4b98-8f59-601be5f7c46c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a hobby request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hobbies API DELETE /hobbies/:id Scenario 3: Delete a hobby request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:365:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;e2363c31-40a3-476d-aa29-dbd69024514a&quot;,&quot;parentUUID&quot;:&quot;8ab2148c-f798-4b98-8f59-601be5f7c46c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a hobby request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hobbies API DELETE /hobbies/:id Scenario 4: Delete a hobby request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingHobby.hobby_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d2591a01-1d77-455b-8bfa-274ad3c4c61d&quot;,&quot;parentUUID&quot;:&quot;8ab2148c-f798-4b98-8f59-601be5f7c46c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d2591a01-1d77-455b-8bfa-274ad3c4c61d&quot;],&quot;failures&quot;:[&quot;11d3a75a-dc2c-4885-abe2-51d9a881219b&quot;,&quot;0d2851fa-0fd8-4108-8c5d-229cbcdac5e6&quot;,&quot;e2363c31-40a3-476d-aa29-dbd69024514a&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:51,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ad4b198f-e24d-4b00-b57e-7393b6ea1eb6&quot;,&quot;title&quot;:&quot;Interests API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Interests API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Interests API \&quot;before each\&quot; hook in \&quot;Interests API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4b9d5bd0-e8f8-40a5-9c36-299a50dfc512&quot;,&quot;parentUUID&quot;:&quot;ad4b198f-e24d-4b00-b57e-7393b6ea1eb6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8260f416-7251-49a8-a347-7aa1c351a001&quot;,&quot;title&quot;:&quot;GET /interests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all interests request successful&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests Scenario 1: Get all interests request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;interest_id&#x27;, &#x27;interest&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:34:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;c26c0b59-2c98-45cd-9362-fe3c0935d32a&quot;,&quot;parentUUID&quot;:&quot;8260f416-7251-49a8-a347-7aa1c351a001&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all interests request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests Scenario 2: Get all interests request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:591,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst InterestModel = require(&#x27;../../src/models/interest.model&#x27;);\nconst modelStub = sinon.stub(InterestModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty interest list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interests not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;1fb75879-9603-4080-b556-7344c2d84002&quot;,&quot;parentUUID&quot;:&quot;8260f416-7251-49a8-a347-7aa1c351a001&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;c26c0b59-2c98-45cd-9362-fe3c0935d32a&quot;,&quot;1fb75879-9603-4080-b556-7344c2d84002&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:600,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6f2aafef-8089-4add-a795-708c96384d4f&quot;,&quot;title&quot;:&quot;GET /interests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a interest request successful&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests/:id Scenario 1: Get a interest request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;interest_id&#x27;, &#x27;interest&#x27;]);\nexpect(resBody.interest_id).to.be.eql(existingInterest.interest_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:70:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;6509e862-b6de-4d0f-ad1e-7bb2ed9b4874&quot;,&quot;parentUUID&quot;:&quot;6f2aafef-8089-4add-a795-708c96384d4f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a interest request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests/:id Scenario 2: Get a interest request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownInterestId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interest not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:84:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;05f9c4b1-fb8b-4107-9459-b2f3a47f24cb&quot;,&quot;parentUUID&quot;:&quot;6f2aafef-8089-4add-a795-708c96384d4f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a interest request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests/:id Scenario 3: Get a interest request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingInterest.interest_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6d14487b-df9d-4946-8664-585ec7078e2d&quot;,&quot;parentUUID&quot;:&quot;6f2aafef-8089-4add-a795-708c96384d4f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6d14487b-df9d-4946-8664-585ec7078e2d&quot;],&quot;failures&quot;:[&quot;6509e862-b6de-4d0f-ad1e-7bb2ed9b4874&quot;,&quot;05f9c4b1-fb8b-4107-9459-b2f3a47f24cb&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;76e10ba5-b7ac-476a-888b-c53f486c76ba&quot;,&quot;title&quot;:&quot;POST /interests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a interest request is successful&quot;,&quot;fullTitle&quot;:&quot;Interests API POST /interests Scenario 1: Create a interest request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;interest_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.interest_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    interest_id: newId,\n    interest: interest\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:117:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;18d1a411-ea7d-4a49-8460-d7ff9c115fdf&quot;,&quot;parentUUID&quot;:&quot;76e10ba5-b7ac-476a-888b-c53f486c76ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a interest request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Interests API POST /interests Scenario 2: Create a interest request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    interests: interest // &lt;-- a valid parameter name should be &#x27;interest&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;interest&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;404a507e-bf1e-477c-9d7a-65a770be3e9a&quot;,&quot;parentUUID&quot;:&quot;76e10ba5-b7ac-476a-888b-c53f486c76ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a interest request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Interests API POST /interests Scenario 3: Create a interest request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:172:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;36ea8abf-817c-4910-a628-5c355ed55af9&quot;,&quot;parentUUID&quot;:&quot;76e10ba5-b7ac-476a-888b-c53f486c76ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a interest request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Interests API POST /interests Scenario 4: Create a interest request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;acf03d73-3723-49e5-a612-876d1748b2d6&quot;,&quot;parentUUID&quot;:&quot;76e10ba5-b7ac-476a-888b-c53f486c76ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;acf03d73-3723-49e5-a612-876d1748b2d6&quot;],&quot;failures&quot;:[&quot;18d1a411-ea7d-4a49-8460-d7ff9c115fdf&quot;,&quot;404a507e-bf1e-477c-9d7a-65a770be3e9a&quot;,&quot;36ea8abf-817c-4910-a628-5c355ed55af9&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:44,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d5eeb820-af87-4d65-a975-c189ef4a41c7&quot;,&quot;title&quot;:&quot;PATCH /interests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a interest request is successful&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 1: Update a interest request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest: newInterest };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    interest_id: existingInterest.interest_id,\n    interest: newInterest\n});\n\n// cleanup\ndata.interest = existingInterest.interest;\nres = await request(app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:210:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;f64abd8f-770b-4c80-80cb-d80de11bf617&quot;,&quot;parentUUID&quot;:&quot;d5eeb820-af87-4d65-a975-c189ef4a41c7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a interest request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 2: Update a interest request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest: newInterest };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownInterestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interest not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:247:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;3d055198-e4f5-4d83-af28-6e4d9a69f795&quot;,&quot;parentUUID&quot;:&quot;d5eeb820-af87-4d65-a975-c189ef4a41c7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a interest request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 3: Update a interest request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    interests: newInterest // &lt;-- a valid parameter name should be &#x27;interest&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;interest&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:266:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;1bada489-f6f3-49e3-b9a1-61bbbcfc4a54&quot;,&quot;parentUUID&quot;:&quot;d5eeb820-af87-4d65-a975-c189ef4a41c7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a interest request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 4: Update a interest request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest: newInterest };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:284:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;d768a4d9-aab8-4e81-907c-5f4e834f3094&quot;,&quot;parentUUID&quot;:&quot;d5eeb820-af87-4d65-a975-c189ef4a41c7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a interest request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 5: Update a interest request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest: newInterest };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ddd451a8-a089-43a3-b725-c39d821aa891&quot;,&quot;parentUUID&quot;:&quot;d5eeb820-af87-4d65-a975-c189ef4a41c7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ddd451a8-a089-43a3-b725-c39d821aa891&quot;],&quot;failures&quot;:[&quot;f64abd8f-770b-4c80-80cb-d80de11bf617&quot;,&quot;3d055198-e4f5-4d83-af28-6e4d9a69f795&quot;,&quot;1bada489-f6f3-49e3-b9a1-61bbbcfc4a54&quot;,&quot;d768a4d9-aab8-4e81-907c-5f4e834f3094&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:34,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7787c6b8-01ca-4b21-91eb-33c7417affee&quot;,&quot;title&quot;:&quot;DELETE /interests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a interest request is successful&quot;,&quot;fullTitle&quot;:&quot;Interests API DELETE /interests/:id Scenario 1: Delete a interest request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { interest };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.interest_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interest has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:320:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;c3f65d30-6a6d-45eb-933e-708a2458b330&quot;,&quot;parentUUID&quot;:&quot;7787c6b8-01ca-4b21-91eb-33c7417affee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a interest request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Interests API DELETE /interests/:id Scenario 2: Delete a interest request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownInterestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interest not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:352:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;56a4636f-a5ba-474c-b53e-c47ced8e9345&quot;,&quot;parentUUID&quot;:&quot;7787c6b8-01ca-4b21-91eb-33c7417affee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a interest request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Interests API DELETE /interests/:id Scenario 3: Delete a interest request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:365:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;41e72db6-55c9-43e2-9412-41a72c823dd2&quot;,&quot;parentUUID&quot;:&quot;7787c6b8-01ca-4b21-91eb-33c7417affee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a interest request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Interests API DELETE /interests/:id Scenario 4: Delete a interest request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingInterest.interest_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2323f9ef-455d-4f6c-a38f-65e984bebc02&quot;,&quot;parentUUID&quot;:&quot;7787c6b8-01ca-4b21-91eb-33c7417affee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2323f9ef-455d-4f6c-a38f-65e984bebc02&quot;],&quot;failures&quot;:[&quot;c3f65d30-6a6d-45eb-933e-708a2458b330&quot;,&quot;56a4636f-a5ba-474c-b53e-c47ced8e9345&quot;,&quot;41e72db6-55c9-43e2-9412-41a72c823dd2&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;32b09a86-7a4c-43a1-aeb6-79ad076412e3&quot;,&quot;title&quot;:&quot;Posts API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Posts API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Posts API \&quot;before each\&quot; hook in \&quot;Posts API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6c6757fe-25bb-4e54-880f-afc6efc9e2b8&quot;,&quot;parentUUID&quot;:&quot;32b09a86-7a4c-43a1-aeb6-79ad076412e3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9bd4dacf-3a37-4c15-8e6d-90cf7c913869&quot;,&quot;title&quot;:&quot;GET /posts&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all posts request successful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 1: Get all posts request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingPost)); // contain all params\nconst examplePost = resBody[0];\nexpect(examplePost.author).to.include.all.keys(Object.keys(existingPost.author));\nexpect(examplePost.resources).to.be.an(&#x27;array&#x27;);\nexpect(examplePost.resources[0]).to.include.all.keys(Object.keys(existingPost.resources[0])); // contain all params\n\nexpect(examplePost.top_3_reactions).to.be.an(&#x27;array&#x27;);\nexpect(examplePost.top_3_reactions[0]).to.include.all.keys(Object.keys(existingPost.top_3_reactions[0])); // contain all params\n        \nconst noReactionOrResourceCheck = post =&gt; post.resources === null &amp;&amp; post.top_3_reactions === null;\nexpect(resBody.some(noReactionOrResourceCheck)).to.be.true; // match atleast one post like this&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:63:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;00b5d5f3-d4f1-4b17-9a5b-73bc05f19994&quot;,&quot;parentUUID&quot;:&quot;9bd4dacf-3a37-4c15-8e6d-90cf7c913869&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all posts request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 2: Get all posts request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst author_erp = userERP;\nlet res = await request(this.app)\n    .get(`${baseRoute}?author_erp=${author_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].author).to.include.all.keys(Object.keys(existingPost.author));\nexpect(resBody[0].author.erp).to.be.equal(author_erp);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:91:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;c047f879-62fc-459e-a2ee-541ed58c554b&quot;,&quot;parentUUID&quot;:&quot;9bd4dacf-3a37-4c15-8e6d-90cf7c913869&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all posts request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 3: Get all posts request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:488,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst PostModel = require(&#x27;../../src/models/post.model&#x27;);\nconst modelStub = sinon.stub(PostModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty post list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;516883f4-4bc5-4284-b370-e28e7c1f8e0e&quot;,&quot;parentUUID&quot;:&quot;9bd4dacf-3a37-4c15-8e6d-90cf7c913869&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all posts request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 4: Get all posts request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;all&#x27;; // &lt;-- invalid privacy value\nlet res = await request(this.app)\n    .get(`${baseRoute}?privacy=${privacy}&amp;week=2`) // &lt;-- `week` is an incorrect query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;privacy&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:125:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;4591856a-d76f-43ad-b321-4baf885d0d55&quot;,&quot;parentUUID&quot;:&quot;9bd4dacf-3a37-4c15-8e6d-90cf7c913869&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all posts request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 5: Get all posts request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4b236229-25f7-45b4-beea-89133cbe85b8&quot;,&quot;parentUUID&quot;:&quot;9bd4dacf-3a37-4c15-8e6d-90cf7c913869&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4b236229-25f7-45b4-beea-89133cbe85b8&quot;],&quot;failures&quot;:[&quot;00b5d5f3-d4f1-4b17-9a5b-73bc05f19994&quot;,&quot;c047f879-62fc-459e-a2ee-541ed58c554b&quot;,&quot;516883f4-4bc5-4284-b370-e28e7c1f8e0e&quot;,&quot;4591856a-d76f-43ad-b321-4baf885d0d55&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:523,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ba736b16-90a5-4703-894b-c30bbb2f968c&quot;,&quot;title&quot;:&quot;GET /posts/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a post request successful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id Scenario 1: Get a post request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingPost.post_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.post_id).to.be.equal(existingPost.post_id); // should match initially sent id\nexpect(resBody).to.include.all.keys(Object.keys(existingPost)); // contain all params\nexpect(resBody.author).to.include.all.keys(Object.keys(existingPost.author));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;18247b97-7d41-4e80-a21b-2801b1347b1e&quot;,&quot;parentUUID&quot;:&quot;ba736b16-90a5-4703-894b-c30bbb2f968c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a post request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id Scenario 2: Get a post request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownPostId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:169:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;9ad73d01-7b55-48ad-8685-b568563faa51&quot;,&quot;parentUUID&quot;:&quot;ba736b16-90a5-4703-894b-c30bbb2f968c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a post request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id Scenario 3: Get a post request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingPost.post_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7e028af4-2560-46e4-a158-a60be8d3da0a&quot;,&quot;parentUUID&quot;:&quot;ba736b16-90a5-4703-894b-c30bbb2f968c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7e028af4-2560-46e4-a158-a60be8d3da0a&quot;],&quot;failures&quot;:[&quot;18247b97-7d41-4e80-a21b-2801b1347b1e&quot;,&quot;9ad73d01-7b55-48ad-8685-b568563faa51&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7b8d6a24-7706-45a5-8749-3bcd65a7994f&quot;,&quot;title&quot;:&quot;GET /posts/:id/reactions&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a post&#x27;s reactions request successful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id/reactions Scenario 1: Get a post&#x27;s reactions request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingPost.post_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys([&#x27;post_id&#x27;, &#x27;reaction_type_id&#x27;, &#x27;student_erp&#x27;, &#x27;reacted_at&#x27;]);\nexpect(resBody[0].post_id).to.be.equal(existingPost.post_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:197:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;fd98732b-fb8d-47b6-ba1b-885d198ba578&quot;,&quot;parentUUID&quot;:&quot;7b8d6a24-7706-45a5-8749-3bcd65a7994f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a post&#x27;s reactions request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id/reactions Scenario 2: Get a post&#x27;s reactions request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownPostId}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:212:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;daf15dc5-2ef2-48ed-bea9-cf9bc85263d4&quot;,&quot;parentUUID&quot;:&quot;7b8d6a24-7706-45a5-8749-3bcd65a7994f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a post&#x27;s reactions request is unsuccessful due to zero reactions&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id/reactions Scenario 3: Get a post&#x27;s reactions request is unsuccessful due to zero reactions&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:557,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst PostModel = require(&#x27;../../src/models/post.model&#x27;);\nconst modelStub = sinon.stub(PostModel, &#x27;findAllReactionsByPost&#x27;).callsFake(() =&gt; []); // return empty post reactions list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingPost.post_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;8d677f9b-3031-47d9-80f8-3c654e8b7ffa&quot;,&quot;parentUUID&quot;:&quot;7b8d6a24-7706-45a5-8749-3bcd65a7994f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a post&#x27;s reactions is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id/reactions Scenario 4: Get a post&#x27;s reactions is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingPost.post_id}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2b4c57c8-4082-45a4-9914-2f31f2ceff45&quot;,&quot;parentUUID&quot;:&quot;7b8d6a24-7706-45a5-8749-3bcd65a7994f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2b4c57c8-4082-45a4-9914-2f31f2ceff45&quot;],&quot;failures&quot;:[&quot;fd98732b-fb8d-47b6-ba1b-885d198ba578&quot;,&quot;daf15dc5-2ef2-48ed-bea9-cf9bc85263d4&quot;,&quot;8d677f9b-3031-47d9-80f8-3c654e8b7ffa&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:585,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d2b26741-796d-4473-b565-2e54d2e15b5d&quot;,&quot;title&quot;:&quot;POST /posts&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a post request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Posts API POST /posts Scenario 1: Create a post request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newPost.author_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;post_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// affirm\nconst newId = res.body.body.post_id;\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nconst resBody = res.body.body;\nresBody.resources = resBody.resources.map(resource =&gt; (\n    {\n        resource_url: resource.resource_url,\n        resource_type: resource.resource_type\n    }\n));\nexpect(resBody.author.erp).to.be.equal(data.author_erp);\ndelete resBody.author;\ndelete data.author_erp;\nexpect(resBody).to.be.eql({\n    post_id: newId,\n    top_3_reactions: null,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:266:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;1ae0a667-2ceb-4579-8cfa-067b839521a6&quot;,&quot;parentUUID&quot;:&quot;d2b26741-796d-4473-b565-2e54d2e15b5d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a post request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Posts API POST /posts Scenario 2: Create a post request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst {resources, ...post} = newPost;\nconst data = {\n    ...post,\n    resourcessfd: resources // &lt;-- a valid param is &#x27;resources&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newPost.author_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;resources&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:318:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;b79245b3-f645-441a-ad8a-9cf512aea405&quot;,&quot;parentUUID&quot;:&quot;d2b26741-796d-4473-b565-2e54d2e15b5d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a post request is forbidden (Unowned Author ERP)&quot;,&quot;fullTitle&quot;:&quot;Posts API POST /posts Scenario 3: Create a post request is forbidden (Unowned Author ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\ndata.author_erp = adminERP; // &lt;-- can be any other non-admin ERP as well, just different from userToken erp\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t create others posts i.e. token erp != newPost.author_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:337:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;5a56017c-5a7e-47a0-9bbf-4c9dca850d48&quot;,&quot;parentUUID&quot;:&quot;d2b26741-796d-4473-b565-2e54d2e15b5d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a post request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API POST /posts Scenario 4: Create a post request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d885520f-6ca8-40be-95fc-549e1453345e&quot;,&quot;parentUUID&quot;:&quot;d2b26741-796d-4473-b565-2e54d2e15b5d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d885520f-6ca8-40be-95fc-549e1453345e&quot;],&quot;failures&quot;:[&quot;1ae0a667-2ceb-4579-8cfa-067b839521a6&quot;,&quot;b79245b3-f645-441a-ad8a-9cf512aea405&quot;,&quot;5a56017c-5a7e-47a0-9bbf-4c9dca850d48&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0205f5e2-f4e1-45bc-9fed-3b4b54dd1902&quot;,&quot;title&quot;:&quot;PATCH /posts/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a post request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 1: Update a post request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { body: updatedPostBody };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingPost.post_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingPost.author_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingPost.post_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.body).to.be.equal(updatedPostBody);\n\n// cleanup\ndata.body = existingPost.body;\nres = await request(app)\n    .patch(`${baseRoute}/${existingPost.post_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:375:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;3c15e15e-c126-41e6-ba71-37099d1bb81e&quot;,&quot;parentUUID&quot;:&quot;0205f5e2-f4e1-45bc-9fed-3b4b54dd1902&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a post request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 2: Update a post request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { body: updatedPostBody };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownPostId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:408:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;653f2b63-7c7e-48e7-a5d2-752460fd3efc&quot;,&quot;parentUUID&quot;:&quot;0205f5e2-f4e1-45bc-9fed-3b4b54dd1902&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a post request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 3: Update a post request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    bodysds: updatedPostBody, // &lt;-- an valid parameter name should be &#x27;body&#x27;\n    privacy: \&quot;all\&quot; // &lt;-- an invalid &#x27;privacy&#x27; value\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingPost.post_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;privacy&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:428:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;b8861589-4fdd-4a8a-b2af-caa0710da4df&quot;,&quot;parentUUID&quot;:&quot;0205f5e2-f4e1-45bc-9fed-3b4b54dd1902&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a post request is forbidden (Unowned Author ERP)&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 4: Update a post request is forbidden (Unowned Author ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { body: updatedPostBody };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedPostId}`) // &lt;-- has a different author_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others posts i.e. token erp != unOwnedPost.author_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:448:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;ab209ad7-a222-4a55-84f2-6076be7eb5d2&quot;,&quot;parentUUID&quot;:&quot;0205f5e2-f4e1-45bc-9fed-3b4b54dd1902&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a post request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 5: Update a post request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { body: updatedPostBody };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingPost.post_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2ad5dc5b-95a3-4d3c-b67b-2e0d76e723dc&quot;,&quot;parentUUID&quot;:&quot;0205f5e2-f4e1-45bc-9fed-3b4b54dd1902&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2ad5dc5b-95a3-4d3c-b67b-2e0d76e723dc&quot;],&quot;failures&quot;:[&quot;3c15e15e-c126-41e6-ba71-37099d1bb81e&quot;,&quot;653f2b63-7c7e-48e7-a5d2-752460fd3efc&quot;,&quot;b8861589-4fdd-4a8a-b2af-caa0710da4df&quot;,&quot;ab209ad7-a222-4a55-84f2-6076be7eb5d2&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:41,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;fa94dc5d-a0a4-48cb-b368-e76e4a4d4456&quot;,&quot;title&quot;:&quot;DELETE /posts/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a post request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 1: Delete a post request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.post_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // using his own token i.e. token erp == newPost.author_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:489:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;86ed16d2-a57c-448f-954a-7898f7b891e8&quot;,&quot;parentUUID&quot;:&quot;fa94dc5d-a0a4-48cb-b368-e76e4a4d4456&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a post request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 2: Delete a post request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.post_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // admin can delete other&#x27;s posts even if token erp != newPost.author_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:524:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;728e4353-7f73-4099-8931-84f219a495d8&quot;,&quot;parentUUID&quot;:&quot;fa94dc5d-a0a4-48cb-b368-e76e4a4d4456&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a post request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 3: Delete a post request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownPostId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:556:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;6f275fea-001a-49f4-a750-1eb281154845&quot;,&quot;parentUUID&quot;:&quot;fa94dc5d-a0a4-48cb-b368-e76e4a4d4456&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a post request is forbidden (Unowned Author ERP)&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 4: Delete a post request is forbidden (Unowned Author ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unOwnedPostId}`) // &lt;-- has a different author_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user can&#x27;t delete others posts i.e. token erp != unOwnedPost.author_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:569:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;e8fbeb5e-95ef-4780-b304-14ae17c0214f&quot;,&quot;parentUUID&quot;:&quot;fa94dc5d-a0a4-48cb-b368-e76e4a4d4456&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a post request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 5: Delete a post request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingPost.post_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1ddff1c2-a1c0-4f55-8919-b2f2416bf926&quot;,&quot;parentUUID&quot;:&quot;fa94dc5d-a0a4-48cb-b368-e76e4a4d4456&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1ddff1c2-a1c0-4f55-8919-b2f2416bf926&quot;],&quot;failures&quot;:[&quot;86ed16d2-a57c-448f-954a-7898f7b891e8&quot;,&quot;728e4353-7f73-4099-8931-84f219a495d8&quot;,&quot;6f275fea-001a-49f4-a750-1eb281154845&quot;,&quot;e8fbeb5e-95ef-4780-b304-14ae17c0214f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7a115147-0529-4104-98e3-189800aac4e1&quot;,&quot;title&quot;:&quot;Post Reactions API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\postReaction.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\postReaction.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Post Reactions API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API \&quot;before each\&quot; hook in \&quot;Post Reactions API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e92b3c85-d712-45e9-87f3-c4fda6317a91&quot;,&quot;parentUUID&quot;:&quot;7a115147-0529-4104-98e3-189800aac4e1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e7274bb6-84ac-4c52-baeb-2582e939d492&quot;,&quot;title&quot;:&quot;POST /posts/:id/reactions&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\postReaction.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\postReaction.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a post reaction request is successful&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 1: Create a post reaction request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkStudentERP = reaction =&gt; reaction.student_erp === data.student_erp;\nexpect(res.body.body.some(checkStudentERP)).to.be.true;\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:44:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;7432c87b-8e8f-42d8-881e-53daa4acbb66&quot;,&quot;parentUUID&quot;:&quot;e7274bb6-84ac-4c52-baeb-2582e939d492&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a post reaction request is unsuccessful due to unknown post id&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 2: Create a post reaction request is unsuccessful due to unknown post id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${unknownPostId}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;post_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:76:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;45064278-6cbb-473f-ae31-5104213591bc&quot;,&quot;parentUUID&quot;:&quot;e7274bb6-84ac-4c52-baeb-2582e939d492&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a post reaction request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 3: Create a post reaction request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\ndata.reaction_type_id = &#x27;not going&#x27;; // &lt;-- not a valid reaction_type_id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;reaction_type_id&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:94:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;6f695873-6fd3-471d-b721-65f8ccdeed9a&quot;,&quot;parentUUID&quot;:&quot;e7274bb6-84ac-4c52-baeb-2582e939d492&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a post reaction request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 4: Create a post reaction request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\ndata.student_erp = adminERP; // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:113:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;979f20a8-1bce-4257-9fa5-ffd28b37a0f4&quot;,&quot;parentUUID&quot;:&quot;e7274bb6-84ac-4c52-baeb-2582e939d492&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a post reaction request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 5: Create a post reaction request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6f2c9023-b60d-4fb3-b573-6f90ae8e9e5f&quot;,&quot;parentUUID&quot;:&quot;e7274bb6-84ac-4c52-baeb-2582e939d492&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6f2c9023-b60d-4fb3-b573-6f90ae8e9e5f&quot;],&quot;failures&quot;:[&quot;7432c87b-8e8f-42d8-881e-53daa4acbb66&quot;,&quot;45064278-6cbb-473f-ae31-5104213591bc&quot;,&quot;6f695873-6fd3-471d-b721-65f8ccdeed9a&quot;,&quot;979f20a8-1bce-4257-9fa5-ffd28b37a0f4&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:50,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;242e2f79-8e4f-431e-82a8-53878250bf56&quot;,&quot;title&quot;:&quot;PATCH /posts/:id/reactions/:student_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\postReaction.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\postReaction.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a post reaction request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 1: Update a post reaction request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type_id, reacted_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- userToken.erp == student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${post_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkStudentERP = reaction =&gt; reaction.student_erp === student_erp;\nconst reaction = res.body.body.filter(checkStudentERP)[0];\nexpect(reaction).to.be.eql({\n    post_id,\n    student_erp,\n    ...data\n});\n// cleanup\ndata.reaction_type_id = existingPostReaction.reaction_type_id;\ndata.reacted_at = existingPostReaction.reacted_at;\nres = await request(app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;8003f936-e085-48cb-9972-59240e557668&quot;,&quot;parentUUID&quot;:&quot;242e2f79-8e4f-431e-82a8-53878250bf56&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a post reaction request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 2: Update a post reaction request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type_id, reacted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownPostId}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:194:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;4fd3b0c0-02b8-4dbd-98b2-b04eb703ab79&quot;,&quot;parentUUID&quot;:&quot;242e2f79-8e4f-431e-82a8-53878250bf56&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a post reaction request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 3: Update a post reaction request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { // missing reqd parameter reacted_at\n    reaction_type_id: &#x27;not going&#x27;, // &lt;-- not a valid reaction_type_id\n    erp: &#x27;12345&#x27; // &lt;-- an invalid update parameter i.e. not allowed\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;reaction_type_id&#x27;, &#x27;reacted_at&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include.members([&#x27;Invalid updates!&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:214:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;c54e6686-0151-43e7-9e4f-cedc34093a1a&quot;,&quot;parentUUID&quot;:&quot;242e2f79-8e4f-431e-82a8-53878250bf56&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a post reaction request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 4: Update a post reaction request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type_id, reacted_at };\nconst user2ERP = &#x27;17619&#x27;;\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${user2ERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user2ERP != userToken.erp, can be any other different erp as well\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:235:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;d5364ba8-35be-4f37-8645-5366899de517&quot;,&quot;parentUUID&quot;:&quot;242e2f79-8e4f-431e-82a8-53878250bf56&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a post reaction request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 5: Update a post reaction request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type_id, reacted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${student_erp}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6fae0093-b6e5-494e-8dba-6ccf7c6e428a&quot;,&quot;parentUUID&quot;:&quot;242e2f79-8e4f-431e-82a8-53878250bf56&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6fae0093-b6e5-494e-8dba-6ccf7c6e428a&quot;],&quot;failures&quot;:[&quot;8003f936-e085-48cb-9972-59240e557668&quot;,&quot;4fd3b0c0-02b8-4dbd-98b2-b04eb703ab79&quot;,&quot;c54e6686-0151-43e7-9e4f-cedc34093a1a&quot;,&quot;d5364ba8-35be-4f37-8645-5366899de517&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:34,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6ff90f5c-51b0-4d07-8d21-e2cce687faff&quot;,&quot;title&quot;:&quot;DELETE /posts/:id/reactions/:student_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\postReaction.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\postReaction.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a post reaction request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 1: Delete a post reaction request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { ...newPostReaction };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp == data.student_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:271:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;d254e4ac-1647-4c36-8f24-ed2d4f48f22e&quot;,&quot;parentUUID&quot;:&quot;6ff90f5c-51b0-4d07-8d21-e2cce687faff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a post reaction request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 2: Delete a post reaction request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { ...newPostReaction };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp != data.student_erp but still bypass\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:306:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;83cb0651-37f5-43c2-892b-8edd81204c45&quot;,&quot;parentUUID&quot;:&quot;6ff90f5c-51b0-4d07-8d21-e2cce687faff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a post reaction request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 3: Delete a post reaction request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownPostId}/${subRoute}/${newPostReaction.student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:338:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;cf19d425-5d80-49ad-a9cd-f7f1034a2774&quot;,&quot;parentUUID&quot;:&quot;6ff90f5c-51b0-4d07-8d21-e2cce687faff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a post reaction request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 4: Delete a post reaction request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingPostReaction.post_id}/${subRoute}/${unknownStudentERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:351:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;123d9c71-4d44-4bec-8c37-34e9ea468ba6&quot;,&quot;parentUUID&quot;:&quot;6ff90f5c-51b0-4d07-8d21-e2cce687faff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a post reaction request is forbidden (Unowned Post Reaction)&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 5: Delete a post reaction request is forbidden (Unowned Post Reaction)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst user2ERP = &#x27;17619&#x27;;\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingPostReaction.post_id}/${subRoute}/${user2ERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user2ERP != userToken.erp, can be any other different erp as well\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:367:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;f59eef06-75cb-4bfb-9a48-3471964552f6&quot;,&quot;parentUUID&quot;:&quot;6ff90f5c-51b0-4d07-8d21-e2cce687faff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Delete a post reaction request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 6: Delete a post reaction request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingPostReaction.post_id}/${subRoute}/${existingPostReaction.student_erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8afc270d-9909-4c1f-ad4b-c5ff2f381ff4&quot;,&quot;parentUUID&quot;:&quot;6ff90f5c-51b0-4d07-8d21-e2cce687faff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8afc270d-9909-4c1f-ad4b-c5ff2f381ff4&quot;],&quot;failures&quot;:[&quot;d254e4ac-1647-4c36-8f24-ed2d4f48f22e&quot;,&quot;83cb0651-37f5-43c2-892b-8edd81204c45&quot;,&quot;cf19d425-5d80-49ad-a9cd-f7f1034a2774&quot;,&quot;123d9c71-4d44-4bec-8c37-34e9ea468ba6&quot;,&quot;f59eef06-75cb-4bfb-9a48-3471964552f6&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:48,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;03850db4-a067-45b1-8241-88f160d64948&quot;,&quot;title&quot;:&quot;Programs API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Programs API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Programs API \&quot;before each\&quot; hook in \&quot;Programs API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;520d97fe-06ba-4b5d-86b1-1724d895c737&quot;,&quot;parentUUID&quot;:&quot;03850db4-a067-45b1-8241-88f160d64948&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d5eb0611-077a-422b-8231-b2202a84efc7&quot;,&quot;title&quot;:&quot;GET /programs&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all programs request successful&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs Scenario 1: Get all programs request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;program_id&#x27;, &#x27;program&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:34:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;787943f5-98cc-457e-ba53-ac2c4942fc77&quot;,&quot;parentUUID&quot;:&quot;d5eb0611-077a-422b-8231-b2202a84efc7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all programs request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs Scenario 2: Get all programs request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:569,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ProgramModel = require(&#x27;../../src/models/program.model&#x27;);\nconst modelStub = sinon.stub(ProgramModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty program list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Programs not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;1947146c-3faf-41b4-b0e8-9c9757b80fc7&quot;,&quot;parentUUID&quot;:&quot;d5eb0611-077a-422b-8231-b2202a84efc7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;787943f5-98cc-457e-ba53-ac2c4942fc77&quot;,&quot;1947146c-3faf-41b4-b0e8-9c9757b80fc7&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:574,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a219a080-54e1-4d86-85b5-1c5d9e24158e&quot;,&quot;title&quot;:&quot;GET /programs/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a program request successful&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs/:id Scenario 1: Get a program request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;program_id&#x27;, &#x27;program&#x27;]);\nexpect(resBody.program_id).to.be.eql(existingProgram.program_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:69:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;febac335-97a9-4d05-b1e9-28de38519ab9&quot;,&quot;parentUUID&quot;:&quot;a219a080-54e1-4d86-85b5-1c5d9e24158e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a program request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs/:id Scenario 2: Get a program request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownProgramId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Program not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:83:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;a089f6c7-3dae-4e68-82d6-3f127a07a4b9&quot;,&quot;parentUUID&quot;:&quot;a219a080-54e1-4d86-85b5-1c5d9e24158e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a program request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs/:id Scenario 3: Get a program request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingProgram.program_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;61362617-3318-4349-b9e2-7d26901672aa&quot;,&quot;parentUUID&quot;:&quot;a219a080-54e1-4d86-85b5-1c5d9e24158e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;61362617-3318-4349-b9e2-7d26901672aa&quot;],&quot;failures&quot;:[&quot;febac335-97a9-4d05-b1e9-28de38519ab9&quot;,&quot;a089f6c7-3dae-4e68-82d6-3f127a07a4b9&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;96379ba4-a89d-424c-abbe-85bc7bf5a167&quot;,&quot;title&quot;:&quot;POST /programs&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a program request is successful&quot;,&quot;fullTitle&quot;:&quot;Programs API POST /programs Scenario 1: Create a program request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;program_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.program_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    program_id: newId,\n    program: program\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:116:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;f58e09c0-1b94-452f-ade5-f861d9061aa5&quot;,&quot;parentUUID&quot;:&quot;96379ba4-a89d-424c-abbe-85bc7bf5a167&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a program request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Programs API POST /programs Scenario 2: Create a program request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    programs: program // &lt;-- a valid parameter name should be &#x27;program&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;program&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:153:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;d6053030-904d-482b-90f0-eaa5a632d531&quot;,&quot;parentUUID&quot;:&quot;96379ba4-a89d-424c-abbe-85bc7bf5a167&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a program request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Programs API POST /programs Scenario 3: Create a program request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:171:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;cc3a0960-af80-4b1e-a8ac-8e3df4067fd1&quot;,&quot;parentUUID&quot;:&quot;96379ba4-a89d-424c-abbe-85bc7bf5a167&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a program request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Programs API POST /programs Scenario 4: Create a program request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e65822d0-cf64-4062-bae7-566f4710a189&quot;,&quot;parentUUID&quot;:&quot;96379ba4-a89d-424c-abbe-85bc7bf5a167&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e65822d0-cf64-4062-bae7-566f4710a189&quot;],&quot;failures&quot;:[&quot;f58e09c0-1b94-452f-ade5-f861d9061aa5&quot;,&quot;d6053030-904d-482b-90f0-eaa5a632d531&quot;,&quot;cc3a0960-af80-4b1e-a8ac-8e3df4067fd1&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:41,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;5e9944a7-7106-44fe-a37b-7948cdb34c5a&quot;,&quot;title&quot;:&quot;PATCH /programs/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a program request is successful&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 1: Update a program request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program: newProgram };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    program_id: existingProgram.program_id,\n    program: newProgram\n});\n\n// cleanup\ndata.program = existingProgram.program;\nres = await request(app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:209:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;c3a267a5-02c7-40eb-a869-b0b1499dd4a8&quot;,&quot;parentUUID&quot;:&quot;5e9944a7-7106-44fe-a37b-7948cdb34c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a program request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 2: Update a program request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program: newProgram };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownProgramId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Program not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:246:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;d4d14f16-23b9-4cb1-b5ef-050046a1a66c&quot;,&quot;parentUUID&quot;:&quot;5e9944a7-7106-44fe-a37b-7948cdb34c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a program request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 3: Update a program request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    programs: newProgram // &lt;-- a valid parameter name should be &#x27;program&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;program&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:265:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;3659ed44-578a-43f4-b229-8a57e7ae5cf2&quot;,&quot;parentUUID&quot;:&quot;5e9944a7-7106-44fe-a37b-7948cdb34c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a program request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 4: Update a program request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program: newProgram };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:283:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;5286f2db-af2a-4b0f-95ab-8c9373b4f53b&quot;,&quot;parentUUID&quot;:&quot;5e9944a7-7106-44fe-a37b-7948cdb34c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a program request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 5: Update a program request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program: newProgram };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1a096624-44a4-4a23-ab69-1b869272f812&quot;,&quot;parentUUID&quot;:&quot;5e9944a7-7106-44fe-a37b-7948cdb34c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1a096624-44a4-4a23-ab69-1b869272f812&quot;],&quot;failures&quot;:[&quot;c3a267a5-02c7-40eb-a869-b0b1499dd4a8&quot;,&quot;d4d14f16-23b9-4cb1-b5ef-050046a1a66c&quot;,&quot;3659ed44-578a-43f4-b229-8a57e7ae5cf2&quot;,&quot;5286f2db-af2a-4b0f-95ab-8c9373b4f53b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:68,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0dda6a84-169d-476a-abfd-39d6cacc4718&quot;,&quot;title&quot;:&quot;DELETE /programs/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a program request is successful&quot;,&quot;fullTitle&quot;:&quot;Programs API DELETE /programs/:id Scenario 1: Delete a program request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { program };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.program_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Program has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:319:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;88bc96f9-ecb2-4eb5-9f7d-46618abfb04d&quot;,&quot;parentUUID&quot;:&quot;0dda6a84-169d-476a-abfd-39d6cacc4718&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a program request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Programs API DELETE /programs/:id Scenario 2: Delete a program request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownProgramId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Program not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:351:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;62739c4f-2038-4b7e-9a0e-c754d5d8ac00&quot;,&quot;parentUUID&quot;:&quot;0dda6a84-169d-476a-abfd-39d6cacc4718&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a program request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Programs API DELETE /programs/:id Scenario 3: Delete a program request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:364:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;d4fdac11-e0ff-4360-b343-8ac798d2b532&quot;,&quot;parentUUID&quot;:&quot;0dda6a84-169d-476a-abfd-39d6cacc4718&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a program request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Programs API DELETE /programs/:id Scenario 4: Delete a program request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingProgram.program_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;93a5965d-1f1d-4f6c-87b5-5be0342a4fd7&quot;,&quot;parentUUID&quot;:&quot;0dda6a84-169d-476a-abfd-39d6cacc4718&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;93a5965d-1f1d-4f6c-87b5-5be0342a4fd7&quot;],&quot;failures&quot;:[&quot;88bc96f9-ecb2-4eb5-9f7d-46618abfb04d&quot;,&quot;62739c4f-2038-4b7e-9a0e-c754d5d8ac00&quot;,&quot;d4fdac11-e0ff-4360-b343-8ac798d2b532&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:32,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;abd9f842-ac03-4ebd-a27b-c2f8856022cb&quot;,&quot;title&quot;:&quot;Reaction Types API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Reaction Types API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API \&quot;before each\&quot; hook in \&quot;Reaction Types API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;42a6086c-9fe8-45f1-bba1-0102c182f0ec&quot;,&quot;parentUUID&quot;:&quot;abd9f842-ac03-4ebd-a27b-c2f8856022cb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bb31d2d5-d02a-47a2-bc26-c302b74a0234&quot;,&quot;title&quot;:&quot;GET /reaction-types&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all reaction types request successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types Scenario 1: Get all reaction types request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys([&#x27;reaction_type_id&#x27;, &#x27;reaction_type&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:34:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;211c8df9-0363-4557-83d9-484231a8f26e&quot;,&quot;parentUUID&quot;:&quot;bb31d2d5-d02a-47a2-bc26-c302b74a0234&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all reaction types request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types Scenario 2: Get all reaction types request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:536,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ReactionTypeModel = require(&#x27;../../src/models/reactionType.model&#x27;);\nconst modelStub = sinon.stub(ReactionTypeModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty reaction_type list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction types not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;56051ee5-a612-41b4-9dea-ba30f31c80be&quot;,&quot;parentUUID&quot;:&quot;bb31d2d5-d02a-47a2-bc26-c302b74a0234&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;211c8df9-0363-4557-83d9-484231a8f26e&quot;,&quot;56051ee5-a612-41b4-9dea-ba30f31c80be&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:546,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;2af43e29-2ca2-4eb9-ab52-e8fc7797756e&quot;,&quot;title&quot;:&quot;GET /reaction-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a reaction type request successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types/:id Scenario 1: Get a reaction type request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys([&#x27;reaction_type_id&#x27;, &#x27;reaction_type&#x27;]);\nexpect(resBody.reaction_type_id).to.be.equal(existingReactionType.reaction_type_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:70:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;fa59fbd8-a268-405e-a650-9c62a75f4238&quot;,&quot;parentUUID&quot;:&quot;2af43e29-2ca2-4eb9-ab52-e8fc7797756e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a reaction type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types/:id Scenario 2: Get a reaction type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownReactionTypeId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction type not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:84:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;2d3b8814-7fdc-4ebd-aa0f-86327c30676d&quot;,&quot;parentUUID&quot;:&quot;2af43e29-2ca2-4eb9-ab52-e8fc7797756e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a reaction type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types/:id Scenario 3: Get a reaction type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingReactionType.reaction_type_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;58636932-81cc-4738-bc04-785821bb6095&quot;,&quot;parentUUID&quot;:&quot;2af43e29-2ca2-4eb9-ab52-e8fc7797756e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;58636932-81cc-4738-bc04-785821bb6095&quot;],&quot;failures&quot;:[&quot;fa59fbd8-a268-405e-a650-9c62a75f4238&quot;,&quot;2d3b8814-7fdc-4ebd-aa0f-86327c30676d&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;596b540f-1d95-4f68-b600-0dae96a60874&quot;,&quot;title&quot;:&quot;POST /reaction-types&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a reaction type request is successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API POST /reaction-types Scenario 1: Create a reaction type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;reaction_type_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.reaction_type_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    reaction_type_id: newId,\n    reaction_type: reaction_type\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:117:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;0e8a8cc2-ef35-4069-aef5-3803b64b7f34&quot;,&quot;parentUUID&quot;:&quot;596b540f-1d95-4f68-b600-0dae96a60874&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a reaction type request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API POST /reaction-types Scenario 2: Create a reaction type request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    reaction_types: reaction_type // &lt;-- a valid parameter name should be &#x27;reaction_type&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;reaction_type&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;ad62ef59-29d6-469a-bde4-7e666fa0edce&quot;,&quot;parentUUID&quot;:&quot;596b540f-1d95-4f68-b600-0dae96a60874&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a reaction type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API POST /reaction-types Scenario 3: Create a reaction type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:172:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;57e085c5-3b9f-41ce-a30e-31635b04fcc1&quot;,&quot;parentUUID&quot;:&quot;596b540f-1d95-4f68-b600-0dae96a60874&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a reaction type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API POST /reaction-types Scenario 4: Create a reaction type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5433ac44-53ca-4d40-8bd3-ea5377d8b3bb&quot;,&quot;parentUUID&quot;:&quot;596b540f-1d95-4f68-b600-0dae96a60874&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5433ac44-53ca-4d40-8bd3-ea5377d8b3bb&quot;],&quot;failures&quot;:[&quot;0e8a8cc2-ef35-4069-aef5-3803b64b7f34&quot;,&quot;ad62ef59-29d6-469a-bde4-7e666fa0edce&quot;,&quot;57e085c5-3b9f-41ce-a30e-31635b04fcc1&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:43,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;cfc67cdb-f8a5-4315-bf08-71561e61c92c&quot;,&quot;title&quot;:&quot;PATCH /reaction-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a reaction type request is successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 1: Update a reaction type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type: newReactionType };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    reaction_type_id: existingReactionType.reaction_type_id,\n    reaction_type: newReactionType\n});\n\n// cleanup\ndata.reaction_type = existingReactionType.reaction_type;\nres = await request(app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:210:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;831e0d6e-2c57-4a74-b599-4d5d4b4a7d56&quot;,&quot;parentUUID&quot;:&quot;cfc67cdb-f8a5-4315-bf08-71561e61c92c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a reaction type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 2: Update a reaction type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type: newReactionType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownReactionTypeId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction type not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:246:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;5c324618-4e92-4a5a-a811-c074c669b808&quot;,&quot;parentUUID&quot;:&quot;cfc67cdb-f8a5-4315-bf08-71561e61c92c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a reaction type request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 3: Update a reaction type request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    reaction_types: newReactionType // &lt;-- a valid parameter name should be &#x27;reaction_type&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;reaction_type&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:265:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;0079e767-63b9-4d37-b9e7-c136218107cb&quot;,&quot;parentUUID&quot;:&quot;cfc67cdb-f8a5-4315-bf08-71561e61c92c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a reaction type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 4: Update a reaction type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type: newReactionType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:283:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;73a6647c-0ce3-4987-991f-e7996093c402&quot;,&quot;parentUUID&quot;:&quot;cfc67cdb-f8a5-4315-bf08-71561e61c92c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a reaction type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 5: Update a reaction type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type: newReactionType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cea78619-dd2e-4bd4-8ecb-6822a4cce92d&quot;,&quot;parentUUID&quot;:&quot;cfc67cdb-f8a5-4315-bf08-71561e61c92c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cea78619-dd2e-4bd4-8ecb-6822a4cce92d&quot;],&quot;failures&quot;:[&quot;831e0d6e-2c57-4a74-b599-4d5d4b4a7d56&quot;,&quot;5c324618-4e92-4a5a-a811-c074c669b808&quot;,&quot;0079e767-63b9-4d37-b9e7-c136218107cb&quot;,&quot;73a6647c-0ce3-4987-991f-e7996093c402&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:41,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;5ade88ef-8b8e-4788-a14e-f70e0b5cac54&quot;,&quot;title&quot;:&quot;DELETE /reaction-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a reaction type request is successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API DELETE /reaction-types/:id Scenario 1: Delete a reaction type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { reaction_type };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.reaction_type_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction type has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:319:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;a07e82a8-32af-488b-a05f-63032ee0d53a&quot;,&quot;parentUUID&quot;:&quot;5ade88ef-8b8e-4788-a14e-f70e0b5cac54&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a reaction type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API DELETE /reaction-types/:id Scenario 2: Delete a reaction type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownReactionTypeId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction type not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:351:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;ebcd7b06-cb8f-4feb-ba19-1dedef85b040&quot;,&quot;parentUUID&quot;:&quot;5ade88ef-8b8e-4788-a14e-f70e0b5cac54&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a reaction type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API DELETE /reaction-types/:id Scenario 3: Delete a reaction type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:364:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;98c09b3e-5b0c-4cb7-ace3-f88c3c38e7d5&quot;,&quot;parentUUID&quot;:&quot;5ade88ef-8b8e-4788-a14e-f70e0b5cac54&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a reaction type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API DELETE /reaction-types/:id Scenario 4: Delete a reaction type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingReactionType.reaction_type_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2c3b1e7d-1f3d-4a69-8437-8092c6071aba&quot;,&quot;parentUUID&quot;:&quot;5ade88ef-8b8e-4788-a14e-f70e0b5cac54&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2c3b1e7d-1f3d-4a69-8437-8092c6071aba&quot;],&quot;failures&quot;:[&quot;a07e82a8-32af-488b-a05f-63032ee0d53a&quot;,&quot;ebcd7b06-cb8f-4feb-ba19-1dedef85b040&quot;,&quot;98c09b3e-5b0c-4cb7-ace3-f88c3c38e7d5&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:28,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;bc0fbb0c-f030-493a-ac3f-d75625e84b88&quot;,&quot;title&quot;:&quot;Saved Activities API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\savedActivity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\savedActivity.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Saved Activities API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API \&quot;before each\&quot; hook in \&quot;Saved Activities API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;acde7636-151f-4e82-92ec-cfac1c0e9c50&quot;,&quot;parentUUID&quot;:&quot;bc0fbb0c-f030-493a-ac3f-d75625e84b88&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;66432778-d751-4bc2-a593-febcdd5da1f8&quot;,&quot;title&quot;:&quot;POST /students/:erp/saved-activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\savedActivity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\savedActivity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a saved activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 1: Create a saved activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: unSavedActivityId, saved_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${userERP}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${userERP}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkActivityId = activity =&gt; activity.activity_id === data.activity_id;\nexpect(res.body.body.some(checkActivityId)).to.be.true;\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${userERP}/${subRoute}/${data.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:45:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;5f30c6cc-2be9-4e79-856c-01e8a6ecbcce&quot;,&quot;parentUUID&quot;:&quot;66432778-d751-4bc2-a593-febcdd5da1f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 1: Create a saved activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 1: Create a saved activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: savedActivityId, saved_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkActivityId = activity =&gt; activity.activity_id === data.activity_id;\nexpect(res.body.body.some(checkActivityId)).to.be.true;\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}/${data.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:78:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;c29641f3-479e-4178-99a1-b811305ba6a8&quot;,&quot;parentUUID&quot;:&quot;66432778-d751-4bc2-a593-febcdd5da1f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a saved activity request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 2: Create a saved activity request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: savedActivityId, saved_at };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${unknownStudentERP}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;student_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:110:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;748ac6e3-6f35-4d2c-84af-c1d9a20ff9c0&quot;,&quot;parentUUID&quot;:&quot;66432778-d751-4bc2-a593-febcdd5da1f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a saved activity request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 3: Create a saved activity request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: unknownActivityId, saved_at }; // &lt;-- Non-existent activity_id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:127:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;617615b2-21b4-46ee-9f80-311ca840b485&quot;,&quot;parentUUID&quot;:&quot;66432778-d751-4bc2-a593-febcdd5da1f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a saved activity request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 4: Create a saved activity request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    id: 1, // &lt;-- a valid parameter name should be &#x27;activity_id&#x27;\n    saved_at: &#x27;not going&#x27; // &lt;-- not a valid saved_at\n};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;saved_at&#x27;, &#x27;activity_id&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:147:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;29b48b24-da97-415e-9970-100bb1237069&quot;,&quot;parentUUID&quot;:&quot;66432778-d751-4bc2-a593-febcdd5da1f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a saved activity request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 5: Create a saved activity request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: savedActivityId, saved_at };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${adminERP}/${subRoute}`) // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:165:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;6a898d8b-2136-4db6-a687-773fe9303032&quot;,&quot;parentUUID&quot;:&quot;66432778-d751-4bc2-a593-febcdd5da1f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a saved activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 6: Create a saved activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: savedActivityId, saved_at };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;efa54417-0f7a-4b56-acf9-f19b6b4a288a&quot;,&quot;parentUUID&quot;:&quot;66432778-d751-4bc2-a593-febcdd5da1f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;efa54417-0f7a-4b56-acf9-f19b6b4a288a&quot;],&quot;failures&quot;:[&quot;5f30c6cc-2be9-4e79-856c-01e8a6ecbcce&quot;,&quot;c29641f3-479e-4178-99a1-b811305ba6a8&quot;,&quot;748ac6e3-6f35-4d2c-84af-c1d9a20ff9c0&quot;,&quot;617615b2-21b4-46ee-9f80-311ca840b485&quot;,&quot;29b48b24-da97-415e-9970-100bb1237069&quot;,&quot;6a898d8b-2136-4db6-a687-773fe9303032&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:69,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;e07014a8-057a-499a-85f9-7a53485f054f&quot;,&quot;title&quot;:&quot;DELETE /students/:erp/saved-activities/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\savedActivity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\savedActivity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a saved activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 1: Delete a saved activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { activity_id: savedActivityId, saved_at };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}/${savedActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp == student_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Saved activity has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No saved activities found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:203:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;ab85ce25-05e9-4280-9031-8e238a407e35&quot;,&quot;parentUUID&quot;:&quot;e07014a8-057a-499a-85f9-7a53485f054f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a saved activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 2: Delete a saved activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { activity_id: savedActivityId, saved_at };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}/${savedActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp != student_erp but still bypass ownerCheck\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Saved activity has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No saved activities found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:238:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;55522ae3-4db6-4fcf-8f47-e181307834f9&quot;,&quot;parentUUID&quot;:&quot;e07014a8-057a-499a-85f9-7a53485f054f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a saved activity request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 3: Delete a saved activity request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownStudentERP}/${subRoute}/${savedActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Saved activity not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:270:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;02618201-5401-4f70-9867-bdb1e757851e&quot;,&quot;parentUUID&quot;:&quot;e07014a8-057a-499a-85f9-7a53485f054f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a saved activity request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 4: Delete a saved activity request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudentERP}/${subRoute}/${unknownActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Saved activity not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:283:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;f82a70aa-6660-4c15-9f8e-f1609c649d2e&quot;,&quot;parentUUID&quot;:&quot;e07014a8-057a-499a-85f9-7a53485f054f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a saved activity request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 5: Delete a saved activity request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${adminERP}/${subRoute}/${savedActivityId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:296:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;ced396f0-f66e-40e0-a8f4-e539b4e3ca0c&quot;,&quot;parentUUID&quot;:&quot;e07014a8-057a-499a-85f9-7a53485f054f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Delete a saved activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 6: Delete a saved activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudentERP}/${subRoute}/${savedActivityId}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a207d165-e8a4-4dfd-88ea-6b67e1dfa7f9&quot;,&quot;parentUUID&quot;:&quot;e07014a8-057a-499a-85f9-7a53485f054f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a207d165-e8a4-4dfd-88ea-6b67e1dfa7f9&quot;],&quot;failures&quot;:[&quot;ab85ce25-05e9-4280-9031-8e238a407e35&quot;,&quot;55522ae3-4db6-4fcf-8f47-e181307834f9&quot;,&quot;02618201-5401-4f70-9867-bdb1e757851e&quot;,&quot;f82a70aa-6660-4c15-9f8e-f1609c649d2e&quot;,&quot;ced396f0-f66e-40e0-a8f4-e539b4e3ca0c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:47,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1d6a64dc-de10-46af-8d96-0e701ff3b06b&quot;,&quot;title&quot;:&quot;Students API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Students API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Students API \&quot;before each\&quot; hook in \&quot;Students API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b289c88b-85d8-4865-8364-966a86e0ef87&quot;,&quot;parentUUID&quot;:&quot;1d6a64dc-de10-46af-8d96-0e701ff3b06b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9c3ed6aa-ce87-400d-bbdb-e9411150b1ee&quot;,&quot;title&quot;:&quot;GET /students&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all students request successful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students Scenario 1: Get all students request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\n// contain all params along with connection details\nexpect(resBody[0]).to.include.all.keys([...Object.keys(existingStudent), &#x27;student_connection&#x27;]);\nconst studentsWithConnection = resBody.filter(o =&gt; o.student_connection !== null);\n// connection details should have these\nexpect(studentsWithConnection[0].student_connection).to.include.all.keys([\n    &#x27;student_connection_id&#x27;,\n    &#x27;sender_erp&#x27;,\n    &#x27;receiver_erp&#x27;,\n    &#x27;connection_status&#x27;,\n    &#x27;sent_at&#x27;,\n    &#x27;accepted_at&#x27;\n]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:52:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;4ce7c2c5-3de7-4f6b-a5ba-bb18149ef44d&quot;,&quot;parentUUID&quot;:&quot;9c3ed6aa-ce87-400d-bbdb-e9411150b1ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all students request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students Scenario 2: Get all students request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?first_name=${existingStudent.first_name}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].first_name).to.be.equal(existingStudent.first_name);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:79:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;3cb4f106-d5da-4273-9ea6-b1131dde78ee&quot;,&quot;parentUUID&quot;:&quot;9c3ed6aa-ce87-400d-bbdb-e9411150b1ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all students request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students Scenario 3: Get all students request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:664,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentModel = require(&#x27;../../src/models/student.model&#x27;);\nconst modelStub = sinon.stub(StudentModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty student list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;6f18b6c9-1cb9-4251-9c5f-0fc6f713df61&quot;,&quot;parentUUID&quot;:&quot;9c3ed6aa-ce87-400d-bbdb-e9411150b1ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all students request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students Scenario 4: Get all students request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6edcddad-c765-4726-98d4-be463b31abbd&quot;,&quot;parentUUID&quot;:&quot;9c3ed6aa-ce87-400d-bbdb-e9411150b1ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6edcddad-c765-4726-98d4-be463b31abbd&quot;],&quot;failures&quot;:[&quot;4ce7c2c5-3de7-4f6b-a5ba-bb18149ef44d&quot;,&quot;3cb4f106-d5da-4273-9ea6-b1131dde78ee&quot;,&quot;6f18b6c9-1cb9-4251-9c5f-0fc6f713df61&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:721,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7259e3aa-dbd7-49a8-9947-63db866b8f06&quot;,&quot;title&quot;:&quot;GET /students/:erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student request successful (Profile)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp Scenario 1: Get a student request successful (Profile)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // userToken.erp === existingStudent.erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.erp).to.be.equal(existingStudent.erp); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:124:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;994b9ab6-f798-4d99-9c67-ac1232d6501a&quot;,&quot;parentUUID&quot;:&quot;7259e3aa-dbd7-49a8-9947-63db866b8f06&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student request successful (Others)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp Scenario 2: Get a student request successful (Others)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${adminERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // userToken.erp !== adminERP\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.erp).to.be.equal(adminERP); // should match initially sent id\nexpect(resBody.student_connection).to.exist; // should contain connection details&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:137:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;b8807b7a-5ea1-450c-804e-d4272fc45866&quot;,&quot;parentUUID&quot;:&quot;7259e3aa-dbd7-49a8-9947-63db866b8f06&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp Scenario 3: Get a student request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unregisteredERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:151:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;b3d920ac-e996-48ba-9ad7-f2b831b70a38&quot;,&quot;parentUUID&quot;:&quot;7259e3aa-dbd7-49a8-9947-63db866b8f06&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a student request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp Scenario 4: Get a student request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudent.erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6082c7c9-e23f-4b2d-96a6-fd7d5cbd06d2&quot;,&quot;parentUUID&quot;:&quot;7259e3aa-dbd7-49a8-9947-63db866b8f06&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6082c7c9-e23f-4b2d-96a6-fd7d5cbd06d2&quot;],&quot;failures&quot;:[&quot;994b9ab6-f798-4d99-9c67-ac1232d6501a&quot;,&quot;b8807b7a-5ea1-450c-804e-d4272fc45866&quot;,&quot;b3d920ac-e996-48ba-9ad7-f2b831b70a38&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:29,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f29efa76-fcbc-41e4-906d-90912f8e19c3&quot;,&quot;title&quot;:&quot;GET /students/:erp/organized-activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student&#x27;s organized activities request successful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 1: Get a student&#x27;s organized activities request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst organizerCheck = activity =&gt; activity.organizer_erp === existingStudent.erp;\nexpect(resBody.every(organizerCheck)).to.be.true; // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:179:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;aea3f90e-d4f7-4130-a671-e6b761a930b8&quot;,&quot;parentUUID&quot;:&quot;f29efa76-fcbc-41e4-906d-90912f8e19c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student&#x27;s organized activities request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 2: Get a student&#x27;s organized activities request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst frequency = &#x27;one_time&#x27;;\nconst query = `frequency=${frequency}`;\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = activity =&gt; activity.frequency === frequency;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:196:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;b3380ce5-57f0-48ca-9af6-7209e89c63af&quot;,&quot;parentUUID&quot;:&quot;f29efa76-fcbc-41e4-906d-90912f8e19c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student&#x27;s organized activities request is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 3: Get a student&#x27;s organized activities request is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unregisteredERP}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No organized activities found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:211:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;32ff9347-65b3-40cb-8a05-f72a6ff03c31&quot;,&quot;parentUUID&quot;:&quot;f29efa76-fcbc-41e4-906d-90912f8e19c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a student&#x27;s organized activities request is unsuccessful due to no organized activities&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 4: Get a student&#x27;s organized activities request is unsuccessful due to no organized activities&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:584,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentModel = require(&#x27;../../src/models/student.model&#x27;);\nconst modelStub = sinon.stub(StudentModel, &#x27;findAllOrganizedActivitiesByStudent&#x27;).callsFake(() =&gt; []); // return empty organized activities list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No organized activities found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;0d43f2d3-b0ca-46c1-aa04-59a7c8a5ca88&quot;,&quot;parentUUID&quot;:&quot;f29efa76-fcbc-41e4-906d-90912f8e19c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get a student&#x27;s organized activities request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 5: Get a student&#x27;s organized activities request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;all&#x27;; // &lt;-- invalid privacy value\nconst invalidQueryParams = `privacy=${privacy}&amp;week=2`; // &lt;-- `week` is an incorrect query param\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${invalidQueryParams}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(422);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParamCheck = o =&gt; o.param === &#x27;privacy&#x27;;\nexpect(resHeaders.data.some(incorrectParamCheck)).to.be.true;\nconst incorrectMsgCheck = o =&gt; o.msg === &#x27;Invalid query params!&#x27;;\nexpect(resHeaders.data.some(incorrectMsgCheck)).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:246:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;9cf44db6-0329-49b3-afe6-8a0a5d6e1af1&quot;,&quot;parentUUID&quot;:&quot;f29efa76-fcbc-41e4-906d-90912f8e19c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get a student&#x27;s organized activities is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 6: Get a student&#x27;s organized activities is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudent.erp}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5c90b64d-bf1d-41a9-91e4-de233793570c&quot;,&quot;parentUUID&quot;:&quot;f29efa76-fcbc-41e4-906d-90912f8e19c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5c90b64d-bf1d-41a9-91e4-de233793570c&quot;],&quot;failures&quot;:[&quot;aea3f90e-d4f7-4130-a671-e6b761a930b8&quot;,&quot;b3380ce5-57f0-48ca-9af6-7209e89c63af&quot;,&quot;32ff9347-65b3-40cb-8a05-f72a6ff03c31&quot;,&quot;0d43f2d3-b0ca-46c1-aa04-59a7c8a5ca88&quot;,&quot;9cf44db6-0329-49b3-afe6-8a0a5d6e1af1&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:624,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;3c95a467-3b68-438a-a9d4-268dfb46d9ca&quot;,&quot;title&quot;:&quot;GET /students/:erp/attended-activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student&#x27;s attended activities request successful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 1: Get a student&#x27;s attended activities request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst attendeeCheck = activity =&gt; activity.student_erp === existingStudent.erp;\nexpect(resBody.every(attendeeCheck)).to.be.true; // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:278:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;10187d5b-e5d7-4845-a806-47a6f8e4ef36&quot;,&quot;parentUUID&quot;:&quot;3c95a467-3b68-438a-a9d4-268dfb46d9ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student&#x27;s attended activities request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 2: Get a student&#x27;s attended activities request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst involvement_type = &#x27;going&#x27;;\nconst query = `involvement_type=${involvement_type}`;\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst attendeeCheck = activity =&gt; activity.student_erp === existingStudent.erp;\nexpect(resBody.every(attendeeCheck)).to.be.true; // should match initially sent id\nconst queryCheck = activity =&gt; activity.involvement_type === involvement_type;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:295:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;2a4738c1-a382-4e08-a400-c8267d140e63&quot;,&quot;parentUUID&quot;:&quot;3c95a467-3b68-438a-a9d4-268dfb46d9ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student&#x27;s attended activities request is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 3: Get a student&#x27;s attended activities request is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unregisteredERP}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No interacted activities found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:312:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;715b2420-8d32-453c-a5e1-26b5fbb74537&quot;,&quot;parentUUID&quot;:&quot;3c95a467-3b68-438a-a9d4-268dfb46d9ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a student&#x27;s attended activities request is unsuccessful due to no attended activities&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 4: Get a student&#x27;s attended activities request is unsuccessful due to no attended activities&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:762,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentModel = require(&#x27;../../src/models/student.model&#x27;);\nconst modelStub = sinon.stub(StudentModel, &#x27;findAllAttendedActivitiesByStudent&#x27;).callsFake(() =&gt; []); // return empty attended activities list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No interacted activities found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;09a60cbc-bdd8-4e6b-be7a-991a91f9a62e&quot;,&quot;parentUUID&quot;:&quot;3c95a467-3b68-438a-a9d4-268dfb46d9ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get a student&#x27;s attended activities request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 5: Get a student&#x27;s attended activities request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst involvement_type = &#x27;not going&#x27;; // &lt;-- invalid involvement type value\nconst invalidQueryParams = `involvement_type=${involvement_type}&amp;week=2`; // &lt;-- `week` is an incorrect query param\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${invalidQueryParams}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(422);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParamCheck = o =&gt; o.param === &#x27;involvement_type&#x27;;\nexpect(resHeaders.data.some(incorrectParamCheck)).to.be.true;\nconst incorrectMsgCheck = o =&gt; o.msg === &#x27;Invalid query params!&#x27;;\nexpect(resHeaders.data.some(incorrectMsgCheck)).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:347:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;f85b929c-c723-4afc-be2b-4bfeee831913&quot;,&quot;parentUUID&quot;:&quot;3c95a467-3b68-438a-a9d4-268dfb46d9ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get a student&#x27;s attended activities is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 6: Get a student&#x27;s attended activities is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudent.erp}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c1d47a29-5493-4d4a-9310-3c881afc684c&quot;,&quot;parentUUID&quot;:&quot;3c95a467-3b68-438a-a9d4-268dfb46d9ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c1d47a29-5493-4d4a-9310-3c881afc684c&quot;],&quot;failures&quot;:[&quot;10187d5b-e5d7-4845-a806-47a6f8e4ef36&quot;,&quot;2a4738c1-a382-4e08-a400-c8267d140e63&quot;,&quot;715b2420-8d32-453c-a5e1-26b5fbb74537&quot;,&quot;09a60cbc-bdd8-4e6b-be7a-991a91f9a62e&quot;,&quot;f85b929c-c723-4afc-be2b-4bfeee831913&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:826,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c0f20bf4-f8b8-4a7b-a183-14ee36d32d82&quot;,&quot;title&quot;:&quot;GET /students/:erp/saved-activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student&#x27;s saved activities request successful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 1: Get a student&#x27;s saved activities request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst studentERPCheck = activity =&gt; activity.student_erp === existingStudent.erp;\nexpect(resBody.every(studentERPCheck)).to.be.true; // should match initially sent erp&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:379:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;b3861837-a6f8-42cf-9706-6ef966174d37&quot;,&quot;parentUUID&quot;:&quot;c0f20bf4-f8b8-4a7b-a183-14ee36d32d82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student&#x27;s saved activities request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 2: Get a student&#x27;s saved activities request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst frequency = &#x27;daily&#x27;;\nconst query = `frequency=${frequency}`;\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = activity =&gt; activity.frequency === frequency;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:396:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;395f6378-7651-4980-bc06-ce3c7d587fd2&quot;,&quot;parentUUID&quot;:&quot;c0f20bf4-f8b8-4a7b-a183-14ee36d32d82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student&#x27;s saved activities request is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 3: Get a student&#x27;s saved activities request is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unregisteredERP}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No saved activities found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:411:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;c4700e9e-9689-42df-9b63-3b2e39af7312&quot;,&quot;parentUUID&quot;:&quot;c0f20bf4-f8b8-4a7b-a183-14ee36d32d82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a student&#x27;s saved activities request is unsuccessful due to no saved activities&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 4: Get a student&#x27;s saved activities request is unsuccessful due to no saved activities&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:686,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentModel = require(&#x27;../../src/models/student.model&#x27;);\nconst modelStub = sinon.stub(StudentModel, &#x27;findAllSavedActivitiesByStudent&#x27;).callsFake(() =&gt; []); // return empty saved activities list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No saved activities found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;993b2a5d-362e-4309-b3cc-cd715b00bb24&quot;,&quot;parentUUID&quot;:&quot;c0f20bf4-f8b8-4a7b-a183-14ee36d32d82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get a student&#x27;s saved activities request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 5: Get a student&#x27;s saved activities request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;all&#x27;; // &lt;-- invalid privacy value\nconst invalidQueryParams = `privacy=${privacy}&amp;week=2`; // &lt;-- `week` is an incorrect query param\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${invalidQueryParams}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(422);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParamCheck = o =&gt; o.param === &#x27;privacy&#x27;;\nexpect(resHeaders.data.some(incorrectParamCheck)).to.be.true;\nconst incorrectMsgCheck = o =&gt; o.msg === &#x27;Invalid query params!&#x27;;\nexpect(resHeaders.data.some(incorrectMsgCheck)).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:446:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;f4159029-e7b6-4e27-92d3-fbae048dbcb4&quot;,&quot;parentUUID&quot;:&quot;c0f20bf4-f8b8-4a7b-a183-14ee36d32d82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get a student&#x27;s saved activities request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 6: Get a student&#x27;s saved activities request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const res = await request(this.app)\n    .get(`${baseRoute}/${adminERP}/${subRoute}`) // token erp != adminERP\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user can&#x27;t view others saved activities\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:462:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;440b201e-0304-4b8c-a4a2-1d4d33ea6093&quot;,&quot;parentUUID&quot;:&quot;c0f20bf4-f8b8-4a7b-a183-14ee36d32d82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Get a student&#x27;s saved activities is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 7: Get a student&#x27;s saved activities is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudent.erp}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ff7f7083-fe59-4445-88a4-7e4e2ec83b19&quot;,&quot;parentUUID&quot;:&quot;c0f20bf4-f8b8-4a7b-a183-14ee36d32d82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ff7f7083-fe59-4445-88a4-7e4e2ec83b19&quot;],&quot;failures&quot;:[&quot;b3861837-a6f8-42cf-9706-6ef966174d37&quot;,&quot;395f6378-7651-4980-bc06-ce3c7d587fd2&quot;,&quot;c4700e9e-9689-42df-9b63-3b2e39af7312&quot;,&quot;993b2a5d-362e-4309-b3cc-cd715b00bb24&quot;,&quot;f4159029-e7b6-4e27-92d3-fbae048dbcb4&quot;,&quot;440b201e-0304-4b8c-a4a2-1d4d33ea6093&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:802,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;500786bb-5b0d-46d3-9f60-321cae7b943a&quot;,&quot;title&quot;:&quot;PATCH /students/:erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a student request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 1: Update a student request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingStudent.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.last_name).to.be.equal(newStudentLastName);\n\n// cleanup\ndata.last_name = existingStudent.last_name;\nres = await request(app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:495:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;53f39335-83a3-4d99-921e-af33f9a9cc63&quot;,&quot;parentUUID&quot;:&quot;500786bb-5b0d-46d3-9f60-321cae7b943a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a student request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 2: Update a student request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // admin to edit other profiles i.e. token erp != existingStudent.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.last_name).to.be.equal(newStudentLastName);\n\n// cleanup\ndata.last_name = existingStudent.last_name;\nres = await request(app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:530:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;bf343f4f-1c2d-4f3e-bb3a-093fb783b0e9&quot;,&quot;parentUUID&quot;:&quot;500786bb-5b0d-46d3-9f60-321cae7b943a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a student request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 3: Update a student request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unregisteredERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:564:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;e4afb2c3-aa79-4244-b54c-720f1ba845c3&quot;,&quot;parentUUID&quot;:&quot;500786bb-5b0d-46d3-9f60-321cae7b943a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a student request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 4: Update a student request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    last_namesds: newStudentLastName, // &lt;-- an valid parameter name should be &#x27;last_name&#x27;\n    first_name: &#x27;test-user%&#x27; // &lt;-- a valid &#x27;first_name&#x27; contains alphabets only\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;first_name&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:584:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;77fd9acb-7afe-4a91-8779-ba4d6fcf09dd&quot;,&quot;parentUUID&quot;:&quot;500786bb-5b0d-46d3-9f60-321cae7b943a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a student request is forbidden (Unowned ERP)&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 5: Update a student request is forbidden (Unowned ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\nconst unOwnedERP = adminERP; // &lt;-- can be any other non-admin ERP as well, just different from existingStudent.erp\n\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others profile i.e. token erp != otherERP\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:605:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;a74ca573-8b3e-4c64-9366-4f4ae596d462&quot;,&quot;parentUUID&quot;:&quot;500786bb-5b0d-46d3-9f60-321cae7b943a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a student request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 6: Update a student request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;36c5206d-51e8-44cc-b4f3-8446f0b9113f&quot;,&quot;parentUUID&quot;:&quot;500786bb-5b0d-46d3-9f60-321cae7b943a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;36c5206d-51e8-44cc-b4f3-8446f0b9113f&quot;],&quot;failures&quot;:[&quot;53f39335-83a3-4d99-921e-af33f9a9cc63&quot;,&quot;bf343f4f-1c2d-4f3e-bb3a-093fb783b0e9&quot;,&quot;e4afb2c3-aa79-4244-b54c-720f1ba845c3&quot;,&quot;77fd9acb-7afe-4a91-8779-ba4d6fcf09dd&quot;,&quot;a74ca573-8b3e-4c64-9366-4f4ae596d462&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:69,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f2d12ce8-77bf-4c88-91e0-6b9849ad5012&quot;,&quot;title&quot;:&quot;DELETE /students/:erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a student request is successful&quot;,&quot;fullTitle&quot;:&quot;Students API DELETE /students/:erp Scenario 1: Delete a student request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:88,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst student = {\n    erp: newERP,\n    password: &#x27;123&#x27;,\n    uni_email: newEmail,\n    first_name: existingStudent.first_name,\n    last_name: existingStudent.last_name,\n    gender: existingStudent.gender,\n    contact: existingStudent.contact,\n    birthday: existingStudent.birthday,\n    profile_picture_url: existingStudent.profile_picture_url,\n    graduation_year: existingStudent.graduation_year,\n    campus_id: existingStudent.campus_id,\n    program_id: existingStudent.program_id,\n    is_active: existingStudent.is_active\n};\nconst registerRoute = `/api/${Config.API_VERSION}/auth/register`;\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(registerRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(student);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.erp;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:655:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;bb6e1e45-561c-408e-8246-de094e1261b1&quot;,&quot;parentUUID&quot;:&quot;f2d12ce8-77bf-4c88-91e0-6b9849ad5012&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a student request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Students API DELETE /students/:erp Scenario 2: Delete a student request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unregisteredERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:687:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;13181bfb-2002-4ebe-b0fa-e74406a59964&quot;,&quot;parentUUID&quot;:&quot;f2d12ce8-77bf-4c88-91e0-6b9849ad5012&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a student request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Students API DELETE /students/:erp Scenario 3: Delete a student request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:700:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;99ce3db7-262d-44bd-aa87-77024b3fff5d&quot;,&quot;parentUUID&quot;:&quot;f2d12ce8-77bf-4c88-91e0-6b9849ad5012&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a student request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API DELETE /students/:erp Scenario 4: Delete a student request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudent.erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;66e85558-fd3f-4170-8311-e07a8e187aea&quot;,&quot;parentUUID&quot;:&quot;f2d12ce8-77bf-4c88-91e0-6b9849ad5012&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;66e85558-fd3f-4170-8311-e07a8e187aea&quot;],&quot;failures&quot;:[&quot;bb6e1e45-561c-408e-8246-de094e1261b1&quot;,&quot;13181bfb-2002-4ebe-b0fa-e74406a59964&quot;,&quot;99ce3db7-262d-44bd-aa87-77024b3fff5d&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:112,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;04617805-cf2f-4dd4-907b-2d028c7c8574&quot;,&quot;title&quot;:&quot;Connection Requests API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Connection Requests API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API \&quot;before each\&quot; hook in \&quot;Connection Requests API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f6984272-c17f-4448-8816-0dda035de48e&quot;,&quot;parentUUID&quot;:&quot;04617805-cf2f-4dd4-907b-2d028c7c8574&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ec91bff3-1bdd-4513-808a-3a2f18e389d7&quot;,&quot;title&quot;:&quot;GET /student-connections&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all friend connections is successful&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 1: Get all friend connections is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst erp = adminERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?erp=${erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // adminToken.erp === erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst studentCheck = studentConn =&gt; studentConn.sender.erp === erp || studentConn.receiver.erp === erp;\nconst connectionStatusCheck = studentConn =&gt; studentConn.connection_status === &#x27;friends&#x27;;\nconst queryCheck = studentConn =&gt; studentCheck(studentConn) &amp;&amp; connectionStatusCheck(studentConn);\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([&#x27;student_connection_id&#x27;, &#x27;sender&#x27;, &#x27;receiver&#x27;, &#x27;connection_status&#x27;, &#x27;sent_at&#x27;, &#x27;accepted_at&#x27;]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingConnectionRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingConnectionRequest.receiver));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:55:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;a7a31871-5e32-4f46-bca1-72f32bcf326b&quot;,&quot;parentUUID&quot;:&quot;ec91bff3-1bdd-4513-808a-3a2f18e389d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all student connections unsuccessful due to no friend connections&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 2: Get all student connections unsuccessful due to no friend connections&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?erp=${erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:78:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;4be971e3-8b56-4d29-9f54-c369afda8fba&quot;,&quot;parentUUID&quot;:&quot;ec91bff3-1bdd-4513-808a-3a2f18e389d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all others&#x27; friends connections is successful&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 3: Get all others&#x27; friends connections is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst erp = adminERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?erp=${erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp !== erp\n\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst studentCheck = studentConn =&gt; studentConn.sender.erp === erp || studentConn.receiver.erp === erp;\nconst connectionStatusCheck = studentConn =&gt; studentConn.connection_status === &#x27;friends&#x27;;\nconst queryCheck = studentConn =&gt; studentCheck(studentConn) &amp;&amp; connectionStatusCheck(studentConn);\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([&#x27;student_connection_id&#x27;, &#x27;sender&#x27;, &#x27;receiver&#x27;, &#x27;connection_status&#x27;, &#x27;sent_at&#x27;, &#x27;accepted_at&#x27;]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingConnectionRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingConnectionRequest.receiver));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:92:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;e83e2258-cc6f-4000-bc5e-2f8af2ba852d&quot;,&quot;parentUUID&quot;:&quot;ec91bff3-1bdd-4513-808a-3a2f18e389d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all student connections is incorrect due to no query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 4: Get all student connections is incorrect due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute) // &lt;-- must specify erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParam = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParam).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:112:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;e147ee87-7010-43a8-968a-1e71af014f52&quot;,&quot;parentUUID&quot;:&quot;ec91bff3-1bdd-4513-808a-3a2f18e389d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all student connections is incorrect due to unknown query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 5: Get all student connections is incorrect due to unknown query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst erp = &#x27;123&#x27;; // a valid erp is 5 digits\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?erp=${erp}&amp;connection_status=friends`) // &lt;-- &#x27;connection_status&#x27; is invalid query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:129:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;2123558c-a8cb-4ff9-a0c8-480d43e54f5c&quot;,&quot;parentUUID&quot;:&quot;ec91bff3-1bdd-4513-808a-3a2f18e389d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get all student connections is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 6: Get all student connections is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;303bab9e-3581-4f3b-a9da-bc74f8cfb8b4&quot;,&quot;parentUUID&quot;:&quot;ec91bff3-1bdd-4513-808a-3a2f18e389d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;303bab9e-3581-4f3b-a9da-bc74f8cfb8b4&quot;],&quot;failures&quot;:[&quot;a7a31871-5e32-4f46-bca1-72f32bcf326b&quot;,&quot;4be971e3-8b56-4d29-9f54-c369afda8fba&quot;,&quot;e83e2258-cc6f-4000-bc5e-2f8af2ba852d&quot;,&quot;e147ee87-7010-43a8-968a-1e71af014f52&quot;,&quot;2123558c-a8cb-4ff9-a0c8-480d43e54f5c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:60,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;bb9238a0-ba77-4c5e-ab84-59f81e022a48&quot;,&quot;title&quot;:&quot;GET /student-connections/requests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all connection requests is successful (Sent)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 1: Get all connection requests is successful (Sent)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // userToken.erp === sender_erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = studentConnection =&gt; studentConnection.sender.erp === sender_erp;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([&#x27;student_connection_id&#x27;, &#x27;sender&#x27;, &#x27;receiver&#x27;, &#x27;connection_status&#x27;, &#x27;sent_at&#x27;]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingConnectionRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingConnectionRequest.receiver));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:163:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;9961bafc-94f3-43e3-9dc7-bc6985e71cf0&quot;,&quot;parentUUID&quot;:&quot;bb9238a0-ba77-4c5e-ab84-59f81e022a48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all connection requests is successful (Receiver)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 2: Get all connection requests is successful (Receiver)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = adminERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?receiver_erp=${receiver_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // adminToken.erp === sender_erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = studentConnection =&gt; studentConnection.receiver.erp === receiver_erp;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([&#x27;student_connection_id&#x27;, &#x27;sender&#x27;, &#x27;receiver&#x27;, &#x27;connection_status&#x27;, &#x27;sent_at&#x27;]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingConnectionRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingConnectionRequest.receiver));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:184:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;6bb03e3a-5596-4bee-ad1b-33c895850a7e&quot;,&quot;parentUUID&quot;:&quot;bb9238a0-ba77-4c5e-ab84-59f81e022a48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all connection requests unsuccessful due to no (sent) connection requests&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 3: Get all connection requests unsuccessful due to no (sent) connection requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = user2ERP;\nconst fakeToken = jwt.sign({erp: sender_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}`)\n    .auth(fakeToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:206:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;ef37566b-28e4-478b-8d6d-f730580423f1&quot;,&quot;parentUUID&quot;:&quot;bb9238a0-ba77-4c5e-ab84-59f81e022a48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all connection requests unsuccessful due to no (received) connection requests&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 4: Get all connection requests unsuccessful due to no (received) connection requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = user2ERP;\nconst fakeToken = jwt.sign({erp: receiver_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?receiver_erp=${receiver_erp}`)\n    .auth(fakeToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:221:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;c2a40826-7f14-4c15-90fa-f60efc51db41&quot;,&quot;parentUUID&quot;:&quot;bb9238a0-ba77-4c5e-ab84-59f81e022a48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all connection requests is incorrect due to multiple query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 5: Get all connection requests is incorrect due to multiple query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\nconst receiver_erp = user2ERP;\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}&amp;receiver_erp=${receiver_erp}`) // &lt;-- can&#x27;t specify both sender_erp and receiver_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;receiver_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Can\\&#x27;t specify both sender and receiver erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:236:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;a0ea31fc-feb2-4ae5-bb03-7c96f555e672&quot;,&quot;parentUUID&quot;:&quot;bb9238a0-ba77-4c5e-ab84-59f81e022a48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get all connection requests is incorrect due to no query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 6: Get all connection requests is incorrect due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}`) // &lt;-- either specify sender_erp or receiver_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Either sender or receiver erp is required&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:252:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;68802de4-7db2-40f4-aee1-1308dbb23fca&quot;,&quot;parentUUID&quot;:&quot;bb9238a0-ba77-4c5e-ab84-59f81e022a48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Get all connection requests is incorrect due to unknown query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 7: Get all connection requests is incorrect due to unknown query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = &#x27;123&#x27;; // a valid erp is 5 digits\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}&amp;connection_status=friends`) // &lt;-- &#x27;connection_status&#x27; is invalid query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;sender_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:269:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;ef13d1e2-013f-4e48-bf82-0c7a20070328&quot;,&quot;parentUUID&quot;:&quot;bb9238a0-ba77-4c5e-ab84-59f81e022a48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Get request is forbidden due to querying other&#x27;s sent connection requests&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 8: Get request is forbidden due to querying other&#x27;s sent connection requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp !== sender_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:288:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;d701fd80-5654-4931-ba6f-84e6df890fe2&quot;,&quot;parentUUID&quot;:&quot;bb9238a0-ba77-4c5e-ab84-59f81e022a48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Get request is forbidden due to querying other&#x27;s received connection requests&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 9: Get request is forbidden due to querying other&#x27;s received connection requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?receiver_erp=${receiver_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp !== receiver_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:304:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;9219ed1b-1f62-4b80-98c2-ecccabbe6dcd&quot;,&quot;parentUUID&quot;:&quot;bb9238a0-ba77-4c5e-ab84-59f81e022a48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Get all connection requests is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 10: Get all connection requests is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d59982b8-8c23-4498-9916-f8bf1ff8f054&quot;,&quot;parentUUID&quot;:&quot;bb9238a0-ba77-4c5e-ab84-59f81e022a48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d59982b8-8c23-4498-9916-f8bf1ff8f054&quot;],&quot;failures&quot;:[&quot;9961bafc-94f3-43e3-9dc7-bc6985e71cf0&quot;,&quot;6bb03e3a-5596-4bee-ad1b-33c895850a7e&quot;,&quot;ef37566b-28e4-478b-8d6d-f730580423f1&quot;,&quot;c2a40826-7f14-4c15-90fa-f60efc51db41&quot;,&quot;a0ea31fc-feb2-4ae5-bb03-7c96f555e672&quot;,&quot;68802de4-7db2-40f4-aee1-1308dbb23fca&quot;,&quot;ef13d1e2-013f-4e48-bf82-0c7a20070328&quot;,&quot;d701fd80-5654-4931-ba6f-84e6df890fe2&quot;,&quot;9219ed1b-1f62-4b80-98c2-ecccabbe6dcd&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:88,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1762065d-3bb2-4ef3-a91b-e60812ee6b43&quot;,&quot;title&quot;:&quot;POST /student-connections&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a connection request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 1: Create a connection request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp, receiver_erp, sent_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // token erp === sender_erp in body\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.student_connection_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // token erp === sender_erp in body\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    student_connection_id: newId,\n    ...data,\n    connection_status: existingConnectionRequest.connection_status,\n    accepted_at: null,\n    student_1_erp: data.receiver_erp, // 17619, bcz smaller\n    student_2_erp: data.sender_erp // 17855, bcz greater\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // sender deletes it\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:339:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;932afa46-e2f0-467d-b3be-e88be9b56676&quot;,&quot;parentUUID&quot;:&quot;1762065d-3bb2-4ef3-a91b-e60812ee6b43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a connection request is unsuccessful due to unknown receiver_erp&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 2: Create a connection request is unsuccessful due to unknown receiver_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: existingConnectionRequest.sender.erp,\n    receiver_erp: unknownStudentERP,\n    sent_at\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === existingStudentConnection.sender.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;receiver_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:381:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;b6101353-f5cc-47cd-b865-9cb477a66386&quot;,&quot;parentUUID&quot;:&quot;1762065d-3bb2-4ef3-a91b-e60812ee6b43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a connection request is unsuccessful due to already sent connection request&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 3: Create a connection request is unsuccessful due to already sent connection request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: existingConnectionRequest.sender.erp,\n    receiver_erp: existingConnectionRequest.receiver.erp,\n    sent_at\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === existingStudentConnection.sender.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(409);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DuplicateEntryException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 409&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 409\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:401:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;409&quot;}]},&quot;uuid&quot;:&quot;238fccea-fef3-4729-adbc-c2cbe69baa2d&quot;,&quot;parentUUID&quot;:&quot;1762065d-3bb2-4ef3-a91b-e60812ee6b43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a connection request is unsuccessful due to already received connection request&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 4: Create a connection request is unsuccessful due to already received connection request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: existingConnectionRequest.receiver.erp,\n    receiver_erp: existingConnectionRequest.sender.erp, // flip receiver and sender\n    sent_at\n};\nconst senderToken = jwt.sign({erp: data.sender_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(senderToken, { type: &#x27;bearer&#x27; }) // senderToken erp === data.sender_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(409);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DuplicateEntryException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 409&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 409\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:422:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;409&quot;}]},&quot;uuid&quot;:&quot;79c37d5e-55ac-4c76-9a50-f8483df5f183&quot;,&quot;parentUUID&quot;:&quot;1762065d-3bb2-4ef3-a91b-e60812ee6b43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a connection request is incorrect due to wrong key name in the body&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 5: Create a connection request is incorrect due to wrong key name in the body&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { // missing receiver_erp\n    sent_at: &#x27;not going&#x27;, // &lt;-- not a valid sent_at\n    send_erp: &#x27;12345&#x27; // &lt;-- a valid parameter name should be &#x27;sender_erp&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;receiver_erp&#x27;, &#x27;sent_at&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:441:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;555372ab-9c62-47f4-b89b-292ced91c08f&quot;,&quot;parentUUID&quot;:&quot;1762065d-3bb2-4ef3-a91b-e60812ee6b43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a connection request is incorrect due to connection request to oneself&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 6: Create a connection request is incorrect due to connection request to oneself&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: sender_erp,\n    receiver_erp: sender_erp,\n    sent_at\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === data.sender_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;receiver_erp&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Sender and receiver ERP can\\&#x27;t be the same&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:463:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;5fa6b802-3449-4054-a9ba-a5f4b78edf39&quot;,&quot;parentUUID&quot;:&quot;1762065d-3bb2-4ef3-a91b-e60812ee6b43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Create a connection request is forbidden due to unowned connection request&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 7: Create a connection request is forbidden due to unowned connection request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp: adminERP, receiver_erp, sent_at }; // adminERP instead of userERP\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- data.sender_erp !== userToken.erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:483:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;447c7780-201e-4995-8b0b-fa7c7992f6fd&quot;,&quot;parentUUID&quot;:&quot;1762065d-3bb2-4ef3-a91b-e60812ee6b43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Create a connection request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 8: Create a connection request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp, receiver_erp, sent_at };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3d7a9e56-5b38-4723-a84e-2897c02cc4aa&quot;,&quot;parentUUID&quot;:&quot;1762065d-3bb2-4ef3-a91b-e60812ee6b43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3d7a9e56-5b38-4723-a84e-2897c02cc4aa&quot;],&quot;failures&quot;:[&quot;932afa46-e2f0-467d-b3be-e88be9b56676&quot;,&quot;b6101353-f5cc-47cd-b865-9cb477a66386&quot;,&quot;238fccea-fef3-4729-adbc-c2cbe69baa2d&quot;,&quot;79c37d5e-55ac-4c76-9a50-f8483df5f183&quot;,&quot;555372ab-9c62-47f4-b89b-292ced91c08f&quot;,&quot;5fa6b802-3449-4054-a9ba-a5f4b78edf39&quot;,&quot;447c7780-201e-4995-8b0b-fa7c7992f6fd&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:58,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b848fa4a-5e6f-4fb0-bebc-a5ff6dd2b3c6&quot;,&quot;title&quot;:&quot;PATCH /student-connections/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a connection request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API PATCH /student-connections/:id Scenario 1: Update a connection request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { connection_status, accepted_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminToken.erp == existingStudentConnection.receiver.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${studentConnectionId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst {sender, receiver, ...studentConnection} = existingConnectionRequest;\n\nstudentConnection.sender_erp = existingConnectionRequest.sender.erp;\nstudentConnection.receiver_erp = existingConnectionRequest.receiver.erp; // 15030, bcz smaller\nstudentConnection.student_1_erp = existingConnectionRequest.receiver.erp; // 15030, bcz smaller\nstudentConnection.student_2_erp = existingConnectionRequest.sender.erp; // 17855, bcz greater\nstudentConnection.accepted_at = data.accepted_at;\nstudentConnection.connection_status = data.connection_status;\nexpect(res.body.body).to.be.eql(studentConnection);\n\n// cleanup\ndata.connection_status = existingConnectionRequest.connection_status;\ndata.accepted_at = existingConnectionRequest.accepted_at;\nres = await request(app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminToken.erp == existingStudentConnection.receiver.erp\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:523:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;02223633-b1b7-4619-a00e-adb74e15f091&quot;,&quot;parentUUID&quot;:&quot;b848fa4a-5e6f-4fb0-bebc-a5ff6dd2b3c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a connection request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API PATCH /student-connections/:id Scenario 2: Update a connection request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    connection_status: &#x27;ignored&#x27;, // &lt;-- not a valid connection_status\n    accepted_at, // can&#x27;t specify accepted at unless connection_status === &#x27;friends&#x27;\n    sender_erp: &#x27;12345&#x27; // &lt;-- an invalid update parameter i.e. not allowed\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;connection_status&#x27;, &#x27;accepted_at&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include.members([&#x27;Invalid updates!&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:569:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;97d1680a-a13c-47f8-935f-62715b3824cd&quot;,&quot;parentUUID&quot;:&quot;b848fa4a-5e6f-4fb0-bebc-a5ff6dd2b3c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a connection request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API PATCH /student-connections/:id Scenario 3: Update a connection request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { connection_status, accepted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- userToken.erp !== existingStudentConnection.receiver.erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:589:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;51472d4d-67b9-4660-b8f5-9241d503d1dd&quot;,&quot;parentUUID&quot;:&quot;b848fa4a-5e6f-4fb0-bebc-a5ff6dd2b3c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a connection request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API PATCH /student-connections/:id Scenario 4: Update a connection request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { connection_status, accepted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bddacb68-389e-473c-87a0-650a44b3b4ec&quot;,&quot;parentUUID&quot;:&quot;b848fa4a-5e6f-4fb0-bebc-a5ff6dd2b3c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bddacb68-389e-473c-87a0-650a44b3b4ec&quot;],&quot;failures&quot;:[&quot;02223633-b1b7-4619-a00e-adb74e15f091&quot;,&quot;97d1680a-a13c-47f8-935f-62715b3824cd&quot;,&quot;51472d4d-67b9-4660-b8f5-9241d503d1dd&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;88a9e4df-4346-4362-8073-a29a19b37aab&quot;,&quot;title&quot;:&quot;DELETE /student-connections/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a connection request is successful (Sender cancels)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 1: Delete a connection request is successful (Sender cancels)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { sender_erp, receiver_erp, sent_at };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\nconst newId = res.body.body.student_connection_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp === sender_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:628:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;a2cd2b11-c5cb-4f70-aa27-b9cb61d89793&quot;,&quot;parentUUID&quot;:&quot;88a9e4df-4346-4362-8073-a29a19b37aab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a connection request is successful (Receiver rejects)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 2: Delete a connection request is successful (Receiver rejects)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { sender_erp, receiver_erp, sent_at };\nconst app = this.app;\nconst receiverToken = jwt.sign({erp: data.receiver_erp}, Config.SECRET_JWT);\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\nconst newId = res.body.body.student_connection_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(receiverToken, { type: &#x27;bearer&#x27; }); // &lt;-- receiverToken.erp === receiver_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:665:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;daf1bff3-7b79-4499-a438-9308ab674156&quot;,&quot;parentUUID&quot;:&quot;88a9e4df-4346-4362-8073-a29a19b37aab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a connection request is unsuccessful due to unknown id&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 3: Delete a connection request is unsuccessful due to unknown id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownConnectionRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:698:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;9b326952-0b9b-4bdb-9894-aacd3b1089a2&quot;,&quot;parentUUID&quot;:&quot;88a9e4df-4346-4362-8073-a29a19b37aab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a connection request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 4: Delete a connection request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst forbiddenToken = jwt.sign({erp: receiver_erp}, Config.SECRET_JWT);\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${studentConnectionId}`)\n    .auth(forbiddenToken, { type: &#x27;bearer&#x27; }); // forbiddenToken.erp !== receiver_erp or sender_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:714:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;c2e63336-0543-47b1-a73f-6a0416bba891&quot;,&quot;parentUUID&quot;:&quot;88a9e4df-4346-4362-8073-a29a19b37aab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a connection request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 5: Delete a connection request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${studentConnectionId}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8bc8306f-d354-4c7c-beec-8f187fd20597&quot;,&quot;parentUUID&quot;:&quot;88a9e4df-4346-4362-8073-a29a19b37aab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8bc8306f-d354-4c7c-beec-8f187fd20597&quot;],&quot;failures&quot;:[&quot;a2cd2b11-c5cb-4f70-aa27-b9cb61d89793&quot;,&quot;daf1bff3-7b79-4499-a438-9308ab674156&quot;,&quot;9b326952-0b9b-4bdb-9894-aacd3b1089a2&quot;,&quot;c2e63336-0543-47b1-a73f-6a0416bba891&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1e84591a-2b24-45b9-b101-7bc294d24a88&quot;,&quot;title&quot;:&quot;Student Statuses API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Student Statuses API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API \&quot;before each\&quot; hook in \&quot;Student Statuses API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1d38e3af-d1ef-44aa-89f1-23c99af5cf5e&quot;,&quot;parentUUID&quot;:&quot;1e84591a-2b24-45b9-b101-7bc294d24a88&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ab5b9b51-e8a7-479f-9872-e74d50091115&quot;,&quot;title&quot;:&quot;GET /student-statuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all student statuses request successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses Scenario 1: Get all student statuses request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;student_status_id&#x27;, &#x27;student_status&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:34:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;0318bf38-a3cb-4304-9aaa-592b91efe470&quot;,&quot;parentUUID&quot;:&quot;ab5b9b51-e8a7-479f-9872-e74d50091115&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all student statuses request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses Scenario 2: Get all student statuses request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:628,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentStatusModel = require(&#x27;../../src/models/studentStatus.model&#x27;);\nconst modelStub = sinon.stub(StudentStatusModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty student_status list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student statuses not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;9c74ff79-f81e-4820-a212-2916cc1f2220&quot;,&quot;parentUUID&quot;:&quot;ab5b9b51-e8a7-479f-9872-e74d50091115&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;0318bf38-a3cb-4304-9aaa-592b91efe470&quot;,&quot;9c74ff79-f81e-4820-a212-2916cc1f2220&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:635,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;21b2bda9-9f63-4104-b7d0-5408efc021c4&quot;,&quot;title&quot;:&quot;GET /student-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student status request successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses/:id Scenario 1: Get a student status request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;student_status_id&#x27;, &#x27;student_status&#x27;]);\nexpect(resBody.student_status_id).to.be.eql(existingStudentStatus.student_status_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:70:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;4e081ffa-9076-4b4f-915f-fce67152b4cf&quot;,&quot;parentUUID&quot;:&quot;21b2bda9-9f63-4104-b7d0-5408efc021c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses/:id Scenario 2: Get a student status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownStudentStatusId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student status not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:84:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;b35b22c0-5cca-4319-89e3-085f3810eecd&quot;,&quot;parentUUID&quot;:&quot;21b2bda9-9f63-4104-b7d0-5408efc021c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses/:id Scenario 3: Get a student status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudentStatus.student_status_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5f0e353f-a57c-4f7b-960d-9550eb4f0bf5&quot;,&quot;parentUUID&quot;:&quot;21b2bda9-9f63-4104-b7d0-5408efc021c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5f0e353f-a57c-4f7b-960d-9550eb4f0bf5&quot;],&quot;failures&quot;:[&quot;4e081ffa-9076-4b4f-915f-fce67152b4cf&quot;,&quot;b35b22c0-5cca-4319-89e3-085f3810eecd&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;44301a05-de7a-4c04-9f67-c94307d363de&quot;,&quot;title&quot;:&quot;POST /student-statuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a student status request is successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API POST /student-statuses Scenario 1: Create a student status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;student_status_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.student_status_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    student_status_id: newId,\n    student_status: student_status\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:117:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;ded0848c-a310-4cb4-95a9-77da930b3d1c&quot;,&quot;parentUUID&quot;:&quot;44301a05-de7a-4c04-9f67-c94307d363de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a student status request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API POST /student-statuses Scenario 2: Create a student status request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    student_statuses: student_status // &lt;-- a valid parameter name should be &#x27;student_status&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;student_status&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;886c84ab-ce9d-4e56-a047-b6152a3bf4c5&quot;,&quot;parentUUID&quot;:&quot;44301a05-de7a-4c04-9f67-c94307d363de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a student status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API POST /student-statuses Scenario 3: Create a student status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:172:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;68e92787-c4d3-4ac8-be83-37be26996aae&quot;,&quot;parentUUID&quot;:&quot;44301a05-de7a-4c04-9f67-c94307d363de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a student status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API POST /student-statuses Scenario 4: Create a student status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e3c70a95-f7d3-433f-a5ae-f98c7f630772&quot;,&quot;parentUUID&quot;:&quot;44301a05-de7a-4c04-9f67-c94307d363de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e3c70a95-f7d3-433f-a5ae-f98c7f630772&quot;],&quot;failures&quot;:[&quot;ded0848c-a310-4cb4-95a9-77da930b3d1c&quot;,&quot;886c84ab-ce9d-4e56-a047-b6152a3bf4c5&quot;,&quot;68e92787-c4d3-4ac8-be83-37be26996aae&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:51,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;38f73f36-8138-4ce3-a0a8-688effa8fc69&quot;,&quot;title&quot;:&quot;PATCH /student-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a student status request is successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 1: Update a student status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status: newStudentStatus };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    student_status_id: existingStudentStatus.student_status_id,\n    student_status: newStudentStatus\n});\n\n// cleanup\ndata.student_status = existingStudentStatus.student_status;\nres = await request(app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:210:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;ec1fc434-08b7-47ac-90a8-2e41fa853488&quot;,&quot;parentUUID&quot;:&quot;38f73f36-8138-4ce3-a0a8-688effa8fc69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a student status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 2: Update a student status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status: newStudentStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownStudentStatusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student status not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:247:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;79ffce8b-65c2-47c1-b602-a3d8a588f69a&quot;,&quot;parentUUID&quot;:&quot;38f73f36-8138-4ce3-a0a8-688effa8fc69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a student status request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 3: Update a student status request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    student_statuses: newStudentStatus // &lt;-- a valid parameter name should be &#x27;student_status&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;student_status&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:266:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;bcd2c24b-bd6c-425a-b793-b56a87cf9e3c&quot;,&quot;parentUUID&quot;:&quot;38f73f36-8138-4ce3-a0a8-688effa8fc69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a student status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 4: Update a student status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status: newStudentStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:284:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;22127b12-8389-4caf-bbcc-b0d92fd097c8&quot;,&quot;parentUUID&quot;:&quot;38f73f36-8138-4ce3-a0a8-688effa8fc69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a student status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 5: Update a student status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status: newStudentStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fd68e907-25c2-4cb6-89fe-a96ac034a695&quot;,&quot;parentUUID&quot;:&quot;38f73f36-8138-4ce3-a0a8-688effa8fc69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fd68e907-25c2-4cb6-89fe-a96ac034a695&quot;],&quot;failures&quot;:[&quot;ec1fc434-08b7-47ac-90a8-2e41fa853488&quot;,&quot;79ffce8b-65c2-47c1-b602-a3d8a588f69a&quot;,&quot;bcd2c24b-bd6c-425a-b793-b56a87cf9e3c&quot;,&quot;22127b12-8389-4caf-bbcc-b0d92fd097c8&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:59,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;8a9b5ea0-8c9e-4bb5-b644-73b3f9a93216&quot;,&quot;title&quot;:&quot;DELETE /student-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a student status request is successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API DELETE /student-statuses/:id Scenario 1: Delete a student status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { student_status };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.student_status_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student status has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:320:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;3cfca5ab-8a23-4517-87d2-499a34b90ce4&quot;,&quot;parentUUID&quot;:&quot;8a9b5ea0-8c9e-4bb5-b644-73b3f9a93216&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a student status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API DELETE /student-statuses/:id Scenario 2: Delete a student status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownStudentStatusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student status not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:352:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;1fb9c008-9973-404f-8c4d-1cb722f96a07&quot;,&quot;parentUUID&quot;:&quot;8a9b5ea0-8c9e-4bb5-b644-73b3f9a93216&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a student status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API DELETE /student-statuses/:id Scenario 3: Delete a student status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:365:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;069f38a8-e59a-4dcd-b060-ba5b4f454d11&quot;,&quot;parentUUID&quot;:&quot;8a9b5ea0-8c9e-4bb5-b644-73b3f9a93216&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a student status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API DELETE /student-statuses/:id Scenario 4: Delete a student status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudentStatus.student_status_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6de09b5d-66a4-4831-bc9f-29cdd40353c9&quot;,&quot;parentUUID&quot;:&quot;8a9b5ea0-8c9e-4bb5-b644-73b3f9a93216&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6de09b5d-66a4-4831-bc9f-29cdd40353c9&quot;],&quot;failures&quot;:[&quot;3cfca5ab-8a23-4517-87d2-499a34b90ce4&quot;,&quot;1fb9c008-9973-404f-8c4d-1cb722f96a07&quot;,&quot;069f38a8-e59a-4dcd-b060-ba5b4f454d11&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1e669f40-6ffe-4ff1-bf50-a9e774651c4b&quot;,&quot;title&quot;:&quot;Subjects API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Subjects API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Subjects API \&quot;before each\&quot; hook in \&quot;Subjects API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8d0622c6-e5c5-4d8c-83d9-1f64c22a40eb&quot;,&quot;parentUUID&quot;:&quot;1e669f40-6ffe-4ff1-bf50-a9e774651c4b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;192422a8-ae1f-4d5c-ba0f-c42ba8550784&quot;,&quot;title&quot;:&quot;GET /subjects&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all subjects request successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects Scenario 1: Get all subjects request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys([&#x27;subject_code&#x27;, &#x27;subject&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:35:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;19977f03-935a-4416-862d-1a5726bee5d1&quot;,&quot;parentUUID&quot;:&quot;192422a8-ae1f-4d5c-ba0f-c42ba8550784&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all subjects request unsuccessful due to zero subjects&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects Scenario 2: Get all subjects request unsuccessful due to zero subjects&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:529,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst SubjectModel = require(&#x27;../../src/models/subject.model&#x27;);\nconst modelStub = sinon.stub(SubjectModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty subject list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subjects not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;dc307024-9694-4569-9af7-bc0529930e3b&quot;,&quot;parentUUID&quot;:&quot;192422a8-ae1f-4d5c-ba0f-c42ba8550784&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects Scenario 3: Get a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:69:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;8fe50720-5f51-4a20-abea-24c38f6a9879&quot;,&quot;parentUUID&quot;:&quot;192422a8-ae1f-4d5c-ba0f-c42ba8550784&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all subjects request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects Scenario 4: Get all subjects request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ffbbfa12-0aa6-4c3d-8c43-47c30f35b533&quot;,&quot;parentUUID&quot;:&quot;192422a8-ae1f-4d5c-ba0f-c42ba8550784&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ffbbfa12-0aa6-4c3d-8c43-47c30f35b533&quot;],&quot;failures&quot;:[&quot;19977f03-935a-4416-862d-1a5726bee5d1&quot;,&quot;dc307024-9694-4569-9af7-bc0529930e3b&quot;,&quot;8fe50720-5f51-4a20-abea-24c38f6a9879&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:561,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9c7382b5-006e-4538-821a-95bdeb548202&quot;,&quot;title&quot;:&quot;GET /subjects/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a subject request successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects/:id Scenario 1: Get a subject request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys([&#x27;subject_code&#x27;, &#x27;subject&#x27;]);\nexpect(resBody.subject_code).to.be.equal(existingSubject.subject_code); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:95:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;3813b34e-dc96-436e-a714-7d103d63d4a3&quot;,&quot;parentUUID&quot;:&quot;9c7382b5-006e-4538-821a-95bdeb548202&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a subject request is unsuccessful due to unknown subject&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects/:id Scenario 2: Get a subject request is unsuccessful due to unknown subject&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownSubjectId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subject not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:109:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;f3f8c265-f039-495d-bfcb-7e91516cd377&quot;,&quot;parentUUID&quot;:&quot;9c7382b5-006e-4538-821a-95bdeb548202&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects/:id Scenario 3: Get a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:122:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;362c74d9-6c26-469b-9a54-0ed349860972&quot;,&quot;parentUUID&quot;:&quot;9c7382b5-006e-4538-821a-95bdeb548202&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects/:id Scenario 4: Get a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingSubject.subject_code}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;279f2dc7-a3a8-438d-9ff1-45cbd44b7406&quot;,&quot;parentUUID&quot;:&quot;9c7382b5-006e-4538-821a-95bdeb548202&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;279f2dc7-a3a8-438d-9ff1-45cbd44b7406&quot;],&quot;failures&quot;:[&quot;3813b34e-dc96-436e-a714-7d103d63d4a3&quot;,&quot;f3f8c265-f039-495d-bfcb-7e91516cd377&quot;,&quot;362c74d9-6c26-469b-9a54-0ed349860972&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:28,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f3e06fd6-3d37-45bb-94b1-32dbf13e1ceb&quot;,&quot;title&quot;:&quot;POST /subjects&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a subject request is successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API POST /subjects Scenario 1: Create a subject request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject, subject_code };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = data.subject_code;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    subject_code: newId,\n    subject: subject\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:156:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;07963bf6-e041-47d2-ad48-d30a37544c42&quot;,&quot;parentUUID&quot;:&quot;f3e06fd6-3d37-45bb-94b1-32dbf13e1ceb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a subject request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Subjects API POST /subjects Scenario 2: Create a subject request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    subjects: subject // &lt;-- a valid parameter name should be &#x27;subject&#x27;\n    // subject_code is required\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;subject&#x27;, &#x27;subject_code&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:194:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;448e4eb9-3774-4a9b-b825-1c9d9ba24d64&quot;,&quot;parentUUID&quot;:&quot;f3e06fd6-3d37-45bb-94b1-32dbf13e1ceb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API POST /subjects Scenario 3: Create a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject, subject_code };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:212:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;c09c77a5-3b87-4feb-95d9-dfb1d50c265c&quot;,&quot;parentUUID&quot;:&quot;f3e06fd6-3d37-45bb-94b1-32dbf13e1ceb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API POST /subjects Scenario 4: Create a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject, subject_code };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;38203269-a7a7-4eab-82c7-b89c871c678b&quot;,&quot;parentUUID&quot;:&quot;f3e06fd6-3d37-45bb-94b1-32dbf13e1ceb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;38203269-a7a7-4eab-82c7-b89c871c678b&quot;],&quot;failures&quot;:[&quot;07963bf6-e041-47d2-ad48-d30a37544c42&quot;,&quot;448e4eb9-3774-4a9b-b825-1c9d9ba24d64&quot;,&quot;c09c77a5-3b87-4feb-95d9-dfb1d50c265c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:45,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9c7eb1df-ae87-48c2-9d0e-5a2f37c51bbe&quot;,&quot;title&quot;:&quot;PATCH /subjects/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a subject request is successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 1: Update a subject request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject: newSubject };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    subject_code: existingSubject.subject_code,\n    subject: newSubject\n});\n\n// cleanup\ndata.subject = existingSubject.subject;\nres = await request(app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:250:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;e8ef45cb-f060-4317-be4e-4424267a93a9&quot;,&quot;parentUUID&quot;:&quot;9c7eb1df-ae87-48c2-9d0e-5a2f37c51bbe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a subject request is unsuccessful due to unknown subject code&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 2: Update a subject request is unsuccessful due to unknown subject code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject: newSubject };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownSubjectId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subject not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:287:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;f903db38-9248-40e6-9f1e-ebb59b7f2893&quot;,&quot;parentUUID&quot;:&quot;9c7eb1df-ae87-48c2-9d0e-5a2f37c51bbe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a subject request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 3: Update a subject request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    subjects: newSubject // &lt;-- a valid parameter name should be &#x27;subject&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;subject&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:306:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;8a64d021-f11d-4fb0-8a67-bc43554aa86c&quot;,&quot;parentUUID&quot;:&quot;9c7eb1df-ae87-48c2-9d0e-5a2f37c51bbe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 4: Update a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject: newSubject };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:324:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;a8177189-c7c4-450c-9957-9fc19e68743a&quot;,&quot;parentUUID&quot;:&quot;9c7eb1df-ae87-48c2-9d0e-5a2f37c51bbe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 5: Update a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject: newSubject };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d4944b35-aef6-44a6-b5ff-15116abe762c&quot;,&quot;parentUUID&quot;:&quot;9c7eb1df-ae87-48c2-9d0e-5a2f37c51bbe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d4944b35-aef6-44a6-b5ff-15116abe762c&quot;],&quot;failures&quot;:[&quot;e8ef45cb-f060-4317-be4e-4424267a93a9&quot;,&quot;f903db38-9248-40e6-9f1e-ebb59b7f2893&quot;,&quot;8a64d021-f11d-4fb0-8a67-bc43554aa86c&quot;,&quot;a8177189-c7c4-450c-9957-9fc19e68743a&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:43,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b4fb5b0f-5817-40a3-8609-ddb93cb18962&quot;,&quot;title&quot;:&quot;DELETE /subjects/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a subject request is successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API DELETE /subjects/:id Scenario 1: Delete a subject request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { subject, subject_code };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = data.subject_code;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subject has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:361:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;8f1deccb-b316-4472-9147-a6a60548fbb9&quot;,&quot;parentUUID&quot;:&quot;b4fb5b0f-5817-40a3-8609-ddb93cb18962&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a subject request is unsuccessful due to unknown subject code&quot;,&quot;fullTitle&quot;:&quot;Subjects API DELETE /subjects/:id Scenario 2: Delete a subject request is unsuccessful due to unknown subject code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownSubjectId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subject not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:393:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;1e4fbb63-7f68-44d5-8c1e-a925c47f8401&quot;,&quot;parentUUID&quot;:&quot;b4fb5b0f-5817-40a3-8609-ddb93cb18962&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API DELETE /subjects/:id Scenario 3: Delete a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:406:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;c86ec3e3-4837-4025-bf10-7fcbbd4c0b3a&quot;,&quot;parentUUID&quot;:&quot;b4fb5b0f-5817-40a3-8609-ddb93cb18962&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API DELETE /subjects/:id Scenario 4: Delete a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingSubject.subject_code}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3d037ac8-e9d6-43c6-a5f1-9c9b0e14c76b&quot;,&quot;parentUUID&quot;:&quot;b4fb5b0f-5817-40a3-8609-ddb93cb18962&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3d037ac8-e9d6-43c6-a5f1-9c9b0e14c76b&quot;],&quot;failures&quot;:[&quot;8f1deccb-b316-4472-9147-a6a60548fbb9&quot;,&quot;1e4fbb63-7f68-44d5-8c1e-a925c47f8401&quot;,&quot;c86ec3e3-4837-4025-bf10-7fcbbd4c0b3a&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:28,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d63034ad-42d3-4694-a93c-f26861532d05&quot;,&quot;title&quot;:&quot;Teachers API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Teachers API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Teachers API \&quot;before each\&quot; hook in \&quot;Teachers API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;94f3d454-270d-4a84-8293-5744c5bca3a6&quot;,&quot;parentUUID&quot;:&quot;d63034ad-42d3-4694-a93c-f26861532d05&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4f2b7bc0-8991-4a9c-9355-b08355d9b7e3&quot;,&quot;title&quot;:&quot;GET /teachers&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all teachers request successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers Scenario 1: Get all teachers request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTeacher));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:36:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;939ee7bc-40f0-4237-939a-db712df180a4&quot;,&quot;parentUUID&quot;:&quot;4f2b7bc0-8991-4a9c-9355-b08355d9b7e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all teachers request unsuccessful due to zero teachers&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers Scenario 2: Get all teachers request unsuccessful due to zero teachers&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:651,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TeacherModel = require(&#x27;../../src/models/teacher.model&#x27;);\nconst modelStub = sinon.stub(TeacherModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty teacher list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;f20e7316-9448-4eaf-a390-16e4e4bdf635&quot;,&quot;parentUUID&quot;:&quot;4f2b7bc0-8991-4a9c-9355-b08355d9b7e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers Scenario 3: Get a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:68:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;75f1fb83-730f-4a8f-b8e4-5b48144f6e81&quot;,&quot;parentUUID&quot;:&quot;4f2b7bc0-8991-4a9c-9355-b08355d9b7e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all teachers request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers Scenario 4: Get all teachers request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;581c4ec4-4e15-46ac-90d5-30ecf40a0665&quot;,&quot;parentUUID&quot;:&quot;4f2b7bc0-8991-4a9c-9355-b08355d9b7e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;581c4ec4-4e15-46ac-90d5-30ecf40a0665&quot;],&quot;failures&quot;:[&quot;939ee7bc-40f0-4237-939a-db712df180a4&quot;,&quot;f20e7316-9448-4eaf-a390-16e4e4bdf635&quot;,&quot;75f1fb83-730f-4a8f-b8e4-5b48144f6e81&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:672,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;2f8f6417-6f21-4a1f-a11d-d4a51445e2d2&quot;,&quot;title&quot;:&quot;GET /teachers/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a teacher request successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers/:id Scenario 1: Get a teacher request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingTeacher));\nexpect(resBody.teacher_id).to.be.equal(existingTeacher.teacher_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:94:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;36096645-2bf9-4248-b1cd-c8a873b39c50&quot;,&quot;parentUUID&quot;:&quot;2f8f6417-6f21-4a1f-a11d-d4a51445e2d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers/:id Scenario 2: Get a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTeacherId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:108:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;68f25b89-92d9-46a7-af5d-7c9c2a8e8df3&quot;,&quot;parentUUID&quot;:&quot;2f8f6417-6f21-4a1f-a11d-d4a51445e2d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers/:id Scenario 3: Get a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:121:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;a4dd211f-844e-4f3f-a328-548b08132265&quot;,&quot;parentUUID&quot;:&quot;2f8f6417-6f21-4a1f-a11d-d4a51445e2d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a teacher request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers/:id Scenario 4: Get a teacher request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTeacher.teacher_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5f22cc4b-fa83-4f5b-885f-52cbaa7bbd7a&quot;,&quot;parentUUID&quot;:&quot;2f8f6417-6f21-4a1f-a11d-d4a51445e2d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5f22cc4b-fa83-4f5b-885f-52cbaa7bbd7a&quot;],&quot;failures&quot;:[&quot;36096645-2bf9-4248-b1cd-c8a873b39c50&quot;,&quot;68f25b89-92d9-46a7-af5d-7c9c2a8e8df3&quot;,&quot;a4dd211f-844e-4f3f-a328-548b08132265&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d00c4bd4-42aa-4f62-9b01-19e4ac189d74&quot;,&quot;title&quot;:&quot;POST /teachers&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a teacher request is successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API POST /teachers Scenario 1: Create a teacher request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;teacher_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.teacher_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    teacher_id: newId,\n    average_rating: \&quot;0.000\&quot;,\n    total_reviews: 0,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;d4f1a0fb-34c9-46c1-b19a-401de35efe10&quot;,&quot;parentUUID&quot;:&quot;d00c4bd4-42aa-4f62-9b01-19e4ac189d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a teacher request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Teachers API POST /teachers Scenario 2: Create a teacher request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    full_names: full_name // &lt;-- a valid parameter name is &#x27;full_name&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;full_name&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:193:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;ec02467a-d956-42fe-b71b-ba38c2ed3fe2&quot;,&quot;parentUUID&quot;:&quot;d00c4bd4-42aa-4f62-9b01-19e4ac189d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API POST /teachers Scenario 3: Create a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:211:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;b99b6e5d-f4fd-46ca-a0f9-4e9254eb1832&quot;,&quot;parentUUID&quot;:&quot;d00c4bd4-42aa-4f62-9b01-19e4ac189d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a teacher request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API POST /teachers Scenario 4: Create a teacher request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d57d60be-3b0c-4663-879c-e931357790d9&quot;,&quot;parentUUID&quot;:&quot;d00c4bd4-42aa-4f62-9b01-19e4ac189d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d57d60be-3b0c-4663-879c-e931357790d9&quot;],&quot;failures&quot;:[&quot;d4f1a0fb-34c9-46c1-b19a-401de35efe10&quot;,&quot;ec02467a-d956-42fe-b71b-ba38c2ed3fe2&quot;,&quot;b99b6e5d-f4fd-46ca-a0f9-4e9254eb1832&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:38,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;42cc452f-fb0f-4dd8-8093-d590ba4906c3&quot;,&quot;title&quot;:&quot;PATCH /teachers/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a teacher request is successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 1: Update a teacher request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name: newTeacherName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    teacher_id: existingTeacher.teacher_id,\n    full_name: newTeacherName,\n    average_rating: existingTeacher.average_rating,\n    total_reviews: existingTeacher.total_reviews\n});\n\n// cleanup\ndata.full_name = existingTeacher.full_name;\nres = await request(app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:249:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;1b7ee73c-12f8-4bcc-8288-fd8272483e9e&quot;,&quot;parentUUID&quot;:&quot;42cc452f-fb0f-4dd8-8093-d590ba4906c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 2: Update a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name: newTeacherName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTeacherId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:288:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;e7ef8209-4f84-4cf2-b8c0-da6466167ced&quot;,&quot;parentUUID&quot;:&quot;42cc452f-fb0f-4dd8-8093-d590ba4906c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a teacher request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 3: Update a teacher request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    full_names: newTeacherName // &lt;-- a invalid update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;full_name&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:307:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;4aae6c49-7836-41b9-a4b3-c44a53bd6517&quot;,&quot;parentUUID&quot;:&quot;42cc452f-fb0f-4dd8-8093-d590ba4906c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 4: Update a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name: newTeacherName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:327:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;7a9644c9-f08e-4b83-8b30-a419b2411968&quot;,&quot;parentUUID&quot;:&quot;42cc452f-fb0f-4dd8-8093-d590ba4906c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a teacher request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 5: Update a teacher request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name: newTeacherName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4040d335-68a3-4c4e-9f44-31d5af68b076&quot;,&quot;parentUUID&quot;:&quot;42cc452f-fb0f-4dd8-8093-d590ba4906c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4040d335-68a3-4c4e-9f44-31d5af68b076&quot;],&quot;failures&quot;:[&quot;1b7ee73c-12f8-4bcc-8288-fd8272483e9e&quot;,&quot;e7ef8209-4f84-4cf2-b8c0-da6466167ced&quot;,&quot;4aae6c49-7836-41b9-a4b3-c44a53bd6517&quot;,&quot;7a9644c9-f08e-4b83-8b30-a419b2411968&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:38,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;32f9b910-b1d3-4c01-958e-5beb18fc09db&quot;,&quot;title&quot;:&quot;DELETE /teachers/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a teacher request is successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API DELETE /teachers/:id Scenario 1: Delete a teacher request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { full_name };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.teacher_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:363:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;b08fa0a3-dcdf-4b4f-8d4f-de7bc3236eda&quot;,&quot;parentUUID&quot;:&quot;32f9b910-b1d3-4c01-958e-5beb18fc09db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Teachers API DELETE /teachers/:id Scenario 2: Delete a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTeacherId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:395:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;ec3df3d7-e1c4-4789-acf5-6ac84e5afae4&quot;,&quot;parentUUID&quot;:&quot;32f9b910-b1d3-4c01-958e-5beb18fc09db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API DELETE /teachers/:id Scenario 3: Delete a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:408:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;e34ccd87-c03d-4586-8ff6-31d279bb1cb6&quot;,&quot;parentUUID&quot;:&quot;32f9b910-b1d3-4c01-958e-5beb18fc09db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a teacher request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API DELETE /teachers/:id Scenario 4: Delete a teacher request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacher.teacher_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;228bdadc-4782-4f6e-baeb-703cb2161dec&quot;,&quot;parentUUID&quot;:&quot;32f9b910-b1d3-4c01-958e-5beb18fc09db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;228bdadc-4782-4f6e-baeb-703cb2161dec&quot;],&quot;failures&quot;:[&quot;b08fa0a3-dcdf-4b4f-8d4f-de7bc3236eda&quot;,&quot;ec3df3d7-e1c4-4789-acf5-6ac84e5afae4&quot;,&quot;e34ccd87-c03d-4586-8ff6-31d279bb1cb6&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;e6da4d93-e810-4be7-80ba-4997dee2bfd8&quot;,&quot;title&quot;:&quot;Teacher Reviews API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Teacher Reviews API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API \&quot;before each\&quot; hook in \&quot;Teacher Reviews API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;92f46f55-03d4-4ce3-b160-dd56e97e9ad7&quot;,&quot;parentUUID&quot;:&quot;e6da4d93-e810-4be7-80ba-4997dee2bfd8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3895c6e0-4072-4f5e-85d2-4bc04936cceb&quot;,&quot;title&quot;:&quot;GET /teacher-reviews&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all teacher reviews request successful&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 1: Get all teacher reviews request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst teacher_id = existingTeacherReview.teacher_id;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?teacher_id=${teacher_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst reviewerCheck = review =&gt; review.teacher_id === teacher_id;\nexpect(resBody.every(reviewerCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTeacherReview));\nexpect(resBody[0].subject).to.include.all.keys(Object.keys(existingTeacherReview.subject));\nexpect(resBody[0].reviewed_by).to.include.all.keys(Object.keys(existingTeacherReview.reviewed_by));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:61:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;1f1fa12e-843e-499e-a9a7-e9cbb1e12e6f&quot;,&quot;parentUUID&quot;:&quot;3895c6e0-4072-4f5e-85d2-4bc04936cceb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all teacher reviews request unsuccessful due to zero teacher reviews&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 2: Get all teacher reviews request unsuccessful due to zero teacher reviews&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:542,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TeacherReviewModel = require(&#x27;../../src/models/teacherReview.model&#x27;);\nconst modelStub = sinon.stub(TeacherReviewModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty teacher review list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}?teacher_id=${existingTeacherReview.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;3bebf715-feaa-4cb8-85cc-ef8000735cf0&quot;,&quot;parentUUID&quot;:&quot;3895c6e0-4072-4f5e-85d2-4bc04936cceb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all teacher reviews is incorrect due to no query params&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 3: Get all teacher reviews is incorrect due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute) // needs teacher_id\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;TeacherID is required for the teacherReview&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:97:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;0444165d-9a33-46d8-9ff2-dcdc2989cec5&quot;,&quot;parentUUID&quot;:&quot;3895c6e0-4072-4f5e-85d2-4bc04936cceb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all teacher reviews is incorrect due to unknown query params&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 4: Get all teacher reviews is incorrect due to unknown query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst teacher_id = existingTeacherReview.teacher_id;\nconst subject_code = \&quot;MM22\&quot;; // a valid subject code is 6 characters\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?teacher_id=${teacher_id}&amp;subject_code=${subject_code}&amp;overall_rating=2.0`) // &lt;-- &#x27;overall_rating&#x27; is not a query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;subject_code&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:115:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;51e08fa9-6a6d-44d4-9dc1-2d4f50bac851&quot;,&quot;parentUUID&quot;:&quot;3895c6e0-4072-4f5e-85d2-4bc04936cceb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all teacher reviews request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 5: Get all teacher reviews request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;90a8a8ec-22df-4488-8409-c495a0a86d18&quot;,&quot;parentUUID&quot;:&quot;3895c6e0-4072-4f5e-85d2-4bc04936cceb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;90a8a8ec-22df-4488-8409-c495a0a86d18&quot;],&quot;failures&quot;:[&quot;1f1fa12e-843e-499e-a9a7-e9cbb1e12e6f&quot;,&quot;3bebf715-feaa-4cb8-85cc-ef8000735cf0&quot;,&quot;0444165d-9a33-46d8-9ff2-dcdc2989cec5&quot;,&quot;51e08fa9-6a6d-44d4-9dc1-2d4f50bac851&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:581,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;12f10fa0-90a6-4b96-adf5-7422277dfadd&quot;,&quot;title&quot;:&quot;GET /teacher-reviews/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a teacher review request successful&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews/:id Scenario 1: Get a teacher review request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTeacherReview.review_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingTeacherReview));\nexpect(resBody.review_id).to.be.equal(existingTeacherReview.review_id); // should match initially sent id\nexpect(resBody.subject).to.include.all.keys(Object.keys(existingTeacherReview.subject));\nexpect(resBody.reviewed_by).to.include.all.keys(Object.keys(existingTeacherReview.reviewed_by));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:144:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;b7a6ce77-dc92-4094-8168-43bf9429050b&quot;,&quot;parentUUID&quot;:&quot;12f10fa0-90a6-4b96-adf5-7422277dfadd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a teacher review request is unsuccessful due to unknown review_id&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews/:id Scenario 2: Get a teacher review request is unsuccessful due to unknown review_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTeacherReviewId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher review not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:160:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;3f6f21f9-0dbb-4115-8a97-11a6aaf40891&quot;,&quot;parentUUID&quot;:&quot;12f10fa0-90a6-4b96-adf5-7422277dfadd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a teacher review request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews/:id Scenario 3: Get a teacher review request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTeacherReview.review_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6c6cf7f0-a5b2-4b84-9ca9-f52058d10b1e&quot;,&quot;parentUUID&quot;:&quot;12f10fa0-90a6-4b96-adf5-7422277dfadd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6c6cf7f0-a5b2-4b84-9ca9-f52058d10b1e&quot;],&quot;failures&quot;:[&quot;b7a6ce77-dc92-4094-8168-43bf9429050b&quot;,&quot;3f6f21f9-0dbb-4115-8a97-11a6aaf40891&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7351ff0d-55fd-4053-8dc9-656b3fa4b91a&quot;,&quot;title&quot;:&quot;POST /teacher-reviews&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a teacher review request is successful&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 1: Create a teacher review request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;review_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// rearrange\nconst newId = res.body.body.review_id;\nconst { old_teacher_rating, old_total_reviews, ...reviewBody } = data;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nconst resBody = res.body.body;\nexpect(resBody.review_id).to.be.equal(newId);\nexpect(resBody.subject.subject_code).to.be.equal(data.subject_code);\nexpect(resBody.reviewed_by.erp).to.be.equal(data.reviewed_by_erp);\n// cleanup\nconst { overall_rating: review_rating } = resBody;\nconst TeacherReviewRepository = require(&#x27;../../src/repositories/teacherReview.repository&#x27;);\nconst newTeacherRating = TeacherReviewRepository.incrementTeacherRating(review_rating, old_teacher_rating, old_total_reviews);\nconst deleteData = {\n    teacher_id: reviewBody.teacher_id,\n    teacher_rating: newTeacherRating,\n    total_reviews: old_total_reviews + 1,\n    review_rating\n};\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(deleteData);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:205:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;b191fb88-3069-4c08-8033-dae826d1c9b2&quot;,&quot;parentUUID&quot;:&quot;7351ff0d-55fd-4053-8dc9-656b3fa4b91a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a teacher review request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 2: Create a teacher review request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\ndata.teacher_id = unknownTeacherId; // non existing teacher_id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;teacher_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:254:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;edfa9d91-c92b-493f-9c7f-4c4b4490fc18&quot;,&quot;parentUUID&quot;:&quot;7351ff0d-55fd-4053-8dc9-656b3fa4b91a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a teacher review request is unsuccessful due to unknown subject_code&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 3: Create a teacher review request is unsuccessful due to unknown subject_code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\ndata.subject_code = unknownSubjectCode; // non existing subject_code\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;subject_code&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:272:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;987a5fc2-bb6f-4b46-b8dd-e24befd65622&quot;,&quot;parentUUID&quot;:&quot;7351ff0d-55fd-4053-8dc9-656b3fa4b91a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a teacher review request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 4: Create a teacher review request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\ndelete data.old_teacher_rating; // make it missing\ndata.learning = 9; // should be between 1 and 5\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;old_teacher_rating&#x27;, &#x27;learning&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:291:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;b59d01f3-c1dc-4a26-b464-8f3a67528b79&quot;,&quot;parentUUID&quot;:&quot;7351ff0d-55fd-4053-8dc9-656b3fa4b91a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a teacher review request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 5: Create a teacher review request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview }; // reviewed_by_erp === adminERP\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:309:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;6909d155-7979-4a8e-85fa-3a53fab7ee18&quot;,&quot;parentUUID&quot;:&quot;7351ff0d-55fd-4053-8dc9-656b3fa4b91a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a teacher review request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 6: Create a teacher review request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3abb72a0-ead5-47ba-8fa3-a3bf3526cfff&quot;,&quot;parentUUID&quot;:&quot;7351ff0d-55fd-4053-8dc9-656b3fa4b91a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3abb72a0-ead5-47ba-8fa3-a3bf3526cfff&quot;],&quot;failures&quot;:[&quot;b191fb88-3069-4c08-8033-dae826d1c9b2&quot;,&quot;edfa9d91-c92b-493f-9c7f-4c4b4490fc18&quot;,&quot;987a5fc2-bb6f-4b46-b8dd-e24befd65622&quot;,&quot;b59d01f3-c1dc-4a26-b464-8f3a67528b79&quot;,&quot;6909d155-7979-4a8e-85fa-3a53fab7ee18&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:56,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;419c01bd-2b26-497f-928c-6cb1f73f3351&quot;,&quot;title&quot;:&quot;DELETE /teacher-reviews/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a teacher review request is successful&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 1: Delete a teacher review request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { ...newTeacherReview };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst {review_id: newId} = res.body.body;\nconst TeacherReviewRepository = require(&#x27;../../src/repositories/teacherReview.repository&#x27;);\nconst review_rating = TeacherReviewRepository.calculateAverageRating(data);\nconst newTeacherRating = TeacherReviewRepository.incrementTeacherRating(review_rating, data.old_teacher_rating, data.old_total_reviews);\nconst deleteData = {\n    teacher_id: data.teacher_id,\n    teacher_rating: newTeacherRating,\n    total_reviews: data.old_total_reviews + 1,\n    review_rating: review_rating.toFixed(3)\n};\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(deleteData);\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher review has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:357:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;423481f3-ec16-434f-b171-a40c00aa9bff&quot;,&quot;parentUUID&quot;:&quot;419c01bd-2b26-497f-928c-6cb1f73f3351&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a teacher review request is unsuccessful due to unknown review_id&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 2: Delete a teacher review request is unsuccessful due to unknown review_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst TeacherReviewRepository = require(&#x27;../../src/repositories/teacherReview.repository&#x27;);\nconst review_rating = TeacherReviewRepository.calculateAverageRating(newTeacherReview);\nconst deleteData = {\n    teacher_id: newTeacherReview.teacher_id,\n    teacher_rating: newTeacherReview.old_teacher_rating,\n    total_reviews: newTeacherReview.old_total_reviews,\n    review_rating: review_rating.toFixed(3)\n};\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTeacherReviewId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(deleteData);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher review not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:410:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;9ce161e1-e6ec-41d1-9cd4-5ed0361bdd76&quot;,&quot;parentUUID&quot;:&quot;419c01bd-2b26-497f-928c-6cb1f73f3351&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a teacher review request is incorrect due to inconsistent body params&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 3: Delete a teacher review request is incorrect due to inconsistent body params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst deleteData = {\n    teacher_id: unknownTeacherId, // not the same as the review being deleted\n    teacher_rating: newTeacherReview.old_teacher_rating,\n    total_reviews: newTeacherReview.old_total_reviews,\n    review_rating: \&quot;0.000\&quot; // not the same as the review being deleted\n};\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacherReview.review_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(deleteData);\n    \n// assert\nexpect(res.status).to.be.equal(500);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DeleteFailedException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;InternalServerException&#x27; to equal &#x27;DeleteFailedException&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;InternalServerException&#x27; to equal &#x27;DeleteFailedException&#x27;\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:434:49)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;InternalServerException&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;DeleteFailedException&quot;}]},&quot;uuid&quot;:&quot;6a0de462-47d1-48bc-9fa2-80593429ece1&quot;,&quot;parentUUID&quot;:&quot;419c01bd-2b26-497f-928c-6cb1f73f3351&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a teacher review request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 4: Delete a teacher review request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst deleteData = {\n    teacher_id: existingTeacherReview.teacher_id,\n    teacher_rating: newTeacherReview.old_teacher_rating,\n    total_reviews: newTeacherReview.old_total_reviews,\n    review_rating: existingTeacherReview.overall_rating\n};\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacherReview.review_id}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(deleteData);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:453:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;c0720fe4-c4d7-438e-8ce4-b351e620c4f4&quot;,&quot;parentUUID&quot;:&quot;419c01bd-2b26-497f-928c-6cb1f73f3351&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a teacher review request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 5: Delete a teacher review request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst deleteData = {\n    teacher_id: newTeacherReview.teacher_id,\n    teacher_rating: newTeacherReview.old_teacher_rating,\n    total_reviews: newTeacherReview.old_total_reviews,\n    review_rating: \&quot;4.300\&quot;\n};\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacherReview.review_id}`)\n    .send(deleteData);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6126b469-4f0a-4f16-82b4-f09be89f5898&quot;,&quot;parentUUID&quot;:&quot;419c01bd-2b26-497f-928c-6cb1f73f3351&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6126b469-4f0a-4f16-82b4-f09be89f5898&quot;],&quot;failures&quot;:[&quot;423481f3-ec16-434f-b171-a40c00aa9bff&quot;,&quot;9ce161e1-e6ec-41d1-9cd4-5ed0361bdd76&quot;,&quot;6a0de462-47d1-48bc-9fa2-80593429ece1&quot;,&quot;c0720fe4-c4d7-438e-8ce4-b351e620c4f4&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:34,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a01bba6c-eb05-4373-9c62-afdec8fe6cbe&quot;,&quot;title&quot;:&quot;Terms API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Terms API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Terms API \&quot;before each\&quot; hook in \&quot;Terms API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;56873978-5c1a-44be-9957-321ff3f14a07&quot;,&quot;parentUUID&quot;:&quot;a01bba6c-eb05-4373-9c62-afdec8fe6cbe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a88ade6f-85b8-404b-8adc-dffcc7a4d986&quot;,&quot;title&quot;:&quot;GET /terms&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all terms request successful&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms Scenario 1: Get all terms request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTerm));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:34:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;62b8f3dc-736e-4458-8f16-3c8b4429ef99&quot;,&quot;parentUUID&quot;:&quot;a88ade6f-85b8-404b-8adc-dffcc7a4d986&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all terms request unsuccessful due to zero terms&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms Scenario 2: Get all terms request unsuccessful due to zero terms&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:490,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TermModel = require(&#x27;../../src/models/term.model&#x27;);\nconst modelStub = sinon.stub(TermModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty term list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Terms not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;27e6f2fa-38d8-4e58-892d-38e3acea4c31&quot;,&quot;parentUUID&quot;:&quot;a88ade6f-85b8-404b-8adc-dffcc7a4d986&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms Scenario 3: Get a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:68:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;a9da555e-345e-43fc-ac6b-9da8f493f633&quot;,&quot;parentUUID&quot;:&quot;a88ade6f-85b8-404b-8adc-dffcc7a4d986&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all terms request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms Scenario 4: Get all terms request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c7938fca-de36-4a00-8382-c4f72fbcca62&quot;,&quot;parentUUID&quot;:&quot;a88ade6f-85b8-404b-8adc-dffcc7a4d986&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c7938fca-de36-4a00-8382-c4f72fbcca62&quot;],&quot;failures&quot;:[&quot;62b8f3dc-736e-4458-8f16-3c8b4429ef99&quot;,&quot;27e6f2fa-38d8-4e58-892d-38e3acea4c31&quot;,&quot;a9da555e-345e-43fc-ac6b-9da8f493f633&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:513,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;09e30515-7b4d-4b30-87d8-86274f3cc271&quot;,&quot;title&quot;:&quot;GET /terms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a term request successful&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms/:id Scenario 1: Get a term request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingTerm));\nexpect(resBody.term_id).to.be.equal(existingTerm.term_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:94:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;e0cf490e-8ed1-43da-ba47-b4f133005133&quot;,&quot;parentUUID&quot;:&quot;09e30515-7b4d-4b30-87d8-86274f3cc271&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a term request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms/:id Scenario 2: Get a term request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTermId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Term not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:108:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;d320b4f1-a788-4f3f-aff2-3dc589e46aea&quot;,&quot;parentUUID&quot;:&quot;09e30515-7b4d-4b30-87d8-86274f3cc271&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms/:id Scenario 3: Get a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:121:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;9864f407-6ef1-45ca-b47b-58c18ed8ff8f&quot;,&quot;parentUUID&quot;:&quot;09e30515-7b4d-4b30-87d8-86274f3cc271&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a term request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms/:id Scenario 4: Get a term request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTerm.term_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3cc50e78-26c7-4997-81b2-159ae59d4b80&quot;,&quot;parentUUID&quot;:&quot;09e30515-7b4d-4b30-87d8-86274f3cc271&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3cc50e78-26c7-4997-81b2-159ae59d4b80&quot;],&quot;failures&quot;:[&quot;e0cf490e-8ed1-43da-ba47-b4f133005133&quot;,&quot;d320b4f1-a788-4f3f-aff2-3dc589e46aea&quot;,&quot;9864f407-6ef1-45ca-b47b-58c18ed8ff8f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:31,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1d54942c-bfad-4952-9777-16a29fbcd79e&quot;,&quot;title&quot;:&quot;POST /terms&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a term request is successful&quot;,&quot;fullTitle&quot;:&quot;Terms API POST /terms Scenario 1: Create a term request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;term_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.term_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    term_id: newId,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;66e012bf-7eb9-4635-b94e-b1d995aeaa0c&quot;,&quot;parentUUID&quot;:&quot;1d54942c-bfad-4952-9777-16a29fbcd79e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a term request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Terms API POST /terms Scenario 2: Create a term request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    terms: term // &lt;-- a valid parameter name is &#x27;term&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;term&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:191:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;2180a922-1483-4626-a8f5-bb1daf2aeebc&quot;,&quot;parentUUID&quot;:&quot;1d54942c-bfad-4952-9777-16a29fbcd79e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API POST /terms Scenario 3: Create a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:209:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;ac9ef6a4-02e2-4b89-8dac-7795ecc0f2f4&quot;,&quot;parentUUID&quot;:&quot;1d54942c-bfad-4952-9777-16a29fbcd79e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a term request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API POST /terms Scenario 4: Create a term request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9f215a56-f819-4f8a-8925-70e5ed116d91&quot;,&quot;parentUUID&quot;:&quot;1d54942c-bfad-4952-9777-16a29fbcd79e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9f215a56-f819-4f8a-8925-70e5ed116d91&quot;],&quot;failures&quot;:[&quot;66e012bf-7eb9-4635-b94e-b1d995aeaa0c&quot;,&quot;2180a922-1483-4626-a8f5-bb1daf2aeebc&quot;,&quot;ac9ef6a4-02e2-4b89-8dac-7795ecc0f2f4&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:38,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;eaabc9d2-dea8-4ad3-ac3f-90ef444af2ac&quot;,&quot;title&quot;:&quot;PATCH /terms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a term request is successful&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 1: Update a term request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term: newTermName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    term_id: existingTerm.term_id,\n    term: newTermName\n});\n\n// cleanup\ndata.term = existingTerm.term;\nres = await request(app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:247:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;6d26ebbb-6294-400b-9409-230dfde5f9f0&quot;,&quot;parentUUID&quot;:&quot;eaabc9d2-dea8-4ad3-ac3f-90ef444af2ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a term request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 2: Update a term request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term: newTermName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTermId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Term not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:284:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;8a151b5b-6ff3-458c-b5fc-3d92a3de5862&quot;,&quot;parentUUID&quot;:&quot;eaabc9d2-dea8-4ad3-ac3f-90ef444af2ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a term request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 3: Update a term request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    terms: newTermName // &lt;-- a invalid update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;term&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:303:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;065d4a46-8a51-4642-a174-db82a2d07ad8&quot;,&quot;parentUUID&quot;:&quot;eaabc9d2-dea8-4ad3-ac3f-90ef444af2ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 4: Update a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term: newTermName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:323:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;6295333c-14dd-4fd5-8cfd-957bf994a4ae&quot;,&quot;parentUUID&quot;:&quot;eaabc9d2-dea8-4ad3-ac3f-90ef444af2ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a term request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 5: Update a term request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term: newTermName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0c0d7538-47d9-4dec-900a-3a822b3e2313&quot;,&quot;parentUUID&quot;:&quot;eaabc9d2-dea8-4ad3-ac3f-90ef444af2ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0c0d7538-47d9-4dec-900a-3a822b3e2313&quot;],&quot;failures&quot;:[&quot;6d26ebbb-6294-400b-9409-230dfde5f9f0&quot;,&quot;8a151b5b-6ff3-458c-b5fc-3d92a3de5862&quot;,&quot;065d4a46-8a51-4642-a174-db82a2d07ad8&quot;,&quot;6295333c-14dd-4fd5-8cfd-957bf994a4ae&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a96bd3d2-0ec4-4f03-a37c-bd13315da62f&quot;,&quot;title&quot;:&quot;DELETE /terms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a term request is successful&quot;,&quot;fullTitle&quot;:&quot;Terms API DELETE /terms/:id Scenario 1: Delete a term request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { term };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.term_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Term has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:359:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;4c2816ef-2788-4100-94b4-f2e56cc6c8c6&quot;,&quot;parentUUID&quot;:&quot;a96bd3d2-0ec4-4f03-a37c-bd13315da62f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a term request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Terms API DELETE /terms/:id Scenario 2: Delete a term request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTermId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Term not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:391:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;fd0e81d4-f931-4438-a7f3-82367d63df90&quot;,&quot;parentUUID&quot;:&quot;a96bd3d2-0ec4-4f03-a37c-bd13315da62f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API DELETE /terms/:id Scenario 3: Delete a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:404:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;e6e9aea2-1324-4395-a134-d210e518260e&quot;,&quot;parentUUID&quot;:&quot;a96bd3d2-0ec4-4f03-a37c-bd13315da62f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a term request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API DELETE /terms/:id Scenario 4: Delete a term request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTerm.term_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d9da9e31-c341-43f3-bb44-1cb4a1f775f6&quot;,&quot;parentUUID&quot;:&quot;a96bd3d2-0ec4-4f03-a37c-bd13315da62f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d9da9e31-c341-43f3-bb44-1cb4a1f775f6&quot;],&quot;failures&quot;:[&quot;4c2816ef-2788-4100-94b4-f2e56cc6c8c6&quot;,&quot;fd0e81d4-f931-4438-a7f3-82367d63df90&quot;,&quot;e6e9aea2-1324-4395-a134-d210e518260e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7d81ffc2-d5a6-4b22-80fe-6a24f0d5bdad&quot;,&quot;title&quot;:&quot;Timeslots API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Timeslots API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Timeslots API \&quot;before each\&quot; hook in \&quot;Timeslots API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b0bc7682-07be-48ec-9bc7-593829ae33f7&quot;,&quot;parentUUID&quot;:&quot;7d81ffc2-d5a6-4b22-80fe-6a24f0d5bdad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6a116849-409e-4aa6-b135-1b0c3f5b475a&quot;,&quot;title&quot;:&quot;GET /timeslots&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all timeslots request successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots Scenario 1: Get all timeslots request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTimeslot));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:37:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;adde3819-40a0-4305-9d22-e3eda824ddb7&quot;,&quot;parentUUID&quot;:&quot;6a116849-409e-4aa6-b135-1b0c3f5b475a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all timeslots request unsuccessful due to zero timeslots&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots Scenario 2: Get all timeslots request unsuccessful due to zero timeslots&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:463,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TimeslotModel = require(&#x27;../../src/models/timeslot.model&#x27;);\nconst modelStub = sinon.stub(TimeslotModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty timeslot list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslots not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;2f6d3d93-9ada-4aa3-b7d9-c7cc66fd4d32&quot;,&quot;parentUUID&quot;:&quot;6a116849-409e-4aa6-b135-1b0c3f5b475a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;adde3819-40a0-4305-9d22-e3eda824ddb7&quot;,&quot;2f6d3d93-9ada-4aa3-b7d9-c7cc66fd4d32&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:469,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1d74b20a-c394-4098-80c2-d8f1f08940b7&quot;,&quot;title&quot;:&quot;GET /timeslots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a timeslot request successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots/:id Scenario 1: Get a timeslot request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingTimeslot));\nexpect(resBody.timeslot_id).to.be.equal(existingTimeslot.timeslot_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:73:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;09b0052c-ebca-4309-b19c-d39f233fb144&quot;,&quot;parentUUID&quot;:&quot;1d74b20a-c394-4098-80c2-d8f1f08940b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a timeslot request is unsuccessful due to unknown timeslot_id&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots/:id Scenario 2: Get a timeslot request is unsuccessful due to unknown timeslot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTimeslotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:87:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;41666d37-f7e9-4d4a-aeca-26aa8c38be22&quot;,&quot;parentUUID&quot;:&quot;1d74b20a-c394-4098-80c2-d8f1f08940b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a timeslot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots/:id Scenario 4: Get a timeslot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTimeslot.timeslot_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1dc1ef90-ac4b-4f60-864a-fb01a049234c&quot;,&quot;parentUUID&quot;:&quot;1d74b20a-c394-4098-80c2-d8f1f08940b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1dc1ef90-ac4b-4f60-864a-fb01a049234c&quot;],&quot;failures&quot;:[&quot;09b0052c-ebca-4309-b19c-d39f233fb144&quot;,&quot;41666d37-f7e9-4d4a-aeca-26aa8c38be22&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:57,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ed669edc-6b79-4c14-b804-d90bae083a5b&quot;,&quot;title&quot;:&quot;POST /timeslots&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a timeslot request is successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 1: Create a timeslot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time, end_time, slot_number };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;timeslot_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.timeslot_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    timeslot_id: newId,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:122:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;557eba9a-0437-4e2f-a788-00e23f91cedc&quot;,&quot;parentUUID&quot;:&quot;ed669edc-6b79-4c14-b804-d90bae083a5b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a timeslot request is unsuccessful due to timeslot conflicts&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 2: Create a timeslot request is unsuccessful due to timeslot conflicts&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time: existingTimeslot.start_time, end_time, slot_number }; // start_time conflict\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(500);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;CreateFailedException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot conflicts found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;InternalServerException&#x27; to equal &#x27;CreateFailedException&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;InternalServerException&#x27; to equal &#x27;CreateFailedException&#x27;\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:159:49)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;InternalServerException&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;CreateFailedException&quot;}]},&quot;uuid&quot;:&quot;199ffd1c-c457-457a-8ee8-fdd7bb2fb3a1&quot;,&quot;parentUUID&quot;:&quot;ed669edc-6b79-4c14-b804-d90bae083a5b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a timeslot request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 3: Create a timeslot request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    timeslots: start_time, // &lt;-- a valid parameter name is &#x27;start_time&#x27;\n    end_time,\n    slot_number: &#x27;asb&#x27; // has to be an int\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;start_time&#x27;, &#x27;slot_number&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:178:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;ea89df06-d323-439c-89e9-affd9829c1b7&quot;,&quot;parentUUID&quot;:&quot;ed669edc-6b79-4c14-b804-d90bae083a5b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a timeslot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 4: Create a timeslot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time, end_time, slot_number };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:196:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;29c715b2-d51e-4f2c-8420-25e268faece1&quot;,&quot;parentUUID&quot;:&quot;ed669edc-6b79-4c14-b804-d90bae083a5b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a timeslot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 5: Create a timeslot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time, end_time, slot_number };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8b0e58f3-2884-47b4-bca6-1e0e0c9aea75&quot;,&quot;parentUUID&quot;:&quot;ed669edc-6b79-4c14-b804-d90bae083a5b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8b0e58f3-2884-47b4-bca6-1e0e0c9aea75&quot;],&quot;failures&quot;:[&quot;557eba9a-0437-4e2f-a788-00e23f91cedc&quot;,&quot;199ffd1c-c457-457a-8ee8-fdd7bb2fb3a1&quot;,&quot;ea89df06-d323-439c-89e9-affd9829c1b7&quot;,&quot;29c715b2-d51e-4f2c-8420-25e268faece1&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:57,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;299b9652-92e1-48cc-80c5-818621a25e68&quot;,&quot;title&quot;:&quot;PATCH /timeslots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a timeslot request is successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 1: Update a timeslot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { slot_number: newTimeslotNumber };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    timeslot_id: existingTimeslot.timeslot_id,\n    start_time: existingTimeslot.start_time,\n    end_time: existingTimeslot.end_time,\n    slot_number: newTimeslotNumber\n});\n\n// cleanup\ndata.slot_number = existingTimeslot.slot_number;\nres = await request(app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:234:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;15844834-b0c5-403e-934c-ad033fd17b7e&quot;,&quot;parentUUID&quot;:&quot;299b9652-92e1-48cc-80c5-818621a25e68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a timeslot request is unsuccessful due to unknown timeslot code&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 2: Update a timeslot request is unsuccessful due to unknown timeslot code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { slot_number: newTimeslotNumber };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTimeslotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:273:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;19edfaa6-c473-4b36-ac30-7c9d93a84807&quot;,&quot;parentUUID&quot;:&quot;299b9652-92e1-48cc-80c5-818621a25e68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a timeslot request is unsuccessful due to timeslot conflicts&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 3: Update a timeslot request is unsuccessful due to timeslot conflicts&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time: existingTimeslot.end_time }; // can&#x27;t be the same time\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(500);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;UpdateFailedException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot conflicts found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;InternalServerException&#x27; to equal &#x27;UpdateFailedException&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;InternalServerException&#x27; to equal &#x27;UpdateFailedException&#x27;\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:292:49)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;InternalServerException&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;UpdateFailedException&quot;}]},&quot;uuid&quot;:&quot;6cd0c06d-77b6-48be-b690-69877c8673eb&quot;,&quot;parentUUID&quot;:&quot;299b9652-92e1-48cc-80c5-818621a25e68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a timeslot request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 4: Update a timeslot request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    timeslots: newTimeslotNumber // &lt;-- a invalid update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:309:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;ece501fa-1b5c-40bd-8be5-d800608a777a&quot;,&quot;parentUUID&quot;:&quot;299b9652-92e1-48cc-80c5-818621a25e68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a timeslot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 5: Update a timeslot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { slot_number: newTimeslotNumber };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:327:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;60275bbd-6b1e-4541-8877-d5734e29623d&quot;,&quot;parentUUID&quot;:&quot;299b9652-92e1-48cc-80c5-818621a25e68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a timeslot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 6: Update a timeslot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { slot_number: newTimeslotNumber };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;840ce8cb-8b5c-473a-831c-0138c904fdfc&quot;,&quot;parentUUID&quot;:&quot;299b9652-92e1-48cc-80c5-818621a25e68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;840ce8cb-8b5c-473a-831c-0138c904fdfc&quot;],&quot;failures&quot;:[&quot;15844834-b0c5-403e-934c-ad033fd17b7e&quot;,&quot;19edfaa6-c473-4b36-ac30-7c9d93a84807&quot;,&quot;6cd0c06d-77b6-48be-b690-69877c8673eb&quot;,&quot;ece501fa-1b5c-40bd-8be5-d800608a777a&quot;,&quot;60275bbd-6b1e-4541-8877-d5734e29623d&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:50,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;da8d12a1-fa84-47cb-b9b6-6f948edd044b&quot;,&quot;title&quot;:&quot;DELETE /timeslots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a timeslot request is successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API DELETE /timeslots/:id Scenario 1: Delete a timeslot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { start_time, end_time, slot_number };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.timeslot_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:365:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;6fc22abf-5726-4a69-9e3c-c77e6515121f&quot;,&quot;parentUUID&quot;:&quot;da8d12a1-fa84-47cb-b9b6-6f948edd044b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a timeslot request is unsuccessful due to unknown timeslot code&quot;,&quot;fullTitle&quot;:&quot;Timeslots API DELETE /timeslots/:id Scenario 2: Delete a timeslot request is unsuccessful due to unknown timeslot code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTimeslotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:397:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;b84dec5f-fda0-44d9-b339-a33d550bc6c7&quot;,&quot;parentUUID&quot;:&quot;da8d12a1-fa84-47cb-b9b6-6f948edd044b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a timeslot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Timeslots API DELETE /timeslots/:id Scenario 3: Delete a timeslot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:410:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;58d30e0b-7700-4dd7-bb7b-faf74c3351a6&quot;,&quot;parentUUID&quot;:&quot;da8d12a1-fa84-47cb-b9b6-6f948edd044b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a timeslot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timeslots API DELETE /timeslots/:id Scenario 4: Delete a timeslot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTimeslot.timeslot_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9c6cf149-743b-491a-bcc0-80432cd63cd2&quot;,&quot;parentUUID&quot;:&quot;da8d12a1-fa84-47cb-b9b6-6f948edd044b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9c6cf149-743b-491a-bcc0-80432cd63cd2&quot;],&quot;failures&quot;:[&quot;6fc22abf-5726-4a69-9e3c-c77e6515121f&quot;,&quot;b84dec5f-fda0-44d9-b339-a33d550bc6c7&quot;,&quot;58d30e0b-7700-4dd7-bb7b-faf74c3351a6&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;42f5a68b-af59-4db9-ae0f-4b6b54352a31&quot;,&quot;title&quot;:&quot;Timetables API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Timetables API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Timetables API \&quot;before each\&quot; hook in \&quot;Timetables API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;23e91473-8d77-4ccb-90c5-90abc040d7b5&quot;,&quot;parentUUID&quot;:&quot;42f5a68b-af59-4db9-ae0f-4b6b54352a31&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8d67a45f-fee9-434d-a484-8219e9ca2c0b&quot;,&quot;title&quot;:&quot;GET /timetables&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all timetables request is successful (Admin Only)&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 1: Get all timetables request is successful (Admin Only)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTimetable)); // contain all params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:152:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;9378a0ff-9a5c-4219-ada2-65451a5b6034&quot;,&quot;parentUUID&quot;:&quot;8d67a45f-fee9-434d-a484-8219e9ca2c0b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all timetables request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 2: Get all timetables request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst student_erp = userERP;\nlet res = await request(this.app)\n    .get(`${baseRoute}?student_erp=${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].student_erp).to.be.equal(student_erp);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:168:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;5d3ba246-a51c-4a53-b952-7542d3a13fc5&quot;,&quot;parentUUID&quot;:&quot;8d67a45f-fee9-434d-a484-8219e9ca2c0b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all timetables request unsuccessful due to no student timetables&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 3: Get all timetables request unsuccessful due to no student timetables&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:525,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TimetableModel = require(&#x27;../../src/models/timetable.model&#x27;);\nconst modelStub = sinon.stub(TimetableModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty timetable list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetables not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;414ad596-c2ac-4947-b2f2-4ac8c2049b7f&quot;,&quot;parentUUID&quot;:&quot;8d67a45f-fee9-434d-a484-8219e9ca2c0b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all timetables request is incorrect due to unknown query parameters&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 4: Get all timetables request is incorrect due to unknown query parameters&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst student_erp = &#x27;all&#x27;; // &lt;-- invalid student_erp value\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?student_erp=${student_erp}&amp;year=2022`) // &lt;-- `year` is an incorrect query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;student_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:206:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;03a49f73-9ade-4895-8c57-0b9c5873c5c6&quot;,&quot;parentUUID&quot;:&quot;8d67a45f-fee9-434d-a484-8219e9ca2c0b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all timetables request is forbidden due to no query params&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 5: Get all timetables request is forbidden due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute) // needs student_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:222:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;1e64c490-449f-451a-bba1-83372e872ab6&quot;,&quot;parentUUID&quot;:&quot;8d67a45f-fee9-434d-a484-8219e9ca2c0b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get all timetables request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 6: Get all timetables request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4954f419-66d9-48be-b0ea-720cc085cdf4&quot;,&quot;parentUUID&quot;:&quot;8d67a45f-fee9-434d-a484-8219e9ca2c0b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4954f419-66d9-48be-b0ea-720cc085cdf4&quot;],&quot;failures&quot;:[&quot;9378a0ff-9a5c-4219-ada2-65451a5b6034&quot;,&quot;5d3ba246-a51c-4a53-b952-7542d3a13fc5&quot;,&quot;414ad596-c2ac-4947-b2f2-4ac8c2049b7f&quot;,&quot;03a49f73-9ade-4895-8c57-0b9c5873c5c6&quot;,&quot;1e64c490-449f-451a-bba1-83372e872ab6&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:565,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7c89d6b0-6d10-4fdf-82ff-1462e8e9657d&quot;,&quot;title&quot;:&quot;GET /timetables/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a timetable request successful&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables/:id Scenario 1: Get a timetable request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTimetable.timetable_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.timetable_id).to.be.equal(existingTimetable.timetable_id); // should match initially sent id\nexpect(resBody).to.include.all.keys(Object.keys(existingTimetable)); // contain all params\nexpect(resBody.classes).to.be.an(&#x27;array&#x27;);\nexpect(resBody.classes[0]).to.include.all.keys(Object.keys(existingClass1)); // contain all params\nconst exampleClass = resBody.classes[0];\nexpect(exampleClass.classroom).to.not.be.undefined;\nexpect(exampleClass.classroom).to.include.all.keys(Object.keys(existingClass1.classroom)); // contain all params\n\nexpect(exampleClass.classroom.campus).to.not.be.undefined;\nexpect(exampleClass.classroom.campus).to.include.all.keys(Object.keys(existingClass1.classroom.campus)); // contain all params\nexpect(exampleClass.subject).to.not.be.undefined;\nexpect(exampleClass.subject).to.include.all.keys(Object.keys(existingClass1.subject)); // contain all params\nexpect(exampleClass.teacher).to.not.be.undefined;\nexpect(exampleClass.teacher).to.include.all.keys(Object.keys(existingClass1.teacher)); // contain all params\nexpect(exampleClass.timeslot_1).to.not.be.undefined;\nexpect(exampleClass.timeslot_1).to.include.all.keys(Object.keys(existingClass1.timeslot_1)); // contain all params\nexpect(exampleClass.timeslot_2).to.not.be.undefined;\nexpect(exampleClass.timeslot_2).to.include.all.keys(Object.keys(existingClass1.timeslot_2)); // contain all params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:248:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;65daa316-5314-4a01-bc2e-ca9df0ae8f94&quot;,&quot;parentUUID&quot;:&quot;7c89d6b0-6d10-4fdf-82ff-1462e8e9657d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a timetable request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables/:id Scenario 2: Get a timetable request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:285:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;53399cb3-d23a-4e9e-acda-09d602e59d30&quot;,&quot;parentUUID&quot;:&quot;7c89d6b0-6d10-4fdf-82ff-1462e8e9657d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables/:id Scenario 3: Get a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTimetable.timetable_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7c745b2f-c228-40fc-b618-792b650233fe&quot;,&quot;parentUUID&quot;:&quot;7c89d6b0-6d10-4fdf-82ff-1462e8e9657d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7c745b2f-c228-40fc-b618-792b650233fe&quot;],&quot;failures&quot;:[&quot;65daa316-5314-4a01-bc2e-ca9df0ae8f94&quot;,&quot;53399cb3-d23a-4e9e-acda-09d602e59d30&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a3b7d24a-9903-4122-ad6b-adf26c5bc652&quot;,&quot;title&quot;:&quot;POST /timetables&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a timetable request is successful&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables Scenario 1: Create a timetable request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTimetable };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;timetable_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// affirm\nconst newId = res.body.body.timetable_id;\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nconst resBody = res.body.body;\n// check if all classes added to schedule\nconst resClasses = resBody.classes.map(classItem =&gt; classItem.class_erp);\nexpect(resClasses).to.include.all.members(data.classes);\n// check other properties\ndelete resBody.classes;\nexpect(resBody).to.be.eql({\n    timetable_id: newId,\n    student_erp: data.student_erp,\n    term_id: data.term_id,\n    is_active: data.is_active\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:324:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;a8345b3f-2b4f-4378-9719-e7b847dc71ac&quot;,&quot;parentUUID&quot;:&quot;a3b7d24a-9903-4122-ad6b-adf26c5bc652&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a timetable request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables Scenario 2: Create a timetable request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst {classes, ...timetable} = newTimetable;\nconst data = {\n    ...timetable,\n    classessfd: classes // &lt;-- a valid param is &#x27;classes&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;classes&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:373:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;9a6c0cb0-6f26-40e3-904f-7f002ec948b6&quot;,&quot;parentUUID&quot;:&quot;a3b7d24a-9903-4122-ad6b-adf26c5bc652&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables Scenario 3: Create a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTimetable };\ndata.student_erp = adminERP; // &lt;-- can be any other non-admin ERP as well, just different from userToken erp\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t create others timetables i.e. token erp != newTimetable.student_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:392:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;4a3a29f1-675d-4311-aa3c-fd36a09240c8&quot;,&quot;parentUUID&quot;:&quot;a3b7d24a-9903-4122-ad6b-adf26c5bc652&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables Scenario 4: Create a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTimetable };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c687eebf-9324-4c2d-98b5-bead0d85a44e&quot;,&quot;parentUUID&quot;:&quot;a3b7d24a-9903-4122-ad6b-adf26c5bc652&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c687eebf-9324-4c2d-98b5-bead0d85a44e&quot;],&quot;failures&quot;:[&quot;a8345b3f-2b4f-4378-9719-e7b847dc71ac&quot;,&quot;9a6c0cb0-6f26-40e3-904f-7f002ec948b6&quot;,&quot;4a3a29f1-675d-4311-aa3c-fd36a09240c8&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:38,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;5e2dc83f-3332-465d-8153-bae43040860e&quot;,&quot;title&quot;:&quot;POST /timetables/generate&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Generate timetables request is successful&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables/generate Scenario 1: Generate timetables request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { num_of_subjects, classes: possibleClasses };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst exampleTimetable = resBody[0];\n\nexpect(exampleTimetable).to.include.all.keys([\&quot;term_id\&quot;, \&quot;is_active\&quot;, \&quot;classes\&quot;]); // contain all params\nexpect(exampleTimetable.classes).to.be.an(&#x27;array&#x27;);\nexpect(exampleTimetable.classes[0]).to.include.all.keys(Object.keys(existingClass1)); // contain all params\nconst exampleClass = exampleTimetable.classes[0];\nexpect(exampleClass.classroom).to.not.be.undefined;\nexpect(exampleClass.classroom).to.include.all.keys(Object.keys(existingClass1.classroom)); // contain all params\n\nexpect(exampleClass.classroom.campus).to.not.be.undefined;\nexpect(exampleClass.classroom.campus).to.include.all.keys(Object.keys(existingClass1.classroom.campus)); // contain all params\nexpect(exampleClass.subject).to.not.be.undefined;\nexpect(exampleClass.subject).to.include.all.keys(Object.keys(existingClass1.subject)); // contain all params\nexpect(exampleClass.teacher).to.not.be.undefined;\nexpect(exampleClass.teacher).to.include.all.keys(Object.keys(existingClass1.teacher)); // contain all params\nexpect(exampleClass.timeslot_1).to.not.be.undefined;\nexpect(exampleClass.timeslot_1).to.include.all.keys(Object.keys(existingClass1.timeslot_1)); // contain all params\nexpect(exampleClass.timeslot_2).to.not.be.undefined;\nexpect(exampleClass.timeslot_2).to.include.all.keys(Object.keys(existingClass1.timeslot_2)); // contain all params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:432:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;1c7f15d1-f574-40e1-97bf-12d700209133&quot;,&quot;parentUUID&quot;:&quot;5e2dc83f-3332-465d-8153-bae43040860e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Generate timetables request is unsuccessful due to no possible timetables&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables/generate Scenario 2: Generate timetables request is unsuccessful due to no possible timetables&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:602,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { num_of_subjects, classes: possibleClasses };\ndecache(&#x27;../../src/server&#x27;);\nconst TimetableRepository = require(&#x27;../../src/repositories/timetable.repository&#x27;);\nconst modelStub = sinon.stub(TimetableRepository, &#x27;findScheduleClass&#x27;).callsFake(() =&gt; []); // return empty timetable list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Possible timetables not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:32:27\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;32811111-804f-4194-bdc8-c7885100b7e7&quot;,&quot;parentUUID&quot;:&quot;5e2dc83f-3332-465d-8153-bae43040860e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a timetable request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables/generate Scenario 3: Create a timetable request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    subjects: num_of_subjects, // &lt;-- a valid param is &#x27;num_of_subjects&#x27;\n    classes: [] // &lt;-- must specify atleast 1 &#x27;class&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;num_of_subjects&#x27;, &#x27;classes&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:501:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;513a66af-43c3-4cf9-859e-5d010ab5fbe2&quot;,&quot;parentUUID&quot;:&quot;5e2dc83f-3332-465d-8153-bae43040860e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables/generate Scenario 4: Create a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { num_of_subjects, classes: possibleClasses };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5350dbdb-8f6d-4407-83b9-091921c9376b&quot;,&quot;parentUUID&quot;:&quot;5e2dc83f-3332-465d-8153-bae43040860e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5350dbdb-8f6d-4407-83b9-091921c9376b&quot;],&quot;failures&quot;:[&quot;1c7f15d1-f574-40e1-97bf-12d700209133&quot;,&quot;32811111-804f-4194-bdc8-c7885100b7e7&quot;,&quot;513a66af-43c3-4cf9-859e-5d010ab5fbe2&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:636,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;5490bbb6-f08f-4ad9-a77e-e1d3c7866403&quot;,&quot;title&quot;:&quot;PATCH /timetables/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a timetable request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 1: Update a timetable request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { is_active: updatedTimetableIsActive };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${inActiveTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(2); // 1 for inactive the previous, then active new\nexpect(res.body.body.rows_changed).to.be.equal(2); // 1 for inactive the previous, then active new\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${inActiveTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.is_active).to.be.equal(updatedTimetableIsActive);\n\n// cleanup\ndata.is_active = existingTimetable.is_active;\nres = await request(app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:540:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;f7373977-50e1-4301-8e6e-2b23008215ea&quot;,&quot;parentUUID&quot;:&quot;5490bbb6-f08f-4ad9-a77e-e1d3c7866403&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 2: Update a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { is_active: updatedTimetableIsActive };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:573:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;466ad0e0-e92f-4edd-b1b5-a6d36c97b3d7&quot;,&quot;parentUUID&quot;:&quot;5490bbb6-f08f-4ad9-a77e-e1d3c7866403&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a timetable request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 3: Update a timetable request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    bodysds: updatedTimetableIsActive, // &lt;-- an valid parameter name should be &#x27;is_active&#x27;\n    is_active: \&quot;all\&quot; // &lt;-- an invalid value for &#x27;is_active&#x27; parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;is_active&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:593:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;4e443f9a-5ccd-4f81-a864-6ab8ec97c979&quot;,&quot;parentUUID&quot;:&quot;5490bbb6-f08f-4ad9-a77e-e1d3c7866403&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 4: Update a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { is_active: updatedTimetableIsActive };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedTimetableId}`) // &lt;-- has a different student_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others timetables i.e. token erp != unOwnedTimetable.student_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:613:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;41c00b45-a360-47ec-8ccb-5eaa0eefc611&quot;,&quot;parentUUID&quot;:&quot;5490bbb6-f08f-4ad9-a77e-e1d3c7866403&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 5: Update a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { is_active: updatedTimetableIsActive };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${inActiveTimetableId}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;87f77f21-32aa-4f1a-9541-1c6586d89033&quot;,&quot;parentUUID&quot;:&quot;5490bbb6-f08f-4ad9-a77e-e1d3c7866403&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;87f77f21-32aa-4f1a-9541-1c6586d89033&quot;],&quot;failures&quot;:[&quot;f7373977-50e1-4301-8e6e-2b23008215ea&quot;,&quot;466ad0e0-e92f-4edd-b1b5-a6d36c97b3d7&quot;,&quot;4e443f9a-5ccd-4f81-a864-6ab8ec97c979&quot;,&quot;41c00b45-a360-47ec-8ccb-5eaa0eefc611&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;26e5e731-aa49-418f-92a2-fef9bc8542e6&quot;,&quot;title&quot;:&quot;PATCH /timetables/:id/classes&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a timetable request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 1: Update a timetable request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added, removed };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_added).to.be.equal(added.length);\nexpect(res.body.body.rows_removed).to.be.equal(removed.length);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingTimetable.timetable_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst classes = res.body.body.classes;\nconst classERPs = classes.map(classItem =&gt; classItem.class_erp);\nexpect(classERPs).to.include.all.members(added);\nexpect(classERPs).to.not.include.all.members(removed);\n\n// cleanup\ndata.added = [...removed];\ndata.removed = [...added];\nres = await request(app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:656:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;804596b1-d575-4597-829f-41e7fa15f6f5&quot;,&quot;parentUUID&quot;:&quot;26e5e731-aa49-418f-92a2-fef9bc8542e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 2: Update a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added, removed };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTimetableId}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:693:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;91cfed18-9045-46e2-8285-77e3a53b4f58&quot;,&quot;parentUUID&quot;:&quot;26e5e731-aa49-418f-92a2-fef9bc8542e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a timetable request is unsuccessful due to unknown class_erp&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 3: Update a timetable request is unsuccessful due to unknown class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added: [unknownClassERP] }; // adding an unknown class erp\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;class_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:710:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;ee013632-3d21-4eb8-b087-3121afaa3664&quot;,&quot;parentUUID&quot;:&quot;26e5e731-aa49-418f-92a2-fef9bc8542e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a timetable request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 4: Update a timetable request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    added: [], // &lt;-- &#x27;added&#x27; should be omitted if empty\n    removed: [\&quot;all\&quot;], // &lt;-- all values in the array should match the classERP format(4 or 5 digits)\n    same: [existingClass2.class_erp] // &lt;-- not an allowed update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;added&#x27;, &#x27;removed[0]&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:731:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;adbc90e9-0534-4c79-b371-9f8952f5ea8a&quot;,&quot;parentUUID&quot;:&quot;26e5e731-aa49-418f-92a2-fef9bc8542e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 5: Update a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added, removed };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedTimetableId}/${subRoute}`) // &lt;-- has a different student_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others timetables i.e. token erp != unOwnedTimetable.student_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:751:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;0d08103e-3fda-4ccb-a3dc-a621295d401d&quot;,&quot;parentUUID&quot;:&quot;26e5e731-aa49-418f-92a2-fef9bc8542e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 6: Update a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added, removed };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6eaaa052-59c9-4b5d-8f46-2bb1a8f069dd&quot;,&quot;parentUUID&quot;:&quot;26e5e731-aa49-418f-92a2-fef9bc8542e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6eaaa052-59c9-4b5d-8f46-2bb1a8f069dd&quot;],&quot;failures&quot;:[&quot;804596b1-d575-4597-829f-41e7fa15f6f5&quot;,&quot;91cfed18-9045-46e2-8285-77e3a53b4f58&quot;,&quot;ee013632-3d21-4eb8-b087-3121afaa3664&quot;,&quot;adbc90e9-0534-4c79-b371-9f8952f5ea8a&quot;,&quot;0d08103e-3fda-4ccb-a3dc-a621295d401d&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:44,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0790f96a-fb96-4d9c-860f-e48397ade714&quot;,&quot;title&quot;:&quot;DELETE /timetables/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a timetable request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Timetables API DELETE /timetables/:id Scenario 1: Delete a timetable request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTimetable };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.timetable_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // using his own token i.e. token erp == newTimetable.student_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:793:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;b9996c2b-7d7e-4051-83a7-2b468cdc6084&quot;,&quot;parentUUID&quot;:&quot;0790f96a-fb96-4d9c-860f-e48397ade714&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;fullTitle&quot;:&quot;Timetables API DELETE /timetables/:id Scenario 2: Delete a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:825:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;84de177e-00dd-4be2-b087-e0c41c5feaff&quot;,&quot;parentUUID&quot;:&quot;0790f96a-fb96-4d9c-860f-e48397ade714&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Timetables API DELETE /timetables/:id Scenario 3: Delete a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unOwnedTimetableId}`) // &lt;-- has a different student_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user can&#x27;t delete others timetables i.e. token erp != unOwnedTimetable.student_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:838:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;ab7be6fb-2c95-40e4-a40c-5011ea9b17d2&quot;,&quot;parentUUID&quot;:&quot;0790f96a-fb96-4d9c-860f-e48397ade714&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API DELETE /timetables/:id Scenario 5: Delete a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTimetable.timetable_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f236be0a-c779-4c73-b972-7e077891df9b&quot;,&quot;parentUUID&quot;:&quot;0790f96a-fb96-4d9c-860f-e48397ade714&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f236be0a-c779-4c73-b972-7e077891df9b&quot;],&quot;failures&quot;:[&quot;b9996c2b-7d7e-4051-83a7-2b468cdc6084&quot;,&quot;84de177e-00dd-4be2-b087-e0c41c5feaff&quot;,&quot;ab7be6fb-2c95-40e4-a40c-5011ea9b17d2&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:29,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:20000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.0.0&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;integration-tests-report&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:false,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:true,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;test/integration/report&quot;,&quot;reportFilename&quot;:&quot;integration-tests-report&quot;,&quot;json&quot;:&quot;false&quot;},&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;integration-tests-report&quot;,&quot;reportDir&quot;:&quot;test/integration/report&quot;,&quot;reportTitle&quot;:&quot;UniPal-Backend&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:false,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;test\\integration\\report\\assets&quot;,&quot;htmlFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\report\\integration-tests-report.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>