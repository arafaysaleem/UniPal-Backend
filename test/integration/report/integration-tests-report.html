<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:159,&quot;tests&quot;:599,&quot;passes&quot;:599,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2022-06-25T22:07:00.065Z&quot;,&quot;end&quot;:&quot;2022-06-25T22:07:24.886Z&quot;,&quot;duration&quot;:24821,&quot;testsRegistered&quot;:599,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;4af23457-6f8d-4f54-b1c0-5d5a13f803fd&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d9100a48-a9a0-49df-ba53-c164a50bff6d&quot;,&quot;title&quot;:&quot;Activities API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Activities API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activities API \&quot;before each\&quot; hook in \&quot;Activities API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ef1ed125-b79d-44c9-a69c-f3bd05db9999&quot;,&quot;parentUUID&quot;:&quot;d9100a48-a9a0-49df-ba53-c164a50bff6d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;95421ef7-5cb6-4792-8e1c-5ac4d09ae121&quot;,&quot;title&quot;:&quot;GET /activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all activities request successful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 1: Get all activities request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingActivity)); // contain all params&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7b125b6b-b991-4a20-ba91-79d53aab90d9&quot;,&quot;parentUUID&quot;:&quot;95421ef7-5cb6-4792-8e1c-5ac4d09ae121&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all activities request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 2: Get all activities request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;public&#x27;;\nlet res = await request(this.app)\n    .get(`${baseRoute}?privacy=${privacy}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].privacy).to.be.equal(privacy);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2914eab4-91fe-478b-a4da-7f10d098741a&quot;,&quot;parentUUID&quot;:&quot;95421ef7-5cb6-4792-8e1c-5ac4d09ae121&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all activities request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 3: Get all activities request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:627,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ActivityModel = require(&#x27;../../src/models/activity.model&#x27;);\nconst modelStub = sinon.stub(ActivityModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty activity list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f89322b3-0bc6-4e3a-95f5-d77f0d9ba404&quot;,&quot;parentUUID&quot;:&quot;95421ef7-5cb6-4792-8e1c-5ac4d09ae121&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all activities request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 4: Get all activities request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;all&#x27;; // &lt;-- invalid privacy value\nlet res = await request(this.app)\n    .get(`${baseRoute}?privacy=${privacy}&amp;week=2`) // &lt;-- `week` is an incorrect query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;privacy&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;42596a28-3fbd-4d4b-a35b-ed9abbdee0c8&quot;,&quot;parentUUID&quot;:&quot;95421ef7-5cb6-4792-8e1c-5ac4d09ae121&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all activities request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 5: Get all activities request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;19d41859-8b8d-440a-801a-414c230f7d2d&quot;,&quot;parentUUID&quot;:&quot;95421ef7-5cb6-4792-8e1c-5ac4d09ae121&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7b125b6b-b991-4a20-ba91-79d53aab90d9&quot;,&quot;2914eab4-91fe-478b-a4da-7f10d098741a&quot;,&quot;f89322b3-0bc6-4e3a-95f5-d77f0d9ba404&quot;,&quot;42596a28-3fbd-4d4b-a35b-ed9abbdee0c8&quot;,&quot;19d41859-8b8d-440a-801a-414c230f7d2d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:713,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7df62e1f-b108-4e7b-9bd5-00780dd8cb04&quot;,&quot;title&quot;:&quot;GET /activities/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a activity request successful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id Scenario 1: Get a activity request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.activity_id).to.be.eql(existingActivity.activity_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e5fca6a1-ee95-4516-aaec-25f967de8fa0&quot;,&quot;parentUUID&quot;:&quot;7df62e1f-b108-4e7b-9bd5-00780dd8cb04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a activity request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id Scenario 2: Get a activity request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownActivityId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;26c2c95b-8e66-4491-bc87-45f07e4e5e24&quot;,&quot;parentUUID&quot;:&quot;7df62e1f-b108-4e7b-9bd5-00780dd8cb04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id Scenario 3: Get a activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingActivity.activity_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1e023e69-6dd7-4ed1-859d-7876963d1264&quot;,&quot;parentUUID&quot;:&quot;7df62e1f-b108-4e7b-9bd5-00780dd8cb04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e5fca6a1-ee95-4516-aaec-25f967de8fa0&quot;,&quot;26c2c95b-8e66-4491-bc87-45f07e4e5e24&quot;,&quot;1e023e69-6dd7-4ed1-859d-7876963d1264&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:29,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6a1f9a51-f692-472e-b3d5-e20bf6f96d42&quot;,&quot;title&quot;:&quot;GET /activities/:id/attendees&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get an activity&#x27;s attendees request successful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 1: Get an activity&#x27;s attendees request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivity.activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].activity_id).to.be.equal(existingActivity.activity_id); // should match initially sent id\nexpect(resBody[0]).to.include.keys([&#x27;student_erp&#x27;, &#x27;first_name&#x27;,\n    &#x27;last_name&#x27;, &#x27;profile_picture_url&#x27;, &#x27;involvement_type&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8129a5f2-745b-4b62-9f78-4c2ad94233ba&quot;,&quot;parentUUID&quot;:&quot;6a1f9a51-f692-472e-b3d5-e20bf6f96d42&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get an activity&#x27;s attendees request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 2: Get an activity&#x27;s attendees request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst involvement_type = &#x27;going&#x27;;\nconst query = `involvement_type=${involvement_type}`;\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivity.activity_id}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].involvement_type).to.be.equal(involvement_type);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;131e2a37-3ef1-4740-bd2f-24987589e9e1&quot;,&quot;parentUUID&quot;:&quot;6a1f9a51-f692-472e-b3d5-e20bf6f96d42&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get an activity&#x27;s attendees request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 3: Get an activity&#x27;s attendees request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownActivityId}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;61b42943-8929-4e17-8212-e3159153f91f&quot;,&quot;parentUUID&quot;:&quot;6a1f9a51-f692-472e-b3d5-e20bf6f96d42&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get an activity&#x27;s attendees request is unsuccessful due to zero attendees&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 4: Get an activity&#x27;s attendees request is unsuccessful due to zero attendees&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:618,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ActivityModel = require(&#x27;../../src/models/activity.model&#x27;);\nconst modelStub = sinon.stub(ActivityModel, &#x27;findAllAttendeesByActivity&#x27;).callsFake(() =&gt; []); // return empty activity attendees list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingActivity.activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;26316088-7b8d-48f2-bfab-3c2929a12d59&quot;,&quot;parentUUID&quot;:&quot;6a1f9a51-f692-472e-b3d5-e20bf6f96d42&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get an activity&#x27;s attendees is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 5: Get an activity&#x27;s attendees is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingActivity.activity_id}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a69715e4-81a5-4e6c-b60e-6e7901a023fd&quot;,&quot;parentUUID&quot;:&quot;6a1f9a51-f692-472e-b3d5-e20bf6f96d42&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8129a5f2-745b-4b62-9f78-4c2ad94233ba&quot;,&quot;131e2a37-3ef1-4740-bd2f-24987589e9e1&quot;,&quot;61b42943-8929-4e17-8212-e3159153f91f&quot;,&quot;26316088-7b8d-48f2-bfab-3c2929a12d59&quot;,&quot;a69715e4-81a5-4e6c-b60e-6e7901a023fd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:659,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;72aeab00-8c9e-4b41-a530-eee4c8bbea00&quot;,&quot;title&quot;:&quot;POST /activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create an activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 1: Create an activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newActivity.organizer_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;activity_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// affirm\nconst newId = res.body.body.activity_id;\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\ndelete res.body.body.happens_at;\ndelete data.happens_at;\nexpect(res.body.body).to.be.eql({\n    activity_id: newId,\n    num_of_attendees: 0,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;77ebb012-a146-45c9-9492-233594277693&quot;,&quot;parentUUID&quot;:&quot;72aeab00-8c9e-4b41-a530-eee4c8bbea00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create an activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 2: Create an activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // admin to create other&#x27;s activities i.e. token erp != newActivity.organizer_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;activity_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// affirm\nconst newId = res.body.body.activity_id;\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\ndelete res.body.body.happens_at;\ndelete data.happens_at;\nexpect(res.body.body).to.be.eql({\n    activity_id: newId,\n    num_of_attendees: 0,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1666db43-9f78-473d-ab9d-f89259932726&quot;,&quot;parentUUID&quot;:&quot;72aeab00-8c9e-4b41-a530-eee4c8bbea00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create an activity request is unsuccessful due to unknown activity_type_id&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 3: Create an activity request is unsuccessful due to unknown activity_type_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.activity_type_id = unknownActivityTypeId; // &lt;-- non-existent activity_type_id\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_type_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;81043825-64ac-481a-b41a-bc8a0852528d&quot;,&quot;parentUUID&quot;:&quot;72aeab00-8c9e-4b41-a530-eee4c8bbea00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create an activity request is unsuccessful due to unknown activity_status_id&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 4: Create an activity request is unsuccessful due to unknown activity_status_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.activity_status_id = unknownActivityStatusId; // &lt;-- non-existent activity_status_id\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_status_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;577ec5de-9b4c-4e77-bf8a-a5b92bb9ac7c&quot;,&quot;parentUUID&quot;:&quot;72aeab00-8c9e-4b41-a530-eee4c8bbea00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create an activity request is unsuccessful due to unknown campus_spot_id&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 5: Create an activity request is unsuccessful due to unknown campus_spot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.campus_spot_id = unknownCampusSpotId; // &lt;-- non-existent campus_spot_id\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;campus_spot_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2662899b-4d58-4960-adcc-d906aff7db6e&quot;,&quot;parentUUID&quot;:&quot;72aeab00-8c9e-4b41-a530-eee4c8bbea00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create an activity request is unsuccessful due to unknown organizer_erp&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 6: Create an activity request is unsuccessful due to unknown organizer_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.organizer_erp = unknownOrganizerERP; // &lt;-- non-existent organizer_erp\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;organizer_erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;79062c4e-c762-4255-ad9a-87b450598c10&quot;,&quot;parentUUID&quot;:&quot;72aeab00-8c9e-4b41-a530-eee4c8bbea00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Create an activity request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 7: Create an activity request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_numbersfd: newActivityMonth // &lt;-- a valid param is &#x27;month_number&#x27; &amp; &#x27;group_size&#x27; is required\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;month_number&#x27;, &#x27;group_size&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5a483d91-05f3-46f8-8213-cb2321905776&quot;,&quot;parentUUID&quot;:&quot;72aeab00-8c9e-4b41-a530-eee4c8bbea00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Create an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 8: Create an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.organizer_erp = adminERP; // &lt;-- can be any other non-admin ERP as well, just different from userToken erp\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t create others activities unless admin i.e. token erp != invalidActivity.organizer_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;52ae4340-b2e1-48ff-a681-44f1e32d9e3a&quot;,&quot;parentUUID&quot;:&quot;72aeab00-8c9e-4b41-a530-eee4c8bbea00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Create an activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 9: Create an activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f2fcbf90-893d-4a47-8bb1-1c97725043dc&quot;,&quot;parentUUID&quot;:&quot;72aeab00-8c9e-4b41-a530-eee4c8bbea00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;77ebb012-a146-45c9-9492-233594277693&quot;,&quot;1666db43-9f78-473d-ab9d-f89259932726&quot;,&quot;81043825-64ac-481a-b41a-bc8a0852528d&quot;,&quot;577ec5de-9b4c-4e77-bf8a-a5b92bb9ac7c&quot;,&quot;2662899b-4d58-4960-adcc-d906aff7db6e&quot;,&quot;79062c4e-c762-4255-ad9a-87b450598c10&quot;,&quot;5a483d91-05f3-46f8-8213-cb2321905776&quot;,&quot;52ae4340-b2e1-48ff-a681-44f1e32d9e3a&quot;,&quot;f2fcbf90-893d-4a47-8bb1-1c97725043dc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:156,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;75a9b22f-2e70-41e8-8cda-99c470999d31&quot;,&quot;title&quot;:&quot;PATCH /activities/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update an activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 1: Update an activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingActivity.organizer_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.month_number).to.be.equal(newActivityMonth);\n\n// cleanup\ndata.month_number = existingActivity.month_number;\nres = await request(app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4e80678b-86dc-4a4b-92c6-afe7439412b1&quot;,&quot;parentUUID&quot;:&quot;75a9b22f-2e70-41e8-8cda-99c470999d31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update an activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 2: Update an activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // admin to edit other profiles i.e. token erp != existingActivity.organizer_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.month_number).to.be.equal(newActivityMonth);\n\n// cleanup\ndata.month_number = existingActivity.month_number;\nres = await request(app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;17393902-9ffb-4fb8-892b-1736b3b59084&quot;,&quot;parentUUID&quot;:&quot;75a9b22f-2e70-41e8-8cda-99c470999d31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update an activity request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 3: Update an activity request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // use admin token for no permission side effects\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7b20997d-09de-4d67-816f-72b3866c2d3d&quot;,&quot;parentUUID&quot;:&quot;75a9b22f-2e70-41e8-8cda-99c470999d31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update an activity request is unsuccessful due to unknown activity_type_id&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 4: Update an activity request is unsuccessful due to unknown activity_type_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type_id: unknownActivityTypeId }; // &lt;-- Non-existent activity_type_id\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // use admin token for no permission side effects\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_type_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5f39e721-cac2-4ad4-8aad-c04a2c190cd5&quot;,&quot;parentUUID&quot;:&quot;75a9b22f-2e70-41e8-8cda-99c470999d31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update an activity request is unsuccessful due to unknown activity_status_id&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 5: Update an activity request is unsuccessful due to unknown activity_status_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status_id: unknownActivityStatusId }; // &lt;-- Non-existent activity_status_id\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // use admin token for no permission side effects\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_status_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;92c24430-6e48-42c9-ab90-59cebbcc8bdb&quot;,&quot;parentUUID&quot;:&quot;75a9b22f-2e70-41e8-8cda-99c470999d31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update an activity request is unsuccessful due to unknown campus_spot_id&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 6: Update an activity request is unsuccessful due to unknown campus_spot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot_id: unknownCampusSpotId }; // &lt;-- Non-existent campus_spot_id\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // use admin token for no permission side effects\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;campus_spot_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f2fb030a-60c4-40c4-82b8-4662bf082af2&quot;,&quot;parentUUID&quot;:&quot;75a9b22f-2e70-41e8-8cda-99c470999d31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Update an activity request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 7: Update an activity request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    month_numbersds: newActivityMonth, // &lt;-- an valid parameter name should be &#x27;month_number&#x27;\n    group_size: -2 // &lt;-- a valid &#x27;group_size&#x27; has to be positive only\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;group_size&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ae748a73-08c7-419a-9aee-f7e36e4817c7&quot;,&quot;parentUUID&quot;:&quot;75a9b22f-2e70-41e8-8cda-99c470999d31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Update an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 8: Update an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedActivityId}`) // &lt;-- has a different organizer_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others activities i.e. token erp != unOwnedActivity.organizer_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bd613276-be5e-4e97-9c69-3229fdd92394&quot;,&quot;parentUUID&quot;:&quot;75a9b22f-2e70-41e8-8cda-99c470999d31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Update an activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 9: Update an activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bafc668a-2ac0-4639-b9c0-6b61c20b96b2&quot;,&quot;parentUUID&quot;:&quot;75a9b22f-2e70-41e8-8cda-99c470999d31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4e80678b-86dc-4a4b-92c6-afe7439412b1&quot;,&quot;17393902-9ffb-4fb8-892b-1736b3b59084&quot;,&quot;7b20997d-09de-4d67-816f-72b3866c2d3d&quot;,&quot;5f39e721-cac2-4ad4-8aad-c04a2c190cd5&quot;,&quot;92c24430-6e48-42c9-ab90-59cebbcc8bdb&quot;,&quot;f2fb030a-60c4-40c4-82b8-4662bf082af2&quot;,&quot;ae748a73-08c7-419a-9aee-f7e36e4817c7&quot;,&quot;bd613276-be5e-4e97-9c69-3229fdd92394&quot;,&quot;bafc668a-2ac0-4639-b9c0-6b61c20b96b2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:104,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a763f2c1-9d59-4d3e-8bf4-907fa1201ee6&quot;,&quot;title&quot;:&quot;DELETE /activities/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete an activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 1: Delete an activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.activity_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // using his own token i.e. token erp == newActivity.organizer_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cfb95146-edcb-4803-8d96-080d45d2a04f&quot;,&quot;parentUUID&quot;:&quot;a763f2c1-9d59-4d3e-8bf4-907fa1201ee6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete an activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 2: Delete an activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.activity_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // admin can delete other&#x27;s activities even if token erp != newActivity.organizer_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ab9d9927-9551-4584-9c5c-af4bf17766d2&quot;,&quot;parentUUID&quot;:&quot;a763f2c1-9d59-4d3e-8bf4-907fa1201ee6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete an activity request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 3: Delete an activity request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4b18cc20-3e10-4311-a454-5b155728ed4b&quot;,&quot;parentUUID&quot;:&quot;a763f2c1-9d59-4d3e-8bf4-907fa1201ee6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 4: Delete an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unOwnedActivityId}`) // &lt;-- has a different organizer_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user can&#x27;t delete others activities i.e. token erp != unOwnedActivity.organizer_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;96b448e1-c758-49d7-96d9-a87baad9c107&quot;,&quot;parentUUID&quot;:&quot;a763f2c1-9d59-4d3e-8bf4-907fa1201ee6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete an activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 5: Delete an activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivity.activity_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e452fa31-c355-49f2-9cea-cfd51ecbb2d7&quot;,&quot;parentUUID&quot;:&quot;a763f2c1-9d59-4d3e-8bf4-907fa1201ee6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cfb95146-edcb-4803-8d96-080d45d2a04f&quot;,&quot;ab9d9927-9551-4584-9c5c-af4bf17766d2&quot;,&quot;4b18cc20-3e10-4311-a454-5b155728ed4b&quot;,&quot;96b448e1-c758-49d7-96d9-a87baad9c107&quot;,&quot;e452fa31-c355-49f2-9cea-cfd51ecbb2d7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:61,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6c1fd23d-7223-4a3d-90d3-58925f74766a&quot;,&quot;title&quot;:&quot;Activity Attendees API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityAttendee.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityAttendee.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Activity Attendees API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API \&quot;before each\&quot; hook in \&quot;Activity Attendees API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9f48a7ec-b8bd-4254-9500-e7555d3a240c&quot;,&quot;parentUUID&quot;:&quot;6c1fd23d-7223-4a3d-90d3-58925f74766a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c1bb3db0-58b5-4ce9-abf6-ce7d5b54a7a6&quot;,&quot;title&quot;:&quot;POST /activities/:id/attendees&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityAttendee.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityAttendee.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create an activity attendee request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 1: Create an activity attendee request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_erp, involvement_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n// affirm\nconst query = `involvement_type=${involvement_type}`;\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkStudentERP = activity =&gt; activity.student_erp === data.student_erp;\nexpect(res.body.body.some(checkStudentERP)).to.be.true;\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${activity_id}/${subRoute}/${data.student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;578a2e74-cd6b-4809-9ccb-23d8ad883a28&quot;,&quot;parentUUID&quot;:&quot;c1bb3db0-58b5-4ce9-abf6-ce7d5b54a7a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create an activity attendee request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 2: Create an activity attendee request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_erp: unknownStudentERP, involvement_type }; // &lt;-- Non-existent student_erp\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;student_erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;daad0716-e8d2-473c-ad56-1858db629249&quot;,&quot;parentUUID&quot;:&quot;c1bb3db0-58b5-4ce9-abf6-ce7d5b54a7a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create an activity attendee request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 3: Create an activity attendee request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    involvement_type: &#x27;not going&#x27;, // &lt;-- not a valid involvement_type\n    erp: &#x27;12345&#x27; // &lt;-- a valid parameter name should be &#x27;student_erp&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;involvement_type&#x27;, &#x27;student_erp&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0382b759-ae3e-4b18-be33-573b76daee73&quot;,&quot;parentUUID&quot;:&quot;c1bb3db0-58b5-4ce9-abf6-ce7d5b54a7a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create an activity attendee request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 4: Create an activity attendee request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_erp: adminERP, involvement_type }; // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a2685b73-e740-4bc9-8f2b-5cecf5807db0&quot;,&quot;parentUUID&quot;:&quot;c1bb3db0-58b5-4ce9-abf6-ce7d5b54a7a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create an activity attendee request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 5: Create an activity attendee request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_erp, involvement_type };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4d2acff9-1b53-43f0-b96b-6e2b20ae7ced&quot;,&quot;parentUUID&quot;:&quot;c1bb3db0-58b5-4ce9-abf6-ce7d5b54a7a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;578a2e74-cd6b-4809-9ccb-23d8ad883a28&quot;,&quot;daad0716-e8d2-473c-ad56-1858db629249&quot;,&quot;0382b759-ae3e-4b18-be33-573b76daee73&quot;,&quot;a2685b73-e740-4bc9-8f2b-5cecf5807db0&quot;,&quot;4d2acff9-1b53-43f0-b96b-6e2b20ae7ced&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:52,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;116ec0f4-be0d-4135-a3ee-889d2b5ef2e7&quot;,&quot;title&quot;:&quot;PATCH /activities/:id/attendees/:student_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityAttendee.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityAttendee.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update an activity attendee request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 1: Update an activity attendee request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- userToken.erp == student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nconst query = `involvement_type=${involvement_type}`;\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst studentERPs = res.body.body.map(o =&gt; (o.student_erp));\nexpect(studentERPs).to.include(student_erp);\n\n// cleanup\ndata.involvement_type = existingActivityAttendee.involvement_type;\nres = await request(app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8f386cf8-ed4e-4122-b9e3-ca3b064a3a43&quot;,&quot;parentUUID&quot;:&quot;116ec0f4-be0d-4135-a3ee-889d2b5ef2e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update an activity attendee request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 2: Update an activity attendee request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nconst query = `involvement_type=${involvement_type}`;\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst studentERPs = res.body.body.map(o =&gt; (o.student_erp));\nexpect(studentERPs).to.include(student_erp);\n\n// cleanup\ndata.involvement_type = existingActivityAttendee.involvement_type;\nres = await request(app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;540c5079-a701-43f2-8103-163e19e7de29&quot;,&quot;parentUUID&quot;:&quot;116ec0f4-be0d-4135-a3ee-889d2b5ef2e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update an activity attendee request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 3: Update an activity attendee request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownActivityId}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;562b2231-7e21-4463-a402-5adc79ed35f6&quot;,&quot;parentUUID&quot;:&quot;116ec0f4-be0d-4135-a3ee-889d2b5ef2e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update an activity attendee request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 4: Update an activity attendee request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${unknownStudentERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1abea6f4-1a29-453d-939a-e41bcb88b4be&quot;,&quot;parentUUID&quot;:&quot;116ec0f4-be0d-4135-a3ee-889d2b5ef2e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update an activity attendee request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 5: Update an activity attendee request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    involvement_type: &#x27;not going&#x27;, // &lt;-- not a valid involvement_type\n    erp: &#x27;12345&#x27; // &lt;-- an invalid update parameter i.e. not allowed\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;involvement_type&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include.members([&#x27;Invalid updates!&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e08ae5f2-6c0b-4315-8e4f-a4674b8bb170&quot;,&quot;parentUUID&quot;:&quot;116ec0f4-be0d-4135-a3ee-889d2b5ef2e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update an activity attendee request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 6: Update an activity attendee request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${adminERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c6b8a9df-e5c3-4c9b-90e6-b51ec2182ede&quot;,&quot;parentUUID&quot;:&quot;116ec0f4-be0d-4135-a3ee-889d2b5ef2e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Update an activity attendee request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 7: Update an activity attendee request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;79f3b9fd-0e08-435a-9c62-8f7f83c06e7e&quot;,&quot;parentUUID&quot;:&quot;116ec0f4-be0d-4135-a3ee-889d2b5ef2e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8f386cf8-ed4e-4122-b9e3-ca3b064a3a43&quot;,&quot;540c5079-a701-43f2-8103-163e19e7de29&quot;,&quot;562b2231-7e21-4463-a402-5adc79ed35f6&quot;,&quot;1abea6f4-1a29-453d-939a-e41bcb88b4be&quot;,&quot;e08ae5f2-6c0b-4315-8e4f-a4674b8bb170&quot;,&quot;c6b8a9df-e5c3-4c9b-90e6-b51ec2182ede&quot;,&quot;79f3b9fd-0e08-435a-9c62-8f7f83c06e7e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:61,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9c976554-33bf-4244-bcc7-3117e19073ba&quot;,&quot;title&quot;:&quot;DELETE /activities/:id/attendees/:student_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityAttendee.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityAttendee.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete an activity attendee request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 1: Delete an activity attendee request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { student_erp, involvement_type };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp == student_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b1111e35-ffb4-41c4-87a1-40d6d5c97884&quot;,&quot;parentUUID&quot;:&quot;9c976554-33bf-4244-bcc7-3117e19073ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete an activity attendee request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 2: Delete an activity attendee request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { student_erp, involvement_type };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp != student_erp but still bypass ownerCheck\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8b393e50-28e0-405c-afa2-dcd7a5a3ec1c&quot;,&quot;parentUUID&quot;:&quot;9c976554-33bf-4244-bcc7-3117e19073ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete an activity attendee request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 3: Delete an activity attendee request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownActivityId}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ca9cd6ef-971a-4d03-a896-9ae129ac1216&quot;,&quot;parentUUID&quot;:&quot;9c976554-33bf-4244-bcc7-3117e19073ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete an activity attendee request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 4: Delete an activity attendee request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityId}/${subRoute}/${unknownStudentERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ec08b4cd-be8e-4c13-9b9a-14e6e3e86c46&quot;,&quot;parentUUID&quot;:&quot;9c976554-33bf-4244-bcc7-3117e19073ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete an activity attendee request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 5: Delete an activity attendee request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityId}/${subRoute}/${adminERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f2f2a315-c163-4076-a6b4-32cf1d86c19f&quot;,&quot;parentUUID&quot;:&quot;9c976554-33bf-4244-bcc7-3117e19073ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Delete an activity attendee request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 6: Delete an activity attendee request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityId}/${subRoute}/${student_erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ec748b59-8af4-484b-bc93-588e85070b36&quot;,&quot;parentUUID&quot;:&quot;9c976554-33bf-4244-bcc7-3117e19073ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b1111e35-ffb4-41c4-87a1-40d6d5c97884&quot;,&quot;8b393e50-28e0-405c-afa2-dcd7a5a3ec1c&quot;,&quot;ca9cd6ef-971a-4d03-a896-9ae129ac1216&quot;,&quot;ec08b4cd-be8e-4c13-9b9a-14e6e3e86c46&quot;,&quot;f2f2a315-c163-4076-a6b4-32cf1d86c19f&quot;,&quot;ec748b59-8af4-484b-bc93-588e85070b36&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:52,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f04607c6-26f0-435e-bd45-d0c2a2cef1f9&quot;,&quot;title&quot;:&quot;Activity Statuses API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Activity Statuses API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API \&quot;before each\&quot; hook in \&quot;Activity Statuses API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;753cc26e-bd9d-4766-a8f3-5aef368f5c2b&quot;,&quot;parentUUID&quot;:&quot;f04607c6-26f0-435e-bd45-d0c2a2cef1f9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2e1d96b7-db81-4994-aa76-2592c1663287&quot;,&quot;title&quot;:&quot;GET /activity-statuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all activity statuses request successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses Scenario 1: Get all activity statuses request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;activity_status_id&#x27;, &#x27;activity_status&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d573d089-05c3-4424-8b65-50e05123c1bd&quot;,&quot;parentUUID&quot;:&quot;2e1d96b7-db81-4994-aa76-2592c1663287&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all activity statuses request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses Scenario 2: Get all activity statuses request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:651,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ActivityStatusModel = require(&#x27;../../src/models/activityStatus.model&#x27;);\nconst modelStub = sinon.stub(ActivityStatusModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty activity_status list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity statuses not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f402ec78-89f2-4973-bf8a-3d61a236eda8&quot;,&quot;parentUUID&quot;:&quot;2e1d96b7-db81-4994-aa76-2592c1663287&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d573d089-05c3-4424-8b65-50e05123c1bd&quot;,&quot;f402ec78-89f2-4973-bf8a-3d61a236eda8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:658,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b1da58a4-3c3d-4d61-8e6a-ad5d10759386&quot;,&quot;title&quot;:&quot;GET /activity-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a activity status request successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses/:id Scenario 1: Get a activity status request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;activity_status_id&#x27;, &#x27;activity_status&#x27;]);\nexpect(resBody.activity_status_id).to.be.eql(existingActivityStatus.activity_status_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c6ec0762-7fc5-41a2-948b-d3d9fc9ee640&quot;,&quot;parentUUID&quot;:&quot;b1da58a4-3c3d-4d61-8e6a-ad5d10759386&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a activity status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses/:id Scenario 2: Get a activity status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownActivityStatusId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity status not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e08e74fd-3d1c-4601-b0d4-67e622b9a2ef&quot;,&quot;parentUUID&quot;:&quot;b1da58a4-3c3d-4d61-8e6a-ad5d10759386&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a activity status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses/:id Scenario 3: Get a activity status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingActivityStatus.activity_status_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7b8c196b-f49c-4a74-a98d-f17e445e222a&quot;,&quot;parentUUID&quot;:&quot;b1da58a4-3c3d-4d61-8e6a-ad5d10759386&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c6ec0762-7fc5-41a2-948b-d3d9fc9ee640&quot;,&quot;e08e74fd-3d1c-4601-b0d4-67e622b9a2ef&quot;,&quot;7b8c196b-f49c-4a74-a98d-f17e445e222a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f92a32b8-e0a7-4cd4-b300-70dba0ea735a&quot;,&quot;title&quot;:&quot;POST /activity-statuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a activity status request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API POST /activity-statuses Scenario 1: Create a activity status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;activity_status_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.activity_status_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    activity_status_id: newId,\n    activity_status: activity_status\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;393ec7e5-bc7e-468a-b2ad-2937384952a1&quot;,&quot;parentUUID&quot;:&quot;f92a32b8-e0a7-4cd4-b300-70dba0ea735a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a activity status request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API POST /activity-statuses Scenario 2: Create a activity status request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    activity_statuses: activity_status // &lt;-- a valid parameter name should be &#x27;activity_status&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;activity_status&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f183a880-ae34-47c0-adc0-31a8b0840fa7&quot;,&quot;parentUUID&quot;:&quot;f92a32b8-e0a7-4cd4-b300-70dba0ea735a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a activity status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API POST /activity-statuses Scenario 3: Create a activity status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b3b6a648-cdf2-4185-9b82-aff692cf79d3&quot;,&quot;parentUUID&quot;:&quot;f92a32b8-e0a7-4cd4-b300-70dba0ea735a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a activity status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API POST /activity-statuses Scenario 4: Create a activity status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;38a0c84b-11d2-432e-9721-4f7de7c6fcd2&quot;,&quot;parentUUID&quot;:&quot;f92a32b8-e0a7-4cd4-b300-70dba0ea735a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;393ec7e5-bc7e-468a-b2ad-2937384952a1&quot;,&quot;f183a880-ae34-47c0-adc0-31a8b0840fa7&quot;,&quot;b3b6a648-cdf2-4185-9b82-aff692cf79d3&quot;,&quot;38a0c84b-11d2-432e-9721-4f7de7c6fcd2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:66,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;912d8f4d-c95e-44a9-81bc-7f2306a60120&quot;,&quot;title&quot;:&quot;PATCH /activity-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a activity status request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 1: Update a activity status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status: newActivityStatus };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    activity_status_id: existingActivityStatus.activity_status_id,\n    activity_status: newActivityStatus\n});\n\n// cleanup\ndata.activity_status = existingActivityStatus.activity_status;\nres = await request(app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c40164ec-958d-4b9e-9816-85880ce5b51a&quot;,&quot;parentUUID&quot;:&quot;912d8f4d-c95e-44a9-81bc-7f2306a60120&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a activity status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 2: Update a activity status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status: newActivityStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownActivityStatusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity status not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;27589e42-2e03-49db-9901-3b2018bff035&quot;,&quot;parentUUID&quot;:&quot;912d8f4d-c95e-44a9-81bc-7f2306a60120&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a activity status request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 3: Update a activity status request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    activity_statuses: newActivityStatus // &lt;-- a valid parameter name should be &#x27;activity_status&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;activity_status&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5756fc3e-65fb-48f7-9624-607318400818&quot;,&quot;parentUUID&quot;:&quot;912d8f4d-c95e-44a9-81bc-7f2306a60120&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a activity status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 4: Update a activity status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status: newActivityStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;10fdfe4c-1710-404f-9f9d-a0bff97f6279&quot;,&quot;parentUUID&quot;:&quot;912d8f4d-c95e-44a9-81bc-7f2306a60120&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a activity status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 5: Update a activity status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status: newActivityStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4e14e46f-c2e8-4da0-baf3-a41883633c0b&quot;,&quot;parentUUID&quot;:&quot;912d8f4d-c95e-44a9-81bc-7f2306a60120&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c40164ec-958d-4b9e-9816-85880ce5b51a&quot;,&quot;27589e42-2e03-49db-9901-3b2018bff035&quot;,&quot;5756fc3e-65fb-48f7-9624-607318400818&quot;,&quot;10fdfe4c-1710-404f-9f9d-a0bff97f6279&quot;,&quot;4e14e46f-c2e8-4da0-baf3-a41883633c0b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:45,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c1210610-22fe-464e-9d41-1ab5c9554b1c&quot;,&quot;title&quot;:&quot;DELETE /activity-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a activity status request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API DELETE /activity-statuses/:id Scenario 1: Delete a activity status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { activity_status };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.activity_status_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity status has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9402dfef-922b-4821-b52a-d76fd625ae7d&quot;,&quot;parentUUID&quot;:&quot;c1210610-22fe-464e-9d41-1ab5c9554b1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a activity status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API DELETE /activity-statuses/:id Scenario 2: Delete a activity status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownActivityStatusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity status not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a01002a3-0b16-4acb-91e9-656b99f7c87e&quot;,&quot;parentUUID&quot;:&quot;c1210610-22fe-464e-9d41-1ab5c9554b1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a activity status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API DELETE /activity-statuses/:id Scenario 3: Delete a activity status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0858c704-72d8-4cbb-89fc-779663f4547d&quot;,&quot;parentUUID&quot;:&quot;c1210610-22fe-464e-9d41-1ab5c9554b1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a activity status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API DELETE /activity-statuses/:id Scenario 4: Delete a activity status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityStatus.activity_status_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f55d3d6d-9d8b-4fc7-894a-07c137b5bddc&quot;,&quot;parentUUID&quot;:&quot;c1210610-22fe-464e-9d41-1ab5c9554b1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9402dfef-922b-4821-b52a-d76fd625ae7d&quot;,&quot;a01002a3-0b16-4acb-91e9-656b99f7c87e&quot;,&quot;0858c704-72d8-4cbb-89fc-779663f4547d&quot;,&quot;f55d3d6d-9d8b-4fc7-894a-07c137b5bddc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;e097a146-9b52-4ea1-a70e-81fa26d846d5&quot;,&quot;title&quot;:&quot;Activity Types API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Activity Types API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Types API \&quot;before each\&quot; hook in \&quot;Activity Types API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8db2772e-a50d-409e-bc4c-8c73956fb532&quot;,&quot;parentUUID&quot;:&quot;e097a146-9b52-4ea1-a70e-81fa26d846d5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ab47beee-fc9d-46ec-ac4c-cc2dd43704b1&quot;,&quot;title&quot;:&quot;GET /activity-types&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all activity types request successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types Scenario 1: Get all activity types request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;activity_type_id&#x27;, &#x27;activity_type&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;60e80b9f-2c71-45ab-8b7d-97dcf8cdc0e6&quot;,&quot;parentUUID&quot;:&quot;ab47beee-fc9d-46ec-ac4c-cc2dd43704b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all activity types request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types Scenario 2: Get all activity types request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:581,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ActivityTypeModel = require(&#x27;../../src/models/activityType.model&#x27;);\nconst modelStub = sinon.stub(ActivityTypeModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty activity_type list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity types not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7131f547-c1e4-4ef8-8c92-f3694a20003c&quot;,&quot;parentUUID&quot;:&quot;ab47beee-fc9d-46ec-ac4c-cc2dd43704b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;60e80b9f-2c71-45ab-8b7d-97dcf8cdc0e6&quot;,&quot;7131f547-c1e4-4ef8-8c92-f3694a20003c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:589,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;419419b8-a315-47b5-b54b-175fca145d0c&quot;,&quot;title&quot;:&quot;GET /activity-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a activity type request successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types/:id Scenario 1: Get a activity type request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;activity_type_id&#x27;, &#x27;activity_type&#x27;]);\nexpect(resBody.activity_type_id).to.be.eql(existingActivityType.activity_type_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a5865e22-75a9-4db8-bca5-079c1d057fb0&quot;,&quot;parentUUID&quot;:&quot;419419b8-a315-47b5-b54b-175fca145d0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a activity type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types/:id Scenario 2: Get a activity type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownActivityTypeId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity type not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7b11de6d-4c8d-4646-abeb-ed78210b9d1c&quot;,&quot;parentUUID&quot;:&quot;419419b8-a315-47b5-b54b-175fca145d0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a activity type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types/:id Scenario 3: Get a activity type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingActivityType.activity_type_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bd2e8f5c-3db9-41e7-9e00-258280361ebd&quot;,&quot;parentUUID&quot;:&quot;419419b8-a315-47b5-b54b-175fca145d0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a5865e22-75a9-4db8-bca5-079c1d057fb0&quot;,&quot;7b11de6d-4c8d-4646-abeb-ed78210b9d1c&quot;,&quot;bd2e8f5c-3db9-41e7-9e00-258280361ebd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;83e1dec0-1177-4469-ab2f-054c61959708&quot;,&quot;title&quot;:&quot;POST /activity-types&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a activity type request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API POST /activity-types Scenario 1: Create a activity type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;activity_type_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.activity_type_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    activity_type_id: newId,\n    activity_type: activity_type\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d5ecb6ab-8904-4352-aade-d3035adc47a7&quot;,&quot;parentUUID&quot;:&quot;83e1dec0-1177-4469-ab2f-054c61959708&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a activity type request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Types API POST /activity-types Scenario 2: Create a activity type request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    activity_types: activity_type // &lt;-- a valid parameter name should be &#x27;activity_type&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;activity_type&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aa3079e7-a470-4729-8658-f574a9330d0b&quot;,&quot;parentUUID&quot;:&quot;83e1dec0-1177-4469-ab2f-054c61959708&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a activity type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Types API POST /activity-types Scenario 3: Create a activity type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dbe43ce5-5ad6-430b-89c0-04300b2d6a2f&quot;,&quot;parentUUID&quot;:&quot;83e1dec0-1177-4469-ab2f-054c61959708&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a activity type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Types API POST /activity-types Scenario 4: Create a activity type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;83f24710-3de9-4f2f-a45a-121b088e019c&quot;,&quot;parentUUID&quot;:&quot;83e1dec0-1177-4469-ab2f-054c61959708&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d5ecb6ab-8904-4352-aade-d3035adc47a7&quot;,&quot;aa3079e7-a470-4729-8658-f574a9330d0b&quot;,&quot;dbe43ce5-5ad6-430b-89c0-04300b2d6a2f&quot;,&quot;83f24710-3de9-4f2f-a45a-121b088e019c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:60,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;77159c0e-dc4b-4e85-bdf1-3aed302c3e30&quot;,&quot;title&quot;:&quot;PATCH /activity-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a activity type request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 1: Update a activity type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type: newActivityType };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    activity_type_id: existingActivityType.activity_type_id,\n    activity_type: newActivityType\n});\n\n// cleanup\ndata.activity_type = existingActivityType.activity_type;\nres = await request(app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cce2c0d9-5b91-40f5-9276-24f0e296440c&quot;,&quot;parentUUID&quot;:&quot;77159c0e-dc4b-4e85-bdf1-3aed302c3e30&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a activity type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 2: Update a activity type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type: newActivityType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownActivityTypeId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity type not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d0d6405f-b8e5-448e-96f2-f276336fcbc3&quot;,&quot;parentUUID&quot;:&quot;77159c0e-dc4b-4e85-bdf1-3aed302c3e30&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a activity type request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 3: Update a activity type request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    activity_types: newActivityType // &lt;-- a valid parameter name should be &#x27;activity_type&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;activity_type&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;57ba7428-bd98-473d-ab60-d226a46ed845&quot;,&quot;parentUUID&quot;:&quot;77159c0e-dc4b-4e85-bdf1-3aed302c3e30&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a activity type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 4: Update a activity type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type: newActivityType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ec918856-3a0e-4169-92a9-05bf7541102c&quot;,&quot;parentUUID&quot;:&quot;77159c0e-dc4b-4e85-bdf1-3aed302c3e30&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a activity type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 5: Update a activity type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type: newActivityType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6e11324c-e1f8-447c-9199-b4c87f8aa191&quot;,&quot;parentUUID&quot;:&quot;77159c0e-dc4b-4e85-bdf1-3aed302c3e30&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cce2c0d9-5b91-40f5-9276-24f0e296440c&quot;,&quot;d0d6405f-b8e5-448e-96f2-f276336fcbc3&quot;,&quot;57ba7428-bd98-473d-ab60-d226a46ed845&quot;,&quot;ec918856-3a0e-4169-92a9-05bf7541102c&quot;,&quot;6e11324c-e1f8-447c-9199-b4c87f8aa191&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:43,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b3d111b5-fa7f-42c9-be30-849f67090e81&quot;,&quot;title&quot;:&quot;DELETE /activity-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a activity type request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API DELETE /activity-types/:id Scenario 1: Delete a activity type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { activity_type };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.activity_type_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity type has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e56498f3-bf4d-4d51-a022-efbaade35edd&quot;,&quot;parentUUID&quot;:&quot;b3d111b5-fa7f-42c9-be30-849f67090e81&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a activity type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API DELETE /activity-types/:id Scenario 2: Delete a activity type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownActivityTypeId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity type not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;52207376-0b05-4cde-a662-06b87177f590&quot;,&quot;parentUUID&quot;:&quot;b3d111b5-fa7f-42c9-be30-849f67090e81&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a activity type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Types API DELETE /activity-types/:id Scenario 3: Delete a activity type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b5f60313-0652-4815-a071-43473a2a0dbd&quot;,&quot;parentUUID&quot;:&quot;b3d111b5-fa7f-42c9-be30-849f67090e81&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a activity type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Types API DELETE /activity-types/:id Scenario 4: Delete a activity type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityType.activity_type_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0388d1e5-fdd9-4061-8f4b-0613c1016386&quot;,&quot;parentUUID&quot;:&quot;b3d111b5-fa7f-42c9-be30-849f67090e81&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e56498f3-bf4d-4d51-a022-efbaade35edd&quot;,&quot;52207376-0b05-4cde-a662-06b87177f590&quot;,&quot;b5f60313-0652-4815-a071-43473a2a0dbd&quot;,&quot;0388d1e5-fdd9-4061-8f4b-0613c1016386&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:35,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;22ed1fd0-aeb3-474c-8b4a-8bf4a8e280ca&quot;,&quot;title&quot;:&quot;Authentication API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Authentication API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API \&quot;before each\&quot; hook in \&quot;Authentication API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0fd47bbe-27cc-40a4-8ce9-90f3f056d4e7&quot;,&quot;parentUUID&quot;:&quot;22ed1fd0-aeb3-474c-8b4a-8bf4a8e280ca&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fe07b0db-8b03-4375-93e1-f5e829b090b6&quot;,&quot;title&quot;:&quot;POST /auth/register&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;POST /auth/register\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register \&quot;before each\&quot; hook in \&quot;POST /auth/register\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;studentBody = {\n    erp: newERP,\n    first_name: \&quot;Abdur Rafay\&quot;,\n    last_name: \&quot;Saleem\&quot;,\n    gender: \&quot;male\&quot;,\n    contact: \&quot;+923009999999\&quot;,\n    birthday: \&quot;1999-09-18\&quot;,\n    password: \&quot;123\&quot;,\n    profile_picture_url: \&quot;https://i.pinimg.com/564x/8d/e3/89/8de389c84e919d3577f47118e2627d95.jpg\&quot;,\n    graduation_year: 2022,\n    uni_email: newEmail,\n    campus_id: 1,\n    program_id: 1,\n    is_active: 1\n};&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;662344c7-0a80-4fa9-8938-141c69a1928c&quot;,&quot;parentUUID&quot;:&quot;fe07b0db-8b03-4375-93e1-f5e829b090b6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Register request is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register Scenario 1: Register request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:248,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nstudentBody.erp = newERP;\nstudentBody.uni_email = newEmail;\nconst app = this.app;\n// act\nlet res = await request(app).post(`${baseRoute}/register`).send(studentBody);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.token).to.exist;\nexpect(resBody.role).to.be.equal(&#x27;api_user&#x27;);\ndelete studentBody.password; // omit token and password\nconst studentFields = Object.keys(studentBody);\nconst studentFieldsCheck = field =&gt; resBody[field] === studentBody[field]; // deep compare two objects\nexpect(studentFields.every(studentFieldsCheck)).to.be.true;\n// cleanup\nconst deleteRoute = `/api/${Config.API_VERSION}/students/${studentBody.erp}`;\nconst adminToken = jwt.sign({erp: adminERP}, Config.SECRET_JWT);\nres = await request(app)\n    .delete(deleteRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1bc3b2bf-0469-4070-b283-c26972f32519&quot;,&quot;parentUUID&quot;:&quot;fe07b0db-8b03-4375-93e1-f5e829b090b6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Register request is unsuccessful due to duplicate student&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register Scenario 2: Register request is unsuccessful due to duplicate student&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:181,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nstudentBody.erp = existingERP;\nstudentBody.uni_email = existingEmail;\n// act\nconst res = await request(this.app).post(`${baseRoute}/register`).send(studentBody);\n    \n// assert\nexpect(res.status).to.be.equal(409);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DuplicateEntryException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dbcc4489-da05-41a5-a267-1ff7a581770c&quot;,&quot;parentUUID&quot;:&quot;fe07b0db-8b03-4375-93e1-f5e829b090b6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Register request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register Scenario 3: Register request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:137,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nstudentBody.erp = &#x27;abdfe&#x27;;\n// act\nconst res = await request(this.app).post(`${baseRoute}/register`).send(studentBody);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8a7c2684-bc23-4fc8-8ff9-e614db417a4d&quot;,&quot;parentUUID&quot;:&quot;fe07b0db-8b03-4375-93e1-f5e829b090b6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1bc3b2bf-0469-4070-b283-c26972f32519&quot;,&quot;dbcc4489-da05-41a5-a267-1ff7a581770c&quot;,&quot;8a7c2684-bc23-4fc8-8ff9-e614db417a4d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:566,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;df2996f3-eb18-4f41-9f57-0d2f03962b73&quot;,&quot;title&quot;:&quot;POST /auth/register-admin&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;POST /auth/register-admin\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register-admin \&quot;before each\&quot; hook in \&quot;POST /auth/register-admin\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminBody = {\n    erp: newERP,\n    first_name: \&quot;Abdur Rafay\&quot;,\n    last_name: \&quot;Saleem\&quot;,\n    gender: \&quot;male\&quot;,\n    contact: \&quot;+923009999999\&quot;,\n    birthday: \&quot;1999-09-18\&quot;,\n    password: \&quot;123\&quot;,\n    profile_picture_url: \&quot;https://i.pinimg.com/564x/8d/e3/89/8de389c84e919d3577f47118e2627d95.jpg\&quot;,\n    graduation_year: 2022,\n    uni_email: newEmail,\n    campus_id: 1,\n    program_id: 1,\n    is_active: 1\n};&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f8da8971-cb46-4738-b852-490f24083f27&quot;,&quot;parentUUID&quot;:&quot;df2996f3-eb18-4f41-9f57-0d2f03962b73&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Register request is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register-admin Scenario 1: Register request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:97,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nadminBody.erp = newERP;\nadminBody.uni_email = newEmail;\nconst app = this.app;\n// act\nlet res = await request(app).post(`${baseRoute}/register-admin`).send(adminBody);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.token).to.exist;\nexpect(resBody.role).to.be.equal(&#x27;admin&#x27;);\ndelete adminBody.password; // omit token, role and password\nconst adminFields = Object.keys(adminBody);\nconst adminFieldsCheck = field =&gt; resBody[field] === adminBody[field]; // deep compare two objects\nexpect(adminFields.every(adminFieldsCheck)).to.be.true;\n// cleanup\nconst deleteRoute = `/api/${Config.API_VERSION}/students/${adminBody.erp}`;\nconst adminToken = jwt.sign({erp: adminERP}, Config.SECRET_JWT);\nres = await request(app)\n    .delete(deleteRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b2ed225d-b70b-4a1b-850b-74d6f8f4a060&quot;,&quot;parentUUID&quot;:&quot;df2996f3-eb18-4f41-9f57-0d2f03962b73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Register request is unsuccessful due to duplicate student&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register-admin Scenario 2: Register request is unsuccessful due to duplicate student&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:182,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nadminBody.erp = existingERP;\nadminBody.uni_email = existingEmail;\n// act\nconst res = await request(this.app).post(`${baseRoute}/register-admin`).send(adminBody);\n    \n// assert\nexpect(res.status).to.be.equal(409);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DuplicateEntryException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1794e8b9-75f3-42de-801b-cdb69a99289d&quot;,&quot;parentUUID&quot;:&quot;df2996f3-eb18-4f41-9f57-0d2f03962b73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Register request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register-admin Scenario 3: Register request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:134,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nadminBody.erp = &#x27;abdfe&#x27;;\n// act\nconst res = await request(this.app).post(`${baseRoute}/register-admin`).send(adminBody);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;87474365-6c9f-47a5-9167-d62d75241d8e&quot;,&quot;parentUUID&quot;:&quot;df2996f3-eb18-4f41-9f57-0d2f03962b73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b2ed225d-b70b-4a1b-850b-74d6f8f4a060&quot;,&quot;1794e8b9-75f3-42de-801b-cdb69a99289d&quot;,&quot;87474365-6c9f-47a5-9167-d62d75241d8e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:413,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9e9efb92-e468-4191-b3de-0c3f0a4d5867&quot;,&quot;title&quot;:&quot;POST /auth/login&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Login request is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/login Scenario 1: Login request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst studentBody = {\n    erp: existingERP,\n    first_name: \&quot;Abdur Rafay\&quot;,\n    last_name: \&quot;Saleem\&quot;,\n    gender: \&quot;male\&quot;,\n    contact: \&quot;+923009999999\&quot;,\n    email: &#x27;arafaysaleem@gmail.com&#x27;,\n    birthday: \&quot;1999-09-18\&quot;,\n    profile_picture_url: \&quot;https://i.pinimg.com/564x/8d/e3/89/8de389c84e919d3577f47118e2627d95.jpg\&quot;,\n    graduation_year: 2022,\n    uni_email: existingEmail,\n    hobbies: [1, 2, 3],\n    interests: [1, 2, 3],\n    campus_id: 1,\n    program_id: 1,\n    favourite_campus_hangout_spot: \&quot;CED\&quot;,\n    favourite_campus_activity: \&quot;Lifting\&quot;,\n    current_status: 1,\n    is_active: 1,\n    role: \&quot;api_user\&quot;\n};\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;\n};\n// act\nlet res = await request(this.app).post(`${baseRoute}/login`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys(&#x27;token&#x27;);\ndelete resBody.token;\nexpect(resBody).to.be.eql(studentBody);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;56c01975-45b6-4dc1-9556-5d457b9b0cc8&quot;,&quot;parentUUID&quot;:&quot;9e9efb92-e468-4191-b3de-0c3f0a4d5867&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Login request is unsuccessful due to missing student&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/login Scenario 2: Login request is unsuccessful due to missing student&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    password: &#x27;123&#x27;\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/login`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;321607ba-8c1c-4536-81b2-44ed212159f6&quot;,&quot;parentUUID&quot;:&quot;9e9efb92-e468-4191-b3de-0c3f0a4d5867&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Login request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/login Scenario 3: Login request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    email: existingEmail, // &lt;-- email is an unrecognized parameter\n    password: &#x27;123&#x27;\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/login`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;542a9790-4c3f-4537-abb2-dfe6b25d1d2b&quot;,&quot;parentUUID&quot;:&quot;9e9efb92-e468-4191-b3de-0c3f0a4d5867&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;56c01975-45b6-4dc1-9556-5d457b9b0cc8&quot;,&quot;321607ba-8c1c-4536-81b2-44ed212159f6&quot;,&quot;542a9790-4c3f-4537-abb2-dfe6b25d1d2b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:46,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f5ede395-e48b-4030-bed6-6296fc7a548a&quot;,&quot;title&quot;:&quot;POST /auth/refresh-token&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Refresh token is successful and return a new token&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 1: Refresh token is successful and return a new token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst secretKey = Config.SECRET_JWT;\nconst old_token = jwt.sign({ erp: existingERP }, secretKey, {\n    expiresIn: \&quot;1\&quot; // &lt;-- immediately expire the token (in 1ms)\n});\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;,\n    old_token: old_token\n};\n// wait for token to expire (in 1ms)\nawait sleep(1);\n// act\nlet res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.token).to.exist;\nexpect(res.body.body.token).to.be.not.equal(old_token);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;892ececb-4994-43a1-b985-9d2a2e0256bf&quot;,&quot;parentUUID&quot;:&quot;f5ede395-e48b-4030-bed6-6296fc7a548a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Refresh token is successful and returns same token&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 2: Refresh token is successful and returns same token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst secretKey = Config.SECRET_JWT;\nconst old_token = jwt.sign({ erp: existingERP }, secretKey); // &lt;-- unexpired token\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;,\n    old_token: old_token\n};\n// act\nlet res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.token).to.exist;\nexpect(res.body.body.token).to.be.equal(old_token);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;406dbeb9-67d6-4092-aea9-d0b3cbd5a1b0&quot;,&quot;parentUUID&quot;:&quot;f5ede395-e48b-4030-bed6-6296fc7a548a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Refresh token is unsuccessful due to unregisted erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 3: Refresh token is unsuccessful due to unregisted erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    password: &#x27;123&#x27;,\n    old_token: \&quot;e.e.e\&quot; // &lt;-- token doesn&#x27;t matter if erp is unregistered\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;ERP not registered&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0ba12be7-ac64-4d1c-aac4-7fd3ec7e2ef1&quot;,&quot;parentUUID&quot;:&quot;f5ede395-e48b-4030-bed6-6296fc7a548a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Refresh token is unsuccessful due to incorrect password&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 4: Refresh token is unsuccessful due to incorrect password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;incOrr3ct&#x27;, // &lt;-- incorrect password\n    old_token: \&quot;e.e.e\&quot; // &lt;-- token doesn&#x27;t matter if password is incorrect\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;Incorrect password&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;186ec8ba-77a2-4789-bf53-03f872eb8243&quot;,&quot;parentUUID&quot;:&quot;f5ede395-e48b-4030-bed6-6296fc7a548a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Refresh token is unsuccessful due to incorrect old token&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 5: Refresh token is unsuccessful due to incorrect old token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// This test performs the same if the token has a valid format, but is\n// signed for a different erp\n// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;,\n    old_token: \&quot;e.e.e\&quot; // &lt;-- incorrect token\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;TokenVerificationException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;Invalid Token&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a45e546c-217c-45cd-b1af-fa4e309f0646&quot;,&quot;parentUUID&quot;:&quot;f5ede395-e48b-4030-bed6-6296fc7a548a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Refresh token request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 6: Refresh token request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;,\n    token: \&quot;e.e.e\&quot; // &lt;-- a valid parameter name should be &#x27;old_token&#x27;\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;old_token&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7cfeb056-a533-445e-96ad-e620842b7d48&quot;,&quot;parentUUID&quot;:&quot;f5ede395-e48b-4030-bed6-6296fc7a548a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;892ececb-4994-43a1-b985-9d2a2e0256bf&quot;,&quot;406dbeb9-67d6-4092-aea9-d0b3cbd5a1b0&quot;,&quot;0ba12be7-ac64-4d1c-aac4-7fd3ec7e2ef1&quot;,&quot;186ec8ba-77a2-4789-bf53-03f872eb8243&quot;,&quot;a45e546c-217c-45cd-b1af-fa4e309f0646&quot;,&quot;7cfeb056-a533-445e-96ad-e620842b7d48&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:133,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1fd6a674-ceb0-4c94-b29f-36ddd8b99411&quot;,&quot;title&quot;:&quot;PATCH /auth/change-password&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Change password is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API PATCH /auth/change-password Scenario 1: Change password is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:100,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nlet app = this.app;\nconst data = {\n    erp: existingERP,\n    old_password,\n    new_password\n};\n// act\nlet res = await request(app).patch(`${baseRoute}/change-password`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// cleanup\ndata.old_password = new_password;\ndata.new_password = old_password;\nres = await request(app).patch(`${baseRoute}/change-password`).send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d5282012-7992-45b4-b003-3fb8f02373b3&quot;,&quot;parentUUID&quot;:&quot;1fd6a674-ceb0-4c94-b29f-36ddd8b99411&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Change password is unsuccessful due to unregisted erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API PATCH /auth/change-password Scenario 2: Change password is unsuccessful due to unregisted erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    old_password,\n    new_password\n};\n// act\nconst res = await request(this.app).patch(`${baseRoute}/change-password`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;ERP not registered&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;147741b8-bee0-4f2a-ba94-f9ff9d80ed8a&quot;,&quot;parentUUID&quot;:&quot;1fd6a674-ceb0-4c94-b29f-36ddd8b99411&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Change password is unsuccessful due to incorrect old password&quot;,&quot;fullTitle&quot;:&quot;Authentication API PATCH /auth/change-password Scenario 3: Change password is unsuccessful due to incorrect old password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    old_password: &#x27;incOrr3ct&#x27;, // &lt;-- incorrect password\n    new_password\n};\n// act\nconst res = await request(this.app).patch(`${baseRoute}/change-password`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;Incorrect old password&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ed33912f-8478-4e97-a8a4-ce9e1801e165&quot;,&quot;parentUUID&quot;:&quot;1fd6a674-ceb0-4c94-b29f-36ddd8b99411&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Change password request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API PATCH /auth/change-password Scenario 6: Change password request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;, // &lt;-- a valid parameter name should be &#x27;old_password&#x27;\n    new_password\n};\n// act\nconst res = await request(this.app).patch(`${baseRoute}/change-password`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;old_password&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;980ea4a8-b024-4eb3-9ab1-55fb13ab6daa&quot;,&quot;parentUUID&quot;:&quot;1fd6a674-ceb0-4c94-b29f-36ddd8b99411&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d5282012-7992-45b4-b003-3fb8f02373b3&quot;,&quot;147741b8-bee0-4f2a-ba94-f9ff9d80ed8a&quot;,&quot;ed33912f-8478-4e97-a8a4-ce9e1801e165&quot;,&quot;980ea4a8-b024-4eb3-9ab1-55fb13ab6daa&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:131,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9e8e1d94-20bd-4098-bdfe-d97b9d62131a&quot;,&quot;title&quot;:&quot;ENDPOINT /auth/forgot/&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3613b974-e30d-4417-a481-ddfbcfd8e9c2&quot;,&quot;title&quot;:&quot;POST /send-otp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;POST /send-otp\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp \&quot;before all\&quot; hook in \&quot;POST /send-otp\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:554,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;decache(&#x27;../../src/server&#x27;);\nconst sendgrid = require(&#x27;../../src/utils/sendgrid.utils&#x27;);\nsendOTPEmailStub = sinon.stub(sendgrid, &#x27;sendOTPEmail&#x27;).callsFake((_, __) =&gt; {});\nconst authRepository = require(&#x27;../../src/repositories/auth.repository&#x27;);\ngenerateOTPStub = sinon.stub(authRepository, &#x27;generateOTP&#x27;).callsFake(() =&gt; otp);\napp = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;50a9d8dd-a366-44f2-9805-11d067d473a0&quot;,&quot;parentUUID&quot;:&quot;3613b974-e30d-4417-a481-ddfbcfd8e9c2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;POST /send-otp\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp \&quot;after all\&quot; hook in \&quot;POST /send-otp\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sendOTPEmailStub.restore();\ngenerateOTPStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;60a2c79c-d36b-4a7a-ba28-2f502113424f&quot;,&quot;parentUUID&quot;:&quot;3613b974-e30d-4417-a481-ddfbcfd8e9c2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Forgot password is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp Scenario 1: Forgot password is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP\n};\n    \n// act\nlet res = await request(app).post(`${baseRoute}/forgot/send-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;OTP generated and sent via email&#x27;);\nexpect(generateOTPStub.calledOnce).to.be.true;\nexpect(sendOTPEmailStub.calledOnce).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;19dee051-5aa9-4b26-8d9b-6d270bd5ae82&quot;,&quot;parentUUID&quot;:&quot;3613b974-e30d-4417-a481-ddfbcfd8e9c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Forgot password is unsuccessful due to unregisted erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp Scenario 2: Forgot password is unsuccessful due to unregisted erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP // &lt;-- no account registered on this erp\n};\n    \n// act\nconst res = await request(app).post(`${baseRoute}/forgot/send-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;ERP not registered&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dbf54359-f47e-45f3-b266-1dd6fb39fa2c&quot;,&quot;parentUUID&quot;:&quot;3613b974-e30d-4417-a481-ddfbcfd8e9c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Forgot password request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp Scenario 3: Forgot password request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    esrp: existingERP // &lt;-- a valid parameter name should be &#x27;erp&#x27;\n};\n    \n// act\nconst res = await request(app).post(`${baseRoute}/forgot/send-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;723cbf74-054d-4051-8626-0f7f90f61a59&quot;,&quot;parentUUID&quot;:&quot;3613b974-e30d-4417-a481-ddfbcfd8e9c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;19dee051-5aa9-4b26-8d9b-6d270bd5ae82&quot;,&quot;dbf54359-f47e-45f3-b266-1dd6fb39fa2c&quot;,&quot;723cbf74-054d-4051-8626-0f7f90f61a59&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:76,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;3bfc15ea-27a4-4723-9c18-8634f87f5bcf&quot;,&quot;title&quot;:&quot;POST /verify-otp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Verify OTP is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 1: Verify OTP is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    otp\n};\n    \n// act\nlet res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;OTP verified succesfully&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c76f7f2f-b5e0-4221-a4a3-705f9208344c&quot;,&quot;parentUUID&quot;:&quot;3bfc15ea-27a4-4723-9c18-8634f87f5bcf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Verify OTP is unsuccessful due to invalid otp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 2: Verify OTP is unsuccessful due to invalid otp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst authRepository = require(&#x27;../../src/repositories/auth.repository&#x27;);\nawait authRepository.saveOTP(existingERP, otp, 1);\n\nconst data = {\n    erp: existingERP,\n    otp: 5678 // &lt;-- Invalid OTP code, should be &#x27;1234&#x27;\n};\n    \n// act\nconst res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;OTPVerificationException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;OTP verification failed&#x27;);\n// cleanup\nawait authRepository.removeExpiredOTP(existingERP);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;59570ba1-19bf-4adc-bb7e-421b9f1e740a&quot;,&quot;parentUUID&quot;:&quot;3bfc15ea-27a4-4723-9c18-8634f87f5bcf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Verify OTP is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 3: Verify OTP is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    otp: otp\n};\n    \n// act\nconst res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;OTPVerificationException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;No OTP found for this ERP&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;62712224-a7ba-4432-a5f1-4650a7182931&quot;,&quot;parentUUID&quot;:&quot;3bfc15ea-27a4-4723-9c18-8634f87f5bcf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Verify OTP is unsuccessful due to expired otp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 4: Verify OTP is unsuccessful due to expired otp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst authRepository = require(&#x27;../../src/repositories/auth.repository&#x27;);\nawait authRepository.saveOTP(existingERP, otp, -1); // create expired otp\n\nconst data = {\n    erp: existingERP,\n    otp: otp\n};\n    \n// act\nconst res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;OTPExpiredException&#x27;);\n// cleanup\nawait authRepository.removeExpiredOTP(existingERP);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;decbfff0-6464-4bac-a740-cb96230cdc31&quot;,&quot;parentUUID&quot;:&quot;3bfc15ea-27a4-4723-9c18-8634f87f5bcf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Verify OTP request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 5: Verify OTP request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    otp: &#x27;12345678&#x27; // &lt;-- otp should be 4 digits in length\n};\n    \n// act\nconst res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;otp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a2a1ab4c-b323-4e60-83b6-458c192a9c1b&quot;,&quot;parentUUID&quot;:&quot;3bfc15ea-27a4-4723-9c18-8634f87f5bcf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c76f7f2f-b5e0-4221-a4a3-705f9208344c&quot;,&quot;59570ba1-19bf-4adc-bb7e-421b9f1e740a&quot;,&quot;62712224-a7ba-4432-a5f1-4650a7182931&quot;,&quot;decbfff0-6464-4bac-a740-cb96230cdc31&quot;,&quot;a2a1ab4c-b323-4e60-83b6-458c192a9c1b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:122,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b1759ada-b78c-4a9d-8abc-02223a2dc79f&quot;,&quot;title&quot;:&quot;POST /reset-password&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Reset Password is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /reset-password Scenario 1: Reset Password is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst app = this.app;\nconst old_password = &#x27;123&#x27;;\nconst new_password = &#x27;256&#x27;;\nconst data = {\n    erp: existingERP,\n    new_password\n};\n    \n// act\nlet res = await request(app).patch(`${baseRoute}/forgot/reset-password`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Password reset successfully&#x27;);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// cleanup\ndata.new_password = old_password;\nres = await request(app).patch(`${baseRoute}/forgot/reset-password`).send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0d224378-7a2f-4a03-a43f-832dddb92bba&quot;,&quot;parentUUID&quot;:&quot;b1759ada-b78c-4a9d-8abc-02223a2dc79f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Reset Password is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /reset-password Scenario 2: Reset Password is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    new_password: &#x27;---&#x27; // &lt;-- doesnn&#x27;t matter since if erp is unregistered\n};\n    \n// act\nconst res = await request(this.app).patch(`${baseRoute}/forgot/reset-password`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;ERP not registered&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;994339ee-2c8e-4261-83e0-ddddb3b88d06&quot;,&quot;parentUUID&quot;:&quot;b1759ada-b78c-4a9d-8abc-02223a2dc79f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Reset Password request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /reset-password Scenario 3: Reset Password request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;12345678&#x27; // &lt;-- correct paramter name should be &#x27;new_password&#x27;\n};\n    \n// act\nconst res = await request(this.app).patch(`${baseRoute}/forgot/reset-password`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;new_password&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ddf3b60c-fe40-4c1c-b9e9-7fe5f453d995&quot;,&quot;parentUUID&quot;:&quot;b1759ada-b78c-4a9d-8abc-02223a2dc79f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0d224378-7a2f-4a03-a43f-832dddb92bba&quot;,&quot;994339ee-2c8e-4261-83e0-ddddb3b88d06&quot;,&quot;ddf3b60c-fe40-4c1c-b9e9-7fe5f453d995&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:84,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9781d9be-c2d2-4989-8861-cb36f709810f&quot;,&quot;title&quot;:&quot;Campuses API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Campuses API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Campuses API \&quot;before each\&quot; hook in \&quot;Campuses API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;597741a9-7219-4f01-8a71-a18c2b67f926&quot;,&quot;parentUUID&quot;:&quot;9781d9be-c2d2-4989-8861-cb36f709810f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;31c96c9e-bdca-4b52-a5b1-cb9b9998852a&quot;,&quot;title&quot;:&quot;GET /campuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all campuses request successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses Scenario 1: Get all campuses request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;campus_id&#x27;, &#x27;campus&#x27;, &#x27;location_url&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4a08ae38-844c-4c64-a930-309bc4a8bbc4&quot;,&quot;parentUUID&quot;:&quot;31c96c9e-bdca-4b52-a5b1-cb9b9998852a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all campuses request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses Scenario 2: Get all campuses request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:615,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst CampusModel = require(&#x27;../../src/models/campus.model&#x27;);\nconst modelStub = sinon.stub(CampusModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty campus list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campuses not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;85b22d80-8143-4a8a-bb55-cb3858b005a1&quot;,&quot;parentUUID&quot;:&quot;31c96c9e-bdca-4b52-a5b1-cb9b9998852a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4a08ae38-844c-4c64-a930-309bc4a8bbc4&quot;,&quot;85b22d80-8143-4a8a-bb55-cb3858b005a1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:622,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;545a1f14-ed26-44ff-914c-825f9a013da9&quot;,&quot;title&quot;:&quot;GET /campuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a campus request successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses/:id Scenario 1: Get a campus request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;campus_id&#x27;, &#x27;campus&#x27;, &#x27;location_url&#x27;]);\nexpect(resBody.campus_id).to.be.eql(existingCampus.campus_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b7203fe1-fc33-4e0a-a7c4-4bc72cf2af5d&quot;,&quot;parentUUID&quot;:&quot;545a1f14-ed26-44ff-914c-825f9a013da9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a campus request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses/:id Scenario 2: Get a campus request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownCampusId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;54738c35-59fb-4ab6-b253-390c1318a415&quot;,&quot;parentUUID&quot;:&quot;545a1f14-ed26-44ff-914c-825f9a013da9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a campus request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses/:id Scenario 3: Get a campus request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingCampus.campus_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fd678435-78d3-4eb4-98bf-6801f5c1f0fd&quot;,&quot;parentUUID&quot;:&quot;545a1f14-ed26-44ff-914c-825f9a013da9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b7203fe1-fc33-4e0a-a7c4-4bc72cf2af5d&quot;,&quot;54738c35-59fb-4ab6-b253-390c1318a415&quot;,&quot;fd678435-78d3-4eb4-98bf-6801f5c1f0fd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;43fbc5aa-22a6-486a-bada-63bd24c780a1&quot;,&quot;title&quot;:&quot;POST /campuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a campus request is successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API POST /campuses Scenario 1: Create a campus request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus, location_url };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;campus_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.campus_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    campus_id: newId,\n    campus: campus,\n    location_url: location_url\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;887d4f98-445e-4135-b828-ec67f8c8aaca&quot;,&quot;parentUUID&quot;:&quot;43fbc5aa-22a6-486a-bada-63bd24c780a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a campus request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Campuses API POST /campuses Scenario 2: Create a campus request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    campuses: campus, // &lt;-- a valid parameter name should be &#x27;campus&#x27;\n    location_url: &#x27;https://maps.app.goo.gl/LvH61VeZZVfyggHw6&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;campus&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2ecc8a6d-b7f3-41dd-b224-d410c8bee519&quot;,&quot;parentUUID&quot;:&quot;43fbc5aa-22a6-486a-bada-63bd24c780a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a campus request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campuses API POST /campuses Scenario 3: Create a campus request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus, location_url };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f7360ed4-e899-4c15-be01-9ad09c52c4c9&quot;,&quot;parentUUID&quot;:&quot;43fbc5aa-22a6-486a-bada-63bd24c780a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a campus request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campuses API POST /campuses Scenario 4: Create a campus request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus, location_url };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8615e646-94be-4cdc-abf4-e2d45bd0b7c6&quot;,&quot;parentUUID&quot;:&quot;43fbc5aa-22a6-486a-bada-63bd24c780a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;887d4f98-445e-4135-b828-ec67f8c8aaca&quot;,&quot;2ecc8a6d-b7f3-41dd-b224-d410c8bee519&quot;,&quot;f7360ed4-e899-4c15-be01-9ad09c52c4c9&quot;,&quot;8615e646-94be-4cdc-abf4-e2d45bd0b7c6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:55,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;4dee4532-cc0a-4c48-ad96-fdd4509ab11f&quot;,&quot;title&quot;:&quot;PATCH /campuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a campus request is successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 1: Update a campus request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus: newCampus };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    campus_id: existingCampus.campus_id,\n    campus: newCampus,\n    location_url: existingCampus.location_url\n});\n\n// cleanup\ndata.campus = existingCampus.campus;\nres = await request(app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ab3360d1-07e2-45da-aa67-4b0db5b47443&quot;,&quot;parentUUID&quot;:&quot;4dee4532-cc0a-4c48-ad96-fdd4509ab11f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a campus request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 2: Update a campus request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus: newCampus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownCampusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e050daef-0027-48ed-a6c9-3843ce2d2743&quot;,&quot;parentUUID&quot;:&quot;4dee4532-cc0a-4c48-ad96-fdd4509ab11f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a campus request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 3: Update a campus request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    campuses: newCampus // &lt;-- an valid parameter name should be &#x27;campus&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectParams).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a8f98a14-eb41-401b-8b73-b115d1b0c792&quot;,&quot;parentUUID&quot;:&quot;4dee4532-cc0a-4c48-ad96-fdd4509ab11f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a campus request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 4: Update a campus request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus: newCampus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fcfc8b7a-48c8-4120-81c3-35cf5e9f8121&quot;,&quot;parentUUID&quot;:&quot;4dee4532-cc0a-4c48-ad96-fdd4509ab11f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a campus request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 5: Update a campus request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus: newCampus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a5d50e38-7bcf-4f8c-80aa-66fe4c5616df&quot;,&quot;parentUUID&quot;:&quot;4dee4532-cc0a-4c48-ad96-fdd4509ab11f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ab3360d1-07e2-45da-aa67-4b0db5b47443&quot;,&quot;e050daef-0027-48ed-a6c9-3843ce2d2743&quot;,&quot;a8f98a14-eb41-401b-8b73-b115d1b0c792&quot;,&quot;fcfc8b7a-48c8-4120-81c3-35cf5e9f8121&quot;,&quot;a5d50e38-7bcf-4f8c-80aa-66fe4c5616df&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:48,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;40521c0a-ac6c-4e21-ac70-78d9c35dbef7&quot;,&quot;title&quot;:&quot;DELETE /campuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a campus request is successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API DELETE /campuses/:id Scenario 1: Delete a campus request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { campus, location_url };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.campus_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1476f0fe-0ec6-43cf-aebc-b55f44597699&quot;,&quot;parentUUID&quot;:&quot;40521c0a-ac6c-4e21-ac70-78d9c35dbef7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a campus request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campuses API DELETE /campuses/:id Scenario 2: Delete a campus request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownCampusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6445fc5b-a017-44ac-be8d-fceaf4861c16&quot;,&quot;parentUUID&quot;:&quot;40521c0a-ac6c-4e21-ac70-78d9c35dbef7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a campus request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campuses API DELETE /campuses/:id Scenario 3: Delete a campus request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f919f2af-ac3a-4db0-b9ea-048c09556ea1&quot;,&quot;parentUUID&quot;:&quot;40521c0a-ac6c-4e21-ac70-78d9c35dbef7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a campus request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campuses API DELETE /campuses/:id Scenario 4: Delete a campus request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingCampus.campus_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6da71fe0-9258-4fc4-bbe6-a433ff8058ad&quot;,&quot;parentUUID&quot;:&quot;40521c0a-ac6c-4e21-ac70-78d9c35dbef7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1476f0fe-0ec6-43cf-aebc-b55f44597699&quot;,&quot;6445fc5b-a017-44ac-be8d-fceaf4861c16&quot;,&quot;f919f2af-ac3a-4db0-b9ea-048c09556ea1&quot;,&quot;6da71fe0-9258-4fc4-bbe6-a433ff8058ad&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7c86ac5b-175e-41d3-9e7a-7c448ecf0ec7&quot;,&quot;title&quot;:&quot;Campus Spots API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Campus Spots API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API \&quot;before each\&quot; hook in \&quot;Campus Spots API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;08eaa08e-99d2-491e-bbcb-0639513b951c&quot;,&quot;parentUUID&quot;:&quot;7c86ac5b-175e-41d3-9e7a-7c448ecf0ec7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;49a94796-b4d8-4470-a4c3-ce8bb6b56bf8&quot;,&quot;title&quot;:&quot;GET /campus-spots&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all campus spots request successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots Scenario 1: Get all campus spots request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;campus_spot_id&#x27;, &#x27;campus_spot&#x27;, &#x27;campus_id&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ad7d0612-0e2f-412f-a9f7-55ded76e834f&quot;,&quot;parentUUID&quot;:&quot;49a94796-b4d8-4470-a4c3-ce8bb6b56bf8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all campus spots request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots Scenario 2: Get all campus spots request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:565,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst CampusSpotModel = require(&#x27;../../src/models/campusSpot.model&#x27;);\nconst modelStub = sinon.stub(CampusSpotModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty campus_spot list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spots not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3892a9b0-ed60-4de3-a93b-3041aae62794&quot;,&quot;parentUUID&quot;:&quot;49a94796-b4d8-4470-a4c3-ce8bb6b56bf8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ad7d0612-0e2f-412f-a9f7-55ded76e834f&quot;,&quot;3892a9b0-ed60-4de3-a93b-3041aae62794&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:571,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;921cc08c-5512-4bbd-8dd8-e6443324b8df&quot;,&quot;title&quot;:&quot;GET /campus-spots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a campus spot request successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots/:id Scenario 1: Get a campus spot request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;campus_spot_id&#x27;, &#x27;campus_spot&#x27;, &#x27;campus_id&#x27;]);\nexpect(resBody.campus_spot_id).to.be.equal(existingCampusSpot.campus_spot_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;49b4a2f3-9418-4bea-b3ce-a01fc1b2ecd0&quot;,&quot;parentUUID&quot;:&quot;921cc08c-5512-4bbd-8dd8-e6443324b8df&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a campus spot request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots/:id Scenario 2: Get a campus spot request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownCampusSpotId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spot not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;82ac6e6e-94ee-40bf-be65-283818eeb644&quot;,&quot;parentUUID&quot;:&quot;921cc08c-5512-4bbd-8dd8-e6443324b8df&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a campus spot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots/:id Scenario 3: Get a campus spot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingCampusSpot.campus_spot_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;54a70763-b127-4a7b-9288-6e04a7d3f7e5&quot;,&quot;parentUUID&quot;:&quot;921cc08c-5512-4bbd-8dd8-e6443324b8df&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;49b4a2f3-9418-4bea-b3ce-a01fc1b2ecd0&quot;,&quot;82ac6e6e-94ee-40bf-be65-283818eeb644&quot;,&quot;54a70763-b127-4a7b-9288-6e04a7d3f7e5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7255418c-2f41-4adb-8922-f9f136a0fea8&quot;,&quot;title&quot;:&quot;POST /campus-spots&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a campus spot request is successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 1: Create a campus spot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot, campus_id };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;campus_spot_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.campus_spot_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    campus_spot_id: newId,\n    campus_spot,\n    campus_id\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aca515c7-784d-4ff0-8a01-5448277ee00f&quot;,&quot;parentUUID&quot;:&quot;7255418c-2f41-4adb-8922-f9f136a0fea8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a campus spot request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 2: Create a campus spot request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot, campus_id: unknownCampusId }; // &lt;-- Non-existent campus_id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;campus_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;10d2a23c-8a62-4dac-a7db-6d3822887f2c&quot;,&quot;parentUUID&quot;:&quot;7255418c-2f41-4adb-8922-f9f136a0fea8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a campus spot request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 3: Create a campus spot request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    campus_spots: campus_spot // &lt;-- a valid parameter name should be &#x27;campus_spot&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;campus_spot&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2f5f0a6d-d28e-41e9-996c-2442e352a05b&quot;,&quot;parentUUID&quot;:&quot;7255418c-2f41-4adb-8922-f9f136a0fea8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a campus spot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 4: Create a campus spot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot, campus_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;da44ceb4-9b4e-4b3a-b6fd-5db84decb04e&quot;,&quot;parentUUID&quot;:&quot;7255418c-2f41-4adb-8922-f9f136a0fea8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a campus spot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 5: Create a campus spot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot, campus_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b0855dad-3d8a-4a12-aab0-bb78fceaa0d1&quot;,&quot;parentUUID&quot;:&quot;7255418c-2f41-4adb-8922-f9f136a0fea8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;aca515c7-784d-4ff0-8a01-5448277ee00f&quot;,&quot;10d2a23c-8a62-4dac-a7db-6d3822887f2c&quot;,&quot;2f5f0a6d-d28e-41e9-996c-2442e352a05b&quot;,&quot;da44ceb4-9b4e-4b3a-b6fd-5db84decb04e&quot;,&quot;b0855dad-3d8a-4a12-aab0-bb78fceaa0d1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:72,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6a214948-e272-4365-a8a9-44185239d8db&quot;,&quot;title&quot;:&quot;PATCH /campus-spots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a campus spot request is successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 1: Update a campus spot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot: newCampusSpot };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    campus_spot_id: existingCampusSpot.campus_spot_id,\n    campus_id: existingCampusSpot.campus_id,\n    campus_spot: newCampusSpot\n});\n\n// cleanup\ndata.campus_spot = existingCampusSpot.campus_spot;\nres = await request(app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;32823d10-2b84-4c30-802c-1dba09bb465d&quot;,&quot;parentUUID&quot;:&quot;6a214948-e272-4365-a8a9-44185239d8db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a campus spot request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 2: Update a campus spot request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot: newCampusSpot };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownCampusSpotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spot not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6a9a8f91-a06a-4288-9ca7-36da02dce4ce&quot;,&quot;parentUUID&quot;:&quot;6a214948-e272-4365-a8a9-44185239d8db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a campus spot request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 3: Update a campus spot request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    campus_spots: newCampusSpot // &lt;-- a valid parameter name should be &#x27;campus_spot&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;campus_spot&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;50038b90-d046-4bc9-b2a6-7ccb4f70802a&quot;,&quot;parentUUID&quot;:&quot;6a214948-e272-4365-a8a9-44185239d8db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a campus spot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 4: Update a campus spot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot: newCampusSpot };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6ee522f2-277d-4c4a-87ee-c595bdce3ca9&quot;,&quot;parentUUID&quot;:&quot;6a214948-e272-4365-a8a9-44185239d8db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a campus spot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 5: Update a campus spot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot: newCampusSpot };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;37699c2e-865b-4ffe-8aa1-236a04eabd8f&quot;,&quot;parentUUID&quot;:&quot;6a214948-e272-4365-a8a9-44185239d8db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;32823d10-2b84-4c30-802c-1dba09bb465d&quot;,&quot;6a9a8f91-a06a-4288-9ca7-36da02dce4ce&quot;,&quot;50038b90-d046-4bc9-b2a6-7ccb4f70802a&quot;,&quot;6ee522f2-277d-4c4a-87ee-c595bdce3ca9&quot;,&quot;37699c2e-865b-4ffe-8aa1-236a04eabd8f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:46,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;759f7890-8aa0-46f6-8140-c6bc3811d6cb&quot;,&quot;title&quot;:&quot;DELETE /campus-spots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a campus spot request is successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API DELETE /campus-spots/:id Scenario 1: Delete a campus spot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { campus_spot, campus_id };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.campus_spot_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spot has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;96a04edc-4a30-44c8-9af1-b6edde5265f6&quot;,&quot;parentUUID&quot;:&quot;759f7890-8aa0-46f6-8140-c6bc3811d6cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a campus spot request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API DELETE /campus-spots/:id Scenario 2: Delete a campus spot request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownCampusSpotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spot not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;220ac585-efd9-457a-a491-2eb9024fe3b8&quot;,&quot;parentUUID&quot;:&quot;759f7890-8aa0-46f6-8140-c6bc3811d6cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a campus spot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API DELETE /campus-spots/:id Scenario 3: Delete a campus spot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;be850890-b0de-47f0-bdc0-e74cbc7fd160&quot;,&quot;parentUUID&quot;:&quot;759f7890-8aa0-46f6-8140-c6bc3811d6cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a campus spot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API DELETE /campus-spots/:id Scenario 4: Delete a campus spot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingCampusSpot.campus_spot_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2c635ce6-954a-4a75-8ae1-d38a9d333013&quot;,&quot;parentUUID&quot;:&quot;759f7890-8aa0-46f6-8140-c6bc3811d6cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;96a04edc-4a30-44c8-9af1-b6edde5265f6&quot;,&quot;220ac585-efd9-457a-a491-2eb9024fe3b8&quot;,&quot;be850890-b0de-47f0-bdc0-e74cbc7fd160&quot;,&quot;2c635ce6-954a-4a75-8ae1-d38a9d333013&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:46,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7a3f4f47-3de4-460b-aa0e-772a0eaee798&quot;,&quot;title&quot;:&quot;Classes API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Classes API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Classes API \&quot;before each\&quot; hook in \&quot;Classes API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b2122411-0731-4c0d-a59a-fa8ff789db88&quot;,&quot;parentUUID&quot;:&quot;7a3f4f47-3de4-460b-aa0e-772a0eaee798&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a49d00ff-d627-47f4-93f2-9e763ebb8bc5&quot;,&quot;title&quot;:&quot;GET /classes&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all classes request successful&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 1: Get all classes request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingClass)); // contain all params\nconst exampleClass = resBody[0];\nexpect(exampleClass.classroom).to.not.be.undefined;\nexpect(exampleClass.classroom).to.include.all.keys(Object.keys(existingClass.classroom)); // contain all params\n\nexpect(exampleClass.classroom.campus).to.not.be.undefined;\nexpect(exampleClass.classroom.campus).to.include.all.keys(Object.keys(existingClass.classroom.campus)); // contain all params\nexpect(exampleClass.subject).to.not.be.undefined;\nexpect(exampleClass.subject).to.include.all.keys(Object.keys(existingClass.subject)); // contain all params\nexpect(exampleClass.teacher).to.not.be.undefined;\nexpect(exampleClass.teacher).to.include.all.keys(Object.keys(existingClass.teacher)); // contain all params\nexpect(exampleClass.timeslot_1).to.not.be.undefined;\nexpect(exampleClass.timeslot_1).to.include.all.keys(Object.keys(existingClass.timeslot_1)); // contain all params\nexpect(exampleClass.timeslot_2).to.not.be.undefined;\nexpect(exampleClass.timeslot_2).to.include.all.keys(Object.keys(existingClass.timeslot_2)); // contain all params&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f5c03e29-c07f-4511-b11e-c86fd62ae1d2&quot;,&quot;parentUUID&quot;:&quot;a49d00ff-d627-47f4-93f2-9e763ebb8bc5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all classes request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 2: Get all classes request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst subject_code = &#x27;HUM201&#x27;;\nconst term_id = 2;\nlet res = await request(this.app)\n    .get(`${baseRoute}?term_id=${term_id}&amp;subject_code=${subject_code}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst termCheck = (t_id) =&gt; term_id === t_id;\nconst subjectCheck = (s_code) =&gt; subject_code === s_code;\nconst queryCheck = (classRow) =&gt; termCheck(classRow.term_id) &amp;&amp; subjectCheck(classRow.subject.subject_code);\nexpect(resBody.every(queryCheck)).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;78422e85-8376-401e-92fd-27529db1add2&quot;,&quot;parentUUID&quot;:&quot;a49d00ff-d627-47f4-93f2-9e763ebb8bc5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all classes request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 3: Get all classes request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:776,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst PostModel = require(&#x27;../../src/models/class.model&#x27;);\nconst modelStub = sinon.stub(PostModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty class list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classes not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;da413a78-b9f3-4158-8512-692b92b99c5e&quot;,&quot;parentUUID&quot;:&quot;a49d00ff-d627-47f4-93f2-9e763ebb8bc5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all classes request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 4: Get all classes request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst term_id = &#x27;Spring 2021&#x27;; // &lt;-- invalid term_id value\nlet res = await request(this.app)\n    .get(`${baseRoute}?term_id=${term_id}&amp;campus=MAIN`) // &lt;-- `campus` is an incorrect query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;term_id&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b44d1fb2-214c-4b2c-af23-64a0a26f15b4&quot;,&quot;parentUUID&quot;:&quot;a49d00ff-d627-47f4-93f2-9e763ebb8bc5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all classes request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 5: Get all classes request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2ada6d5a-72aa-423e-890a-d57ce06d3384&quot;,&quot;parentUUID&quot;:&quot;a49d00ff-d627-47f4-93f2-9e763ebb8bc5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f5c03e29-c07f-4511-b11e-c86fd62ae1d2&quot;,&quot;78422e85-8376-401e-92fd-27529db1add2&quot;,&quot;da413a78-b9f3-4158-8512-692b92b99c5e&quot;,&quot;b44d1fb2-214c-4b2c-af23-64a0a26f15b4&quot;,&quot;2ada6d5a-72aa-423e-890a-d57ce06d3384&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:822,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;cbfc250d-b27e-4fca-8eba-b43430b57672&quot;,&quot;title&quot;:&quot;GET /classes/:term_id/:class_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a class request successful&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes/:term_id/:class_erp Scenario 1: Get a class request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.class_erp).to.be.eql(existingClass.class_erp); // should match initially sent id\nexpect(resBody).to.include.all.keys(Object.keys(existingClass)); // contain all params&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;492c4aa9-12c1-460f-bb1c-c6369a39ae90&quot;,&quot;parentUUID&quot;:&quot;cbfc250d-b27e-4fca-8eba-b43430b57672&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a class request is unsuccessful due to unknown class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes/:term_id/:class_erp Scenario 2: Get a class request is unsuccessful due to unknown class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}/${unknownClassERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cd8916c3-53d2-4cd1-aff0-e9d5bf9748c6&quot;,&quot;parentUUID&quot;:&quot;cbfc250d-b27e-4fca-8eba-b43430b57672&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a class request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes/:term_id/:class_erp Scenario 3: Get a class request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTermId}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;73b87e6d-b958-428e-9b1c-30ee6f78d4b8&quot;,&quot;parentUUID&quot;:&quot;cbfc250d-b27e-4fca-8eba-b43430b57672&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a class request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes/:term_id/:class_erp Scenario 3: Get a class request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${subRoute}/${existingClass.class_erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;add66e16-e346-4f7c-bbd6-61a7d9c051ff&quot;,&quot;parentUUID&quot;:&quot;cbfc250d-b27e-4fca-8eba-b43430b57672&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;492c4aa9-12c1-460f-bb1c-c6369a39ae90&quot;,&quot;cd8916c3-53d2-4cd1-aff0-e9d5bf9748c6&quot;,&quot;73b87e6d-b958-428e-9b1c-30ee6f78d4b8&quot;,&quot;add66e16-e346-4f7c-bbd6-61a7d9c051ff&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9e23eb30-b01a-45d6-b136-48716a8f35ad&quot;,&quot;title&quot;:&quot;POST /classes&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a class request is successful&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 1: Create a class request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newClass };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = data.class_erp;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${data.term_id}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.class_erp).to.be.equal(newId);\nexpect(res.body.body.term_id).to.be.equal(data.term_id);\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${data.term_id}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;69a6b709-85f6-4f75-bb35-2b5beb0804cf&quot;,&quot;parentUUID&quot;:&quot;9e23eb30-b01a-45d6-b136-48716a8f35ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a class request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 2: Create a class request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newClass };\ndelete data.term_id; // term_id is required\ndata.subject_code = &#x27;000&#x27;; // &lt;-- a valid subject code should be &#x27;XXX999&#x27;\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;term_id&#x27;, &#x27;subject_code&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7f559f3f-3baa-4f9e-9f56-db4701dd2df1&quot;,&quot;parentUUID&quot;:&quot;9e23eb30-b01a-45d6-b136-48716a8f35ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a class request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 3: Create a class request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.term_id = unknownTermId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;term_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a479f70f-a17f-4e38-bcb9-8511855cabe5&quot;,&quot;parentUUID&quot;:&quot;9e23eb30-b01a-45d6-b136-48716a8f35ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a class request is unsuccessful due to unknown subject_code&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 4: Create a class request is unsuccessful due to unknown subject_code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.subject_code = unknownSubjectCode; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;subject_code&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b2ea1eb1-059b-4649-9d97-4a4927be162c&quot;,&quot;parentUUID&quot;:&quot;9e23eb30-b01a-45d6-b136-48716a8f35ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a class request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 5: Create a class request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.teacher_id = unknownTeacherId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;teacher_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;78c177e1-db2e-4c70-ae1e-ceaa8765b41d&quot;,&quot;parentUUID&quot;:&quot;9e23eb30-b01a-45d6-b136-48716a8f35ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a class request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 6: Create a class request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.classroom_id = unknownClassroomId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;classroom_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a1e6b008-0621-4cc9-9236-ebe268b3ea9f&quot;,&quot;parentUUID&quot;:&quot;9e23eb30-b01a-45d6-b136-48716a8f35ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Create a class request is unsuccessful due to unknown timeslot_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 7: Create a class request is unsuccessful due to unknown timeslot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.timeslot_1 = unknownTimeslotId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;timeslot_1&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1c62d9bf-50e9-4aac-b630-80ebd2500e0f&quot;,&quot;parentUUID&quot;:&quot;9e23eb30-b01a-45d6-b136-48716a8f35ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Create a class request is unsuccessful due to unknown parent_class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 8: Create a class request is unsuccessful due to unknown parent_class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.parent_class_erp = unknownClassERP; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;parent_class_erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;989ca03e-6305-408e-ac3c-8e4b9aabbbe0&quot;,&quot;parentUUID&quot;:&quot;9e23eb30-b01a-45d6-b136-48716a8f35ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Create a class request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 9: Create a class request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newClass };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a0275c6e-c52f-4ae6-a6d1-217ba4968ece&quot;,&quot;parentUUID&quot;:&quot;9e23eb30-b01a-45d6-b136-48716a8f35ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Create a class request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 10: Create a class request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newClass };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9fc3e083-1b40-4b90-ae42-c27de86c7489&quot;,&quot;parentUUID&quot;:&quot;9e23eb30-b01a-45d6-b136-48716a8f35ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;69a6b709-85f6-4f75-bb35-2b5beb0804cf&quot;,&quot;7f559f3f-3baa-4f9e-9f56-db4701dd2df1&quot;,&quot;a479f70f-a17f-4e38-bcb9-8511855cabe5&quot;,&quot;b2ea1eb1-059b-4649-9d97-4a4927be162c&quot;,&quot;78c177e1-db2e-4c70-ae1e-ceaa8765b41d&quot;,&quot;a1e6b008-0621-4cc9-9236-ebe268b3ea9f&quot;,&quot;1c62d9bf-50e9-4aac-b630-80ebd2500e0f&quot;,&quot;989ca03e-6305-408e-ac3c-8e4b9aabbbe0&quot;,&quot;a0275c6e-c52f-4ae6-a6d1-217ba4968ece&quot;,&quot;9fc3e083-1b40-4b90-ae42-c27de86c7489&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:124,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;e768ba1e-9b40-4fe4-a1fc-ce761b3ccdad&quot;,&quot;title&quot;:&quot;POST /classes/bulk&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;POST /classes/bulk\&quot;&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk \&quot;before each\&quot; hook in \&quot;POST /classes/bulk\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;newClasses = [\n    {\n        class_erp: &#x27;8996&#x27;,\n        semester: \&quot;CS-3\&quot;,\n        classroom_id: 1,\n        subject_code: \&quot;CSE555\&quot;,\n        teacher_id: 5,\n        timeslot_1: 2,\n        timeslot_2: 2,\n        day_1: \&quot;monday\&quot;,\n        day_2: \&quot;wednesday\&quot;,\n        term_id: 1,\n        parent_class_erp: \&quot;\&quot;\n    },\n    {\n        class_erp: &#x27;8997&#x27;,\n        semester: \&quot;CS-3\&quot;,\n        classroom_id: 4,\n        subject_code: \&quot;CSE555\&quot;,\n        teacher_id: 5,\n        timeslot_1: 3,\n        timeslot_2: 3,\n        day_1: \&quot;monday\&quot;,\n        day_2: \&quot;wednesday\&quot;,\n        term_id: 1,\n        parent_class_erp: \&quot;8996\&quot;\n    },\n    {\n        class_erp: &#x27;8998&#x27;,\n        semester: \&quot;ACF-2\&quot;,\n        classroom_id: 3,\n        subject_code: \&quot;HUM201\&quot;,\n        teacher_id: 1,\n        timeslot_1: 2,\n        timeslot_2: 2,\n        day_1: \&quot;tuesday\&quot;,\n        day_2: \&quot;thursday\&quot;,\n        term_id: 1,\n        parent_class_erp: \&quot;\&quot;\n    },\n    {\n        class_erp: &#x27;8999&#x27;,\n        semester: \&quot;ECO-2\&quot;,\n        classroom_id: 5,\n        subject_code: \&quot;HUM201\&quot;,\n        teacher_id: 2,\n        timeslot_1: 2,\n        timeslot_2: 2,\n        day_1: \&quot;tuesday\&quot;,\n        day_2: \&quot;thursday\&quot;,\n        term_id: 1,\n        parent_class_erp: \&quot;\&quot;\n    }\n];&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1dac2269-c480-4fe5-a389-dad3a9d7e876&quot;,&quot;parentUUID&quot;:&quot;e768ba1e-9b40-4fe4-a1fc-ce761b3ccdad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create many classes request is successful&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 1: Create many classes request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classes: [...newClasses] };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(newClasses.length); // as many affected as classes sent\nconst term_id = data.classes[0].term_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}?term_id=${term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nconst classERPs = data.classes.map(classRow =&gt; (classRow.class_erp));\nconst responseERPs = res.body.body.map(classRow =&gt; (classRow.class_erp));\nexpect(responseERPs).to.include.all.members(classERPs);\n// cleanup\nfor (const class_erp of classERPs.reverse()) { // reversing so that FK references get removed first\n    res = await request(app)\n        .delete(`${baseRoute}/${term_id}/${class_erp}`)\n        .auth(adminToken, { type: &#x27;bearer&#x27; });\n    expect(res.status).to.be.equal(200);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7da37a9b-21cb-426f-8443-af5adfd1aed6&quot;,&quot;parentUUID&quot;:&quot;e768ba1e-9b40-4fe4-a1fc-ce761b3ccdad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create many classes request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 2: Create many classes request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classes: [...newClasses] };\ndelete data.classes[0].term_id; // term_id is required\ndata.classes[0].subject_code = &#x27;000&#x27;; // &lt;-- a valid subject code should be &#x27;XXX999&#x27;\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param.split(&#x27;.&#x27;)[1]));\nexpect(incorrectParams).to.include.all.members([&#x27;term_id&#x27;, &#x27;subject_code&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;04567f6b-444e-4b00-bbd5-1987a1db385f&quot;,&quot;parentUUID&quot;:&quot;e768ba1e-9b40-4fe4-a1fc-ce761b3ccdad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create many classes request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 3: Create many classes request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].term_id = unknownTermId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;term_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;75b498a2-1b6e-4896-80c6-bbc9578bf2fb&quot;,&quot;parentUUID&quot;:&quot;e768ba1e-9b40-4fe4-a1fc-ce761b3ccdad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create many classes request is unsuccessful due to unknown subject_code&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 4: Create many classes request is unsuccessful due to unknown subject_code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].subject_code = unknownSubjectCode; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;subject_code&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4621229d-1bb9-4fb5-a6da-a382e5e678c6&quot;,&quot;parentUUID&quot;:&quot;e768ba1e-9b40-4fe4-a1fc-ce761b3ccdad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create many classes request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 5: Create many classes request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].teacher_id = unknownTeacherId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;teacher_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;61e2ab0d-1521-469e-b418-87bbcba3adeb&quot;,&quot;parentUUID&quot;:&quot;e768ba1e-9b40-4fe4-a1fc-ce761b3ccdad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create many classes request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 6: Create many classes request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].classroom_id = unknownClassroomId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;classroom_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f387c2eb-d75a-4876-ab86-0d64d2ad5b4c&quot;,&quot;parentUUID&quot;:&quot;e768ba1e-9b40-4fe4-a1fc-ce761b3ccdad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Create many classes request is unsuccessful due to unknown timeslot_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 7: Create many classes request is unsuccessful due to unknown timeslot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].timeslot_1 = unknownTimeslotId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;timeslot_1&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4887338c-dd73-4c03-bced-63297e1bfa46&quot;,&quot;parentUUID&quot;:&quot;e768ba1e-9b40-4fe4-a1fc-ce761b3ccdad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Create many classes request is unsuccessful due to unknown parent_class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 8: Create many classes request is unsuccessful due to unknown parent_class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].parent_class_erp = unknownClassERP; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;parent_class_erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;edccd5ae-78ca-4946-978b-0044506a3068&quot;,&quot;parentUUID&quot;:&quot;e768ba1e-9b40-4fe4-a1fc-ce761b3ccdad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Create many classes request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 9: Create many classes request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b3c1e7d4-b22a-4e64-a7cb-13c91731841a&quot;,&quot;parentUUID&quot;:&quot;e768ba1e-9b40-4fe4-a1fc-ce761b3ccdad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Create many classes request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 10: Create many classes request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d8dabd26-3ea8-47b8-a5c0-6ece3081e06e&quot;,&quot;parentUUID&quot;:&quot;e768ba1e-9b40-4fe4-a1fc-ce761b3ccdad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7da37a9b-21cb-426f-8443-af5adfd1aed6&quot;,&quot;04567f6b-444e-4b00-bbd5-1987a1db385f&quot;,&quot;75b498a2-1b6e-4896-80c6-bbc9578bf2fb&quot;,&quot;4621229d-1bb9-4fb5-a6da-a382e5e678c6&quot;,&quot;61e2ab0d-1521-469e-b418-87bbcba3adeb&quot;,&quot;f387c2eb-d75a-4876-ab86-0d64d2ad5b4c&quot;,&quot;4887338c-dd73-4c03-bced-63297e1bfa46&quot;,&quot;edccd5ae-78ca-4946-978b-0044506a3068&quot;,&quot;b3c1e7d4-b22a-4e64-a7cb-13c91731841a&quot;,&quot;d8dabd26-3ea8-47b8-a5c0-6ece3081e06e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:129,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;da183aa8-d386-4298-89e3-1963f6eb886f&quot;,&quot;title&quot;:&quot;PATCH /classes/:term_id/:class_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a class request is successful&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 1: Update a class request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.classroom.classroom_id).to.be.equal(newClassroom);\n\n// cleanup\ndata.classroom_id = existingClass.classroom.classroom_id;\nres = await request(app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8b86cdc7-f9d7-46e2-a7cf-67f0050743b6&quot;,&quot;parentUUID&quot;:&quot;da183aa8-d386-4298-89e3-1963f6eb886f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a class request is unsuccessful due to unknown class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 2: Update a class request is unsuccessful due to unknown class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${unknownClassERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;86e56353-2809-4138-a9c4-e64871c2a8f9&quot;,&quot;parentUUID&quot;:&quot;da183aa8-d386-4298-89e3-1963f6eb886f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a class request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 3: Update a class request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTermId}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;24b5d1d8-09d0-424d-b8cb-c915c5d95919&quot;,&quot;parentUUID&quot;:&quot;da183aa8-d386-4298-89e3-1963f6eb886f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a class request is unsuccessful due to unknown subject_code&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 4: Update a class request is unsuccessful due to unknown subject_code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject_code: unknownSubjectCode };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;subject_code&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a4fccd39-e4c4-4393-ac60-a3e4a524e1e0&quot;,&quot;parentUUID&quot;:&quot;da183aa8-d386-4298-89e3-1963f6eb886f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a class request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 5: Update a class request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { teacher_id: unknownTeacherId };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;teacher_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ccf03f2c-b4a7-4b21-b244-6c7c959b3575&quot;,&quot;parentUUID&quot;:&quot;da183aa8-d386-4298-89e3-1963f6eb886f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a class request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 6: Update a class request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: unknownClassroomId };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;classroom_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ca0235cd-2a40-410e-aa42-9e699ba1adc6&quot;,&quot;parentUUID&quot;:&quot;da183aa8-d386-4298-89e3-1963f6eb886f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Update a class request is unsuccessful due to unknown timeslot_id&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 7: Update a class request is unsuccessful due to unknown timeslot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { timeslot_1: unknownTimeslotId };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;timeslot_1&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a865a57d-5738-4232-8d8a-2dd0bc78ae3e&quot;,&quot;parentUUID&quot;:&quot;da183aa8-d386-4298-89e3-1963f6eb886f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Update a class request is unsuccessful due to unknown parent_class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 8: Update a class request is unsuccessful due to unknown parent_class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { parent_class_erp: unknownClassERP };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;parent_class_erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a814c479-3417-456b-84ce-36a904618010&quot;,&quot;parentUUID&quot;:&quot;da183aa8-d386-4298-89e3-1963f6eb886f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Update a class request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 9: Update a class request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    classroom: newClassroom, // &lt;-- an valid parameter name should be &#x27;classroom_id&#x27;\n    subject_code: &#x27;123&#x27; // &lt;-- a valid &#x27;subject_code&#x27; follows format &#x27;XXX999&#x27; only\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;subject_code&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7d4fd6f2-1e65-4b43-b98e-ca8c4a0101b9&quot;,&quot;parentUUID&quot;:&quot;da183aa8-d386-4298-89e3-1963f6eb886f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Update a class request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 10: Update a class request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\n\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change classes\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;46550dd2-2b69-46b3-9ffe-2a325c31ec7d&quot;,&quot;parentUUID&quot;:&quot;da183aa8-d386-4298-89e3-1963f6eb886f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 11: Update a class request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 11: Update a class request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;81e971d2-97a8-49b0-a94a-84fd7bb70162&quot;,&quot;parentUUID&quot;:&quot;da183aa8-d386-4298-89e3-1963f6eb886f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8b86cdc7-f9d7-46e2-a7cf-67f0050743b6&quot;,&quot;86e56353-2809-4138-a9c4-e64871c2a8f9&quot;,&quot;24b5d1d8-09d0-424d-b8cb-c915c5d95919&quot;,&quot;a4fccd39-e4c4-4393-ac60-a3e4a524e1e0&quot;,&quot;ccf03f2c-b4a7-4b21-b244-6c7c959b3575&quot;,&quot;ca0235cd-2a40-410e-aa42-9e699ba1adc6&quot;,&quot;a865a57d-5738-4232-8d8a-2dd0bc78ae3e&quot;,&quot;a814c479-3417-456b-84ce-36a904618010&quot;,&quot;7d4fd6f2-1e65-4b43-b98e-ca8c4a0101b9&quot;,&quot;46550dd2-2b69-46b3-9ffe-2a325c31ec7d&quot;,&quot;81e971d2-97a8-49b0-a94a-84fd7bb70162&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:88,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;79f7fbf5-7d2b-4b19-bbe3-fcd1d55fa24e&quot;,&quot;title&quot;:&quot;DELETE /classes/:term_id/:class_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a subject request is successful&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 1: Delete a subject request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { ...newClass };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = data.class_erp;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${subRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${subRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f0077824-d7c5-44ac-b9c9-1c0297e18941&quot;,&quot;parentUUID&quot;:&quot;79f7fbf5-7d2b-4b19-bbe3-fcd1d55fa24e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a subject request is unsuccessful due to unknown class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 2: Delete a subject request is unsuccessful due to unknown class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${subRoute}/${unknownClassERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0922f961-f977-44a4-a773-40729ccb9690&quot;,&quot;parentUUID&quot;:&quot;79f7fbf5-7d2b-4b19-bbe3-fcd1d55fa24e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a subject request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 3: Delete a subject request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTermId}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5b2e4bf2-0ead-402a-a71a-46130f655ce3&quot;,&quot;parentUUID&quot;:&quot;79f7fbf5-7d2b-4b19-bbe3-fcd1d55fa24e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 4: Delete a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;64faa7ab-9b1e-4004-9ef7-5d675b37b344&quot;,&quot;parentUUID&quot;:&quot;79f7fbf5-7d2b-4b19-bbe3-fcd1d55fa24e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 5: Delete a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${subRoute}/${existingClass.class_erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bfa5c028-8247-4143-a2fc-61bb01d5abeb&quot;,&quot;parentUUID&quot;:&quot;79f7fbf5-7d2b-4b19-bbe3-fcd1d55fa24e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f0077824-d7c5-44ac-b9c9-1c0297e18941&quot;,&quot;0922f961-f977-44a4-a773-40729ccb9690&quot;,&quot;5b2e4bf2-0ead-402a-a71a-46130f655ce3&quot;,&quot;64faa7ab-9b1e-4004-9ef7-5d675b37b344&quot;,&quot;bfa5c028-8247-4143-a2fc-61bb01d5abeb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;05768e1c-a842-4456-be72-e1af879b09c6&quot;,&quot;title&quot;:&quot;Classrooms API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Classrooms API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Classrooms API \&quot;before each\&quot; hook in \&quot;Classrooms API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;32881001-658a-4f1e-bb79-6e1f22b0c216&quot;,&quot;parentUUID&quot;:&quot;05768e1c-a842-4456-be72-e1af879b09c6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2cc48ded-d112-486a-83af-b7b85dd2d1d3&quot;,&quot;title&quot;:&quot;GET /classrooms&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all classrooms request successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms Scenario 1: Get all classrooms request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingClassroom));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f0f6b3b7-d312-4c4d-add4-12d8f20a6b16&quot;,&quot;parentUUID&quot;:&quot;2cc48ded-d112-486a-83af-b7b85dd2d1d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all classrooms request unsuccessful due to zero classrooms&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms Scenario 2: Get all classrooms request unsuccessful due to zero classrooms&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:576,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ClassroomModel = require(&#x27;../../src/models/classroom.model&#x27;);\nconst modelStub = sinon.stub(ClassroomModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty classroom list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classrooms not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;59f6cb17-4fb6-4a31-b7b0-3c1974d4ad44&quot;,&quot;parentUUID&quot;:&quot;2cc48ded-d112-486a-83af-b7b85dd2d1d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms Scenario 3: Get a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6707d6b0-aaed-4a52-837b-45a4c1aadcef&quot;,&quot;parentUUID&quot;:&quot;2cc48ded-d112-486a-83af-b7b85dd2d1d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all classrooms request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms Scenario 4: Get all classrooms request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;68e45c18-2d28-4d15-8835-ba4417ed1711&quot;,&quot;parentUUID&quot;:&quot;2cc48ded-d112-486a-83af-b7b85dd2d1d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f0f6b3b7-d312-4c4d-add4-12d8f20a6b16&quot;,&quot;59f6cb17-4fb6-4a31-b7b0-3c1974d4ad44&quot;,&quot;6707d6b0-aaed-4a52-837b-45a4c1aadcef&quot;,&quot;68e45c18-2d28-4d15-8835-ba4417ed1711&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:596,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;3ae44ab6-3331-4463-b172-1074698da58c&quot;,&quot;title&quot;:&quot;GET /classrooms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a classroom request successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms/:id Scenario 1: Get a classroom request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingClassroom));\nexpect(resBody.classroom_id).to.be.equal(existingClassroom.classroom_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ee2a19f7-53c1-4239-afbf-28313226714c&quot;,&quot;parentUUID&quot;:&quot;3ae44ab6-3331-4463-b172-1074698da58c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms/:id Scenario 2: Get a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownClassroomId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classroom not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;baae61f1-48f2-4179-ac21-724cf1b31c37&quot;,&quot;parentUUID&quot;:&quot;3ae44ab6-3331-4463-b172-1074698da58c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms/:id Scenario 3: Get a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b1e8c493-adf4-469a-9cdd-549f7ae7a9e5&quot;,&quot;parentUUID&quot;:&quot;3ae44ab6-3331-4463-b172-1074698da58c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a classroom request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms/:id Scenario 4: Get a classroom request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingClassroom.classroom_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c9b3b081-295d-4103-adaf-728cb7a779c3&quot;,&quot;parentUUID&quot;:&quot;3ae44ab6-3331-4463-b172-1074698da58c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ee2a19f7-53c1-4239-afbf-28313226714c&quot;,&quot;baae61f1-48f2-4179-ac21-724cf1b31c37&quot;,&quot;b1e8c493-adf4-469a-9cdd-549f7ae7a9e5&quot;,&quot;c9b3b081-295d-4103-adaf-728cb7a779c3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ad61e3ae-7c20-4c1c-9431-0e56b5c8a10d&quot;,&quot;title&quot;:&quot;POST /classrooms&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a classroom request is successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 1: Create a classroom request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom, campus_id };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;classroom_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.classroom_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    classroom_id: newId,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9c121418-2ef5-4e1f-925d-3394dac2c394&quot;,&quot;parentUUID&quot;:&quot;ad61e3ae-7c20-4c1c-9431-0e56b5c8a10d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a classroom request is unsuccessful due to unknown campus_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 2: Create a classroom request is unsuccessful due to unknown campus_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom, campus_id: unknownCampusId };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;campus_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6a4709d0-20e9-4eee-8e15-1ba5d13e0757&quot;,&quot;parentUUID&quot;:&quot;ad61e3ae-7c20-4c1c-9431-0e56b5c8a10d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a classroom request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 3: Create a classroom request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    classrooms: classroom, // &lt;-- a valid parameter name is &#x27;classroom&#x27;\n    campus_id\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;classroom&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1d31d8bf-79b3-4e4b-bc68-c5fd0b7afaf9&quot;,&quot;parentUUID&quot;:&quot;ad61e3ae-7c20-4c1c-9431-0e56b5c8a10d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 4: Create a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom, campus_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9b048fcd-b585-46ed-941a-8e7bc6328402&quot;,&quot;parentUUID&quot;:&quot;ad61e3ae-7c20-4c1c-9431-0e56b5c8a10d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a classroom request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 5: Create a classroom request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom, campus_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2058646e-97c3-407f-85c6-aa3096758ce8&quot;,&quot;parentUUID&quot;:&quot;ad61e3ae-7c20-4c1c-9431-0e56b5c8a10d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9c121418-2ef5-4e1f-925d-3394dac2c394&quot;,&quot;6a4709d0-20e9-4eee-8e15-1ba5d13e0757&quot;,&quot;1d31d8bf-79b3-4e4b-bc68-c5fd0b7afaf9&quot;,&quot;9b048fcd-b585-46ed-941a-8e7bc6328402&quot;,&quot;2058646e-97c3-407f-85c6-aa3096758ce8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:70,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f0227498-b382-43b7-8ba9-4b24a614dd09&quot;,&quot;title&quot;:&quot;PATCH /classrooms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a classroom request is successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 1: Update a classroom request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom: newClassroomName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    classroom_id: existingClassroom.classroom_id,\n    classroom: newClassroomName,\n    campus_id: existingClassroom.campus_id\n});\n\n// cleanup\ndata.classroom = existingClassroom.classroom;\nres = await request(app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9e9900a6-57ba-4299-8f31-1120467cbf87&quot;,&quot;parentUUID&quot;:&quot;f0227498-b382-43b7-8ba9-4b24a614dd09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 2: Update a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom: newClassroomName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownClassroomId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classroom not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8d27d386-bc6f-4788-b0c1-57a304e7689a&quot;,&quot;parentUUID&quot;:&quot;f0227498-b382-43b7-8ba9-4b24a614dd09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a classroom request is unsuccessful due to unknown campus_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 3: Update a classroom request is unsuccessful due to unknown campus_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_id: unknownCampusId };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;campus_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f1de9298-16e9-4b82-ae86-92f664745496&quot;,&quot;parentUUID&quot;:&quot;f0227498-b382-43b7-8ba9-4b24a614dd09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a classroom request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 4: Update a classroom request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    classrooms: newClassroomName // &lt;-- a invalid update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4482db8a-e5da-49e2-b5e0-8cb6f1e4fd9e&quot;,&quot;parentUUID&quot;:&quot;f0227498-b382-43b7-8ba9-4b24a614dd09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 5: Update a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom: newClassroomName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9556648c-c894-4afd-a460-4292dda3651e&quot;,&quot;parentUUID&quot;:&quot;f0227498-b382-43b7-8ba9-4b24a614dd09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a classroom request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 6: Update a classroom request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom: newClassroomName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f2bf0233-6b83-42f3-afe2-8b04069e609e&quot;,&quot;parentUUID&quot;:&quot;f0227498-b382-43b7-8ba9-4b24a614dd09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9e9900a6-57ba-4299-8f31-1120467cbf87&quot;,&quot;8d27d386-bc6f-4788-b0c1-57a304e7689a&quot;,&quot;f1de9298-16e9-4b82-ae86-92f664745496&quot;,&quot;4482db8a-e5da-49e2-b5e0-8cb6f1e4fd9e&quot;,&quot;9556648c-c894-4afd-a460-4292dda3651e&quot;,&quot;f2bf0233-6b83-42f3-afe2-8b04069e609e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:60,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6474f055-dfff-4bc2-bade-e0159a6f1ebf&quot;,&quot;title&quot;:&quot;DELETE /classrooms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a classroom request is successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API DELETE /classrooms/:id Scenario 1: Delete a classroom request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { classroom, campus_id };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.classroom_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classroom has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;46c43660-d32c-4a60-9488-3e4371408e33&quot;,&quot;parentUUID&quot;:&quot;6474f055-dfff-4bc2-bade-e0159a6f1ebf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API DELETE /classrooms/:id Scenario 2: Delete a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownClassroomId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classroom not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;142f5e32-b83e-4853-ab51-d3a25edd1dee&quot;,&quot;parentUUID&quot;:&quot;6474f055-dfff-4bc2-bade-e0159a6f1ebf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API DELETE /classrooms/:id Scenario 3: Delete a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7d2736be-c448-492a-9e09-dd2e0bd933bd&quot;,&quot;parentUUID&quot;:&quot;6474f055-dfff-4bc2-bade-e0159a6f1ebf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a classroom request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API DELETE /classrooms/:id Scenario 4: Delete a classroom request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingClassroom.classroom_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6435b6a8-4af2-4e71-a859-0d4e2fb40d05&quot;,&quot;parentUUID&quot;:&quot;6474f055-dfff-4bc2-bade-e0159a6f1ebf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;46c43660-d32c-4a60-9488-3e4371408e33&quot;,&quot;142f5e32-b83e-4853-ab51-d3a25edd1dee&quot;,&quot;7d2736be-c448-492a-9e09-dd2e0bd933bd&quot;,&quot;6435b6a8-4af2-4e71-a859-0d4e2fb40d05&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:38,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;15064b9b-0a5e-495a-9aa8-184ca5716a69&quot;,&quot;title&quot;:&quot;Hangout requests API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Hangout requests API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API \&quot;before each\&quot; hook in \&quot;Hangout requests API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;adc2c3eb-6e3c-43e0-a5e4-0a2c01ffc1bf&quot;,&quot;parentUUID&quot;:&quot;15064b9b-0a5e-495a-9aa8-184ca5716a69&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;85ebf3bc-3d4d-40fc-acad-005b68cf0f02&quot;,&quot;title&quot;:&quot;GET /hangout-requests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all hangout requests is successful (Sent)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 1: Get all hangout requests is successful (Sent)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // userToken.erp === sender_erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = hangoutRequest =&gt; hangoutRequest.sender.erp === sender_erp;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([\n    &#x27;hangout_request_id&#x27;,\n    &#x27;sender&#x27;,\n    &#x27;receiver&#x27;,\n    &#x27;purpose&#x27;,\n    &#x27;request_status&#x27;,\n    &#x27;meetup_at&#x27;,\n    &#x27;meetup_spot_id&#x27;,\n    &#x27;accepted_at&#x27;\n]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingHangoutRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingHangoutRequest.receiver));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;09e87265-20ae-41c7-b741-62d0bbd20dea&quot;,&quot;parentUUID&quot;:&quot;85ebf3bc-3d4d-40fc-acad-005b68cf0f02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all hangout requests is successful (Receiver)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 2: Get all hangout requests is successful (Receiver)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = adminERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?receiver_erp=${receiver_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // adminToken.erp === receiver_erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = hangoutRequest =&gt; hangoutRequest.receiver.erp === receiver_erp;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([\n    &#x27;hangout_request_id&#x27;,\n    &#x27;sender&#x27;,\n    &#x27;receiver&#x27;,\n    &#x27;purpose&#x27;,\n    &#x27;request_status&#x27;,\n    &#x27;meetup_at&#x27;,\n    &#x27;meetup_spot_id&#x27;,\n    &#x27;accepted_at&#x27;\n]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingHangoutRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingHangoutRequest.receiver));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;abb169f2-c45a-4072-8a99-ea7a18949aff&quot;,&quot;parentUUID&quot;:&quot;85ebf3bc-3d4d-40fc-acad-005b68cf0f02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all hangout requests unsuccessful due to no (sent) hangout requests&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 3: Get all hangout requests unsuccessful due to no (sent) hangout requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = user2ERP;\nconst fakeToken = jwt.sign({erp: sender_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}`)\n    .auth(fakeToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b8b38c79-af5c-4b93-b2d7-60e8589985cc&quot;,&quot;parentUUID&quot;:&quot;85ebf3bc-3d4d-40fc-acad-005b68cf0f02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all hangout requests unsuccessful due to no (received) hangout requests&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 4: Get all hangout requests unsuccessful due to no (received) hangout requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = user2ERP;\nconst fakeToken = jwt.sign({erp: receiver_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?receiver_erp=${receiver_erp}`)\n    .auth(fakeToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a6c04d9a-1802-4a18-a8ef-dde2650d44a3&quot;,&quot;parentUUID&quot;:&quot;85ebf3bc-3d4d-40fc-acad-005b68cf0f02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all hangout requests is incorrect due to multiple query params&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 5: Get all hangout requests is incorrect due to multiple query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\nconst receiver_erp = user2ERP;\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}&amp;receiver_erp=${receiver_erp}`) // &lt;-- can&#x27;t specify both sender_erp and receiver_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;receiver_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Can\\&#x27;t specify both sender and receiver erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;24ea3fc5-f1aa-4a94-abf5-383e831ade41&quot;,&quot;parentUUID&quot;:&quot;85ebf3bc-3d4d-40fc-acad-005b68cf0f02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get all hangout requests is incorrect due to no query params&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 6: Get all hangout requests is incorrect due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}`) // &lt;-- either specify sender_erp or receiver_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Either sender or receiver erp is required&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8aff7649-5bf0-436a-bfab-fce551d21d7d&quot;,&quot;parentUUID&quot;:&quot;85ebf3bc-3d4d-40fc-acad-005b68cf0f02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Get all hangout requests is incorrect due to unknown query params&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 7: Get all hangout requests is incorrect due to unknown query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = &#x27;123&#x27;; // a valid erp is 5 digits\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}&amp;request_status=accepted`) // &lt;-- &#x27;request_status&#x27; is invalid query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;sender_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2f34ccdf-e1d5-4de7-b363-16de25e89c1a&quot;,&quot;parentUUID&quot;:&quot;85ebf3bc-3d4d-40fc-acad-005b68cf0f02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Get request is forbidden due to querying other&#x27;s sent hangout requests&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 8: Get request is forbidden due to querying other&#x27;s sent hangout requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp !== sender_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f8bc6133-7d02-4515-b980-8476a76f0b7b&quot;,&quot;parentUUID&quot;:&quot;85ebf3bc-3d4d-40fc-acad-005b68cf0f02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Get request is forbidden due to querying other&#x27;s received hangout requests&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 9: Get request is forbidden due to querying other&#x27;s received hangout requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?receiver_erp=${receiver_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp !== receiver_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;59e2481c-17b3-4ccb-84e0-e368ea3bc25e&quot;,&quot;parentUUID&quot;:&quot;85ebf3bc-3d4d-40fc-acad-005b68cf0f02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Get all hangout requests is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 10: Get all hangout requests is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5d483733-b6ce-472c-875f-6582c609bba9&quot;,&quot;parentUUID&quot;:&quot;85ebf3bc-3d4d-40fc-acad-005b68cf0f02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;09e87265-20ae-41c7-b741-62d0bbd20dea&quot;,&quot;abb169f2-c45a-4072-8a99-ea7a18949aff&quot;,&quot;b8b38c79-af5c-4b93-b2d7-60e8589985cc&quot;,&quot;a6c04d9a-1802-4a18-a8ef-dde2650d44a3&quot;,&quot;24ea3fc5-f1aa-4a94-abf5-383e831ade41&quot;,&quot;8aff7649-5bf0-436a-bfab-fce551d21d7d&quot;,&quot;2f34ccdf-e1d5-4de7-b363-16de25e89c1a&quot;,&quot;f8bc6133-7d02-4515-b980-8476a76f0b7b&quot;,&quot;59e2481c-17b3-4ccb-84e0-e368ea3bc25e&quot;,&quot;5d483733-b6ce-472c-875f-6582c609bba9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:85,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;73569115-030d-4e4b-8eb4-6e5902a5408d&quot;,&quot;title&quot;:&quot;POST /hangout-requests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a hangout request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 1: Create a hangout request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp, receiver_erp, purpose, meetup_at, meetup_spot_id };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // token erp === sender_erp in body\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.hangout_request_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // token erp === sender_erp in body\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.hangout_request_id).to.be.equal(newId);\nexpect(res.body.body.sender.erp).to.be.equal(data.sender_erp);\nexpect(res.body.body.receiver.erp).to.be.equal(data.receiver_erp);\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // sender deletes it\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8316238d-0747-4a73-aa0f-6339d2c8827b&quot;,&quot;parentUUID&quot;:&quot;73569115-030d-4e4b-8eb4-6e5902a5408d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a hangout request is unsuccessful due to unknown receiver_erp&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 2: Create a hangout request is unsuccessful due to unknown receiver_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: existingHangoutRequest.sender.erp,\n    receiver_erp: unknownStudentERP,\n    purpose,\n    meetup_at,\n    meetup_spot_id\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === existingHangoutRequest.sender.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;receiver_erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;34c59b4d-2ef7-408b-bb7d-06751fe8a8e2&quot;,&quot;parentUUID&quot;:&quot;73569115-030d-4e4b-8eb4-6e5902a5408d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a hangout request is incorrect due to wrong key name in the body&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 3: Create a hangout request is incorrect due to wrong key name in the body&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { // missing receiver_erp,\n    meetup_at: &#x27;not going&#x27;, // &lt;-- not a valid meetup_at\n    purpose,\n    meetup_spot_id,\n    send_erp: &#x27;12345&#x27; // &lt;-- a valid parameter name should be &#x27;sender_erp&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;receiver_erp&#x27;, &#x27;meetup_at&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a224eb68-8b59-4f6c-97f4-d3cf2c25643b&quot;,&quot;parentUUID&quot;:&quot;73569115-030d-4e4b-8eb4-6e5902a5408d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a hangout request is incorrect due to hangout request to oneself&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 4: Create a hangout request is incorrect due to hangout request to oneself&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: sender_erp,\n    receiver_erp: sender_erp,\n    purpose,\n    meetup_at,\n    meetup_spot_id\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === data.sender_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;receiver_erp&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Sender and receiver ERP can\\&#x27;t be the same&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;df55953a-437c-43a0-b71c-844af5e0edce&quot;,&quot;parentUUID&quot;:&quot;73569115-030d-4e4b-8eb4-6e5902a5408d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a hangout request is forbidden due to unowned hangout request&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 5: Create a hangout request is forbidden due to unowned hangout request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp: adminERP, receiver_erp, purpose, meetup_at, meetup_spot_id }; // adminERP instead of userERP\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- data.sender_erp !== userToken.erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;091ba481-39ab-4fd8-aea5-df02e931778a&quot;,&quot;parentUUID&quot;:&quot;73569115-030d-4e4b-8eb4-6e5902a5408d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a hangout request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 6: Create a hangout request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp, receiver_erp, purpose, meetup_at, meetup_spot_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;11b34941-51ec-4d27-9344-2c40eecaa518&quot;,&quot;parentUUID&quot;:&quot;73569115-030d-4e4b-8eb4-6e5902a5408d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8316238d-0747-4a73-aa0f-6339d2c8827b&quot;,&quot;34c59b4d-2ef7-408b-bb7d-06751fe8a8e2&quot;,&quot;a224eb68-8b59-4f6c-97f4-d3cf2c25643b&quot;,&quot;df55953a-437c-43a0-b71c-844af5e0edce&quot;,&quot;091ba481-39ab-4fd8-aea5-df02e931778a&quot;,&quot;11b34941-51ec-4d27-9344-2c40eecaa518&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:46,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;62289a7c-f659-4aac-ae46-289710664393&quot;,&quot;title&quot;:&quot;PATCH /hangout-requests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a hangout request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API PATCH /hangout-requests/:id Scenario 1: Update a hangout request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { request_status, accepted_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminToken.erp == existingHangoutRequest.receiver.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${hangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst hangoutRequest = {\n    ...existingHangoutRequest\n};\nhangoutRequest.accepted_at = data.accepted_at;\nhangoutRequest.request_status = data.request_status;\nexpect(res.body.body).to.be.eql(hangoutRequest);\n\n// cleanup\ndata.request_status = existingHangoutRequest.request_status;\ndata.accepted_at = existingHangoutRequest.accepted_at;\nres = await request(app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminToken.erp == existingHangoutRequest.receiver.erp\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b961d78a-1099-404b-8dd4-2d126bf5fc46&quot;,&quot;parentUUID&quot;:&quot;62289a7c-f659-4aac-ae46-289710664393&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a hangout request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API PATCH /hangout-requests/:id Scenario 2: Update a hangout request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    request_status: &#x27;ignored&#x27;, // &lt;-- not a valid request_status\n    accepted_at, // can&#x27;t specify accepted at unless request_status === &#x27;accepted/reject&#x27;\n    sender_erp: &#x27;12345&#x27; // &lt;-- an invalid update parameter i.e. not allowed\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;request_status&#x27;, &#x27;accepted_at&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include.members([&#x27;Invalid updates!&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0a631ad2-f3c1-433f-a6da-e51fc0636197&quot;,&quot;parentUUID&quot;:&quot;62289a7c-f659-4aac-ae46-289710664393&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a hangout request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API PATCH /hangout-requests/:id Scenario 3: Update a hangout request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { request_status, accepted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- userToken.erp !== existingHangoutRequest.receiver.erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bcd9ce14-20c3-4427-99cc-03678ddd4314&quot;,&quot;parentUUID&quot;:&quot;62289a7c-f659-4aac-ae46-289710664393&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a hangout request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API PATCH /hangout-requests/:id Scenario 4: Update a hangout request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { request_status, accepted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;56ea6e6b-a8b5-4f46-bf4b-45e3467164d1&quot;,&quot;parentUUID&quot;:&quot;62289a7c-f659-4aac-ae46-289710664393&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b961d78a-1099-404b-8dd4-2d126bf5fc46&quot;,&quot;0a631ad2-f3c1-433f-a6da-e51fc0636197&quot;,&quot;bcd9ce14-20c3-4427-99cc-03678ddd4314&quot;,&quot;56ea6e6b-a8b5-4f46-bf4b-45e3467164d1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:35,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;857c8d0d-ffe4-4a3b-a8e6-d50eabfe63de&quot;,&quot;title&quot;:&quot;DELETE /hangout-requests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a hangout request is successful (Sender cancels)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API DELETE /hangout-requests/:id Scenario 1: Delete a hangout request is successful (Sender cancels)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { sender_erp, receiver_erp, purpose, meetup_at, meetup_spot_id };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\nconst newId = res.body.body.hangout_request_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp === sender_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hangout request has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hangout request not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f49c9b46-82c1-40ee-9561-6a90dd7bcfa5&quot;,&quot;parentUUID&quot;:&quot;857c8d0d-ffe4-4a3b-a8e6-d50eabfe63de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a hangout request is unsuccessful due to unknown id&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API DELETE /hangout-requests/:id Scenario 2: Delete a hangout request is unsuccessful due to unknown id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownHangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hangout request not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8628f5b6-34e9-4b6a-aa0d-af3d47617dfe&quot;,&quot;parentUUID&quot;:&quot;857c8d0d-ffe4-4a3b-a8e6-d50eabfe63de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a hangout request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API DELETE /hangout-requests/:id Scenario 3: Delete a hangout request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst forbiddenToken = jwt.sign({erp: receiver_erp}, Config.SECRET_JWT);\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${hangoutRequestId}`)\n    .auth(forbiddenToken, { type: &#x27;bearer&#x27; }); // forbiddenToken.erp !== receiver_erp or sender_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;022a28b8-44b6-4c9d-a8f9-2774c5b8b8b3&quot;,&quot;parentUUID&quot;:&quot;857c8d0d-ffe4-4a3b-a8e6-d50eabfe63de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a hangout request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API DELETE /hangout-requests/:id Scenario 4: Delete a hangout request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${hangoutRequestId}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4e505474-75e0-460d-9403-092494443f79&quot;,&quot;parentUUID&quot;:&quot;857c8d0d-ffe4-4a3b-a8e6-d50eabfe63de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f49c9b46-82c1-40ee-9561-6a90dd7bcfa5&quot;,&quot;8628f5b6-34e9-4b6a-aa0d-af3d47617dfe&quot;,&quot;022a28b8-44b6-4c9d-a8f9-2774c5b8b8b3&quot;,&quot;4e505474-75e0-460d-9403-092494443f79&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;16f9945b-6bf5-4b32-b410-0e401623fae4&quot;,&quot;title&quot;:&quot;Healthcheck&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\healthCheck.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\healthCheck.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Healthcheck\&quot;&quot;,&quot;fullTitle&quot;:&quot;Healthcheck \&quot;before each\&quot; hook in \&quot;Healthcheck\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;originalDateNow = Date.now;\nDate.now = () =&gt; { return now; };&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0b7d67c2-b1c9-4563-998b-159c6ad134b9&quot;,&quot;parentUUID&quot;:&quot;16f9945b-6bf5-4b32-b410-0e401623fae4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Healthcheck\&quot;&quot;,&quot;fullTitle&quot;:&quot;Healthcheck \&quot;after each\&quot; hook in \&quot;Healthcheck\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;Date.now = originalDateNow;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b11244af-811e-4293-b1f6-bc5fd4fdccbf&quot;,&quot;parentUUID&quot;:&quot;16f9945b-6bf5-4b32-b410-0e401623fae4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns OK, uptime and timestamp, if server is healthy&quot;,&quot;fullTitle&quot;:&quot;Healthcheck returns OK, uptime and timestamp, if server is healthy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const res = await request(app).get(`/api/${Config.API_VERSION}/health`, null);\n// status check\nexpect(res.status).to.be.equal(200);\n// error check\nexpect(res.body.headers.error).to.be.equal(0);\n\n// params check\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys(\&quot;health\&quot;, \&quot;uptime\&quot;, \&quot;timestamp\&quot;);\n// health check\nexpect(resBody.health).to.be.equal(&#x27;OK&#x27;);\n// uptime check\nconst uptime = Number.parseFloat(resBody.uptime);\nexpect(uptime).to.be.gt(0);\n// timestamp check\nconst timestamp = new Date(now).toJSON();\nexpect(resBody.timestamp).to.be.equal(timestamp);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7b838f36-4aaf-417e-8c3e-7b6fc948d34f&quot;,&quot;parentUUID&quot;:&quot;16f9945b-6bf5-4b32-b410-0e401623fae4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7b838f36-4aaf-417e-8c3e-7b6fc948d34f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:8,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;540b3d3d-3495-47fc-934f-3840948899da&quot;,&quot;title&quot;:&quot;Hobbies API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Hobbies API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Hobbies API \&quot;before each\&quot; hook in \&quot;Hobbies API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;58bb326c-c9a8-452c-bdaf-e47dabfa98e1&quot;,&quot;parentUUID&quot;:&quot;540b3d3d-3495-47fc-934f-3840948899da&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7bc01ac4-4550-4e4a-bd47-7879aa82528b&quot;,&quot;title&quot;:&quot;GET /hobbies&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all hobbies request successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies Scenario 1: Get all hobbies request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;hobby_id&#x27;, &#x27;hobby&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;51bb9a7b-37e5-4271-9010-1d6aa4be2704&quot;,&quot;parentUUID&quot;:&quot;7bc01ac4-4550-4e4a-bd47-7879aa82528b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all hobbies request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies Scenario 2: Get all hobbies request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:507,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst HobbyModel = require(&#x27;../../src/models/hobby.model&#x27;);\nconst modelStub = sinon.stub(HobbyModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty hobby list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobbies not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fb2900f6-8774-4447-b086-3f98750a7b5b&quot;,&quot;parentUUID&quot;:&quot;7bc01ac4-4550-4e4a-bd47-7879aa82528b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;51bb9a7b-37e5-4271-9010-1d6aa4be2704&quot;,&quot;fb2900f6-8774-4447-b086-3f98750a7b5b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:512,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;88e9f940-0417-4756-920a-61504159cf09&quot;,&quot;title&quot;:&quot;GET /hobbies/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a hobby request successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies/:id Scenario 1: Get a hobby request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;hobby_id&#x27;, &#x27;hobby&#x27;]);\nexpect(resBody.hobby_id).to.be.eql(existingHobby.hobby_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f87527e0-660c-4b73-a19e-be675139a094&quot;,&quot;parentUUID&quot;:&quot;88e9f940-0417-4756-920a-61504159cf09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a hobby request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies/:id Scenario 2: Get a hobby request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownHobbyId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobby not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e42514b6-b3f5-420e-b61a-3012d8380e79&quot;,&quot;parentUUID&quot;:&quot;88e9f940-0417-4756-920a-61504159cf09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a hobby request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies/:id Scenario 3: Get a hobby request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingHobby.hobby_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;81d21312-3f33-459d-b1c7-dee23515c1ce&quot;,&quot;parentUUID&quot;:&quot;88e9f940-0417-4756-920a-61504159cf09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f87527e0-660c-4b73-a19e-be675139a094&quot;,&quot;e42514b6-b3f5-420e-b61a-3012d8380e79&quot;,&quot;81d21312-3f33-459d-b1c7-dee23515c1ce&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;29dcf6e5-c86a-4274-89e3-899b1c616d3a&quot;,&quot;title&quot;:&quot;POST /hobbies&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a hobby request is successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API POST /hobbies Scenario 1: Create a hobby request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;hobby_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.hobby_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    hobby_id: newId,\n    hobby: hobby\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a974af28-83a9-428d-a428-a4d36a53377e&quot;,&quot;parentUUID&quot;:&quot;29dcf6e5-c86a-4274-89e3-899b1c616d3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a hobby request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Hobbies API POST /hobbies Scenario 2: Create a hobby request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    hobbies: hobby // &lt;-- a valid parameter name should be &#x27;hobby&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;hobby&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;172cb0f2-6769-432d-bc84-951e382b4906&quot;,&quot;parentUUID&quot;:&quot;29dcf6e5-c86a-4274-89e3-899b1c616d3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a hobby request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hobbies API POST /hobbies Scenario 3: Create a hobby request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;40bd1214-2124-4679-9fe5-b21f9c49e2f7&quot;,&quot;parentUUID&quot;:&quot;29dcf6e5-c86a-4274-89e3-899b1c616d3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a hobby request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hobbies API POST /hobbies Scenario 4: Create a hobby request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0dfa4ac6-f22f-44ba-9da8-db88119ca1f7&quot;,&quot;parentUUID&quot;:&quot;29dcf6e5-c86a-4274-89e3-899b1c616d3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a974af28-83a9-428d-a428-a4d36a53377e&quot;,&quot;172cb0f2-6769-432d-bc84-951e382b4906&quot;,&quot;40bd1214-2124-4679-9fe5-b21f9c49e2f7&quot;,&quot;0dfa4ac6-f22f-44ba-9da8-db88119ca1f7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:66,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9a3b9d72-7758-46e9-a712-524855cef2bc&quot;,&quot;title&quot;:&quot;PATCH /hobbies/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a hobby request is successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 1: Update a hobby request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby: newHobby };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    hobby_id: existingHobby.hobby_id,\n    hobby: newHobby\n});\n\n// cleanup\ndata.hobby = existingHobby.hobby;\nres = await request(app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;584311e5-40fd-4f04-add8-82635e968ad2&quot;,&quot;parentUUID&quot;:&quot;9a3b9d72-7758-46e9-a712-524855cef2bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a hobby request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 2: Update a hobby request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby: newHobby };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownHobbyId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobby not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b1594f60-63bc-4e86-9a47-f6a02a971908&quot;,&quot;parentUUID&quot;:&quot;9a3b9d72-7758-46e9-a712-524855cef2bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a hobby request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 3: Update a hobby request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    hobbies: newHobby // &lt;-- a valid parameter name should be &#x27;hobby&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;hobby&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3620cae3-08cd-4299-9685-e884bf4e9da9&quot;,&quot;parentUUID&quot;:&quot;9a3b9d72-7758-46e9-a712-524855cef2bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a hobby request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 4: Update a hobby request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby: newHobby };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ec3662bc-43a9-4855-895c-38b8a1f3a970&quot;,&quot;parentUUID&quot;:&quot;9a3b9d72-7758-46e9-a712-524855cef2bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a hobby request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 5: Update a hobby request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby: newHobby };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;55a92063-781a-4ec3-a95b-96c9ee2187dc&quot;,&quot;parentUUID&quot;:&quot;9a3b9d72-7758-46e9-a712-524855cef2bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;584311e5-40fd-4f04-add8-82635e968ad2&quot;,&quot;b1594f60-63bc-4e86-9a47-f6a02a971908&quot;,&quot;3620cae3-08cd-4299-9685-e884bf4e9da9&quot;,&quot;ec3662bc-43a9-4855-895c-38b8a1f3a970&quot;,&quot;55a92063-781a-4ec3-a95b-96c9ee2187dc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:55,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a2c9792d-b331-48c4-b5d1-0628bc60e28e&quot;,&quot;title&quot;:&quot;DELETE /hobbies/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a hobby request is successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API DELETE /hobbies/:id Scenario 1: Delete a hobby request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { hobby };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.hobby_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobby has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4492ea63-bdd8-439c-818f-a8da5aaf25d3&quot;,&quot;parentUUID&quot;:&quot;a2c9792d-b331-48c4-b5d1-0628bc60e28e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a hobby request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API DELETE /hobbies/:id Scenario 2: Delete a hobby request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownHobbyId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobby not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;67a3a668-62be-4034-951e-baf8ed3b57a5&quot;,&quot;parentUUID&quot;:&quot;a2c9792d-b331-48c4-b5d1-0628bc60e28e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a hobby request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hobbies API DELETE /hobbies/:id Scenario 3: Delete a hobby request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;21eb35b3-22e0-4a66-8d69-94b7354866c7&quot;,&quot;parentUUID&quot;:&quot;a2c9792d-b331-48c4-b5d1-0628bc60e28e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a hobby request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hobbies API DELETE /hobbies/:id Scenario 4: Delete a hobby request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingHobby.hobby_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0e0438e1-540b-4826-b524-2627ecc1ebb3&quot;,&quot;parentUUID&quot;:&quot;a2c9792d-b331-48c4-b5d1-0628bc60e28e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4492ea63-bdd8-439c-818f-a8da5aaf25d3&quot;,&quot;67a3a668-62be-4034-951e-baf8ed3b57a5&quot;,&quot;21eb35b3-22e0-4a66-8d69-94b7354866c7&quot;,&quot;0e0438e1-540b-4826-b524-2627ecc1ebb3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:41,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9cc737bc-124a-470b-a600-46997903eb84&quot;,&quot;title&quot;:&quot;Interests API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Interests API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Interests API \&quot;before each\&quot; hook in \&quot;Interests API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f412620e-516c-4b0b-b892-577ea7e3eeb9&quot;,&quot;parentUUID&quot;:&quot;9cc737bc-124a-470b-a600-46997903eb84&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6bb2933a-f009-4490-893e-61e9bd98fef4&quot;,&quot;title&quot;:&quot;GET /interests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all interests request successful&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests Scenario 1: Get all interests request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;interest_id&#x27;, &#x27;interest&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0e84f00f-422b-4fbc-bdc4-c8a54c6099d5&quot;,&quot;parentUUID&quot;:&quot;6bb2933a-f009-4490-893e-61e9bd98fef4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all interests request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests Scenario 2: Get all interests request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:506,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst InterestModel = require(&#x27;../../src/models/interest.model&#x27;);\nconst modelStub = sinon.stub(InterestModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty interest list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interests not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a3fec0fa-3f03-4673-859b-4596f32ccadb&quot;,&quot;parentUUID&quot;:&quot;6bb2933a-f009-4490-893e-61e9bd98fef4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0e84f00f-422b-4fbc-bdc4-c8a54c6099d5&quot;,&quot;a3fec0fa-3f03-4673-859b-4596f32ccadb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:512,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;694fa8ff-d6df-4e00-97c7-24fbc6541963&quot;,&quot;title&quot;:&quot;GET /interests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a interest request successful&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests/:id Scenario 1: Get a interest request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;interest_id&#x27;, &#x27;interest&#x27;]);\nexpect(resBody.interest_id).to.be.eql(existingInterest.interest_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;87694562-758f-49bd-b81f-b476c795221b&quot;,&quot;parentUUID&quot;:&quot;694fa8ff-d6df-4e00-97c7-24fbc6541963&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a interest request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests/:id Scenario 2: Get a interest request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownInterestId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interest not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;51d605d2-fa61-4eb2-9408-fabe8f64545d&quot;,&quot;parentUUID&quot;:&quot;694fa8ff-d6df-4e00-97c7-24fbc6541963&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a interest request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests/:id Scenario 3: Get a interest request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingInterest.interest_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0eef8cb2-5416-4f33-8723-9e42a62bb5fa&quot;,&quot;parentUUID&quot;:&quot;694fa8ff-d6df-4e00-97c7-24fbc6541963&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;87694562-758f-49bd-b81f-b476c795221b&quot;,&quot;51d605d2-fa61-4eb2-9408-fabe8f64545d&quot;,&quot;0eef8cb2-5416-4f33-8723-9e42a62bb5fa&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:34,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a585e51c-aea5-49c5-ad59-2ba373a634a4&quot;,&quot;title&quot;:&quot;POST /interests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a interest request is successful&quot;,&quot;fullTitle&quot;:&quot;Interests API POST /interests Scenario 1: Create a interest request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;interest_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.interest_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    interest_id: newId,\n    interest: interest\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;013895f7-62f0-44dc-b19a-f6b621b7e530&quot;,&quot;parentUUID&quot;:&quot;a585e51c-aea5-49c5-ad59-2ba373a634a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a interest request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Interests API POST /interests Scenario 2: Create a interest request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    interests: interest // &lt;-- a valid parameter name should be &#x27;interest&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;interest&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dddcaf8b-0e43-4391-8c50-006c0bc98334&quot;,&quot;parentUUID&quot;:&quot;a585e51c-aea5-49c5-ad59-2ba373a634a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a interest request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Interests API POST /interests Scenario 3: Create a interest request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;84d9d073-b5be-4d25-b79f-deedd4bd0994&quot;,&quot;parentUUID&quot;:&quot;a585e51c-aea5-49c5-ad59-2ba373a634a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a interest request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Interests API POST /interests Scenario 4: Create a interest request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8e743b5d-a410-441c-8cb6-f03b63379193&quot;,&quot;parentUUID&quot;:&quot;a585e51c-aea5-49c5-ad59-2ba373a634a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;013895f7-62f0-44dc-b19a-f6b621b7e530&quot;,&quot;dddcaf8b-0e43-4391-8c50-006c0bc98334&quot;,&quot;84d9d073-b5be-4d25-b79f-deedd4bd0994&quot;,&quot;8e743b5d-a410-441c-8cb6-f03b63379193&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:81,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d316c68e-9a15-42c3-ab72-6e8be71b1273&quot;,&quot;title&quot;:&quot;PATCH /interests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a interest request is successful&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 1: Update a interest request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest: newInterest };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    interest_id: existingInterest.interest_id,\n    interest: newInterest\n});\n\n// cleanup\ndata.interest = existingInterest.interest;\nres = await request(app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7910fe44-20ea-4e20-9a28-c1a2bb41205f&quot;,&quot;parentUUID&quot;:&quot;d316c68e-9a15-42c3-ab72-6e8be71b1273&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a interest request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 2: Update a interest request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest: newInterest };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownInterestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interest not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;262eed24-bb48-4a1e-b76e-b0aefb134e56&quot;,&quot;parentUUID&quot;:&quot;d316c68e-9a15-42c3-ab72-6e8be71b1273&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a interest request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 3: Update a interest request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    interests: newInterest // &lt;-- a valid parameter name should be &#x27;interest&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;interest&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;95bb97d5-ffd8-48f7-8d98-ae62a9cf2c21&quot;,&quot;parentUUID&quot;:&quot;d316c68e-9a15-42c3-ab72-6e8be71b1273&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a interest request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 4: Update a interest request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest: newInterest };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c5907df6-641b-4118-99ec-91062450cf63&quot;,&quot;parentUUID&quot;:&quot;d316c68e-9a15-42c3-ab72-6e8be71b1273&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a interest request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 5: Update a interest request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest: newInterest };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e9b9db86-eecd-46bb-a036-626ec11c0272&quot;,&quot;parentUUID&quot;:&quot;d316c68e-9a15-42c3-ab72-6e8be71b1273&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7910fe44-20ea-4e20-9a28-c1a2bb41205f&quot;,&quot;262eed24-bb48-4a1e-b76e-b0aefb134e56&quot;,&quot;95bb97d5-ffd8-48f7-8d98-ae62a9cf2c21&quot;,&quot;c5907df6-641b-4118-99ec-91062450cf63&quot;,&quot;e9b9db86-eecd-46bb-a036-626ec11c0272&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:38,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;174b2016-6fc3-4a84-9ac2-24f672e0bd2c&quot;,&quot;title&quot;:&quot;DELETE /interests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a interest request is successful&quot;,&quot;fullTitle&quot;:&quot;Interests API DELETE /interests/:id Scenario 1: Delete a interest request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { interest };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.interest_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interest has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b2428f88-657d-4c90-88df-26990c10236b&quot;,&quot;parentUUID&quot;:&quot;174b2016-6fc3-4a84-9ac2-24f672e0bd2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a interest request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Interests API DELETE /interests/:id Scenario 2: Delete a interest request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownInterestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interest not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8ec1c888-15cc-4673-bc71-41fe6c110f08&quot;,&quot;parentUUID&quot;:&quot;174b2016-6fc3-4a84-9ac2-24f672e0bd2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a interest request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Interests API DELETE /interests/:id Scenario 3: Delete a interest request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;91556fa1-8252-40fa-9f78-afa4f9abf5cd&quot;,&quot;parentUUID&quot;:&quot;174b2016-6fc3-4a84-9ac2-24f672e0bd2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a interest request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Interests API DELETE /interests/:id Scenario 4: Delete a interest request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingInterest.interest_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e4adc04e-32a4-4629-a1fd-601060f40edd&quot;,&quot;parentUUID&quot;:&quot;174b2016-6fc3-4a84-9ac2-24f672e0bd2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b2428f88-657d-4c90-88df-26990c10236b&quot;,&quot;8ec1c888-15cc-4673-bc71-41fe6c110f08&quot;,&quot;91556fa1-8252-40fa-9f78-afa4f9abf5cd&quot;,&quot;e4adc04e-32a4-4629-a1fd-601060f40edd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:29,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;488c9618-f00b-4ab4-9adc-d020bf9bbad7&quot;,&quot;title&quot;:&quot;Posts API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Posts API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Posts API \&quot;before each\&quot; hook in \&quot;Posts API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dc618fb9-4632-4689-9c24-216c92349e8a&quot;,&quot;parentUUID&quot;:&quot;488c9618-f00b-4ab4-9adc-d020bf9bbad7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f76b94c2-6af2-4c22-b8a4-22043e10515b&quot;,&quot;title&quot;:&quot;GET /posts&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all posts request successful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 1: Get all posts request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingPost)); // contain all params\nconst examplePost = resBody[0];\nexpect(examplePost.author).to.include.all.keys(Object.keys(existingPost.author));\nexpect(examplePost.resources).to.be.an(&#x27;array&#x27;);\nexpect(examplePost.resources[0]).to.include.all.keys(Object.keys(existingPost.resources[0])); // contain all params\n\nexpect(examplePost.top_3_reactions).to.be.an(&#x27;array&#x27;);\nexpect(examplePost.top_3_reactions[0]).to.include.all.keys(Object.keys(existingPost.top_3_reactions[0])); // contain all params\n        \nconst noReactionOrResourceCheck = post =&gt; post.resources === null &amp;&amp; post.top_3_reactions === null;\nexpect(resBody.some(noReactionOrResourceCheck)).to.be.true; // match atleast one post like this&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c34c1eb0-af7f-470c-ab6a-1712093c0680&quot;,&quot;parentUUID&quot;:&quot;f76b94c2-6af2-4c22-b8a4-22043e10515b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all posts request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 2: Get all posts request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst author_erp = userERP;\nlet res = await request(this.app)\n    .get(`${baseRoute}?author_erp=${author_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].author).to.include.all.keys(Object.keys(existingPost.author));\nexpect(resBody[0].author.erp).to.be.equal(author_erp);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8b7c7416-aa33-4673-89f3-9bb798ed5ab9&quot;,&quot;parentUUID&quot;:&quot;f76b94c2-6af2-4c22-b8a4-22043e10515b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all posts request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 3: Get all posts request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:541,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst PostModel = require(&#x27;../../src/models/post.model&#x27;);\nconst modelStub = sinon.stub(PostModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty post list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4da76f9b-453e-4924-b8b8-8cc7b5df20dc&quot;,&quot;parentUUID&quot;:&quot;f76b94c2-6af2-4c22-b8a4-22043e10515b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all posts request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 4: Get all posts request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;all&#x27;; // &lt;-- invalid privacy value\nlet res = await request(this.app)\n    .get(`${baseRoute}?privacy=${privacy}&amp;week=2`) // &lt;-- `week` is an incorrect query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;privacy&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;629204f2-db04-4cca-860a-5364c4c7a72f&quot;,&quot;parentUUID&quot;:&quot;f76b94c2-6af2-4c22-b8a4-22043e10515b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all posts request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 5: Get all posts request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3e515d10-2695-49c9-bc9f-76cf78261b4b&quot;,&quot;parentUUID&quot;:&quot;f76b94c2-6af2-4c22-b8a4-22043e10515b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c34c1eb0-af7f-470c-ab6a-1712093c0680&quot;,&quot;8b7c7416-aa33-4673-89f3-9bb798ed5ab9&quot;,&quot;4da76f9b-453e-4924-b8b8-8cc7b5df20dc&quot;,&quot;629204f2-db04-4cca-860a-5364c4c7a72f&quot;,&quot;3e515d10-2695-49c9-bc9f-76cf78261b4b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:584,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;45b29abd-fa11-4788-8633-47db0a98e1f2&quot;,&quot;title&quot;:&quot;GET /posts/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a post request successful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id Scenario 1: Get a post request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingPost.post_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.post_id).to.be.equal(existingPost.post_id); // should match initially sent id\nexpect(resBody).to.include.all.keys(Object.keys(existingPost)); // contain all params\nexpect(resBody.author).to.include.all.keys(Object.keys(existingPost.author));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8b3f292a-9c44-4854-b3a8-a3d59c504de9&quot;,&quot;parentUUID&quot;:&quot;45b29abd-fa11-4788-8633-47db0a98e1f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a post request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id Scenario 2: Get a post request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownPostId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d8b04f52-8e40-4316-9312-03004deda36c&quot;,&quot;parentUUID&quot;:&quot;45b29abd-fa11-4788-8633-47db0a98e1f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a post request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id Scenario 3: Get a post request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingPost.post_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;73b90c2c-ebe4-409c-a056-046c09f45ed9&quot;,&quot;parentUUID&quot;:&quot;45b29abd-fa11-4788-8633-47db0a98e1f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8b3f292a-9c44-4854-b3a8-a3d59c504de9&quot;,&quot;d8b04f52-8e40-4316-9312-03004deda36c&quot;,&quot;73b90c2c-ebe4-409c-a056-046c09f45ed9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;cdc2bf66-8687-4c64-9f0e-307b99842611&quot;,&quot;title&quot;:&quot;GET /posts/:id/reactions&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a post&#x27;s reactions request successful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id/reactions Scenario 1: Get a post&#x27;s reactions request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingPost.post_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys([&#x27;post_id&#x27;, &#x27;reaction_type_id&#x27;, &#x27;student_erp&#x27;, &#x27;reacted_at&#x27;]);\nexpect(resBody[0].post_id).to.be.equal(existingPost.post_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;def6b394-f6b7-411a-b190-d3ec77d58e77&quot;,&quot;parentUUID&quot;:&quot;cdc2bf66-8687-4c64-9f0e-307b99842611&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a post&#x27;s reactions request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id/reactions Scenario 2: Get a post&#x27;s reactions request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownPostId}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ff4cc0ab-3f58-49fd-a048-b9c034d034cb&quot;,&quot;parentUUID&quot;:&quot;cdc2bf66-8687-4c64-9f0e-307b99842611&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a post&#x27;s reactions request is unsuccessful due to zero reactions&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id/reactions Scenario 3: Get a post&#x27;s reactions request is unsuccessful due to zero reactions&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:553,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst PostModel = require(&#x27;../../src/models/post.model&#x27;);\nconst modelStub = sinon.stub(PostModel, &#x27;findAllReactionsByPost&#x27;).callsFake(() =&gt; []); // return empty post reactions list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingPost.post_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;472ac5b1-037c-48c3-b0fc-93e66fb1af9e&quot;,&quot;parentUUID&quot;:&quot;cdc2bf66-8687-4c64-9f0e-307b99842611&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a post&#x27;s reactions is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id/reactions Scenario 4: Get a post&#x27;s reactions is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingPost.post_id}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7438b0d5-5d9f-4d4d-ae79-36fbf69e3ebe&quot;,&quot;parentUUID&quot;:&quot;cdc2bf66-8687-4c64-9f0e-307b99842611&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;def6b394-f6b7-411a-b190-d3ec77d58e77&quot;,&quot;ff4cc0ab-3f58-49fd-a048-b9c034d034cb&quot;,&quot;472ac5b1-037c-48c3-b0fc-93e66fb1af9e&quot;,&quot;7438b0d5-5d9f-4d4d-ae79-36fbf69e3ebe&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:578,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a2cc1f0c-9f8a-4c27-ba95-e2125874311d&quot;,&quot;title&quot;:&quot;POST /posts&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a post request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Posts API POST /posts Scenario 1: Create a post request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:81,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newPost.author_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;post_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// affirm\nconst newId = res.body.body.post_id;\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nconst resBody = res.body.body;\nresBody.resources = resBody.resources.map(resource =&gt; (\n    {\n        resource_url: resource.resource_url,\n        resource_type: resource.resource_type\n    }\n));\nexpect(resBody.author.erp).to.be.equal(data.author_erp);\ndelete resBody.author;\ndelete data.author_erp;\nexpect(resBody).to.be.eql({\n    post_id: newId,\n    top_3_reactions: null,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;849dc21b-e37b-486e-a5ca-6a0dd7fc3a64&quot;,&quot;parentUUID&quot;:&quot;a2cc1f0c-9f8a-4c27-ba95-e2125874311d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a post request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Posts API POST /posts Scenario 2: Create a post request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst {resources, ...post} = newPost;\nconst data = {\n    ...post,\n    resourcessfd: resources // &lt;-- a valid param is &#x27;resources&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newPost.author_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;resources&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6e66ec7c-062e-4e03-a6ab-09e34fc47603&quot;,&quot;parentUUID&quot;:&quot;a2cc1f0c-9f8a-4c27-ba95-e2125874311d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a post request is forbidden (Unowned Author ERP)&quot;,&quot;fullTitle&quot;:&quot;Posts API POST /posts Scenario 3: Create a post request is forbidden (Unowned Author ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\ndata.author_erp = adminERP; // &lt;-- can be any other non-admin ERP as well, just different from userToken erp\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t create others posts i.e. token erp != newPost.author_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e29edaab-e362-4241-a04f-21dccd19c2a1&quot;,&quot;parentUUID&quot;:&quot;a2cc1f0c-9f8a-4c27-ba95-e2125874311d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a post request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API POST /posts Scenario 4: Create a post request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dc249b38-364c-4604-80b7-55638b3c6d42&quot;,&quot;parentUUID&quot;:&quot;a2cc1f0c-9f8a-4c27-ba95-e2125874311d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;849dc21b-e37b-486e-a5ca-6a0dd7fc3a64&quot;,&quot;6e66ec7c-062e-4e03-a6ab-09e34fc47603&quot;,&quot;e29edaab-e362-4241-a04f-21dccd19c2a1&quot;,&quot;dc249b38-364c-4604-80b7-55638b3c6d42&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:104,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f27c47eb-1d42-445a-93ac-af5f81822240&quot;,&quot;title&quot;:&quot;PATCH /posts/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a post request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 1: Update a post request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { body: updatedPostBody };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingPost.post_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingPost.author_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingPost.post_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.body).to.be.equal(updatedPostBody);\n\n// cleanup\ndata.body = existingPost.body;\nres = await request(app)\n    .patch(`${baseRoute}/${existingPost.post_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7f024eca-fa8d-4c46-a02e-b30d0e91455c&quot;,&quot;parentUUID&quot;:&quot;f27c47eb-1d42-445a-93ac-af5f81822240&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a post request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 2: Update a post request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { body: updatedPostBody };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownPostId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;83e8181e-6e75-4490-85c3-16d631c1f976&quot;,&quot;parentUUID&quot;:&quot;f27c47eb-1d42-445a-93ac-af5f81822240&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a post request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 3: Update a post request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    bodysds: updatedPostBody, // &lt;-- an valid parameter name should be &#x27;body&#x27;\n    privacy: \&quot;all\&quot; // &lt;-- an invalid &#x27;privacy&#x27; value\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingPost.post_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;privacy&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d0a58359-2c7d-4f1b-a450-9b516bcdbaca&quot;,&quot;parentUUID&quot;:&quot;f27c47eb-1d42-445a-93ac-af5f81822240&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a post request is forbidden (Unowned Author ERP)&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 4: Update a post request is forbidden (Unowned Author ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { body: updatedPostBody };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedPostId}`) // &lt;-- has a different author_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others posts i.e. token erp != unOwnedPost.author_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3711789d-5884-41d6-89ec-7400ebefa169&quot;,&quot;parentUUID&quot;:&quot;f27c47eb-1d42-445a-93ac-af5f81822240&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a post request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 5: Update a post request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { body: updatedPostBody };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingPost.post_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c00ad578-e3c6-42c3-8597-47d9a5a5a758&quot;,&quot;parentUUID&quot;:&quot;f27c47eb-1d42-445a-93ac-af5f81822240&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7f024eca-fa8d-4c46-a02e-b30d0e91455c&quot;,&quot;83e8181e-6e75-4490-85c3-16d631c1f976&quot;,&quot;d0a58359-2c7d-4f1b-a450-9b516bcdbaca&quot;,&quot;3711789d-5884-41d6-89ec-7400ebefa169&quot;,&quot;c00ad578-e3c6-42c3-8597-47d9a5a5a758&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:68,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d0536c84-ae0e-45ae-a24e-3fc9e4f8a702&quot;,&quot;title&quot;:&quot;DELETE /posts/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a post request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 1: Delete a post request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.post_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // using his own token i.e. token erp == newPost.author_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;582ed0ac-235e-4e64-82c4-e24331d29180&quot;,&quot;parentUUID&quot;:&quot;d0536c84-ae0e-45ae-a24e-3fc9e4f8a702&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a post request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 2: Delete a post request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.post_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // admin can delete other&#x27;s posts even if token erp != newPost.author_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9a7a989e-dbcf-4b71-867d-d5a94f4e07e0&quot;,&quot;parentUUID&quot;:&quot;d0536c84-ae0e-45ae-a24e-3fc9e4f8a702&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a post request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 3: Delete a post request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownPostId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c4cc714a-9c64-44a6-8b95-a9db71089bcb&quot;,&quot;parentUUID&quot;:&quot;d0536c84-ae0e-45ae-a24e-3fc9e4f8a702&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a post request is forbidden (Unowned Author ERP)&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 4: Delete a post request is forbidden (Unowned Author ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unOwnedPostId}`) // &lt;-- has a different author_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user can&#x27;t delete others posts i.e. token erp != unOwnedPost.author_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9daceef8-ff47-4166-a64d-7bc728d2f286&quot;,&quot;parentUUID&quot;:&quot;d0536c84-ae0e-45ae-a24e-3fc9e4f8a702&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a post request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 5: Delete a post request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingPost.post_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d5167b36-a12b-4099-8769-c1d2a9cf92b2&quot;,&quot;parentUUID&quot;:&quot;d0536c84-ae0e-45ae-a24e-3fc9e4f8a702&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;582ed0ac-235e-4e64-82c4-e24331d29180&quot;,&quot;9a7a989e-dbcf-4b71-867d-d5a94f4e07e0&quot;,&quot;c4cc714a-9c64-44a6-8b95-a9db71089bcb&quot;,&quot;9daceef8-ff47-4166-a64d-7bc728d2f286&quot;,&quot;d5167b36-a12b-4099-8769-c1d2a9cf92b2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:67,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;be3f98a0-9bec-48d3-acd5-6f69d2031933&quot;,&quot;title&quot;:&quot;Post Reactions API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\postReaction.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\postReaction.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Post Reactions API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API \&quot;before each\&quot; hook in \&quot;Post Reactions API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9038d137-873d-4456-b912-5432e161c0a1&quot;,&quot;parentUUID&quot;:&quot;be3f98a0-9bec-48d3-acd5-6f69d2031933&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b413c9df-8a2a-44c7-be68-57b7df966337&quot;,&quot;title&quot;:&quot;POST /posts/:id/reactions&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\postReaction.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\postReaction.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a post reaction request is successful&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 1: Create a post reaction request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkStudentERP = reaction =&gt; reaction.student_erp === data.student_erp;\nexpect(res.body.body.some(checkStudentERP)).to.be.true;\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ba989ae2-c124-4cd7-b740-948afbabc4b3&quot;,&quot;parentUUID&quot;:&quot;b413c9df-8a2a-44c7-be68-57b7df966337&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a post reaction request is unsuccessful due to unknown post id&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 2: Create a post reaction request is unsuccessful due to unknown post id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${unknownPostId}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;post_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;92f2754e-e96e-44c9-aa8a-fe0c58193670&quot;,&quot;parentUUID&quot;:&quot;b413c9df-8a2a-44c7-be68-57b7df966337&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a post reaction request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 3: Create a post reaction request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\ndata.reaction_type_id = &#x27;not going&#x27;; // &lt;-- not a valid reaction_type_id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;reaction_type_id&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;51e91b86-dddf-4f4d-a383-d07f46a21de9&quot;,&quot;parentUUID&quot;:&quot;b413c9df-8a2a-44c7-be68-57b7df966337&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a post reaction request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 4: Create a post reaction request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\ndata.student_erp = adminERP; // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d5a0631e-29b3-4cd1-b172-e4a86a16f78e&quot;,&quot;parentUUID&quot;:&quot;b413c9df-8a2a-44c7-be68-57b7df966337&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a post reaction request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 5: Create a post reaction request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;edbb8afc-021a-49b6-aa62-69c25be6b900&quot;,&quot;parentUUID&quot;:&quot;b413c9df-8a2a-44c7-be68-57b7df966337&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ba989ae2-c124-4cd7-b740-948afbabc4b3&quot;,&quot;92f2754e-e96e-44c9-aa8a-fe0c58193670&quot;,&quot;51e91b86-dddf-4f4d-a383-d07f46a21de9&quot;,&quot;d5a0631e-29b3-4cd1-b172-e4a86a16f78e&quot;,&quot;edbb8afc-021a-49b6-aa62-69c25be6b900&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:51,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;dd4c60cf-64cf-4608-b879-597bbbdb98ec&quot;,&quot;title&quot;:&quot;PATCH /posts/:id/reactions/:student_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\postReaction.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\postReaction.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a post reaction request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 1: Update a post reaction request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type_id, reacted_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- userToken.erp == student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${post_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkStudentERP = reaction =&gt; reaction.student_erp === student_erp;\nconst reaction = res.body.body.filter(checkStudentERP)[0];\nexpect(reaction).to.be.eql({\n    post_id,\n    student_erp,\n    ...data\n});\n// cleanup\ndata.reaction_type_id = existingPostReaction.reaction_type_id;\ndata.reacted_at = existingPostReaction.reacted_at;\nres = await request(app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4484ff74-5bb0-4df9-9187-18c96b779ae7&quot;,&quot;parentUUID&quot;:&quot;dd4c60cf-64cf-4608-b879-597bbbdb98ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a post reaction request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 2: Update a post reaction request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type_id, reacted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownPostId}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a12ae1cd-8a83-4e9d-87bf-2f5ff7d0634f&quot;,&quot;parentUUID&quot;:&quot;dd4c60cf-64cf-4608-b879-597bbbdb98ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a post reaction request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 3: Update a post reaction request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { // missing reqd parameter reacted_at\n    reaction_type_id: &#x27;not going&#x27;, // &lt;-- not a valid reaction_type_id\n    erp: &#x27;12345&#x27; // &lt;-- an invalid update parameter i.e. not allowed\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;reaction_type_id&#x27;, &#x27;reacted_at&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include.members([&#x27;Invalid updates!&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;24c737ba-7f0e-43dd-9b6b-2702ce3b9e42&quot;,&quot;parentUUID&quot;:&quot;dd4c60cf-64cf-4608-b879-597bbbdb98ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a post reaction request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 4: Update a post reaction request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type_id, reacted_at };\nconst user2ERP = &#x27;17619&#x27;;\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${user2ERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user2ERP != userToken.erp, can be any other different erp as well\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;72991cd1-0901-48e0-a8a1-045e2b94b9d6&quot;,&quot;parentUUID&quot;:&quot;dd4c60cf-64cf-4608-b879-597bbbdb98ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a post reaction request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 5: Update a post reaction request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type_id, reacted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${student_erp}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b8a4d03e-3840-4544-8f32-9d57d7199c18&quot;,&quot;parentUUID&quot;:&quot;dd4c60cf-64cf-4608-b879-597bbbdb98ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4484ff74-5bb0-4df9-9187-18c96b779ae7&quot;,&quot;a12ae1cd-8a83-4e9d-87bf-2f5ff7d0634f&quot;,&quot;24c737ba-7f0e-43dd-9b6b-2702ce3b9e42&quot;,&quot;72991cd1-0901-48e0-a8a1-045e2b94b9d6&quot;,&quot;b8a4d03e-3840-4544-8f32-9d57d7199c18&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:48,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d065572c-3842-489d-a60d-32006fa4510e&quot;,&quot;title&quot;:&quot;DELETE /posts/:id/reactions/:student_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\postReaction.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\postReaction.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a post reaction request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 1: Delete a post reaction request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { ...newPostReaction };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp == data.student_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b742db0e-6cc2-4c7e-8699-84b8dfccc2e0&quot;,&quot;parentUUID&quot;:&quot;d065572c-3842-489d-a60d-32006fa4510e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a post reaction request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 2: Delete a post reaction request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { ...newPostReaction };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp != data.student_erp but still bypass\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;67941060-1efc-45f2-8fff-7f3a77fca2ac&quot;,&quot;parentUUID&quot;:&quot;d065572c-3842-489d-a60d-32006fa4510e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a post reaction request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 3: Delete a post reaction request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownPostId}/${subRoute}/${newPostReaction.student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2fb16d7d-d452-4abc-9b02-3398c59d1e3d&quot;,&quot;parentUUID&quot;:&quot;d065572c-3842-489d-a60d-32006fa4510e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a post reaction request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 4: Delete a post reaction request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingPostReaction.post_id}/${subRoute}/${unknownStudentERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cae85396-0d98-4a8c-b1ed-e886f50e6a46&quot;,&quot;parentUUID&quot;:&quot;d065572c-3842-489d-a60d-32006fa4510e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a post reaction request is forbidden (Unowned Post Reaction)&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 5: Delete a post reaction request is forbidden (Unowned Post Reaction)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst user2ERP = &#x27;17619&#x27;;\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingPostReaction.post_id}/${subRoute}/${user2ERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user2ERP != userToken.erp, can be any other different erp as well\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d61eaaa6-fbd4-4133-8959-0efde950222e&quot;,&quot;parentUUID&quot;:&quot;d065572c-3842-489d-a60d-32006fa4510e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Delete a post reaction request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 6: Delete a post reaction request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingPostReaction.post_id}/${subRoute}/${existingPostReaction.student_erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;798802a4-cbc1-4675-8329-5ebc61d6688b&quot;,&quot;parentUUID&quot;:&quot;d065572c-3842-489d-a60d-32006fa4510e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b742db0e-6cc2-4c7e-8699-84b8dfccc2e0&quot;,&quot;67941060-1efc-45f2-8fff-7f3a77fca2ac&quot;,&quot;2fb16d7d-d452-4abc-9b02-3398c59d1e3d&quot;,&quot;cae85396-0d98-4a8c-b1ed-e886f50e6a46&quot;,&quot;d61eaaa6-fbd4-4133-8959-0efde950222e&quot;,&quot;798802a4-cbc1-4675-8329-5ebc61d6688b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:79,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7e1355c9-72da-4e49-a14e-aaa0c22a8741&quot;,&quot;title&quot;:&quot;Programs API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Programs API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Programs API \&quot;before each\&quot; hook in \&quot;Programs API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e8312530-11eb-4a8b-b226-139d4f2f43c6&quot;,&quot;parentUUID&quot;:&quot;7e1355c9-72da-4e49-a14e-aaa0c22a8741&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;421ab8c4-a1bd-47cb-bb93-d968e3bd4d63&quot;,&quot;title&quot;:&quot;GET /programs&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all programs request successful&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs Scenario 1: Get all programs request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;program_id&#x27;, &#x27;program&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d7896153-1891-445a-ba5c-b007646bfdee&quot;,&quot;parentUUID&quot;:&quot;421ab8c4-a1bd-47cb-bb93-d968e3bd4d63&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all programs request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs Scenario 2: Get all programs request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:558,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ProgramModel = require(&#x27;../../src/models/program.model&#x27;);\nconst modelStub = sinon.stub(ProgramModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty program list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Programs not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c3a0092e-766e-4132-9e29-f562c8d23178&quot;,&quot;parentUUID&quot;:&quot;421ab8c4-a1bd-47cb-bb93-d968e3bd4d63&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d7896153-1891-445a-ba5c-b007646bfdee&quot;,&quot;c3a0092e-766e-4132-9e29-f562c8d23178&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:563,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b1bdf914-b6c2-4e24-a2fd-cc70f48a1c55&quot;,&quot;title&quot;:&quot;GET /programs/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a program request successful&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs/:id Scenario 1: Get a program request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;program_id&#x27;, &#x27;program&#x27;]);\nexpect(resBody.program_id).to.be.eql(existingProgram.program_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;943788cf-f895-4876-b0e3-5da63458487b&quot;,&quot;parentUUID&quot;:&quot;b1bdf914-b6c2-4e24-a2fd-cc70f48a1c55&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a program request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs/:id Scenario 2: Get a program request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownProgramId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Program not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;61d4442f-74bf-4fe1-b980-3221edfae6f6&quot;,&quot;parentUUID&quot;:&quot;b1bdf914-b6c2-4e24-a2fd-cc70f48a1c55&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a program request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs/:id Scenario 3: Get a program request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingProgram.program_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;eef75d17-63c7-4338-a7fe-15e551a7c7c2&quot;,&quot;parentUUID&quot;:&quot;b1bdf914-b6c2-4e24-a2fd-cc70f48a1c55&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;943788cf-f895-4876-b0e3-5da63458487b&quot;,&quot;61d4442f-74bf-4fe1-b980-3221edfae6f6&quot;,&quot;eef75d17-63c7-4338-a7fe-15e551a7c7c2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:25,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f36dd489-98c3-4836-9262-b53e4aedfdb7&quot;,&quot;title&quot;:&quot;POST /programs&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a program request is successful&quot;,&quot;fullTitle&quot;:&quot;Programs API POST /programs Scenario 1: Create a program request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;program_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.program_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    program_id: newId,\n    program: program\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;93a2a02b-8efd-4912-9caa-190bf3e9dd4e&quot;,&quot;parentUUID&quot;:&quot;f36dd489-98c3-4836-9262-b53e4aedfdb7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a program request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Programs API POST /programs Scenario 2: Create a program request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    programs: program // &lt;-- a valid parameter name should be &#x27;program&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;program&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e6b4af68-5e07-4387-b004-39f7c4dcafa4&quot;,&quot;parentUUID&quot;:&quot;f36dd489-98c3-4836-9262-b53e4aedfdb7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a program request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Programs API POST /programs Scenario 3: Create a program request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;018ba9f5-7481-4094-b238-3aa92f59ee8a&quot;,&quot;parentUUID&quot;:&quot;f36dd489-98c3-4836-9262-b53e4aedfdb7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a program request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Programs API POST /programs Scenario 4: Create a program request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0d560241-caad-4a38-8c41-53e59ff4ef3d&quot;,&quot;parentUUID&quot;:&quot;f36dd489-98c3-4836-9262-b53e4aedfdb7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;93a2a02b-8efd-4912-9caa-190bf3e9dd4e&quot;,&quot;e6b4af68-5e07-4387-b004-39f7c4dcafa4&quot;,&quot;018ba9f5-7481-4094-b238-3aa92f59ee8a&quot;,&quot;0d560241-caad-4a38-8c41-53e59ff4ef3d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:66,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;bcd6ff6b-02f7-439f-8c0b-4f49d12538e5&quot;,&quot;title&quot;:&quot;PATCH /programs/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a program request is successful&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 1: Update a program request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program: newProgram };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    program_id: existingProgram.program_id,\n    program: newProgram\n});\n\n// cleanup\ndata.program = existingProgram.program;\nres = await request(app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b3bdada1-c989-4050-bd5b-46913026ce28&quot;,&quot;parentUUID&quot;:&quot;bcd6ff6b-02f7-439f-8c0b-4f49d12538e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a program request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 2: Update a program request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program: newProgram };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownProgramId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Program not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0f20ed78-e9ab-45cf-bcb8-861d8df3cfc0&quot;,&quot;parentUUID&quot;:&quot;bcd6ff6b-02f7-439f-8c0b-4f49d12538e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a program request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 3: Update a program request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    programs: newProgram // &lt;-- a valid parameter name should be &#x27;program&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;program&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;add4011c-2df0-4987-a591-e536fddd3f25&quot;,&quot;parentUUID&quot;:&quot;bcd6ff6b-02f7-439f-8c0b-4f49d12538e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a program request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 4: Update a program request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program: newProgram };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ffb30ef7-29e9-4ab1-b737-14ab0b602810&quot;,&quot;parentUUID&quot;:&quot;bcd6ff6b-02f7-439f-8c0b-4f49d12538e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a program request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 5: Update a program request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program: newProgram };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b2014baa-21fd-4552-9d70-d28d54a9cdf0&quot;,&quot;parentUUID&quot;:&quot;bcd6ff6b-02f7-439f-8c0b-4f49d12538e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b3bdada1-c989-4050-bd5b-46913026ce28&quot;,&quot;0f20ed78-e9ab-45cf-bcb8-861d8df3cfc0&quot;,&quot;add4011c-2df0-4987-a591-e536fddd3f25&quot;,&quot;ffb30ef7-29e9-4ab1-b737-14ab0b602810&quot;,&quot;b2014baa-21fd-4552-9d70-d28d54a9cdf0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:57,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;be79b5c0-d905-4899-9905-fac39c86fc11&quot;,&quot;title&quot;:&quot;DELETE /programs/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a program request is successful&quot;,&quot;fullTitle&quot;:&quot;Programs API DELETE /programs/:id Scenario 1: Delete a program request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { program };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.program_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Program has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c7f4ea9e-cea5-4df3-b28d-ca7331382257&quot;,&quot;parentUUID&quot;:&quot;be79b5c0-d905-4899-9905-fac39c86fc11&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a program request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Programs API DELETE /programs/:id Scenario 2: Delete a program request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownProgramId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Program not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1226ce10-b8c0-42ca-8839-3b78cbab99f9&quot;,&quot;parentUUID&quot;:&quot;be79b5c0-d905-4899-9905-fac39c86fc11&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a program request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Programs API DELETE /programs/:id Scenario 3: Delete a program request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7fb7de07-f0b4-4996-90f3-344cbec19a23&quot;,&quot;parentUUID&quot;:&quot;be79b5c0-d905-4899-9905-fac39c86fc11&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a program request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Programs API DELETE /programs/:id Scenario 4: Delete a program request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingProgram.program_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;82229aa4-37b9-4217-9f0b-3b929cb3675a&quot;,&quot;parentUUID&quot;:&quot;be79b5c0-d905-4899-9905-fac39c86fc11&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c7f4ea9e-cea5-4df3-b28d-ca7331382257&quot;,&quot;1226ce10-b8c0-42ca-8839-3b78cbab99f9&quot;,&quot;7fb7de07-f0b4-4996-90f3-344cbec19a23&quot;,&quot;82229aa4-37b9-4217-9f0b-3b929cb3675a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:35,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0ba92f4a-180d-47fa-8968-506b9c4e1851&quot;,&quot;title&quot;:&quot;Reaction Types API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Reaction Types API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API \&quot;before each\&quot; hook in \&quot;Reaction Types API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a6280fa3-6448-40c4-bcfe-137e020e75d1&quot;,&quot;parentUUID&quot;:&quot;0ba92f4a-180d-47fa-8968-506b9c4e1851&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e45754b2-3f71-4f14-881f-18f3ad9275ea&quot;,&quot;title&quot;:&quot;GET /reaction-types&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all reaction types request successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types Scenario 1: Get all reaction types request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys([&#x27;reaction_type_id&#x27;, &#x27;reaction_type&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;87f651e8-c0bc-4327-a764-4d8eda09b262&quot;,&quot;parentUUID&quot;:&quot;e45754b2-3f71-4f14-881f-18f3ad9275ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all reaction types request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types Scenario 2: Get all reaction types request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:544,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ReactionTypeModel = require(&#x27;../../src/models/reactionType.model&#x27;);\nconst modelStub = sinon.stub(ReactionTypeModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty reaction_type list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction types not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d7ff28e6-0b02-432c-8326-65921b9bfb69&quot;,&quot;parentUUID&quot;:&quot;e45754b2-3f71-4f14-881f-18f3ad9275ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;87f651e8-c0bc-4327-a764-4d8eda09b262&quot;,&quot;d7ff28e6-0b02-432c-8326-65921b9bfb69&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:550,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d6b32062-bcaf-40ca-b188-42d58a146c1c&quot;,&quot;title&quot;:&quot;GET /reaction-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a reaction type request successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types/:id Scenario 1: Get a reaction type request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys([&#x27;reaction_type_id&#x27;, &#x27;reaction_type&#x27;]);\nexpect(resBody.reaction_type_id).to.be.equal(existingReactionType.reaction_type_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e13b6d92-1989-4a34-9b1b-1fb76a191e48&quot;,&quot;parentUUID&quot;:&quot;d6b32062-bcaf-40ca-b188-42d58a146c1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a reaction type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types/:id Scenario 2: Get a reaction type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownReactionTypeId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction type not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9a7df58a-44a4-47bc-bb1d-875f9f3c1d5d&quot;,&quot;parentUUID&quot;:&quot;d6b32062-bcaf-40ca-b188-42d58a146c1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a reaction type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types/:id Scenario 3: Get a reaction type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingReactionType.reaction_type_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3820fdcf-9a48-41c7-a368-97ed7bf93954&quot;,&quot;parentUUID&quot;:&quot;d6b32062-bcaf-40ca-b188-42d58a146c1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e13b6d92-1989-4a34-9b1b-1fb76a191e48&quot;,&quot;9a7df58a-44a4-47bc-bb1d-875f9f3c1d5d&quot;,&quot;3820fdcf-9a48-41c7-a368-97ed7bf93954&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6c0662fa-20da-4073-908a-759f9f5f1bef&quot;,&quot;title&quot;:&quot;POST /reaction-types&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a reaction type request is successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API POST /reaction-types Scenario 1: Create a reaction type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;reaction_type_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.reaction_type_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    reaction_type_id: newId,\n    reaction_type: reaction_type\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;49a55cbc-8969-4807-9c46-15e46b1e9f50&quot;,&quot;parentUUID&quot;:&quot;6c0662fa-20da-4073-908a-759f9f5f1bef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a reaction type request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API POST /reaction-types Scenario 2: Create a reaction type request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    reaction_types: reaction_type // &lt;-- a valid parameter name should be &#x27;reaction_type&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;reaction_type&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;15054b51-3574-41ea-a53c-5ced04cd1228&quot;,&quot;parentUUID&quot;:&quot;6c0662fa-20da-4073-908a-759f9f5f1bef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a reaction type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API POST /reaction-types Scenario 3: Create a reaction type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;50deff7a-5ead-4487-94ef-9c68c977e7ee&quot;,&quot;parentUUID&quot;:&quot;6c0662fa-20da-4073-908a-759f9f5f1bef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a reaction type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API POST /reaction-types Scenario 4: Create a reaction type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5aea218c-5f0f-4686-8b88-b154a325a0b1&quot;,&quot;parentUUID&quot;:&quot;6c0662fa-20da-4073-908a-759f9f5f1bef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;49a55cbc-8969-4807-9c46-15e46b1e9f50&quot;,&quot;15054b51-3574-41ea-a53c-5ced04cd1228&quot;,&quot;50deff7a-5ead-4487-94ef-9c68c977e7ee&quot;,&quot;5aea218c-5f0f-4686-8b88-b154a325a0b1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:65,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ef140894-63f0-42a4-83bb-f00c645f4528&quot;,&quot;title&quot;:&quot;PATCH /reaction-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a reaction type request is successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 1: Update a reaction type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type: newReactionType };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    reaction_type_id: existingReactionType.reaction_type_id,\n    reaction_type: newReactionType\n});\n\n// cleanup\ndata.reaction_type = existingReactionType.reaction_type;\nres = await request(app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;15fa9ed2-fd50-488f-b3a1-613c64dd19aa&quot;,&quot;parentUUID&quot;:&quot;ef140894-63f0-42a4-83bb-f00c645f4528&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a reaction type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 2: Update a reaction type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type: newReactionType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownReactionTypeId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction type not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7391c8ea-c699-46aa-8e14-7c1b09276883&quot;,&quot;parentUUID&quot;:&quot;ef140894-63f0-42a4-83bb-f00c645f4528&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a reaction type request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 3: Update a reaction type request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    reaction_types: newReactionType // &lt;-- a valid parameter name should be &#x27;reaction_type&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;reaction_type&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;75b4ce68-364f-45a9-8e05-83933786da2e&quot;,&quot;parentUUID&quot;:&quot;ef140894-63f0-42a4-83bb-f00c645f4528&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a reaction type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 4: Update a reaction type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type: newReactionType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2668ec34-f032-490d-a630-0f19552504be&quot;,&quot;parentUUID&quot;:&quot;ef140894-63f0-42a4-83bb-f00c645f4528&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a reaction type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 5: Update a reaction type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type: newReactionType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3ff6685d-6015-4751-b170-592e3e0d5e0b&quot;,&quot;parentUUID&quot;:&quot;ef140894-63f0-42a4-83bb-f00c645f4528&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;15fa9ed2-fd50-488f-b3a1-613c64dd19aa&quot;,&quot;7391c8ea-c699-46aa-8e14-7c1b09276883&quot;,&quot;75b4ce68-364f-45a9-8e05-83933786da2e&quot;,&quot;2668ec34-f032-490d-a630-0f19552504be&quot;,&quot;3ff6685d-6015-4751-b170-592e3e0d5e0b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:63,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;62ffdd73-db6a-4b9a-8f60-da6f63f2d4ba&quot;,&quot;title&quot;:&quot;DELETE /reaction-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a reaction type request is successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API DELETE /reaction-types/:id Scenario 1: Delete a reaction type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { reaction_type };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.reaction_type_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction type has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2798062f-cbbb-4fa5-b240-d65848f7ebfc&quot;,&quot;parentUUID&quot;:&quot;62ffdd73-db6a-4b9a-8f60-da6f63f2d4ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a reaction type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API DELETE /reaction-types/:id Scenario 2: Delete a reaction type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownReactionTypeId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction type not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b6596c6d-91f5-4fcc-94b2-dd4ab489e8e4&quot;,&quot;parentUUID&quot;:&quot;62ffdd73-db6a-4b9a-8f60-da6f63f2d4ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a reaction type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API DELETE /reaction-types/:id Scenario 3: Delete a reaction type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;92849dad-2d28-4406-9d10-c1b1caa41baf&quot;,&quot;parentUUID&quot;:&quot;62ffdd73-db6a-4b9a-8f60-da6f63f2d4ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a reaction type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API DELETE /reaction-types/:id Scenario 4: Delete a reaction type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingReactionType.reaction_type_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1f298bb2-cc1c-4bd4-81bd-df9afc401055&quot;,&quot;parentUUID&quot;:&quot;62ffdd73-db6a-4b9a-8f60-da6f63f2d4ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2798062f-cbbb-4fa5-b240-d65848f7ebfc&quot;,&quot;b6596c6d-91f5-4fcc-94b2-dd4ab489e8e4&quot;,&quot;92849dad-2d28-4406-9d10-c1b1caa41baf&quot;,&quot;1f298bb2-cc1c-4bd4-81bd-df9afc401055&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:35,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a270808c-171d-44f5-ab43-7dfbd7c94dbc&quot;,&quot;title&quot;:&quot;Saved Activities API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\savedActivity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\savedActivity.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Saved Activities API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API \&quot;before each\&quot; hook in \&quot;Saved Activities API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;46a71303-2884-4feb-a312-68ef18cee1d7&quot;,&quot;parentUUID&quot;:&quot;a270808c-171d-44f5-ab43-7dfbd7c94dbc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2e8a330c-d09b-47ff-92ad-9594f2f0e765&quot;,&quot;title&quot;:&quot;POST /students/:erp/saved-activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\savedActivity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\savedActivity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a saved activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 1: Create a saved activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: unSavedActivityId, saved_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${userERP}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${userERP}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkActivityId = activity =&gt; activity.activity_id === data.activity_id;\nexpect(res.body.body.some(checkActivityId)).to.be.true;\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${userERP}/${subRoute}/${data.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;23454a05-b652-401f-b183-b4ead8c856a7&quot;,&quot;parentUUID&quot;:&quot;2e8a330c-d09b-47ff-92ad-9594f2f0e765&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 1: Create a saved activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 1: Create a saved activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: savedActivityId, saved_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkActivityId = activity =&gt; activity.activity_id === data.activity_id;\nexpect(res.body.body.some(checkActivityId)).to.be.true;\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}/${data.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2ce623ca-c718-46b0-9366-5d9e2d95a6fe&quot;,&quot;parentUUID&quot;:&quot;2e8a330c-d09b-47ff-92ad-9594f2f0e765&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a saved activity request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 2: Create a saved activity request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: savedActivityId, saved_at };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${unknownStudentERP}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;student_erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bb7696a3-4fe4-495e-9196-f63f37924a39&quot;,&quot;parentUUID&quot;:&quot;2e8a330c-d09b-47ff-92ad-9594f2f0e765&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a saved activity request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 3: Create a saved activity request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: unknownActivityId, saved_at }; // &lt;-- Non-existent activity_id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;71e37bf1-bdde-4a58-9380-0ae1a517fe77&quot;,&quot;parentUUID&quot;:&quot;2e8a330c-d09b-47ff-92ad-9594f2f0e765&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a saved activity request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 4: Create a saved activity request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    id: 1, // &lt;-- a valid parameter name should be &#x27;activity_id&#x27;\n    saved_at: &#x27;not going&#x27; // &lt;-- not a valid saved_at\n};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;saved_at&#x27;, &#x27;activity_id&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0b8e3b7e-7725-43d6-a565-0872018afdb5&quot;,&quot;parentUUID&quot;:&quot;2e8a330c-d09b-47ff-92ad-9594f2f0e765&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a saved activity request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 5: Create a saved activity request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: savedActivityId, saved_at };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${adminERP}/${subRoute}`) // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;839e3ae7-59c9-4aa8-8ed9-1b7d213b80c9&quot;,&quot;parentUUID&quot;:&quot;2e8a330c-d09b-47ff-92ad-9594f2f0e765&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a saved activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 6: Create a saved activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: savedActivityId, saved_at };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;225687f0-2997-4f4e-96fb-7259bb26aa19&quot;,&quot;parentUUID&quot;:&quot;2e8a330c-d09b-47ff-92ad-9594f2f0e765&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;23454a05-b652-401f-b183-b4ead8c856a7&quot;,&quot;2ce623ca-c718-46b0-9366-5d9e2d95a6fe&quot;,&quot;bb7696a3-4fe4-495e-9196-f63f37924a39&quot;,&quot;71e37bf1-bdde-4a58-9380-0ae1a517fe77&quot;,&quot;0b8e3b7e-7725-43d6-a565-0872018afdb5&quot;,&quot;839e3ae7-59c9-4aa8-8ed9-1b7d213b80c9&quot;,&quot;225687f0-2997-4f4e-96fb-7259bb26aa19&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:90,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7cc7b9ca-4293-4d0a-ae21-45a11dc22f6c&quot;,&quot;title&quot;:&quot;DELETE /students/:erp/saved-activities/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\savedActivity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\savedActivity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a saved activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 1: Delete a saved activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { activity_id: savedActivityId, saved_at };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}/${savedActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp == student_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Saved activity has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No saved activities found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d5462857-93fb-4984-8216-1cb158bf7278&quot;,&quot;parentUUID&quot;:&quot;7cc7b9ca-4293-4d0a-ae21-45a11dc22f6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a saved activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 2: Delete a saved activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { activity_id: savedActivityId, saved_at };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}/${savedActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp != student_erp but still bypass ownerCheck\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Saved activity has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No saved activities found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5b65d22b-1d50-4518-80c7-62413be38bc4&quot;,&quot;parentUUID&quot;:&quot;7cc7b9ca-4293-4d0a-ae21-45a11dc22f6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a saved activity request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 3: Delete a saved activity request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownStudentERP}/${subRoute}/${savedActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Saved activity not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;69839417-085c-4aeb-a695-e76504a76232&quot;,&quot;parentUUID&quot;:&quot;7cc7b9ca-4293-4d0a-ae21-45a11dc22f6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a saved activity request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 4: Delete a saved activity request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudentERP}/${subRoute}/${unknownActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Saved activity not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8132fb3b-ec51-41b9-b4c1-dc769ebafb73&quot;,&quot;parentUUID&quot;:&quot;7cc7b9ca-4293-4d0a-ae21-45a11dc22f6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a saved activity request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 5: Delete a saved activity request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${adminERP}/${subRoute}/${savedActivityId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b31b4a54-b609-46c2-a7cd-8c9ecfe54a76&quot;,&quot;parentUUID&quot;:&quot;7cc7b9ca-4293-4d0a-ae21-45a11dc22f6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Delete a saved activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 6: Delete a saved activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudentERP}/${subRoute}/${savedActivityId}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;23b39a64-4580-49ba-b6df-c781db37884a&quot;,&quot;parentUUID&quot;:&quot;7cc7b9ca-4293-4d0a-ae21-45a11dc22f6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d5462857-93fb-4984-8216-1cb158bf7278&quot;,&quot;5b65d22b-1d50-4518-80c7-62413be38bc4&quot;,&quot;69839417-085c-4aeb-a695-e76504a76232&quot;,&quot;8132fb3b-ec51-41b9-b4c1-dc769ebafb73&quot;,&quot;b31b4a54-b609-46c2-a7cd-8c9ecfe54a76&quot;,&quot;23b39a64-4580-49ba-b6df-c781db37884a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:88,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7d00a456-f3bf-4263-bc0c-d2b92440dadd&quot;,&quot;title&quot;:&quot;Students API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Students API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Students API \&quot;before each\&quot; hook in \&quot;Students API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e025999a-5b27-42ef-af38-5ff1434f5cb7&quot;,&quot;parentUUID&quot;:&quot;7d00a456-f3bf-4263-bc0c-d2b92440dadd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;819363ab-2725-4af5-a37f-80fdbe788ee7&quot;,&quot;title&quot;:&quot;GET /students&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all students request successful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students Scenario 1: Get all students request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\n// contain all params along with connection details\nexpect(resBody[0]).to.include.all.keys([...Object.keys(existingStudent), &#x27;student_connection&#x27;]);\nconst studentsWithConnection = resBody.filter(o =&gt; o.student_connection !== null);\n// connection details should have these\nexpect(studentsWithConnection[0].student_connection).to.include.all.keys([\n    &#x27;student_connection_id&#x27;,\n    &#x27;sender_erp&#x27;,\n    &#x27;receiver_erp&#x27;,\n    &#x27;connection_status&#x27;,\n    &#x27;sent_at&#x27;,\n    &#x27;accepted_at&#x27;\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9ca3d680-8c67-40b2-bc4a-21078308d804&quot;,&quot;parentUUID&quot;:&quot;819363ab-2725-4af5-a37f-80fdbe788ee7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all students request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students Scenario 2: Get all students request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?first_name=${existingStudent.first_name}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].first_name).to.be.equal(existingStudent.first_name);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7d607bfa-8997-4641-bd65-37830916f99b&quot;,&quot;parentUUID&quot;:&quot;819363ab-2725-4af5-a37f-80fdbe788ee7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all students request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students Scenario 3: Get all students request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:579,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentModel = require(&#x27;../../src/models/student.model&#x27;);\nconst modelStub = sinon.stub(StudentModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty student list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8ab22576-f16b-4129-b32f-31c9737e2a28&quot;,&quot;parentUUID&quot;:&quot;819363ab-2725-4af5-a37f-80fdbe788ee7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all students request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students Scenario 4: Get all students request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6e825de5-ab45-4143-bcae-5e8ab5c4312e&quot;,&quot;parentUUID&quot;:&quot;819363ab-2725-4af5-a37f-80fdbe788ee7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9ca3d680-8c67-40b2-bc4a-21078308d804&quot;,&quot;7d607bfa-8997-4641-bd65-37830916f99b&quot;,&quot;8ab22576-f16b-4129-b32f-31c9737e2a28&quot;,&quot;6e825de5-ab45-4143-bcae-5e8ab5c4312e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:618,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;08d7c5e3-f591-4a07-bf4f-9fa5b2ca212f&quot;,&quot;title&quot;:&quot;GET /students/:erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student request successful (Profile)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp Scenario 1: Get a student request successful (Profile)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // userToken.erp === existingStudent.erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.erp).to.be.equal(existingStudent.erp); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c8386750-9b68-4c82-94a3-cd7e84b0bb8b&quot;,&quot;parentUUID&quot;:&quot;08d7c5e3-f591-4a07-bf4f-9fa5b2ca212f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student request successful (Others)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp Scenario 2: Get a student request successful (Others)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${adminERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // userToken.erp !== adminERP\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.erp).to.be.equal(adminERP); // should match initially sent id\nexpect(resBody.student_connection).to.exist; // should contain connection details&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a22b8dda-e35d-4d73-893c-6c3a0433bb01&quot;,&quot;parentUUID&quot;:&quot;08d7c5e3-f591-4a07-bf4f-9fa5b2ca212f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp Scenario 3: Get a student request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unregisteredERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ebc859b2-2e89-4183-9997-c65aaaf1c048&quot;,&quot;parentUUID&quot;:&quot;08d7c5e3-f591-4a07-bf4f-9fa5b2ca212f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a student request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp Scenario 4: Get a student request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudent.erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;612dee87-0c07-4835-8b40-cbcdebdf366a&quot;,&quot;parentUUID&quot;:&quot;08d7c5e3-f591-4a07-bf4f-9fa5b2ca212f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c8386750-9b68-4c82-94a3-cd7e84b0bb8b&quot;,&quot;a22b8dda-e35d-4d73-893c-6c3a0433bb01&quot;,&quot;ebc859b2-2e89-4183-9997-c65aaaf1c048&quot;,&quot;612dee87-0c07-4835-8b40-cbcdebdf366a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;4c33e2e8-5e86-46c8-8342-ec1f91911682&quot;,&quot;title&quot;:&quot;GET /students/:erp/organized-activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student&#x27;s organized activities request successful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 1: Get a student&#x27;s organized activities request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst organizerCheck = activity =&gt; activity.organizer_erp === existingStudent.erp;\nexpect(resBody.every(organizerCheck)).to.be.true; // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8aa72193-de17-4108-952f-2563e7e55f77&quot;,&quot;parentUUID&quot;:&quot;4c33e2e8-5e86-46c8-8342-ec1f91911682&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student&#x27;s organized activities request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 2: Get a student&#x27;s organized activities request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst frequency = &#x27;one_time&#x27;;\nconst query = `frequency=${frequency}`;\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = activity =&gt; activity.frequency === frequency;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;052c478e-c0fd-454e-a6e4-752e10327079&quot;,&quot;parentUUID&quot;:&quot;4c33e2e8-5e86-46c8-8342-ec1f91911682&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student&#x27;s organized activities request is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 3: Get a student&#x27;s organized activities request is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unregisteredERP}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No organized activities found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b96ddf2c-168b-4d0d-90a8-3ab947b115bf&quot;,&quot;parentUUID&quot;:&quot;4c33e2e8-5e86-46c8-8342-ec1f91911682&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a student&#x27;s organized activities request is unsuccessful due to no organized activities&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 4: Get a student&#x27;s organized activities request is unsuccessful due to no organized activities&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:547,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentModel = require(&#x27;../../src/models/student.model&#x27;);\nconst modelStub = sinon.stub(StudentModel, &#x27;findAllOrganizedActivitiesByStudent&#x27;).callsFake(() =&gt; []); // return empty organized activities list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No organized activities found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;754928a7-a1bf-4c08-8e3f-7b8819c40349&quot;,&quot;parentUUID&quot;:&quot;4c33e2e8-5e86-46c8-8342-ec1f91911682&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get a student&#x27;s organized activities request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 5: Get a student&#x27;s organized activities request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;all&#x27;; // &lt;-- invalid privacy value\nconst invalidQueryParams = `privacy=${privacy}&amp;week=2`; // &lt;-- `week` is an incorrect query param\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${invalidQueryParams}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(422);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParamCheck = o =&gt; o.param === &#x27;privacy&#x27;;\nexpect(resHeaders.data.some(incorrectParamCheck)).to.be.true;\nconst incorrectMsgCheck = o =&gt; o.msg === &#x27;Invalid query params!&#x27;;\nexpect(resHeaders.data.some(incorrectMsgCheck)).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9291f77b-70bd-4680-85cb-0a13f694a623&quot;,&quot;parentUUID&quot;:&quot;4c33e2e8-5e86-46c8-8342-ec1f91911682&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get a student&#x27;s organized activities is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 6: Get a student&#x27;s organized activities is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudent.erp}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;748ed54b-1daa-491e-a235-3a0382736026&quot;,&quot;parentUUID&quot;:&quot;4c33e2e8-5e86-46c8-8342-ec1f91911682&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8aa72193-de17-4108-952f-2563e7e55f77&quot;,&quot;052c478e-c0fd-454e-a6e4-752e10327079&quot;,&quot;b96ddf2c-168b-4d0d-90a8-3ab947b115bf&quot;,&quot;754928a7-a1bf-4c08-8e3f-7b8819c40349&quot;,&quot;9291f77b-70bd-4680-85cb-0a13f694a623&quot;,&quot;748ed54b-1daa-491e-a235-3a0382736026&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:602,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b2049366-63c5-4089-b30d-2105ec1f730c&quot;,&quot;title&quot;:&quot;GET /students/:erp/attended-activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student&#x27;s attended activities request successful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 1: Get a student&#x27;s attended activities request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst attendeeCheck = activity =&gt; activity.student_erp === existingStudent.erp;\nexpect(resBody.every(attendeeCheck)).to.be.true; // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dfb2ee8d-94d6-47ae-b081-45d7793583ef&quot;,&quot;parentUUID&quot;:&quot;b2049366-63c5-4089-b30d-2105ec1f730c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student&#x27;s attended activities request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 2: Get a student&#x27;s attended activities request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst involvement_type = &#x27;going&#x27;;\nconst query = `involvement_type=${involvement_type}`;\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst attendeeCheck = activity =&gt; activity.student_erp === existingStudent.erp;\nexpect(resBody.every(attendeeCheck)).to.be.true; // should match initially sent id\nconst queryCheck = activity =&gt; activity.involvement_type === involvement_type;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4cb487b6-1d66-4daa-b85e-c8aa318c8ac2&quot;,&quot;parentUUID&quot;:&quot;b2049366-63c5-4089-b30d-2105ec1f730c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student&#x27;s attended activities request is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 3: Get a student&#x27;s attended activities request is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unregisteredERP}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No interacted activities found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;89a035ab-e0fc-4133-b6fd-efade1784e97&quot;,&quot;parentUUID&quot;:&quot;b2049366-63c5-4089-b30d-2105ec1f730c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a student&#x27;s attended activities request is unsuccessful due to no attended activities&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 4: Get a student&#x27;s attended activities request is unsuccessful due to no attended activities&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:565,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentModel = require(&#x27;../../src/models/student.model&#x27;);\nconst modelStub = sinon.stub(StudentModel, &#x27;findAllAttendedActivitiesByStudent&#x27;).callsFake(() =&gt; []); // return empty attended activities list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No interacted activities found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6f8012eb-31fe-4897-a1d7-728fa8ed0ea0&quot;,&quot;parentUUID&quot;:&quot;b2049366-63c5-4089-b30d-2105ec1f730c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get a student&#x27;s attended activities request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 5: Get a student&#x27;s attended activities request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst involvement_type = &#x27;not going&#x27;; // &lt;-- invalid involvement type value\nconst invalidQueryParams = `involvement_type=${involvement_type}&amp;week=2`; // &lt;-- `week` is an incorrect query param\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${invalidQueryParams}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(422);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParamCheck = o =&gt; o.param === &#x27;involvement_type&#x27;;\nexpect(resHeaders.data.some(incorrectParamCheck)).to.be.true;\nconst incorrectMsgCheck = o =&gt; o.msg === &#x27;Invalid query params!&#x27;;\nexpect(resHeaders.data.some(incorrectMsgCheck)).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d960009c-6191-4dfe-b251-5afc81838b7a&quot;,&quot;parentUUID&quot;:&quot;b2049366-63c5-4089-b30d-2105ec1f730c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get a student&#x27;s attended activities is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 6: Get a student&#x27;s attended activities is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudent.erp}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e2c2e4be-b1b2-4fbb-a683-7846282465bb&quot;,&quot;parentUUID&quot;:&quot;b2049366-63c5-4089-b30d-2105ec1f730c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;dfb2ee8d-94d6-47ae-b081-45d7793583ef&quot;,&quot;4cb487b6-1d66-4daa-b85e-c8aa318c8ac2&quot;,&quot;89a035ab-e0fc-4133-b6fd-efade1784e97&quot;,&quot;6f8012eb-31fe-4897-a1d7-728fa8ed0ea0&quot;,&quot;d960009c-6191-4dfe-b251-5afc81838b7a&quot;,&quot;e2c2e4be-b1b2-4fbb-a683-7846282465bb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:616,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;2d6beb34-2d19-4a49-8505-c01a5193dd49&quot;,&quot;title&quot;:&quot;GET /students/:erp/saved-activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student&#x27;s saved activities request successful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 1: Get a student&#x27;s saved activities request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst studentERPCheck = activity =&gt; activity.student_erp === existingStudent.erp;\nexpect(resBody.every(studentERPCheck)).to.be.true; // should match initially sent erp&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9052219b-1c4f-4d7b-95eb-5a1f77967390&quot;,&quot;parentUUID&quot;:&quot;2d6beb34-2d19-4a49-8505-c01a5193dd49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student&#x27;s saved activities request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 2: Get a student&#x27;s saved activities request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst frequency = &#x27;daily&#x27;;\nconst query = `frequency=${frequency}`;\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = activity =&gt; activity.frequency === frequency;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0d74a33f-e76c-4e49-b0ae-db8e67dd05f8&quot;,&quot;parentUUID&quot;:&quot;2d6beb34-2d19-4a49-8505-c01a5193dd49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student&#x27;s saved activities request is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 3: Get a student&#x27;s saved activities request is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unregisteredERP}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No saved activities found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dccfb499-ae54-41ef-936e-fdbe4ff52953&quot;,&quot;parentUUID&quot;:&quot;2d6beb34-2d19-4a49-8505-c01a5193dd49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a student&#x27;s saved activities request is unsuccessful due to no saved activities&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 4: Get a student&#x27;s saved activities request is unsuccessful due to no saved activities&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:558,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentModel = require(&#x27;../../src/models/student.model&#x27;);\nconst modelStub = sinon.stub(StudentModel, &#x27;findAllSavedActivitiesByStudent&#x27;).callsFake(() =&gt; []); // return empty saved activities list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No saved activities found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a4bd60ff-c050-45a2-b944-aa176ee684d6&quot;,&quot;parentUUID&quot;:&quot;2d6beb34-2d19-4a49-8505-c01a5193dd49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get a student&#x27;s saved activities request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 5: Get a student&#x27;s saved activities request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;all&#x27;; // &lt;-- invalid privacy value\nconst invalidQueryParams = `privacy=${privacy}&amp;week=2`; // &lt;-- `week` is an incorrect query param\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${invalidQueryParams}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(422);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParamCheck = o =&gt; o.param === &#x27;privacy&#x27;;\nexpect(resHeaders.data.some(incorrectParamCheck)).to.be.true;\nconst incorrectMsgCheck = o =&gt; o.msg === &#x27;Invalid query params!&#x27;;\nexpect(resHeaders.data.some(incorrectMsgCheck)).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7dc6a3da-41ce-4807-a6ba-4f4059fda6cc&quot;,&quot;parentUUID&quot;:&quot;2d6beb34-2d19-4a49-8505-c01a5193dd49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get a student&#x27;s saved activities request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 6: Get a student&#x27;s saved activities request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const res = await request(this.app)\n    .get(`${baseRoute}/${adminERP}/${subRoute}`) // token erp != adminERP\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user can&#x27;t view others saved activities\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;faa77457-6912-4cec-a248-becbbe2a6aae&quot;,&quot;parentUUID&quot;:&quot;2d6beb34-2d19-4a49-8505-c01a5193dd49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Get a student&#x27;s saved activities is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 7: Get a student&#x27;s saved activities is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudent.erp}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a82a3952-0a4c-4a5a-89c9-e2a465611873&quot;,&quot;parentUUID&quot;:&quot;2d6beb34-2d19-4a49-8505-c01a5193dd49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9052219b-1c4f-4d7b-95eb-5a1f77967390&quot;,&quot;0d74a33f-e76c-4e49-b0ae-db8e67dd05f8&quot;,&quot;dccfb499-ae54-41ef-936e-fdbe4ff52953&quot;,&quot;a4bd60ff-c050-45a2-b944-aa176ee684d6&quot;,&quot;7dc6a3da-41ce-4807-a6ba-4f4059fda6cc&quot;,&quot;faa77457-6912-4cec-a248-becbbe2a6aae&quot;,&quot;a82a3952-0a4c-4a5a-89c9-e2a465611873&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:621,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;2d3f88ff-e3a1-495c-9b58-7d9be26e6c40&quot;,&quot;title&quot;:&quot;PATCH /students/:erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a student request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 1: Update a student request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingStudent.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.last_name).to.be.equal(newStudentLastName);\n\n// cleanup\ndata.last_name = existingStudent.last_name;\nres = await request(app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7c18f82a-b62a-488f-88e7-208f71f98c15&quot;,&quot;parentUUID&quot;:&quot;2d3f88ff-e3a1-495c-9b58-7d9be26e6c40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a student request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 2: Update a student request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // admin to edit other profiles i.e. token erp != existingStudent.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.last_name).to.be.equal(newStudentLastName);\n\n// cleanup\ndata.last_name = existingStudent.last_name;\nres = await request(app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ac08ac24-6a74-4006-ab77-668f66e6b3fd&quot;,&quot;parentUUID&quot;:&quot;2d3f88ff-e3a1-495c-9b58-7d9be26e6c40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a student request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 3: Update a student request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unregisteredERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;042dce0e-c93a-4858-bd1f-d579df7dd0e2&quot;,&quot;parentUUID&quot;:&quot;2d3f88ff-e3a1-495c-9b58-7d9be26e6c40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a student request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 4: Update a student request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    last_namesds: newStudentLastName, // &lt;-- an valid parameter name should be &#x27;last_name&#x27;\n    first_name: &#x27;test-user%&#x27; // &lt;-- a valid &#x27;first_name&#x27; contains alphabets only\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;first_name&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e233b7ec-2ed5-4104-9651-d589ee2ca68b&quot;,&quot;parentUUID&quot;:&quot;2d3f88ff-e3a1-495c-9b58-7d9be26e6c40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a student request is forbidden (Unowned ERP)&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 5: Update a student request is forbidden (Unowned ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\nconst unOwnedERP = adminERP; // &lt;-- can be any other non-admin ERP as well, just different from existingStudent.erp\n\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others profile i.e. token erp != otherERP\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9a6bea5a-506f-4179-b872-9af83c97426f&quot;,&quot;parentUUID&quot;:&quot;2d3f88ff-e3a1-495c-9b58-7d9be26e6c40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a student request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 6: Update a student request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;578e4aeb-7e2c-4c16-a6f7-bb7576c6c719&quot;,&quot;parentUUID&quot;:&quot;2d3f88ff-e3a1-495c-9b58-7d9be26e6c40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7c18f82a-b62a-488f-88e7-208f71f98c15&quot;,&quot;ac08ac24-6a74-4006-ab77-668f66e6b3fd&quot;,&quot;042dce0e-c93a-4858-bd1f-d579df7dd0e2&quot;,&quot;e233b7ec-2ed5-4104-9651-d589ee2ca68b&quot;,&quot;9a6bea5a-506f-4179-b872-9af83c97426f&quot;,&quot;578e4aeb-7e2c-4c16-a6f7-bb7576c6c719&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:107,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;93faa25d-686a-4e9c-9d4d-a3bbbd2d3aad&quot;,&quot;title&quot;:&quot;DELETE /students/:erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a student request is successful&quot;,&quot;fullTitle&quot;:&quot;Students API DELETE /students/:erp Scenario 1: Delete a student request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:113,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst student = {\n    erp: newERP,\n    password: &#x27;123&#x27;,\n    uni_email: newEmail,\n    first_name: existingStudent.first_name,\n    last_name: existingStudent.last_name,\n    gender: existingStudent.gender,\n    contact: existingStudent.contact,\n    birthday: existingStudent.birthday,\n    profile_picture_url: existingStudent.profile_picture_url,\n    graduation_year: existingStudent.graduation_year,\n    campus_id: existingStudent.campus_id,\n    program_id: existingStudent.program_id,\n    is_active: existingStudent.is_active\n};\nconst registerRoute = `/api/${Config.API_VERSION}/auth/register`;\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(registerRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(student);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.erp;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;76cbc973-62c8-4f8a-bb89-181e596a34e1&quot;,&quot;parentUUID&quot;:&quot;93faa25d-686a-4e9c-9d4d-a3bbbd2d3aad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a student request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Students API DELETE /students/:erp Scenario 2: Delete a student request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unregisteredERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9df89dcb-bbef-4f65-80e2-e4d4d379351a&quot;,&quot;parentUUID&quot;:&quot;93faa25d-686a-4e9c-9d4d-a3bbbd2d3aad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a student request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Students API DELETE /students/:erp Scenario 3: Delete a student request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ec5a0b78-665f-4123-81d9-07f49c58518c&quot;,&quot;parentUUID&quot;:&quot;93faa25d-686a-4e9c-9d4d-a3bbbd2d3aad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a student request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API DELETE /students/:erp Scenario 4: Delete a student request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudent.erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;de99686b-f9e7-4b0e-8435-d6b0c6b130f8&quot;,&quot;parentUUID&quot;:&quot;93faa25d-686a-4e9c-9d4d-a3bbbd2d3aad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;76cbc973-62c8-4f8a-bb89-181e596a34e1&quot;,&quot;9df89dcb-bbef-4f65-80e2-e4d4d379351a&quot;,&quot;ec5a0b78-665f-4123-81d9-07f49c58518c&quot;,&quot;de99686b-f9e7-4b0e-8435-d6b0c6b130f8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:131,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6f039737-15be-4729-8da6-b990bc4c4bfd&quot;,&quot;title&quot;:&quot;Connection Requests API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Connection Requests API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API \&quot;before each\&quot; hook in \&quot;Connection Requests API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9c42bdc1-be19-4dad-a80d-3e6f5904bf68&quot;,&quot;parentUUID&quot;:&quot;6f039737-15be-4729-8da6-b990bc4c4bfd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;64f0d2e3-ff4b-478d-8d7d-8c3669c5cf72&quot;,&quot;title&quot;:&quot;GET /student-connections&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all friend connections is successful&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 1: Get all friend connections is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst erp = adminERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?erp=${erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // adminToken.erp === erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst studentCheck = studentConn =&gt; studentConn.sender.erp === erp || studentConn.receiver.erp === erp;\nconst connectionStatusCheck = studentConn =&gt; studentConn.connection_status === &#x27;friends&#x27;;\nconst queryCheck = studentConn =&gt; studentCheck(studentConn) &amp;&amp; connectionStatusCheck(studentConn);\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([&#x27;student_connection_id&#x27;, &#x27;sender&#x27;, &#x27;receiver&#x27;, &#x27;connection_status&#x27;, &#x27;sent_at&#x27;, &#x27;accepted_at&#x27;]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingConnectionRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingConnectionRequest.receiver));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ff029fae-6b01-4bec-a880-51600fe0c101&quot;,&quot;parentUUID&quot;:&quot;64f0d2e3-ff4b-478d-8d7d-8c3669c5cf72&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all student connections unsuccessful due to no friend connections&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 2: Get all student connections unsuccessful due to no friend connections&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?erp=${erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;140eafc8-33be-4d62-a385-c92456a90ab8&quot;,&quot;parentUUID&quot;:&quot;64f0d2e3-ff4b-478d-8d7d-8c3669c5cf72&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all others&#x27; friends connections is successful&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 3: Get all others&#x27; friends connections is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst erp = adminERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?erp=${erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp !== erp\n\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst studentCheck = studentConn =&gt; studentConn.sender.erp === erp || studentConn.receiver.erp === erp;\nconst connectionStatusCheck = studentConn =&gt; studentConn.connection_status === &#x27;friends&#x27;;\nconst queryCheck = studentConn =&gt; studentCheck(studentConn) &amp;&amp; connectionStatusCheck(studentConn);\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([&#x27;student_connection_id&#x27;, &#x27;sender&#x27;, &#x27;receiver&#x27;, &#x27;connection_status&#x27;, &#x27;sent_at&#x27;, &#x27;accepted_at&#x27;]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingConnectionRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingConnectionRequest.receiver));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;939e97d4-dfee-4b58-99a9-442a7869b371&quot;,&quot;parentUUID&quot;:&quot;64f0d2e3-ff4b-478d-8d7d-8c3669c5cf72&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all student connections is incorrect due to no query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 4: Get all student connections is incorrect due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute) // &lt;-- must specify erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParam = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParam).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;948770cd-fe6b-4f2e-a5eb-93a9a6b63db3&quot;,&quot;parentUUID&quot;:&quot;64f0d2e3-ff4b-478d-8d7d-8c3669c5cf72&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all student connections is incorrect due to unknown query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 5: Get all student connections is incorrect due to unknown query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst erp = &#x27;123&#x27;; // a valid erp is 5 digits\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?erp=${erp}&amp;connection_status=friends`) // &lt;-- &#x27;connection_status&#x27; is invalid query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3191f005-3cd9-4f0d-be4d-a74562187d20&quot;,&quot;parentUUID&quot;:&quot;64f0d2e3-ff4b-478d-8d7d-8c3669c5cf72&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get all student connections is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 6: Get all student connections is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;71a48494-0200-4c78-b246-941b62bc7a70&quot;,&quot;parentUUID&quot;:&quot;64f0d2e3-ff4b-478d-8d7d-8c3669c5cf72&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ff029fae-6b01-4bec-a880-51600fe0c101&quot;,&quot;140eafc8-33be-4d62-a385-c92456a90ab8&quot;,&quot;939e97d4-dfee-4b58-99a9-442a7869b371&quot;,&quot;948770cd-fe6b-4f2e-a5eb-93a9a6b63db3&quot;,&quot;3191f005-3cd9-4f0d-be4d-a74562187d20&quot;,&quot;71a48494-0200-4c78-b246-941b62bc7a70&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:50,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b0c19749-2598-4194-93fb-74f017543963&quot;,&quot;title&quot;:&quot;GET /student-connections/requests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all connection requests is successful (Sent)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 1: Get all connection requests is successful (Sent)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // userToken.erp === sender_erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = studentConnection =&gt; studentConnection.sender.erp === sender_erp;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([&#x27;student_connection_id&#x27;, &#x27;sender&#x27;, &#x27;receiver&#x27;, &#x27;connection_status&#x27;, &#x27;sent_at&#x27;]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingConnectionRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingConnectionRequest.receiver));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3add4b70-5cdf-4a9e-ac8d-81386464ce17&quot;,&quot;parentUUID&quot;:&quot;b0c19749-2598-4194-93fb-74f017543963&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all connection requests is successful (Receiver)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 2: Get all connection requests is successful (Receiver)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = adminERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?receiver_erp=${receiver_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // adminToken.erp === sender_erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = studentConnection =&gt; studentConnection.receiver.erp === receiver_erp;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([&#x27;student_connection_id&#x27;, &#x27;sender&#x27;, &#x27;receiver&#x27;, &#x27;connection_status&#x27;, &#x27;sent_at&#x27;]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingConnectionRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingConnectionRequest.receiver));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;94b97af5-b19d-4243-9bb3-a61330bd9fb2&quot;,&quot;parentUUID&quot;:&quot;b0c19749-2598-4194-93fb-74f017543963&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all connection requests unsuccessful due to no (sent) connection requests&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 3: Get all connection requests unsuccessful due to no (sent) connection requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = user2ERP;\nconst fakeToken = jwt.sign({erp: sender_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}`)\n    .auth(fakeToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fb9eae2b-5ece-417c-b2d4-5fe28cf33996&quot;,&quot;parentUUID&quot;:&quot;b0c19749-2598-4194-93fb-74f017543963&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all connection requests unsuccessful due to no (received) connection requests&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 4: Get all connection requests unsuccessful due to no (received) connection requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = user2ERP;\nconst fakeToken = jwt.sign({erp: receiver_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?receiver_erp=${receiver_erp}`)\n    .auth(fakeToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;23dc23cf-2b06-405a-8d30-219b0f46592a&quot;,&quot;parentUUID&quot;:&quot;b0c19749-2598-4194-93fb-74f017543963&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all connection requests is incorrect due to multiple query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 5: Get all connection requests is incorrect due to multiple query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\nconst receiver_erp = user2ERP;\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}&amp;receiver_erp=${receiver_erp}`) // &lt;-- can&#x27;t specify both sender_erp and receiver_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;receiver_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Can\\&#x27;t specify both sender and receiver erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;11716073-cc70-4928-a44a-f4f93455c6c7&quot;,&quot;parentUUID&quot;:&quot;b0c19749-2598-4194-93fb-74f017543963&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get all connection requests is incorrect due to no query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 6: Get all connection requests is incorrect due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}`) // &lt;-- either specify sender_erp or receiver_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Either sender or receiver erp is required&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;67bc5968-ea71-4e4f-819e-70afc4fbb797&quot;,&quot;parentUUID&quot;:&quot;b0c19749-2598-4194-93fb-74f017543963&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Get all connection requests is incorrect due to unknown query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 7: Get all connection requests is incorrect due to unknown query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = &#x27;123&#x27;; // a valid erp is 5 digits\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}&amp;connection_status=friends`) // &lt;-- &#x27;connection_status&#x27; is invalid query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;sender_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;02f19f23-df27-4b08-b7bb-bc341f1cccb1&quot;,&quot;parentUUID&quot;:&quot;b0c19749-2598-4194-93fb-74f017543963&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Get request is forbidden due to querying other&#x27;s sent connection requests&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 8: Get request is forbidden due to querying other&#x27;s sent connection requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp !== sender_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;420a9e38-2761-4a4f-9c7d-0e81ae2eca20&quot;,&quot;parentUUID&quot;:&quot;b0c19749-2598-4194-93fb-74f017543963&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Get request is forbidden due to querying other&#x27;s received connection requests&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 9: Get request is forbidden due to querying other&#x27;s received connection requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?receiver_erp=${receiver_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp !== receiver_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b83a2245-9f0c-4d6b-9811-94c5abd6a2ea&quot;,&quot;parentUUID&quot;:&quot;b0c19749-2598-4194-93fb-74f017543963&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Get all connection requests is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 10: Get all connection requests is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4a689492-0785-417e-bb43-b58068162caa&quot;,&quot;parentUUID&quot;:&quot;b0c19749-2598-4194-93fb-74f017543963&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3add4b70-5cdf-4a9e-ac8d-81386464ce17&quot;,&quot;94b97af5-b19d-4243-9bb3-a61330bd9fb2&quot;,&quot;fb9eae2b-5ece-417c-b2d4-5fe28cf33996&quot;,&quot;23dc23cf-2b06-405a-8d30-219b0f46592a&quot;,&quot;11716073-cc70-4928-a44a-f4f93455c6c7&quot;,&quot;67bc5968-ea71-4e4f-819e-70afc4fbb797&quot;,&quot;02f19f23-df27-4b08-b7bb-bc341f1cccb1&quot;,&quot;420a9e38-2761-4a4f-9c7d-0e81ae2eca20&quot;,&quot;b83a2245-9f0c-4d6b-9811-94c5abd6a2ea&quot;,&quot;4a689492-0785-417e-bb43-b58068162caa&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:78,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;8248cada-69ac-499b-9591-a144e8430ff8&quot;,&quot;title&quot;:&quot;POST /student-connections&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a connection request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 1: Create a connection request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp, receiver_erp, sent_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // token erp === sender_erp in body\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.student_connection_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // token erp === sender_erp in body\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    student_connection_id: newId,\n    ...data,\n    connection_status: existingConnectionRequest.connection_status,\n    accepted_at: null,\n    student_1_erp: data.receiver_erp, // 17619, bcz smaller\n    student_2_erp: data.sender_erp // 17855, bcz greater\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // sender deletes it\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;83f652b6-faf2-4f93-86ea-1080ceee623e&quot;,&quot;parentUUID&quot;:&quot;8248cada-69ac-499b-9591-a144e8430ff8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a connection request is unsuccessful due to unknown receiver_erp&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 2: Create a connection request is unsuccessful due to unknown receiver_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: existingConnectionRequest.sender.erp,\n    receiver_erp: unknownStudentERP,\n    sent_at\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === existingStudentConnection.sender.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;receiver_erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1bcaf731-46ce-4066-bfa7-a2da20f87182&quot;,&quot;parentUUID&quot;:&quot;8248cada-69ac-499b-9591-a144e8430ff8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a connection request is unsuccessful due to already sent connection request&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 3: Create a connection request is unsuccessful due to already sent connection request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: existingConnectionRequest.sender.erp,\n    receiver_erp: existingConnectionRequest.receiver.erp,\n    sent_at\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === existingStudentConnection.sender.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(409);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DuplicateEntryException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a1e25b54-8a90-467f-a435-1ca76089b02a&quot;,&quot;parentUUID&quot;:&quot;8248cada-69ac-499b-9591-a144e8430ff8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a connection request is unsuccessful due to already received connection request&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 4: Create a connection request is unsuccessful due to already received connection request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: existingConnectionRequest.receiver.erp,\n    receiver_erp: existingConnectionRequest.sender.erp, // flip receiver and sender\n    sent_at\n};\nconst senderToken = jwt.sign({erp: data.sender_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(senderToken, { type: &#x27;bearer&#x27; }) // senderToken erp === data.sender_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(409);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DuplicateEntryException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5d1e5060-1fb8-4c51-8467-8c985c99291d&quot;,&quot;parentUUID&quot;:&quot;8248cada-69ac-499b-9591-a144e8430ff8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a connection request is incorrect due to wrong key name in the body&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 5: Create a connection request is incorrect due to wrong key name in the body&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { // missing receiver_erp\n    sent_at: &#x27;not going&#x27;, // &lt;-- not a valid sent_at\n    send_erp: &#x27;12345&#x27; // &lt;-- a valid parameter name should be &#x27;sender_erp&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;receiver_erp&#x27;, &#x27;sent_at&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;31fe7691-41f3-42de-8e58-e7fc9b3ff146&quot;,&quot;parentUUID&quot;:&quot;8248cada-69ac-499b-9591-a144e8430ff8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a connection request is incorrect due to connection request to oneself&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 6: Create a connection request is incorrect due to connection request to oneself&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: sender_erp,\n    receiver_erp: sender_erp,\n    sent_at\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === data.sender_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;receiver_erp&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Sender and receiver ERP can\\&#x27;t be the same&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;02f0cd6d-c2cd-4133-aec2-61644f26f53d&quot;,&quot;parentUUID&quot;:&quot;8248cada-69ac-499b-9591-a144e8430ff8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Create a connection request is forbidden due to unowned connection request&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 7: Create a connection request is forbidden due to unowned connection request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp: adminERP, receiver_erp, sent_at }; // adminERP instead of userERP\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- data.sender_erp !== userToken.erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b012f9ac-f7ef-4c9a-aed9-386265349db9&quot;,&quot;parentUUID&quot;:&quot;8248cada-69ac-499b-9591-a144e8430ff8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Create a connection request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 8: Create a connection request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp, receiver_erp, sent_at };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e3ff3bf2-7675-4b39-b9c7-06276f77dd4e&quot;,&quot;parentUUID&quot;:&quot;8248cada-69ac-499b-9591-a144e8430ff8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;83f652b6-faf2-4f93-86ea-1080ceee623e&quot;,&quot;1bcaf731-46ce-4066-bfa7-a2da20f87182&quot;,&quot;a1e25b54-8a90-467f-a435-1ca76089b02a&quot;,&quot;5d1e5060-1fb8-4c51-8467-8c985c99291d&quot;,&quot;31fe7691-41f3-42de-8e58-e7fc9b3ff146&quot;,&quot;02f0cd6d-c2cd-4133-aec2-61644f26f53d&quot;,&quot;b012f9ac-f7ef-4c9a-aed9-386265349db9&quot;,&quot;e3ff3bf2-7675-4b39-b9c7-06276f77dd4e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:91,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6122347f-b80e-48ea-9e26-b06317e3ae76&quot;,&quot;title&quot;:&quot;PATCH /student-connections/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a connection request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API PATCH /student-connections/:id Scenario 1: Update a connection request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { connection_status, accepted_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminToken.erp == existingStudentConnection.receiver.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${studentConnectionId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst {sender, receiver, ...studentConnection} = existingConnectionRequest;\n\nstudentConnection.sender_erp = existingConnectionRequest.sender.erp;\nstudentConnection.receiver_erp = existingConnectionRequest.receiver.erp; // 15030, bcz smaller\nstudentConnection.student_1_erp = existingConnectionRequest.receiver.erp; // 15030, bcz smaller\nstudentConnection.student_2_erp = existingConnectionRequest.sender.erp; // 17855, bcz greater\nstudentConnection.accepted_at = data.accepted_at;\nstudentConnection.connection_status = data.connection_status;\nexpect(res.body.body).to.be.eql(studentConnection);\n\n// cleanup\ndata.connection_status = existingConnectionRequest.connection_status;\ndata.accepted_at = existingConnectionRequest.accepted_at;\nres = await request(app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminToken.erp == existingStudentConnection.receiver.erp\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bfdd0de2-967f-4d21-bc29-4e35090b0863&quot;,&quot;parentUUID&quot;:&quot;6122347f-b80e-48ea-9e26-b06317e3ae76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a connection request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API PATCH /student-connections/:id Scenario 2: Update a connection request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    connection_status: &#x27;ignored&#x27;, // &lt;-- not a valid connection_status\n    accepted_at, // can&#x27;t specify accepted at unless connection_status === &#x27;friends&#x27;\n    sender_erp: &#x27;12345&#x27; // &lt;-- an invalid update parameter i.e. not allowed\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;connection_status&#x27;, &#x27;accepted_at&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include.members([&#x27;Invalid updates!&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;12a31ce6-6ae5-4810-9673-a08c42937ad1&quot;,&quot;parentUUID&quot;:&quot;6122347f-b80e-48ea-9e26-b06317e3ae76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a connection request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API PATCH /student-connections/:id Scenario 3: Update a connection request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { connection_status, accepted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- userToken.erp !== existingStudentConnection.receiver.erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;02d42b82-857b-42a6-ac43-50109c7c639e&quot;,&quot;parentUUID&quot;:&quot;6122347f-b80e-48ea-9e26-b06317e3ae76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a connection request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API PATCH /student-connections/:id Scenario 4: Update a connection request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { connection_status, accepted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;18fc6f46-bfed-4e6e-a92b-3102bf8d1ce9&quot;,&quot;parentUUID&quot;:&quot;6122347f-b80e-48ea-9e26-b06317e3ae76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bfdd0de2-967f-4d21-bc29-4e35090b0863&quot;,&quot;12a31ce6-6ae5-4810-9673-a08c42937ad1&quot;,&quot;02d42b82-857b-42a6-ac43-50109c7c639e&quot;,&quot;18fc6f46-bfed-4e6e-a92b-3102bf8d1ce9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:49,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;fae84488-1bb6-4883-b393-5e39be18c128&quot;,&quot;title&quot;:&quot;DELETE /student-connections/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a connection request is successful (Sender cancels)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 1: Delete a connection request is successful (Sender cancels)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { sender_erp, receiver_erp, sent_at };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\nconst newId = res.body.body.student_connection_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp === sender_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;81e2be5a-b1f6-464d-ad0c-0c010332e4a6&quot;,&quot;parentUUID&quot;:&quot;fae84488-1bb6-4883-b393-5e39be18c128&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a connection request is successful (Receiver rejects)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 2: Delete a connection request is successful (Receiver rejects)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { sender_erp, receiver_erp, sent_at };\nconst app = this.app;\nconst receiverToken = jwt.sign({erp: data.receiver_erp}, Config.SECRET_JWT);\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\nconst newId = res.body.body.student_connection_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(receiverToken, { type: &#x27;bearer&#x27; }); // &lt;-- receiverToken.erp === receiver_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;20425f74-7f05-4e1b-9c1f-f5dde078f7f8&quot;,&quot;parentUUID&quot;:&quot;fae84488-1bb6-4883-b393-5e39be18c128&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a connection request is unsuccessful due to unknown id&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 3: Delete a connection request is unsuccessful due to unknown id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownConnectionRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fc9acb1a-9f6e-4853-be25-3de490c05c83&quot;,&quot;parentUUID&quot;:&quot;fae84488-1bb6-4883-b393-5e39be18c128&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a connection request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 4: Delete a connection request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst forbiddenToken = jwt.sign({erp: receiver_erp}, Config.SECRET_JWT);\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${studentConnectionId}`)\n    .auth(forbiddenToken, { type: &#x27;bearer&#x27; }); // forbiddenToken.erp !== receiver_erp or sender_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;50fed3eb-4677-4951-a39e-a20f1ccd34bd&quot;,&quot;parentUUID&quot;:&quot;fae84488-1bb6-4883-b393-5e39be18c128&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a connection request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 5: Delete a connection request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${studentConnectionId}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0d0ac9bb-7406-4708-8cd5-f91564e62cd1&quot;,&quot;parentUUID&quot;:&quot;fae84488-1bb6-4883-b393-5e39be18c128&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;81e2be5a-b1f6-464d-ad0c-0c010332e4a6&quot;,&quot;20425f74-7f05-4e1b-9c1f-f5dde078f7f8&quot;,&quot;fc9acb1a-9f6e-4853-be25-3de490c05c83&quot;,&quot;50fed3eb-4677-4951-a39e-a20f1ccd34bd&quot;,&quot;0d0ac9bb-7406-4708-8cd5-f91564e62cd1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:67,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c6a4a2ff-903b-4678-94ce-f8732c1fba61&quot;,&quot;title&quot;:&quot;Student Statuses API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Student Statuses API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API \&quot;before each\&quot; hook in \&quot;Student Statuses API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ab3765b3-4774-4f8f-9cce-b5b2a4e30675&quot;,&quot;parentUUID&quot;:&quot;c6a4a2ff-903b-4678-94ce-f8732c1fba61&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bc2de4b2-6565-409d-a53f-b1cf147d9831&quot;,&quot;title&quot;:&quot;GET /student-statuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all student statuses request successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses Scenario 1: Get all student statuses request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;student_status_id&#x27;, &#x27;student_status&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;88588f7f-b43d-4fdd-8053-c976da9af247&quot;,&quot;parentUUID&quot;:&quot;bc2de4b2-6565-409d-a53f-b1cf147d9831&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all student statuses request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses Scenario 2: Get all student statuses request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:556,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentStatusModel = require(&#x27;../../src/models/studentStatus.model&#x27;);\nconst modelStub = sinon.stub(StudentStatusModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty student_status list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student statuses not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7fe30145-f6b3-45d4-92d0-9a8693ea90f6&quot;,&quot;parentUUID&quot;:&quot;bc2de4b2-6565-409d-a53f-b1cf147d9831&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;88588f7f-b43d-4fdd-8053-c976da9af247&quot;,&quot;7fe30145-f6b3-45d4-92d0-9a8693ea90f6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:566,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a20360f6-6875-422f-8530-1d6919b3d1a0&quot;,&quot;title&quot;:&quot;GET /student-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student status request successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses/:id Scenario 1: Get a student status request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;student_status_id&#x27;, &#x27;student_status&#x27;]);\nexpect(resBody.student_status_id).to.be.eql(existingStudentStatus.student_status_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6ddebb27-acf5-4e38-b133-84d0d42b7af2&quot;,&quot;parentUUID&quot;:&quot;a20360f6-6875-422f-8530-1d6919b3d1a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses/:id Scenario 2: Get a student status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownStudentStatusId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student status not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fae89409-4eb3-442f-b526-e1ae47304662&quot;,&quot;parentUUID&quot;:&quot;a20360f6-6875-422f-8530-1d6919b3d1a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses/:id Scenario 3: Get a student status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudentStatus.student_status_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;42c30d7e-2730-485b-9d83-b0017105a9a1&quot;,&quot;parentUUID&quot;:&quot;a20360f6-6875-422f-8530-1d6919b3d1a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6ddebb27-acf5-4e38-b133-84d0d42b7af2&quot;,&quot;fae89409-4eb3-442f-b526-e1ae47304662&quot;,&quot;42c30d7e-2730-485b-9d83-b0017105a9a1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a2c48036-f294-4441-80ce-e520c9c6d3c6&quot;,&quot;title&quot;:&quot;POST /student-statuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a student status request is successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API POST /student-statuses Scenario 1: Create a student status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;student_status_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.student_status_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    student_status_id: newId,\n    student_status: student_status\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d9c4167a-cb1b-4db3-9218-f049b06dfb0e&quot;,&quot;parentUUID&quot;:&quot;a2c48036-f294-4441-80ce-e520c9c6d3c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a student status request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API POST /student-statuses Scenario 2: Create a student status request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    student_statuses: student_status // &lt;-- a valid parameter name should be &#x27;student_status&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;student_status&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e640cc99-461b-4b1a-8aa2-bf5ba28e022a&quot;,&quot;parentUUID&quot;:&quot;a2c48036-f294-4441-80ce-e520c9c6d3c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a student status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API POST /student-statuses Scenario 3: Create a student status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;18a9b389-3f9a-48cb-b8bd-b2e2a9fcaab1&quot;,&quot;parentUUID&quot;:&quot;a2c48036-f294-4441-80ce-e520c9c6d3c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a student status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API POST /student-statuses Scenario 4: Create a student status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;56f0e3ac-3e8b-4a6d-88fc-ab403b7f002a&quot;,&quot;parentUUID&quot;:&quot;a2c48036-f294-4441-80ce-e520c9c6d3c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d9c4167a-cb1b-4db3-9218-f049b06dfb0e&quot;,&quot;e640cc99-461b-4b1a-8aa2-bf5ba28e022a&quot;,&quot;18a9b389-3f9a-48cb-b8bd-b2e2a9fcaab1&quot;,&quot;56f0e3ac-3e8b-4a6d-88fc-ab403b7f002a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:91,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;4deba8ca-a8e8-4b35-883f-be7ba6d84614&quot;,&quot;title&quot;:&quot;PATCH /student-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a student status request is successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 1: Update a student status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status: newStudentStatus };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    student_status_id: existingStudentStatus.student_status_id,\n    student_status: newStudentStatus\n});\n\n// cleanup\ndata.student_status = existingStudentStatus.student_status;\nres = await request(app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3a5dedfe-2ef4-48f2-8171-4780188cd5b7&quot;,&quot;parentUUID&quot;:&quot;4deba8ca-a8e8-4b35-883f-be7ba6d84614&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a student status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 2: Update a student status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status: newStudentStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownStudentStatusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student status not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bcf2f6db-5647-4c97-8c91-e3d000f4f7c4&quot;,&quot;parentUUID&quot;:&quot;4deba8ca-a8e8-4b35-883f-be7ba6d84614&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a student status request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 3: Update a student status request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    student_statuses: newStudentStatus // &lt;-- a valid parameter name should be &#x27;student_status&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;student_status&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;80e3906b-6868-4e40-8f08-4acef5f46211&quot;,&quot;parentUUID&quot;:&quot;4deba8ca-a8e8-4b35-883f-be7ba6d84614&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a student status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 4: Update a student status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status: newStudentStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;163637b2-fb5b-47cd-a154-d4686d37ea07&quot;,&quot;parentUUID&quot;:&quot;4deba8ca-a8e8-4b35-883f-be7ba6d84614&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a student status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 5: Update a student status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status: newStudentStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ac4352d8-70e8-457a-9d35-b7efff2085c4&quot;,&quot;parentUUID&quot;:&quot;4deba8ca-a8e8-4b35-883f-be7ba6d84614&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3a5dedfe-2ef4-48f2-8171-4780188cd5b7&quot;,&quot;bcf2f6db-5647-4c97-8c91-e3d000f4f7c4&quot;,&quot;80e3906b-6868-4e40-8f08-4acef5f46211&quot;,&quot;163637b2-fb5b-47cd-a154-d4686d37ea07&quot;,&quot;ac4352d8-70e8-457a-9d35-b7efff2085c4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:62,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;783aa81e-52cc-474e-b96a-4e66dc55b062&quot;,&quot;title&quot;:&quot;DELETE /student-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a student status request is successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API DELETE /student-statuses/:id Scenario 1: Delete a student status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { student_status };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.student_status_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student status has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;49c91b1a-879c-4454-9392-b7d8ab814f2c&quot;,&quot;parentUUID&quot;:&quot;783aa81e-52cc-474e-b96a-4e66dc55b062&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a student status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API DELETE /student-statuses/:id Scenario 2: Delete a student status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownStudentStatusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student status not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;829162ce-fe8e-48ff-b7fc-04181aac3356&quot;,&quot;parentUUID&quot;:&quot;783aa81e-52cc-474e-b96a-4e66dc55b062&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a student status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API DELETE /student-statuses/:id Scenario 3: Delete a student status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;74534de9-8d1f-46c2-8b12-dd8ab643a4e0&quot;,&quot;parentUUID&quot;:&quot;783aa81e-52cc-474e-b96a-4e66dc55b062&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a student status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API DELETE /student-statuses/:id Scenario 4: Delete a student status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudentStatus.student_status_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c88ad92f-0cc4-4867-be01-6fe036ee9021&quot;,&quot;parentUUID&quot;:&quot;783aa81e-52cc-474e-b96a-4e66dc55b062&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;49c91b1a-879c-4454-9392-b7d8ab814f2c&quot;,&quot;829162ce-fe8e-48ff-b7fc-04181aac3356&quot;,&quot;74534de9-8d1f-46c2-8b12-dd8ab643a4e0&quot;,&quot;c88ad92f-0cc4-4867-be01-6fe036ee9021&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:47,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;e75f78a8-a2f8-415b-b3e6-e2068aa31be2&quot;,&quot;title&quot;:&quot;Subjects API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Subjects API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Subjects API \&quot;before each\&quot; hook in \&quot;Subjects API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b3e26aa8-6595-459a-b0f4-cb39a612390b&quot;,&quot;parentUUID&quot;:&quot;e75f78a8-a2f8-415b-b3e6-e2068aa31be2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;eed2c500-701a-497e-bbff-05a1bdada08c&quot;,&quot;title&quot;:&quot;GET /subjects&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all subjects request successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects Scenario 1: Get all subjects request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys([&#x27;subject_code&#x27;, &#x27;subject&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2d1380ab-602c-4b53-8aab-96e3f5de1682&quot;,&quot;parentUUID&quot;:&quot;eed2c500-701a-497e-bbff-05a1bdada08c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all subjects request unsuccessful due to zero subjects&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects Scenario 2: Get all subjects request unsuccessful due to zero subjects&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:563,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst SubjectModel = require(&#x27;../../src/models/subject.model&#x27;);\nconst modelStub = sinon.stub(SubjectModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty subject list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subjects not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;883b8b16-1122-4f01-b1f8-f97ff3e1cf38&quot;,&quot;parentUUID&quot;:&quot;eed2c500-701a-497e-bbff-05a1bdada08c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects Scenario 3: Get a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c647413e-a5d4-4540-901c-655e7b321b22&quot;,&quot;parentUUID&quot;:&quot;eed2c500-701a-497e-bbff-05a1bdada08c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all subjects request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects Scenario 4: Get all subjects request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1e785ff6-8b27-43c2-b153-01f587d768c5&quot;,&quot;parentUUID&quot;:&quot;eed2c500-701a-497e-bbff-05a1bdada08c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2d1380ab-602c-4b53-8aab-96e3f5de1682&quot;,&quot;883b8b16-1122-4f01-b1f8-f97ff3e1cf38&quot;,&quot;c647413e-a5d4-4540-901c-655e7b321b22&quot;,&quot;1e785ff6-8b27-43c2-b153-01f587d768c5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:579,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;05da34a8-1297-48bc-b6d7-a1080dcf20da&quot;,&quot;title&quot;:&quot;GET /subjects/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a subject request successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects/:id Scenario 1: Get a subject request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys([&#x27;subject_code&#x27;, &#x27;subject&#x27;]);\nexpect(resBody.subject_code).to.be.equal(existingSubject.subject_code); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;be6327c1-090e-4ec0-a042-6a32877cc6a5&quot;,&quot;parentUUID&quot;:&quot;05da34a8-1297-48bc-b6d7-a1080dcf20da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a subject request is unsuccessful due to unknown subject&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects/:id Scenario 2: Get a subject request is unsuccessful due to unknown subject&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownSubjectId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subject not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9cbff781-5261-4522-80eb-3aa44ad6998c&quot;,&quot;parentUUID&quot;:&quot;05da34a8-1297-48bc-b6d7-a1080dcf20da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects/:id Scenario 3: Get a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;48242bc7-a0fc-4cf9-b2d6-31aaf6334016&quot;,&quot;parentUUID&quot;:&quot;05da34a8-1297-48bc-b6d7-a1080dcf20da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects/:id Scenario 4: Get a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingSubject.subject_code}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3f9247bd-be63-4277-8de5-eee11921dd78&quot;,&quot;parentUUID&quot;:&quot;05da34a8-1297-48bc-b6d7-a1080dcf20da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;be6327c1-090e-4ec0-a042-6a32877cc6a5&quot;,&quot;9cbff781-5261-4522-80eb-3aa44ad6998c&quot;,&quot;48242bc7-a0fc-4cf9-b2d6-31aaf6334016&quot;,&quot;3f9247bd-be63-4277-8de5-eee11921dd78&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:40,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;07f917b5-764a-4b4b-be7a-f01445c4655e&quot;,&quot;title&quot;:&quot;POST /subjects&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a subject request is successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API POST /subjects Scenario 1: Create a subject request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject, subject_code };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = data.subject_code;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    subject_code: newId,\n    subject: subject\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d4b176c0-7aee-44e1-8cf5-6ff52ace4b40&quot;,&quot;parentUUID&quot;:&quot;07f917b5-764a-4b4b-be7a-f01445c4655e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a subject request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Subjects API POST /subjects Scenario 2: Create a subject request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    subjects: subject // &lt;-- a valid parameter name should be &#x27;subject&#x27;\n    // subject_code is required\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;subject&#x27;, &#x27;subject_code&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f7944cd0-08c8-4094-b053-90a301536845&quot;,&quot;parentUUID&quot;:&quot;07f917b5-764a-4b4b-be7a-f01445c4655e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API POST /subjects Scenario 3: Create a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject, subject_code };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;34a2eee0-2790-4b1a-8189-98179aa81417&quot;,&quot;parentUUID&quot;:&quot;07f917b5-764a-4b4b-be7a-f01445c4655e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API POST /subjects Scenario 4: Create a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject, subject_code };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0502c375-f19e-41f0-bd85-7d83024edada&quot;,&quot;parentUUID&quot;:&quot;07f917b5-764a-4b4b-be7a-f01445c4655e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d4b176c0-7aee-44e1-8cf5-6ff52ace4b40&quot;,&quot;f7944cd0-08c8-4094-b053-90a301536845&quot;,&quot;34a2eee0-2790-4b1a-8189-98179aa81417&quot;,&quot;0502c375-f19e-41f0-bd85-7d83024edada&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:83,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;957f348d-e1b3-4a5f-af85-18a754648454&quot;,&quot;title&quot;:&quot;PATCH /subjects/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a subject request is successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 1: Update a subject request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject: newSubject };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    subject_code: existingSubject.subject_code,\n    subject: newSubject\n});\n\n// cleanup\ndata.subject = existingSubject.subject;\nres = await request(app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8169c400-4fee-44bb-b274-36bca3f4475e&quot;,&quot;parentUUID&quot;:&quot;957f348d-e1b3-4a5f-af85-18a754648454&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a subject request is unsuccessful due to unknown subject code&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 2: Update a subject request is unsuccessful due to unknown subject code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject: newSubject };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownSubjectId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subject not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bfa2be1a-11b5-4ea2-b422-98182d77edd3&quot;,&quot;parentUUID&quot;:&quot;957f348d-e1b3-4a5f-af85-18a754648454&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a subject request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 3: Update a subject request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    subjects: newSubject // &lt;-- a valid parameter name should be &#x27;subject&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;subject&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b71d1181-a165-449f-879a-b3a688349225&quot;,&quot;parentUUID&quot;:&quot;957f348d-e1b3-4a5f-af85-18a754648454&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 4: Update a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject: newSubject };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a8d0dc4b-1fa6-498e-8463-aa9cb48b0baf&quot;,&quot;parentUUID&quot;:&quot;957f348d-e1b3-4a5f-af85-18a754648454&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 5: Update a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject: newSubject };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;db871ff0-9c2a-4c26-92d7-0a6ee609ca1d&quot;,&quot;parentUUID&quot;:&quot;957f348d-e1b3-4a5f-af85-18a754648454&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8169c400-4fee-44bb-b274-36bca3f4475e&quot;,&quot;bfa2be1a-11b5-4ea2-b422-98182d77edd3&quot;,&quot;b71d1181-a165-449f-879a-b3a688349225&quot;,&quot;a8d0dc4b-1fa6-498e-8463-aa9cb48b0baf&quot;,&quot;db871ff0-9c2a-4c26-92d7-0a6ee609ca1d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:56,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;4a30c7a7-917c-41ef-8e81-64c036cdd432&quot;,&quot;title&quot;:&quot;DELETE /subjects/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a subject request is successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API DELETE /subjects/:id Scenario 1: Delete a subject request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { subject, subject_code };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = data.subject_code;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subject has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a3c687bf-d11c-4652-87ea-77a51b08a287&quot;,&quot;parentUUID&quot;:&quot;4a30c7a7-917c-41ef-8e81-64c036cdd432&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a subject request is unsuccessful due to unknown subject code&quot;,&quot;fullTitle&quot;:&quot;Subjects API DELETE /subjects/:id Scenario 2: Delete a subject request is unsuccessful due to unknown subject code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownSubjectId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subject not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ad76aefd-1eed-4dff-bc2c-bddfdca4dc2b&quot;,&quot;parentUUID&quot;:&quot;4a30c7a7-917c-41ef-8e81-64c036cdd432&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API DELETE /subjects/:id Scenario 3: Delete a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b5be77fa-6036-4248-a63a-acfd049249d4&quot;,&quot;parentUUID&quot;:&quot;4a30c7a7-917c-41ef-8e81-64c036cdd432&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API DELETE /subjects/:id Scenario 4: Delete a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingSubject.subject_code}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e1d0fd87-e73e-41d4-8e2c-c095fc10a63f&quot;,&quot;parentUUID&quot;:&quot;4a30c7a7-917c-41ef-8e81-64c036cdd432&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a3c687bf-d11c-4652-87ea-77a51b08a287&quot;,&quot;ad76aefd-1eed-4dff-bc2c-bddfdca4dc2b&quot;,&quot;b5be77fa-6036-4248-a63a-acfd049249d4&quot;,&quot;e1d0fd87-e73e-41d4-8e2c-c095fc10a63f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:43,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;676c869d-f04d-466a-9f59-b5659d8caec5&quot;,&quot;title&quot;:&quot;Teachers API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Teachers API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Teachers API \&quot;before each\&quot; hook in \&quot;Teachers API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;40803bbb-562f-4b52-baa3-0b3853e3c7c7&quot;,&quot;parentUUID&quot;:&quot;676c869d-f04d-466a-9f59-b5659d8caec5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0d1680d4-b2fa-44e7-89e5-f018a7e9742f&quot;,&quot;title&quot;:&quot;GET /teachers&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all teachers request successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers Scenario 1: Get all teachers request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTeacher));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5faf2b52-59b8-4752-bd5f-7cdf4bced91c&quot;,&quot;parentUUID&quot;:&quot;0d1680d4-b2fa-44e7-89e5-f018a7e9742f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all teachers request unsuccessful due to zero teachers&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers Scenario 2: Get all teachers request unsuccessful due to zero teachers&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:560,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TeacherModel = require(&#x27;../../src/models/teacher.model&#x27;);\nconst modelStub = sinon.stub(TeacherModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty teacher list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8f9f3c80-2ff2-4a31-a070-6a9ce6666a8f&quot;,&quot;parentUUID&quot;:&quot;0d1680d4-b2fa-44e7-89e5-f018a7e9742f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers Scenario 3: Get a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c3a29ae7-a8cf-4dde-be72-ecf4a537fa51&quot;,&quot;parentUUID&quot;:&quot;0d1680d4-b2fa-44e7-89e5-f018a7e9742f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all teachers request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers Scenario 4: Get all teachers request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7752f994-3cb1-4f99-a3ef-b7831b96e0fa&quot;,&quot;parentUUID&quot;:&quot;0d1680d4-b2fa-44e7-89e5-f018a7e9742f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5faf2b52-59b8-4752-bd5f-7cdf4bced91c&quot;,&quot;8f9f3c80-2ff2-4a31-a070-6a9ce6666a8f&quot;,&quot;c3a29ae7-a8cf-4dde-be72-ecf4a537fa51&quot;,&quot;7752f994-3cb1-4f99-a3ef-b7831b96e0fa&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:584,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;e9f2ec8b-57e6-4563-8bb5-eb35dd00bef6&quot;,&quot;title&quot;:&quot;GET /teachers/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a teacher request successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers/:id Scenario 1: Get a teacher request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingTeacher));\nexpect(resBody.teacher_id).to.be.equal(existingTeacher.teacher_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;93a529b4-b3c4-4b5a-832a-dc9b61f0bc67&quot;,&quot;parentUUID&quot;:&quot;e9f2ec8b-57e6-4563-8bb5-eb35dd00bef6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers/:id Scenario 2: Get a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTeacherId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6b7fffde-fbc5-4d04-b3aa-18f5e4f80cf8&quot;,&quot;parentUUID&quot;:&quot;e9f2ec8b-57e6-4563-8bb5-eb35dd00bef6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers/:id Scenario 3: Get a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3f5cade4-b5b2-4fd2-b114-ea0f38b189c3&quot;,&quot;parentUUID&quot;:&quot;e9f2ec8b-57e6-4563-8bb5-eb35dd00bef6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a teacher request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers/:id Scenario 4: Get a teacher request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTeacher.teacher_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;673df876-1b54-48c0-982d-3e264061af88&quot;,&quot;parentUUID&quot;:&quot;e9f2ec8b-57e6-4563-8bb5-eb35dd00bef6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;93a529b4-b3c4-4b5a-832a-dc9b61f0bc67&quot;,&quot;6b7fffde-fbc5-4d04-b3aa-18f5e4f80cf8&quot;,&quot;3f5cade4-b5b2-4fd2-b114-ea0f38b189c3&quot;,&quot;673df876-1b54-48c0-982d-3e264061af88&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:32,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9f1a2b12-530a-44f7-aedd-5691db80d608&quot;,&quot;title&quot;:&quot;POST /teachers&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a teacher request is successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API POST /teachers Scenario 1: Create a teacher request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;teacher_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.teacher_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    teacher_id: newId,\n    average_rating: \&quot;0.000\&quot;,\n    total_reviews: 0,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ec0f00c5-fd07-4932-bd4d-48ca24e0a866&quot;,&quot;parentUUID&quot;:&quot;9f1a2b12-530a-44f7-aedd-5691db80d608&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a teacher request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Teachers API POST /teachers Scenario 2: Create a teacher request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    full_names: full_name // &lt;-- a valid parameter name is &#x27;full_name&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;full_name&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;96e7e532-280b-46ba-a534-b4f64110de59&quot;,&quot;parentUUID&quot;:&quot;9f1a2b12-530a-44f7-aedd-5691db80d608&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API POST /teachers Scenario 3: Create a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4f17951b-4c88-49e8-b915-7d70f24b438e&quot;,&quot;parentUUID&quot;:&quot;9f1a2b12-530a-44f7-aedd-5691db80d608&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a teacher request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API POST /teachers Scenario 4: Create a teacher request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;12d17c03-7d2d-4c17-9c28-81eaad2834f8&quot;,&quot;parentUUID&quot;:&quot;9f1a2b12-530a-44f7-aedd-5691db80d608&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ec0f00c5-fd07-4932-bd4d-48ca24e0a866&quot;,&quot;96e7e532-280b-46ba-a534-b4f64110de59&quot;,&quot;4f17951b-4c88-49e8-b915-7d70f24b438e&quot;,&quot;12d17c03-7d2d-4c17-9c28-81eaad2834f8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:83,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;109b0212-c9c0-405b-8109-dcc41d35cf8d&quot;,&quot;title&quot;:&quot;PATCH /teachers/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a teacher request is successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 1: Update a teacher request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name: newTeacherName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    teacher_id: existingTeacher.teacher_id,\n    full_name: newTeacherName,\n    average_rating: existingTeacher.average_rating,\n    total_reviews: existingTeacher.total_reviews\n});\n\n// cleanup\ndata.full_name = existingTeacher.full_name;\nres = await request(app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;726d6ebd-76c9-4f8e-9c08-ca4d4914342a&quot;,&quot;parentUUID&quot;:&quot;109b0212-c9c0-405b-8109-dcc41d35cf8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 2: Update a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name: newTeacherName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTeacherId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f94f7b17-5cb8-4319-8eb6-e98c5731a0b4&quot;,&quot;parentUUID&quot;:&quot;109b0212-c9c0-405b-8109-dcc41d35cf8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a teacher request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 3: Update a teacher request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    full_names: newTeacherName // &lt;-- a invalid update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;full_name&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;861a3036-ba35-4927-b511-dda9553cd863&quot;,&quot;parentUUID&quot;:&quot;109b0212-c9c0-405b-8109-dcc41d35cf8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 4: Update a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name: newTeacherName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bc6558dc-0917-46fd-b388-107db9c487e7&quot;,&quot;parentUUID&quot;:&quot;109b0212-c9c0-405b-8109-dcc41d35cf8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a teacher request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 5: Update a teacher request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name: newTeacherName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1a6cc4af-6d0c-4822-9e8d-d172ccffffcb&quot;,&quot;parentUUID&quot;:&quot;109b0212-c9c0-405b-8109-dcc41d35cf8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;726d6ebd-76c9-4f8e-9c08-ca4d4914342a&quot;,&quot;f94f7b17-5cb8-4319-8eb6-e98c5731a0b4&quot;,&quot;861a3036-ba35-4927-b511-dda9553cd863&quot;,&quot;bc6558dc-0917-46fd-b388-107db9c487e7&quot;,&quot;1a6cc4af-6d0c-4822-9e8d-d172ccffffcb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:54,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d2b2e2fe-7e84-42dc-8edc-c129ac3b77cd&quot;,&quot;title&quot;:&quot;DELETE /teachers/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a teacher request is successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API DELETE /teachers/:id Scenario 1: Delete a teacher request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { full_name };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.teacher_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c178a569-c4f1-484d-9107-25dd4dd1f3e7&quot;,&quot;parentUUID&quot;:&quot;d2b2e2fe-7e84-42dc-8edc-c129ac3b77cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Teachers API DELETE /teachers/:id Scenario 2: Delete a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTeacherId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;42dc5dab-f9cd-4eae-9f23-06bff37588ff&quot;,&quot;parentUUID&quot;:&quot;d2b2e2fe-7e84-42dc-8edc-c129ac3b77cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API DELETE /teachers/:id Scenario 3: Delete a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9e4b7957-7c21-491c-b32f-d3d69c576a3c&quot;,&quot;parentUUID&quot;:&quot;d2b2e2fe-7e84-42dc-8edc-c129ac3b77cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a teacher request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API DELETE /teachers/:id Scenario 4: Delete a teacher request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacher.teacher_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9a31e8c5-be3b-4609-8c5d-08b9b1fbb242&quot;,&quot;parentUUID&quot;:&quot;d2b2e2fe-7e84-42dc-8edc-c129ac3b77cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c178a569-c4f1-484d-9107-25dd4dd1f3e7&quot;,&quot;42dc5dab-f9cd-4eae-9f23-06bff37588ff&quot;,&quot;9e4b7957-7c21-491c-b32f-d3d69c576a3c&quot;,&quot;9a31e8c5-be3b-4609-8c5d-08b9b1fbb242&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:56,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6f1a04f3-5f26-4dbf-bdf2-de187c06c15a&quot;,&quot;title&quot;:&quot;Teacher Reviews API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Teacher Reviews API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API \&quot;before each\&quot; hook in \&quot;Teacher Reviews API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b2ac978f-214e-45e7-8e79-71bbc0318d25&quot;,&quot;parentUUID&quot;:&quot;6f1a04f3-5f26-4dbf-bdf2-de187c06c15a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7f373799-20e4-4861-9251-511b576df874&quot;,&quot;title&quot;:&quot;GET /teacher-reviews&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all teacher reviews request successful&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 1: Get all teacher reviews request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst teacher_id = existingTeacherReview.teacher_id;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?teacher_id=${teacher_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst reviewerCheck = review =&gt; review.teacher_id === teacher_id;\nexpect(resBody.every(reviewerCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTeacherReview));\nexpect(resBody[0].subject).to.include.all.keys(Object.keys(existingTeacherReview.subject));\nexpect(resBody[0].reviewed_by).to.include.all.keys(Object.keys(existingTeacherReview.reviewed_by));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;85393223-7cb9-4d00-8e84-164e7c39907c&quot;,&quot;parentUUID&quot;:&quot;7f373799-20e4-4861-9251-511b576df874&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all teacher reviews request unsuccessful due to zero teacher reviews&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 2: Get all teacher reviews request unsuccessful due to zero teacher reviews&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:552,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TeacherReviewModel = require(&#x27;../../src/models/teacherReview.model&#x27;);\nconst modelStub = sinon.stub(TeacherReviewModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty teacher review list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}?teacher_id=${existingTeacherReview.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;99db6736-5e07-484c-88a1-3c61c0a82af1&quot;,&quot;parentUUID&quot;:&quot;7f373799-20e4-4861-9251-511b576df874&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all teacher reviews is incorrect due to no query params&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 3: Get all teacher reviews is incorrect due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute) // needs teacher_id\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;TeacherID is required for the teacherReview&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;22e12a44-aff0-4852-b8cd-ae97599363d9&quot;,&quot;parentUUID&quot;:&quot;7f373799-20e4-4861-9251-511b576df874&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all teacher reviews is incorrect due to unknown query params&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 4: Get all teacher reviews is incorrect due to unknown query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst teacher_id = existingTeacherReview.teacher_id;\nconst subject_code = \&quot;MM22\&quot;; // a valid subject code is 6 characters\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?teacher_id=${teacher_id}&amp;subject_code=${subject_code}&amp;overall_rating=2.0`) // &lt;-- &#x27;overall_rating&#x27; is not a query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;subject_code&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dddb4708-2030-4775-9f01-94be7cc445af&quot;,&quot;parentUUID&quot;:&quot;7f373799-20e4-4861-9251-511b576df874&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all teacher reviews request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 5: Get all teacher reviews request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1e96775b-397b-488e-a1dc-984d3c5f8c64&quot;,&quot;parentUUID&quot;:&quot;7f373799-20e4-4861-9251-511b576df874&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;85393223-7cb9-4d00-8e84-164e7c39907c&quot;,&quot;99db6736-5e07-484c-88a1-3c61c0a82af1&quot;,&quot;22e12a44-aff0-4852-b8cd-ae97599363d9&quot;,&quot;dddb4708-2030-4775-9f01-94be7cc445af&quot;,&quot;1e96775b-397b-488e-a1dc-984d3c5f8c64&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:594,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9bf2bc17-5c1b-4e3c-beac-c928a74aa711&quot;,&quot;title&quot;:&quot;GET /teacher-reviews/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a teacher review request successful&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews/:id Scenario 1: Get a teacher review request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTeacherReview.review_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingTeacherReview));\nexpect(resBody.review_id).to.be.equal(existingTeacherReview.review_id); // should match initially sent id\nexpect(resBody.subject).to.include.all.keys(Object.keys(existingTeacherReview.subject));\nexpect(resBody.reviewed_by).to.include.all.keys(Object.keys(existingTeacherReview.reviewed_by));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a4ecc12f-7e71-49ac-84c5-78eae721fd54&quot;,&quot;parentUUID&quot;:&quot;9bf2bc17-5c1b-4e3c-beac-c928a74aa711&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a teacher review request is unsuccessful due to unknown review_id&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews/:id Scenario 2: Get a teacher review request is unsuccessful due to unknown review_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTeacherReviewId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher review not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;14566b86-112d-4ae1-9529-1fdefc23996b&quot;,&quot;parentUUID&quot;:&quot;9bf2bc17-5c1b-4e3c-beac-c928a74aa711&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a teacher review request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews/:id Scenario 3: Get a teacher review request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTeacherReview.review_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6dc8f6b9-a2fe-4ddd-bd51-0f75933735e9&quot;,&quot;parentUUID&quot;:&quot;9bf2bc17-5c1b-4e3c-beac-c928a74aa711&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a4ecc12f-7e71-49ac-84c5-78eae721fd54&quot;,&quot;14566b86-112d-4ae1-9529-1fdefc23996b&quot;,&quot;6dc8f6b9-a2fe-4ddd-bd51-0f75933735e9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;311e93f0-ed27-4f5d-8f73-2605cac0aee6&quot;,&quot;title&quot;:&quot;POST /teacher-reviews&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a teacher review request is successful&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 1: Create a teacher review request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;review_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// rearrange\nconst newId = res.body.body.review_id;\nconst { old_teacher_rating, old_total_reviews, ...reviewBody } = data;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nconst resBody = res.body.body;\nexpect(resBody.review_id).to.be.equal(newId);\nexpect(resBody.subject.subject_code).to.be.equal(data.subject_code);\nexpect(resBody.reviewed_by.erp).to.be.equal(data.reviewed_by_erp);\n// cleanup\nconst { overall_rating: review_rating } = resBody;\nconst TeacherReviewRepository = require(&#x27;../../src/repositories/teacherReview.repository&#x27;);\nconst newTeacherRating = TeacherReviewRepository.incrementTeacherRating(review_rating, old_teacher_rating, old_total_reviews);\nconst deleteData = {\n    teacher_id: reviewBody.teacher_id,\n    teacher_rating: newTeacherRating,\n    total_reviews: old_total_reviews + 1,\n    review_rating\n};\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(deleteData);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e5e83e49-6b11-4ef4-b772-b1875518d8af&quot;,&quot;parentUUID&quot;:&quot;311e93f0-ed27-4f5d-8f73-2605cac0aee6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a teacher review request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 2: Create a teacher review request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\ndata.teacher_id = unknownTeacherId; // non existing teacher_id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;teacher_id&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;af81ce4c-fa47-46ad-942d-1dbb6c009f47&quot;,&quot;parentUUID&quot;:&quot;311e93f0-ed27-4f5d-8f73-2605cac0aee6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a teacher review request is unsuccessful due to unknown subject_code&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 3: Create a teacher review request is unsuccessful due to unknown subject_code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\ndata.subject_code = unknownSubjectCode; // non existing subject_code\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;subject_code&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;21d21bf4-a88f-48ae-8625-1dc77e8e0bab&quot;,&quot;parentUUID&quot;:&quot;311e93f0-ed27-4f5d-8f73-2605cac0aee6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a teacher review request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 4: Create a teacher review request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\ndelete data.old_teacher_rating; // make it missing\ndata.learning = 9; // should be between 1 and 5\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;old_teacher_rating&#x27;, &#x27;learning&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e1d8525e-8e80-4fab-a94c-cdcaca268825&quot;,&quot;parentUUID&quot;:&quot;311e93f0-ed27-4f5d-8f73-2605cac0aee6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a teacher review request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 5: Create a teacher review request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview }; // reviewed_by_erp === adminERP\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9618420c-138d-4612-abc9-43e695e14b79&quot;,&quot;parentUUID&quot;:&quot;311e93f0-ed27-4f5d-8f73-2605cac0aee6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a teacher review request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 6: Create a teacher review request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fbc4335a-dba7-43f8-ab68-2775ec784128&quot;,&quot;parentUUID&quot;:&quot;311e93f0-ed27-4f5d-8f73-2605cac0aee6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e5e83e49-6b11-4ef4-b772-b1875518d8af&quot;,&quot;af81ce4c-fa47-46ad-942d-1dbb6c009f47&quot;,&quot;21d21bf4-a88f-48ae-8625-1dc77e8e0bab&quot;,&quot;e1d8525e-8e80-4fab-a94c-cdcaca268825&quot;,&quot;9618420c-138d-4612-abc9-43e695e14b79&quot;,&quot;fbc4335a-dba7-43f8-ab68-2775ec784128&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:126,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9bb97ecf-5981-4f0c-b2a3-bbe556262355&quot;,&quot;title&quot;:&quot;DELETE /teacher-reviews/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a teacher review request is successful&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 1: Delete a teacher review request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { ...newTeacherReview };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst {review_id: newId} = res.body.body;\nconst TeacherReviewRepository = require(&#x27;../../src/repositories/teacherReview.repository&#x27;);\nconst review_rating = TeacherReviewRepository.calculateAverageRating(data);\nconst newTeacherRating = TeacherReviewRepository.incrementTeacherRating(review_rating, data.old_teacher_rating, data.old_total_reviews);\nconst deleteData = {\n    teacher_id: data.teacher_id,\n    teacher_rating: newTeacherRating,\n    total_reviews: data.old_total_reviews + 1,\n    review_rating: review_rating.toFixed(3)\n};\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(deleteData);\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher review has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;896af028-93de-4ff4-b255-3cbc5b20f8db&quot;,&quot;parentUUID&quot;:&quot;9bb97ecf-5981-4f0c-b2a3-bbe556262355&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a teacher review request is unsuccessful due to unknown review_id&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 2: Delete a teacher review request is unsuccessful due to unknown review_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst TeacherReviewRepository = require(&#x27;../../src/repositories/teacherReview.repository&#x27;);\nconst review_rating = TeacherReviewRepository.calculateAverageRating(newTeacherReview);\nconst deleteData = {\n    teacher_id: newTeacherReview.teacher_id,\n    teacher_rating: newTeacherReview.old_teacher_rating,\n    total_reviews: newTeacherReview.old_total_reviews,\n    review_rating: review_rating.toFixed(3)\n};\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTeacherReviewId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(deleteData);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher review not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;39e481ce-936a-4591-bcb5-cb0b979f0380&quot;,&quot;parentUUID&quot;:&quot;9bb97ecf-5981-4f0c-b2a3-bbe556262355&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a teacher review request is incorrect due to inconsistent body params&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 3: Delete a teacher review request is incorrect due to inconsistent body params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst deleteData = {\n    teacher_id: unknownTeacherId, // not the same as the review being deleted\n    teacher_rating: newTeacherReview.old_teacher_rating,\n    total_reviews: newTeacherReview.old_total_reviews,\n    review_rating: \&quot;0.000\&quot; // not the same as the review being deleted\n};\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacherReview.review_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(deleteData);\n    \n// assert\nexpect(res.status).to.be.equal(500);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DeleteFailedException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d5f61120-b0e0-4b20-a0e7-ff40b5fdc053&quot;,&quot;parentUUID&quot;:&quot;9bb97ecf-5981-4f0c-b2a3-bbe556262355&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a teacher review request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 4: Delete a teacher review request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst deleteData = {\n    teacher_id: existingTeacherReview.teacher_id,\n    teacher_rating: newTeacherReview.old_teacher_rating,\n    total_reviews: newTeacherReview.old_total_reviews,\n    review_rating: existingTeacherReview.overall_rating\n};\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacherReview.review_id}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(deleteData);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;365a79c7-988c-43f0-923b-471c19b03671&quot;,&quot;parentUUID&quot;:&quot;9bb97ecf-5981-4f0c-b2a3-bbe556262355&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a teacher review request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 5: Delete a teacher review request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst deleteData = {\n    teacher_id: newTeacherReview.teacher_id,\n    teacher_rating: newTeacherReview.old_teacher_rating,\n    total_reviews: newTeacherReview.old_total_reviews,\n    review_rating: \&quot;4.300\&quot;\n};\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacherReview.review_id}`)\n    .send(deleteData);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e9928af4-6b76-419e-a8c3-0139b05df3cb&quot;,&quot;parentUUID&quot;:&quot;9bb97ecf-5981-4f0c-b2a3-bbe556262355&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;896af028-93de-4ff4-b255-3cbc5b20f8db&quot;,&quot;39e481ce-936a-4591-bcb5-cb0b979f0380&quot;,&quot;d5f61120-b0e0-4b20-a0e7-ff40b5fdc053&quot;,&quot;365a79c7-988c-43f0-923b-471c19b03671&quot;,&quot;e9928af4-6b76-419e-a8c3-0139b05df3cb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:67,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;77f35950-32cf-4881-bb95-b15ec0eb2570&quot;,&quot;title&quot;:&quot;Terms API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Terms API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Terms API \&quot;before each\&quot; hook in \&quot;Terms API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c7835e8f-fff2-4ea3-a39a-f4d13170491a&quot;,&quot;parentUUID&quot;:&quot;77f35950-32cf-4881-bb95-b15ec0eb2570&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0793f85c-b557-48c5-8891-2d3171949d23&quot;,&quot;title&quot;:&quot;GET /terms&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all terms request successful&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms Scenario 1: Get all terms request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTerm));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d6328e23-6890-4425-a305-5c7c5e3e98d2&quot;,&quot;parentUUID&quot;:&quot;0793f85c-b557-48c5-8891-2d3171949d23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all terms request unsuccessful due to zero terms&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms Scenario 2: Get all terms request unsuccessful due to zero terms&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:538,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TermModel = require(&#x27;../../src/models/term.model&#x27;);\nconst modelStub = sinon.stub(TermModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty term list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Terms not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;97118951-cedc-452b-bd66-9cb211afdfdb&quot;,&quot;parentUUID&quot;:&quot;0793f85c-b557-48c5-8891-2d3171949d23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms Scenario 3: Get a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0aa4846c-4b65-4052-a287-7fb26ae5334b&quot;,&quot;parentUUID&quot;:&quot;0793f85c-b557-48c5-8891-2d3171949d23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all terms request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms Scenario 4: Get all terms request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8f7594c8-3f6f-4bca-a060-d9a948e1c049&quot;,&quot;parentUUID&quot;:&quot;0793f85c-b557-48c5-8891-2d3171949d23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d6328e23-6890-4425-a305-5c7c5e3e98d2&quot;,&quot;97118951-cedc-452b-bd66-9cb211afdfdb&quot;,&quot;0aa4846c-4b65-4052-a287-7fb26ae5334b&quot;,&quot;8f7594c8-3f6f-4bca-a060-d9a948e1c049&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:558,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;409e2b50-8364-4adb-97ca-5774a3988146&quot;,&quot;title&quot;:&quot;GET /terms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a term request successful&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms/:id Scenario 1: Get a term request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingTerm));\nexpect(resBody.term_id).to.be.equal(existingTerm.term_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fe240e04-4294-49cb-96b6-c4e1c106b395&quot;,&quot;parentUUID&quot;:&quot;409e2b50-8364-4adb-97ca-5774a3988146&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a term request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms/:id Scenario 2: Get a term request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTermId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Term not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7e09b449-71be-4c0d-8bde-7dfae10383c4&quot;,&quot;parentUUID&quot;:&quot;409e2b50-8364-4adb-97ca-5774a3988146&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms/:id Scenario 3: Get a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7cc90f93-b3b4-440f-9ffe-13169543670d&quot;,&quot;parentUUID&quot;:&quot;409e2b50-8364-4adb-97ca-5774a3988146&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a term request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms/:id Scenario 4: Get a term request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTerm.term_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;76310425-ea9d-46cb-b4b2-b51069d15ecc&quot;,&quot;parentUUID&quot;:&quot;409e2b50-8364-4adb-97ca-5774a3988146&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fe240e04-4294-49cb-96b6-c4e1c106b395&quot;,&quot;7e09b449-71be-4c0d-8bde-7dfae10383c4&quot;,&quot;7cc90f93-b3b4-440f-9ffe-13169543670d&quot;,&quot;76310425-ea9d-46cb-b4b2-b51069d15ecc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:40,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7a9dda4f-5eca-4e03-ac85-7199ae481483&quot;,&quot;title&quot;:&quot;POST /terms&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a term request is successful&quot;,&quot;fullTitle&quot;:&quot;Terms API POST /terms Scenario 1: Create a term request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;term_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.term_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    term_id: newId,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7c914e74-eaab-4dd1-9bd8-2c7183af43c0&quot;,&quot;parentUUID&quot;:&quot;7a9dda4f-5eca-4e03-ac85-7199ae481483&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a term request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Terms API POST /terms Scenario 2: Create a term request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    terms: term // &lt;-- a valid parameter name is &#x27;term&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;term&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bae4d3c2-5de6-4ddc-b55f-5f8a77c20ea9&quot;,&quot;parentUUID&quot;:&quot;7a9dda4f-5eca-4e03-ac85-7199ae481483&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API POST /terms Scenario 3: Create a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dde50702-e6ca-47d5-8c1d-ba02d39ede30&quot;,&quot;parentUUID&quot;:&quot;7a9dda4f-5eca-4e03-ac85-7199ae481483&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a term request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API POST /terms Scenario 4: Create a term request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a96a41a7-bae4-4b36-b297-a01ceaee470a&quot;,&quot;parentUUID&quot;:&quot;7a9dda4f-5eca-4e03-ac85-7199ae481483&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7c914e74-eaab-4dd1-9bd8-2c7183af43c0&quot;,&quot;bae4d3c2-5de6-4ddc-b55f-5f8a77c20ea9&quot;,&quot;dde50702-e6ca-47d5-8c1d-ba02d39ede30&quot;,&quot;a96a41a7-bae4-4b36-b297-a01ceaee470a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:66,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;39aaae9d-9461-4662-8425-4042782ad3d2&quot;,&quot;title&quot;:&quot;PATCH /terms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a term request is successful&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 1: Update a term request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term: newTermName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    term_id: existingTerm.term_id,\n    term: newTermName\n});\n\n// cleanup\ndata.term = existingTerm.term;\nres = await request(app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;57739129-3bc4-47ef-9b60-40b90b8dac80&quot;,&quot;parentUUID&quot;:&quot;39aaae9d-9461-4662-8425-4042782ad3d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a term request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 2: Update a term request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term: newTermName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTermId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Term not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6526ceb0-09cb-4ad0-a57e-ab6e5bb179f2&quot;,&quot;parentUUID&quot;:&quot;39aaae9d-9461-4662-8425-4042782ad3d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a term request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 3: Update a term request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    terms: newTermName // &lt;-- a invalid update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;term&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e5853944-43a5-4775-bacb-d0190b6a5c0d&quot;,&quot;parentUUID&quot;:&quot;39aaae9d-9461-4662-8425-4042782ad3d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 4: Update a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term: newTermName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2355e88b-5020-4f6a-af63-519637399890&quot;,&quot;parentUUID&quot;:&quot;39aaae9d-9461-4662-8425-4042782ad3d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a term request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 5: Update a term request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term: newTermName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;80f45ca4-d9b7-4241-be98-7423e693fb4d&quot;,&quot;parentUUID&quot;:&quot;39aaae9d-9461-4662-8425-4042782ad3d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;57739129-3bc4-47ef-9b60-40b90b8dac80&quot;,&quot;6526ceb0-09cb-4ad0-a57e-ab6e5bb179f2&quot;,&quot;e5853944-43a5-4775-bacb-d0190b6a5c0d&quot;,&quot;2355e88b-5020-4f6a-af63-519637399890&quot;,&quot;80f45ca4-d9b7-4241-be98-7423e693fb4d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:60,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;4a4f7dbe-f8ea-477c-a61d-937fa9d677e4&quot;,&quot;title&quot;:&quot;DELETE /terms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a term request is successful&quot;,&quot;fullTitle&quot;:&quot;Terms API DELETE /terms/:id Scenario 1: Delete a term request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { term };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.term_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Term has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2a68319f-6e4a-4e52-aa15-7e8fa79c6895&quot;,&quot;parentUUID&quot;:&quot;4a4f7dbe-f8ea-477c-a61d-937fa9d677e4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a term request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Terms API DELETE /terms/:id Scenario 2: Delete a term request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTermId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Term not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8e808897-9734-477b-a3a5-46eb0c81a666&quot;,&quot;parentUUID&quot;:&quot;4a4f7dbe-f8ea-477c-a61d-937fa9d677e4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API DELETE /terms/:id Scenario 3: Delete a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;26f6dccb-e17e-47e3-93cd-658738c1c030&quot;,&quot;parentUUID&quot;:&quot;4a4f7dbe-f8ea-477c-a61d-937fa9d677e4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a term request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API DELETE /terms/:id Scenario 4: Delete a term request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTerm.term_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;44ce0533-2df9-40d0-b493-b821625a9463&quot;,&quot;parentUUID&quot;:&quot;4a4f7dbe-f8ea-477c-a61d-937fa9d677e4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2a68319f-6e4a-4e52-aa15-7e8fa79c6895&quot;,&quot;8e808897-9734-477b-a3a5-46eb0c81a666&quot;,&quot;26f6dccb-e17e-47e3-93cd-658738c1c030&quot;,&quot;44ce0533-2df9-40d0-b493-b821625a9463&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:44,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b52ba6ab-d4c8-4d58-856b-59e2c1b2e813&quot;,&quot;title&quot;:&quot;Timeslots API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Timeslots API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Timeslots API \&quot;before each\&quot; hook in \&quot;Timeslots API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f74c10a9-64b6-4d4f-bdcf-dc560e8d98e6&quot;,&quot;parentUUID&quot;:&quot;b52ba6ab-d4c8-4d58-856b-59e2c1b2e813&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3a0d299e-0546-4f7d-a333-387068a50b1d&quot;,&quot;title&quot;:&quot;GET /timeslots&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all timeslots request successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots Scenario 1: Get all timeslots request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTimeslot));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3c07e713-8c1d-4201-8715-673b61457ec1&quot;,&quot;parentUUID&quot;:&quot;3a0d299e-0546-4f7d-a333-387068a50b1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all timeslots request unsuccessful due to zero timeslots&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots Scenario 2: Get all timeslots request unsuccessful due to zero timeslots&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:555,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TimeslotModel = require(&#x27;../../src/models/timeslot.model&#x27;);\nconst modelStub = sinon.stub(TimeslotModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty timeslot list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslots not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8b849491-5a19-4858-b15f-f01087a4789c&quot;,&quot;parentUUID&quot;:&quot;3a0d299e-0546-4f7d-a333-387068a50b1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3c07e713-8c1d-4201-8715-673b61457ec1&quot;,&quot;8b849491-5a19-4858-b15f-f01087a4789c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:566,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;dec055fe-9026-4281-acc0-024754200242&quot;,&quot;title&quot;:&quot;GET /timeslots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a timeslot request successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots/:id Scenario 1: Get a timeslot request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingTimeslot));\nexpect(resBody.timeslot_id).to.be.equal(existingTimeslot.timeslot_id); // should match initially sent id&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e32decfa-6087-4e75-86b3-983999f80781&quot;,&quot;parentUUID&quot;:&quot;dec055fe-9026-4281-acc0-024754200242&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a timeslot request is unsuccessful due to unknown timeslot_id&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots/:id Scenario 2: Get a timeslot request is unsuccessful due to unknown timeslot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTimeslotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;346c342e-0f64-4596-b25c-ea999798cf84&quot;,&quot;parentUUID&quot;:&quot;dec055fe-9026-4281-acc0-024754200242&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a timeslot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots/:id Scenario 4: Get a timeslot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTimeslot.timeslot_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;77c0ab78-0b0c-4c9d-8043-01a9a1059a3e&quot;,&quot;parentUUID&quot;:&quot;dec055fe-9026-4281-acc0-024754200242&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e32decfa-6087-4e75-86b3-983999f80781&quot;,&quot;346c342e-0f64-4596-b25c-ea999798cf84&quot;,&quot;77c0ab78-0b0c-4c9d-8043-01a9a1059a3e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a6a03dda-73e8-4c78-8615-025130bad428&quot;,&quot;title&quot;:&quot;POST /timeslots&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a timeslot request is successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 1: Create a timeslot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time, end_time, slot_number };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;timeslot_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.timeslot_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    timeslot_id: newId,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f48465bf-c2d7-4f7e-bd0e-fb3fff9179bf&quot;,&quot;parentUUID&quot;:&quot;a6a03dda-73e8-4c78-8615-025130bad428&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a timeslot request is unsuccessful due to timeslot conflicts&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 2: Create a timeslot request is unsuccessful due to timeslot conflicts&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time: existingTimeslot.start_time, end_time, slot_number }; // start_time conflict\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(500);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;CreateFailedException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot conflicts found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;26cae8f9-bb1b-4ee1-a990-eba44525c71f&quot;,&quot;parentUUID&quot;:&quot;a6a03dda-73e8-4c78-8615-025130bad428&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a timeslot request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 3: Create a timeslot request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    timeslots: start_time, // &lt;-- a valid parameter name is &#x27;start_time&#x27;\n    end_time,\n    slot_number: &#x27;asb&#x27; // has to be an int\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;start_time&#x27;, &#x27;slot_number&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;eb9046c2-2719-440a-8f82-4b3ebc2972d5&quot;,&quot;parentUUID&quot;:&quot;a6a03dda-73e8-4c78-8615-025130bad428&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a timeslot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 4: Create a timeslot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time, end_time, slot_number };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ba0f9af9-602e-47f0-8797-0e0513812643&quot;,&quot;parentUUID&quot;:&quot;a6a03dda-73e8-4c78-8615-025130bad428&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a timeslot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 5: Create a timeslot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time, end_time, slot_number };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;652332be-dc3d-433e-ace0-62d7b921ab3c&quot;,&quot;parentUUID&quot;:&quot;a6a03dda-73e8-4c78-8615-025130bad428&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f48465bf-c2d7-4f7e-bd0e-fb3fff9179bf&quot;,&quot;26cae8f9-bb1b-4ee1-a990-eba44525c71f&quot;,&quot;eb9046c2-2719-440a-8f82-4b3ebc2972d5&quot;,&quot;ba0f9af9-602e-47f0-8797-0e0513812643&quot;,&quot;652332be-dc3d-433e-ace0-62d7b921ab3c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:80,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ec63c063-8cc9-4c50-83a3-b44d923c2758&quot;,&quot;title&quot;:&quot;PATCH /timeslots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a timeslot request is successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 1: Update a timeslot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { slot_number: newTimeslotNumber };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    timeslot_id: existingTimeslot.timeslot_id,\n    start_time: existingTimeslot.start_time,\n    end_time: existingTimeslot.end_time,\n    slot_number: newTimeslotNumber\n});\n\n// cleanup\ndata.slot_number = existingTimeslot.slot_number;\nres = await request(app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;220bb9fe-79eb-4173-8ef3-24b156c02af4&quot;,&quot;parentUUID&quot;:&quot;ec63c063-8cc9-4c50-83a3-b44d923c2758&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a timeslot request is unsuccessful due to unknown timeslot code&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 2: Update a timeslot request is unsuccessful due to unknown timeslot code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { slot_number: newTimeslotNumber };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTimeslotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;33480439-3048-4c0d-a470-bbc9399dd419&quot;,&quot;parentUUID&quot;:&quot;ec63c063-8cc9-4c50-83a3-b44d923c2758&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a timeslot request is unsuccessful due to timeslot conflicts&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 3: Update a timeslot request is unsuccessful due to timeslot conflicts&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time: existingTimeslot.end_time }; // can&#x27;t be the same time\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(500);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;UpdateFailedException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot conflicts found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e261a124-7435-4d8b-877f-5617e46ff3a3&quot;,&quot;parentUUID&quot;:&quot;ec63c063-8cc9-4c50-83a3-b44d923c2758&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a timeslot request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 4: Update a timeslot request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    timeslots: newTimeslotNumber // &lt;-- a invalid update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8095df69-ed96-4219-b5bb-5708a3d86fb8&quot;,&quot;parentUUID&quot;:&quot;ec63c063-8cc9-4c50-83a3-b44d923c2758&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a timeslot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 5: Update a timeslot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { slot_number: newTimeslotNumber };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6f0cb9a5-7232-4c1a-ac02-5ca78a196068&quot;,&quot;parentUUID&quot;:&quot;ec63c063-8cc9-4c50-83a3-b44d923c2758&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a timeslot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 6: Update a timeslot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { slot_number: newTimeslotNumber };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e895385c-6d4d-4806-97d3-7a8bfbd68475&quot;,&quot;parentUUID&quot;:&quot;ec63c063-8cc9-4c50-83a3-b44d923c2758&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;220bb9fe-79eb-4173-8ef3-24b156c02af4&quot;,&quot;33480439-3048-4c0d-a470-bbc9399dd419&quot;,&quot;e261a124-7435-4d8b-877f-5617e46ff3a3&quot;,&quot;8095df69-ed96-4219-b5bb-5708a3d86fb8&quot;,&quot;6f0cb9a5-7232-4c1a-ac02-5ca78a196068&quot;,&quot;e895385c-6d4d-4806-97d3-7a8bfbd68475&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:66,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f8df431a-f9ca-4cba-8e31-e63d4efcdd6f&quot;,&quot;title&quot;:&quot;DELETE /timeslots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a timeslot request is successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API DELETE /timeslots/:id Scenario 1: Delete a timeslot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { start_time, end_time, slot_number };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.timeslot_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9a6e6a65-f2b1-48d8-bba1-f3349dcc498d&quot;,&quot;parentUUID&quot;:&quot;f8df431a-f9ca-4cba-8e31-e63d4efcdd6f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a timeslot request is unsuccessful due to unknown timeslot code&quot;,&quot;fullTitle&quot;:&quot;Timeslots API DELETE /timeslots/:id Scenario 2: Delete a timeslot request is unsuccessful due to unknown timeslot code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTimeslotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;714ff49e-409f-4898-b516-ff2f3e15fdb5&quot;,&quot;parentUUID&quot;:&quot;f8df431a-f9ca-4cba-8e31-e63d4efcdd6f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a timeslot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Timeslots API DELETE /timeslots/:id Scenario 3: Delete a timeslot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c480a9d3-8867-44db-bbbf-690db54a38d2&quot;,&quot;parentUUID&quot;:&quot;f8df431a-f9ca-4cba-8e31-e63d4efcdd6f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a timeslot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timeslots API DELETE /timeslots/:id Scenario 4: Delete a timeslot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTimeslot.timeslot_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;12950dc3-142f-48dd-9604-1097f4bb2794&quot;,&quot;parentUUID&quot;:&quot;f8df431a-f9ca-4cba-8e31-e63d4efcdd6f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9a6e6a65-f2b1-48d8-bba1-f3349dcc498d&quot;,&quot;714ff49e-409f-4898-b516-ff2f3e15fdb5&quot;,&quot;c480a9d3-8867-44db-bbbf-690db54a38d2&quot;,&quot;12950dc3-142f-48dd-9604-1097f4bb2794&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:51,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c5c6bbb2-4226-4ea4-b193-e2093e1a202a&quot;,&quot;title&quot;:&quot;Timetables API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Timetables API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Timetables API \&quot;before each\&quot; hook in \&quot;Timetables API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7a909eb4-070f-4789-80f9-b04b4fa3caf4&quot;,&quot;parentUUID&quot;:&quot;c5c6bbb2-4226-4ea4-b193-e2093e1a202a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a6fe84dd-f2a4-446f-93aa-37a0b26ab145&quot;,&quot;title&quot;:&quot;GET /timetables&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all timetables request is successful (Admin Only)&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 1: Get all timetables request is successful (Admin Only)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTimetable)); // contain all params&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b08a857c-636a-454b-86d7-09bd5869a3b0&quot;,&quot;parentUUID&quot;:&quot;a6fe84dd-f2a4-446f-93aa-37a0b26ab145&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all timetables request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 2: Get all timetables request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst student_erp = userERP;\nlet res = await request(this.app)\n    .get(`${baseRoute}?student_erp=${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].student_erp).to.be.equal(student_erp);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;330170e7-5a45-4dd5-9140-2e5f0e60ba7e&quot;,&quot;parentUUID&quot;:&quot;a6fe84dd-f2a4-446f-93aa-37a0b26ab145&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all timetables request unsuccessful due to no student timetables&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 3: Get all timetables request unsuccessful due to no student timetables&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:542,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TimetableModel = require(&#x27;../../src/models/timetable.model&#x27;);\nconst modelStub = sinon.stub(TimetableModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty timetable list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetables not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;88c4145f-3e0e-4278-8666-d9c2ee0a42de&quot;,&quot;parentUUID&quot;:&quot;a6fe84dd-f2a4-446f-93aa-37a0b26ab145&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all timetables request is incorrect due to unknown query parameters&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 4: Get all timetables request is incorrect due to unknown query parameters&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst student_erp = &#x27;all&#x27;; // &lt;-- invalid student_erp value\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?student_erp=${student_erp}&amp;year=2022`) // &lt;-- `year` is an incorrect query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;student_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;76a752c8-c086-4777-94ce-de8fbccb1c79&quot;,&quot;parentUUID&quot;:&quot;a6fe84dd-f2a4-446f-93aa-37a0b26ab145&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all timetables request is forbidden due to no query params&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 5: Get all timetables request is forbidden due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute) // needs student_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d0e1041b-677a-41b2-af9c-39d3015d1c22&quot;,&quot;parentUUID&quot;:&quot;a6fe84dd-f2a4-446f-93aa-37a0b26ab145&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get all timetables request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 6: Get all timetables request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fe614ce7-56a6-40fe-beb2-a68473575f62&quot;,&quot;parentUUID&quot;:&quot;a6fe84dd-f2a4-446f-93aa-37a0b26ab145&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b08a857c-636a-454b-86d7-09bd5869a3b0&quot;,&quot;330170e7-5a45-4dd5-9140-2e5f0e60ba7e&quot;,&quot;88c4145f-3e0e-4278-8666-d9c2ee0a42de&quot;,&quot;76a752c8-c086-4777-94ce-de8fbccb1c79&quot;,&quot;d0e1041b-677a-41b2-af9c-39d3015d1c22&quot;,&quot;fe614ce7-56a6-40fe-beb2-a68473575f62&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:583,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;55182135-5176-4d56-8dae-f3d3d41a865c&quot;,&quot;title&quot;:&quot;GET /timetables/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a timetable request successful&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables/:id Scenario 1: Get a timetable request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTimetable.timetable_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.timetable_id).to.be.equal(existingTimetable.timetable_id); // should match initially sent id\nexpect(resBody).to.include.all.keys(Object.keys(existingTimetable)); // contain all params\nexpect(resBody.classes).to.be.an(&#x27;array&#x27;);\nexpect(resBody.classes[0]).to.include.all.keys(Object.keys(existingClass1)); // contain all params\nconst exampleClass = resBody.classes[0];\nexpect(exampleClass.classroom).to.not.be.undefined;\nexpect(exampleClass.classroom).to.include.all.keys(Object.keys(existingClass1.classroom)); // contain all params\n\nexpect(exampleClass.classroom.campus).to.not.be.undefined;\nexpect(exampleClass.classroom.campus).to.include.all.keys(Object.keys(existingClass1.classroom.campus)); // contain all params\nexpect(exampleClass.subject).to.not.be.undefined;\nexpect(exampleClass.subject).to.include.all.keys(Object.keys(existingClass1.subject)); // contain all params\nexpect(exampleClass.teacher).to.not.be.undefined;\nexpect(exampleClass.teacher).to.include.all.keys(Object.keys(existingClass1.teacher)); // contain all params\nexpect(exampleClass.timeslot_1).to.not.be.undefined;\nexpect(exampleClass.timeslot_1).to.include.all.keys(Object.keys(existingClass1.timeslot_1)); // contain all params\nexpect(exampleClass.timeslot_2).to.not.be.undefined;\nexpect(exampleClass.timeslot_2).to.include.all.keys(Object.keys(existingClass1.timeslot_2)); // contain all params&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3538831c-13fa-405d-913c-6923a9393246&quot;,&quot;parentUUID&quot;:&quot;55182135-5176-4d56-8dae-f3d3d41a865c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a timetable request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables/:id Scenario 2: Get a timetable request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0eb6d35d-5964-4dac-a685-09f4b40a342c&quot;,&quot;parentUUID&quot;:&quot;55182135-5176-4d56-8dae-f3d3d41a865c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables/:id Scenario 3: Get a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTimetable.timetable_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ca0cfed3-b013-41e9-94ba-5a7f98313c43&quot;,&quot;parentUUID&quot;:&quot;55182135-5176-4d56-8dae-f3d3d41a865c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3538831c-13fa-405d-913c-6923a9393246&quot;,&quot;0eb6d35d-5964-4dac-a685-09f4b40a342c&quot;,&quot;ca0cfed3-b013-41e9-94ba-5a7f98313c43&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0d3e7b01-1d7c-42a3-8c5a-52a849ed342f&quot;,&quot;title&quot;:&quot;POST /timetables&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a timetable request is successful&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables Scenario 1: Create a timetable request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTimetable };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;timetable_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// affirm\nconst newId = res.body.body.timetable_id;\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nconst resBody = res.body.body;\n// check if all classes added to schedule\nconst resClasses = resBody.classes.map(classItem =&gt; classItem.class_erp);\nexpect(resClasses).to.include.all.members(data.classes);\n// check other properties\ndelete resBody.classes;\nexpect(resBody).to.be.eql({\n    timetable_id: newId,\n    student_erp: data.student_erp,\n    term_id: data.term_id,\n    is_active: data.is_active\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aed111b9-2083-42d5-a48d-216178345820&quot;,&quot;parentUUID&quot;:&quot;0d3e7b01-1d7c-42a3-8c5a-52a849ed342f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a timetable request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables Scenario 2: Create a timetable request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst {classes, ...timetable} = newTimetable;\nconst data = {\n    ...timetable,\n    classessfd: classes // &lt;-- a valid param is &#x27;classes&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;classes&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fcc7f1e5-8871-4f9c-be81-e3c2ba4d8c35&quot;,&quot;parentUUID&quot;:&quot;0d3e7b01-1d7c-42a3-8c5a-52a849ed342f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables Scenario 3: Create a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTimetable };\ndata.student_erp = adminERP; // &lt;-- can be any other non-admin ERP as well, just different from userToken erp\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t create others timetables i.e. token erp != newTimetable.student_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;12f95b04-db8d-4c13-b709-1507b25ca5fc&quot;,&quot;parentUUID&quot;:&quot;0d3e7b01-1d7c-42a3-8c5a-52a849ed342f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables Scenario 4: Create a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTimetable };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;189c80d6-b642-4747-9e47-de894f4dd23e&quot;,&quot;parentUUID&quot;:&quot;0d3e7b01-1d7c-42a3-8c5a-52a849ed342f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;aed111b9-2083-42d5-a48d-216178345820&quot;,&quot;fcc7f1e5-8871-4f9c-be81-e3c2ba4d8c35&quot;,&quot;12f95b04-db8d-4c13-b709-1507b25ca5fc&quot;,&quot;189c80d6-b642-4747-9e47-de894f4dd23e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:86,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c6ef334b-0672-4556-96c7-617e638fed98&quot;,&quot;title&quot;:&quot;POST /timetables/generate&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Generate timetables request is successful&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables/generate Scenario 1: Generate timetables request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { num_of_subjects, classes: possibleClasses };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst exampleTimetable = resBody[0];\n\nexpect(exampleTimetable).to.include.all.keys([\&quot;term_id\&quot;, \&quot;is_active\&quot;, \&quot;classes\&quot;]); // contain all params\nexpect(exampleTimetable.classes).to.be.an(&#x27;array&#x27;);\nexpect(exampleTimetable.classes[0]).to.include.all.keys(Object.keys(existingClass1)); // contain all params\nconst exampleClass = exampleTimetable.classes[0];\nexpect(exampleClass.classroom).to.not.be.undefined;\nexpect(exampleClass.classroom).to.include.all.keys(Object.keys(existingClass1.classroom)); // contain all params\n\nexpect(exampleClass.classroom.campus).to.not.be.undefined;\nexpect(exampleClass.classroom.campus).to.include.all.keys(Object.keys(existingClass1.classroom.campus)); // contain all params\nexpect(exampleClass.subject).to.not.be.undefined;\nexpect(exampleClass.subject).to.include.all.keys(Object.keys(existingClass1.subject)); // contain all params\nexpect(exampleClass.teacher).to.not.be.undefined;\nexpect(exampleClass.teacher).to.include.all.keys(Object.keys(existingClass1.teacher)); // contain all params\nexpect(exampleClass.timeslot_1).to.not.be.undefined;\nexpect(exampleClass.timeslot_1).to.include.all.keys(Object.keys(existingClass1.timeslot_1)); // contain all params\nexpect(exampleClass.timeslot_2).to.not.be.undefined;\nexpect(exampleClass.timeslot_2).to.include.all.keys(Object.keys(existingClass1.timeslot_2)); // contain all params&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;313d629c-a1f8-4640-a1be-84ea6f768ef4&quot;,&quot;parentUUID&quot;:&quot;c6ef334b-0672-4556-96c7-617e638fed98&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Generate timetables request is unsuccessful due to no possible timetables&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables/generate Scenario 2: Generate timetables request is unsuccessful due to no possible timetables&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:539,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { num_of_subjects, classes: possibleClasses };\ndecache(&#x27;../../src/server&#x27;);\nconst TimetableRepository = require(&#x27;../../src/repositories/timetable.repository&#x27;);\nconst modelStub = sinon.stub(TimetableRepository, &#x27;findScheduleClass&#x27;).callsFake(() =&gt; []); // return empty timetable list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Possible timetables not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;80a258fa-178c-4ff7-ac4c-45a8af238d88&quot;,&quot;parentUUID&quot;:&quot;c6ef334b-0672-4556-96c7-617e638fed98&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a timetable request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables/generate Scenario 3: Create a timetable request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    subjects: num_of_subjects, // &lt;-- a valid param is &#x27;num_of_subjects&#x27;\n    classes: [] // &lt;-- must specify atleast 1 &#x27;class&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;num_of_subjects&#x27;, &#x27;classes&#x27;]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bc8438c6-3256-452f-b978-8dde8c53376f&quot;,&quot;parentUUID&quot;:&quot;c6ef334b-0672-4556-96c7-617e638fed98&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables/generate Scenario 4: Create a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { num_of_subjects, classes: possibleClasses };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6540ba0f-7cc9-458a-b1d2-8459fda9f1f5&quot;,&quot;parentUUID&quot;:&quot;c6ef334b-0672-4556-96c7-617e638fed98&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;313d629c-a1f8-4640-a1be-84ea6f768ef4&quot;,&quot;80a258fa-178c-4ff7-ac4c-45a8af238d88&quot;,&quot;bc8438c6-3256-452f-b978-8dde8c53376f&quot;,&quot;6540ba0f-7cc9-458a-b1d2-8459fda9f1f5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:559,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f8a5038a-086f-4d46-b0a9-a92a9d640743&quot;,&quot;title&quot;:&quot;PATCH /timetables/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a timetable request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 1: Update a timetable request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { is_active: updatedTimetableIsActive };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${inActiveTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(2); // 1 for inactive the previous, then active new\nexpect(res.body.body.rows_changed).to.be.equal(2); // 1 for inactive the previous, then active new\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${inActiveTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.is_active).to.be.equal(updatedTimetableIsActive);\n\n// cleanup\ndata.is_active = existingTimetable.is_active;\nres = await request(app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3223cc2b-7215-4142-b0c7-12cb2a9e0734&quot;,&quot;parentUUID&quot;:&quot;f8a5038a-086f-4d46-b0a9-a92a9d640743&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 2: Update a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { is_active: updatedTimetableIsActive };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9d521afc-df6e-4ee4-82f9-538c912dc74e&quot;,&quot;parentUUID&quot;:&quot;f8a5038a-086f-4d46-b0a9-a92a9d640743&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a timetable request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 3: Update a timetable request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    bodysds: updatedTimetableIsActive, // &lt;-- an valid parameter name should be &#x27;is_active&#x27;\n    is_active: \&quot;all\&quot; // &lt;-- an invalid value for &#x27;is_active&#x27; parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;is_active&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;207f923f-d2e9-4b34-8675-6af2ec52943c&quot;,&quot;parentUUID&quot;:&quot;f8a5038a-086f-4d46-b0a9-a92a9d640743&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 4: Update a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { is_active: updatedTimetableIsActive };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedTimetableId}`) // &lt;-- has a different student_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others timetables i.e. token erp != unOwnedTimetable.student_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c14355c5-501a-4a45-baac-421e430e8fd7&quot;,&quot;parentUUID&quot;:&quot;f8a5038a-086f-4d46-b0a9-a92a9d640743&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 5: Update a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { is_active: updatedTimetableIsActive };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${inActiveTimetableId}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;99dd592a-60a2-4023-97cb-f52616d20abe&quot;,&quot;parentUUID&quot;:&quot;f8a5038a-086f-4d46-b0a9-a92a9d640743&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3223cc2b-7215-4142-b0c7-12cb2a9e0734&quot;,&quot;9d521afc-df6e-4ee4-82f9-538c912dc74e&quot;,&quot;207f923f-d2e9-4b34-8675-6af2ec52943c&quot;,&quot;c14355c5-501a-4a45-baac-421e430e8fd7&quot;,&quot;99dd592a-60a2-4023-97cb-f52616d20abe&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:77,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9820c5c3-9da6-4e21-a92c-a9a36bb3bf0c&quot;,&quot;title&quot;:&quot;PATCH /timetables/:id/classes&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a timetable request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 1: Update a timetable request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added, removed };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_added).to.be.equal(added.length);\nexpect(res.body.body.rows_removed).to.be.equal(removed.length);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingTimetable.timetable_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst classes = res.body.body.classes;\nconst classERPs = classes.map(classItem =&gt; classItem.class_erp);\nexpect(classERPs).to.include.all.members(added);\nexpect(classERPs).to.not.include.all.members(removed);\n\n// cleanup\ndata.added = [...removed];\ndata.removed = [...added];\nres = await request(app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ef7d32b8-2a60-409b-bc81-6b53224a0b93&quot;,&quot;parentUUID&quot;:&quot;9820c5c3-9da6-4e21-a92c-a9a36bb3bf0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 2: Update a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added, removed };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTimetableId}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3ccd9ad8-797d-4f0f-984a-a539988b0e77&quot;,&quot;parentUUID&quot;:&quot;9820c5c3-9da6-4e21-a92c-a9a36bb3bf0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a timetable request is unsuccessful due to unknown class_erp&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 3: Update a timetable request is unsuccessful due to unknown class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added: [unknownClassERP] }; // adding an unknown class erp\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;class_erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;152dab19-c0e6-42b9-a12c-53b0aa2adab3&quot;,&quot;parentUUID&quot;:&quot;9820c5c3-9da6-4e21-a92c-a9a36bb3bf0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a timetable request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 4: Update a timetable request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    added: [], // &lt;-- &#x27;added&#x27; should be omitted if empty\n    removed: [\&quot;all\&quot;], // &lt;-- all values in the array should match the classERP format(4 or 5 digits)\n    same: [existingClass2.class_erp] // &lt;-- not an allowed update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;added&#x27;, &#x27;removed[0]&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b998d171-5874-4543-8393-46633061b14f&quot;,&quot;parentUUID&quot;:&quot;9820c5c3-9da6-4e21-a92c-a9a36bb3bf0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 5: Update a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added, removed };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedTimetableId}/${subRoute}`) // &lt;-- has a different student_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others timetables i.e. token erp != unOwnedTimetable.student_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;95293528-3a61-475d-8d4c-daa6f3453cee&quot;,&quot;parentUUID&quot;:&quot;9820c5c3-9da6-4e21-a92c-a9a36bb3bf0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 6: Update a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added, removed };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;82756fe2-e2ed-42a0-af40-859be1354cc6&quot;,&quot;parentUUID&quot;:&quot;9820c5c3-9da6-4e21-a92c-a9a36bb3bf0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ef7d32b8-2a60-409b-bc81-6b53224a0b93&quot;,&quot;3ccd9ad8-797d-4f0f-984a-a539988b0e77&quot;,&quot;152dab19-c0e6-42b9-a12c-53b0aa2adab3&quot;,&quot;b998d171-5874-4543-8393-46633061b14f&quot;,&quot;95293528-3a61-475d-8d4c-daa6f3453cee&quot;,&quot;82756fe2-e2ed-42a0-af40-859be1354cc6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:84,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;3cf182ff-8a86-48c1-af98-ca08b764d4c6&quot;,&quot;title&quot;:&quot;DELETE /timetables/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a timetable request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Timetables API DELETE /timetables/:id Scenario 1: Delete a timetable request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTimetable };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.timetable_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // using his own token i.e. token erp == newTimetable.student_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c4703785-ae3d-4eb5-995c-b2fe0edc5cc5&quot;,&quot;parentUUID&quot;:&quot;3cf182ff-8a86-48c1-af98-ca08b764d4c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;fullTitle&quot;:&quot;Timetables API DELETE /timetables/:id Scenario 2: Delete a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable not found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;df976286-1dd4-40da-98e1-1ecbc8d0ed74&quot;,&quot;parentUUID&quot;:&quot;3cf182ff-8a86-48c1-af98-ca08b764d4c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Timetables API DELETE /timetables/:id Scenario 3: Delete a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unOwnedTimetableId}`) // &lt;-- has a different student_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user can&#x27;t delete others timetables i.e. token erp != unOwnedTimetable.student_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3ccf551d-c114-45ba-9e41-c779b0f11a47&quot;,&quot;parentUUID&quot;:&quot;3cf182ff-8a86-48c1-af98-ca08b764d4c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API DELETE /timetables/:id Scenario 5: Delete a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTimetable.timetable_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4c6228f9-6660-46f3-a4a2-656a43d4ba27&quot;,&quot;parentUUID&quot;:&quot;3cf182ff-8a86-48c1-af98-ca08b764d4c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c4703785-ae3d-4eb5-995c-b2fe0edc5cc5&quot;,&quot;df976286-1dd4-40da-98e1-1ecbc8d0ed74&quot;,&quot;3ccf551d-c114-45ba-9e41-c779b0f11a47&quot;,&quot;4c6228f9-6660-46f3-a4a2-656a43d4ba27&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:50,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:20000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.0.0&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;integration-tests-report&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:false,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:true,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;test/integration/report&quot;,&quot;reportFilename&quot;:&quot;integration-tests-report&quot;,&quot;json&quot;:&quot;false&quot;,&quot;autoOpen&quot;:&quot;true&quot;},&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;integration-tests-report&quot;,&quot;reportDir&quot;:&quot;test/integration/report&quot;,&quot;reportTitle&quot;:&quot;UniPal-Backend&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:true,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:false,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;test\\integration\\report\\assets&quot;,&quot;htmlFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\report\\integration-tests-report.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>