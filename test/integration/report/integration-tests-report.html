<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:159,&quot;tests&quot;:599,&quot;passes&quot;:122,&quot;pending&quot;:0,&quot;failures&quot;:477,&quot;start&quot;:&quot;2022-06-20T11:55:37.790Z&quot;,&quot;end&quot;:&quot;2022-06-20T11:55:58.398Z&quot;,&quot;duration&quot;:20608,&quot;testsRegistered&quot;:599,&quot;passPercent&quot;:20.36727879799666,&quot;pendingPercent&quot;:0,&quot;other&quot;:29,&quot;hasOther&quot;:true,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;e520ed90-0a05-49c3-a0ef-bc54c46392b0&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;175e5384-1d84-4079-8b34-d0e0335941db&quot;,&quot;title&quot;:&quot;Activities API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Activities API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activities API \&quot;before each\&quot; hook in \&quot;Activities API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;26ca2579-f3d3-46ed-987c-13b810af2ada&quot;,&quot;parentUUID&quot;:&quot;175e5384-1d84-4079-8b34-d0e0335941db&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;94c715ff-c13e-4089-9ccb-e96c43c353d8&quot;,&quot;title&quot;:&quot;GET /activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all activities request successful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 1: Get all activities request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingActivity)); // contain all params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:58:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;60cef2ef-ade6-4cd6-a39c-02d3e89c7fd9&quot;,&quot;parentUUID&quot;:&quot;94c715ff-c13e-4089-9ccb-e96c43c353d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all activities request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 2: Get all activities request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;public&#x27;;\nlet res = await request(this.app)\n    .get(`${baseRoute}?privacy=${privacy}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].privacy).to.be.equal(privacy);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:73:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;0db76a17-7378-4bcb-a5bb-c65cffdbb3fc&quot;,&quot;parentUUID&quot;:&quot;94c715ff-c13e-4089-9ccb-e96c43c353d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all activities request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 3: Get all activities request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:772,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ActivityModel = require(&#x27;../../src/models/activity.model&#x27;);\nconst modelStub = sinon.stub(ActivityModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty activity list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;8ae25dd7-57a8-49d0-8d2e-8c9430fd648d&quot;,&quot;parentUUID&quot;:&quot;94c715ff-c13e-4089-9ccb-e96c43c353d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all activities request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 4: Get all activities request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;all&#x27;; // &lt;-- invalid privacy value\nlet res = await request(this.app)\n    .get(`${baseRoute}?privacy=${privacy}&amp;week=2`) // &lt;-- `week` is an incorrect query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;privacy&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:106:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;61e96809-2e2b-46eb-b555-7519676e0d17&quot;,&quot;parentUUID&quot;:&quot;94c715ff-c13e-4089-9ccb-e96c43c353d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all activities request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities Scenario 5: Get all activities request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d09daa79-76fd-45b3-b8fe-f11307bf69a9&quot;,&quot;parentUUID&quot;:&quot;94c715ff-c13e-4089-9ccb-e96c43c353d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d09daa79-76fd-45b3-b8fe-f11307bf69a9&quot;],&quot;failures&quot;:[&quot;60cef2ef-ade6-4cd6-a39c-02d3e89c7fd9&quot;,&quot;0db76a17-7378-4bcb-a5bb-c65cffdbb3fc&quot;,&quot;8ae25dd7-57a8-49d0-8d2e-8c9430fd648d&quot;,&quot;61e96809-2e2b-46eb-b555-7519676e0d17&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:833,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;396b0a31-7f23-4399-9ca3-8e5cb01162e0&quot;,&quot;title&quot;:&quot;GET /activities/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a activity request successful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id Scenario 1: Get a activity request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.activity_id).to.be.eql(existingActivity.activity_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:135:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;1d142d5d-1e9a-40b7-bbc0-37e30aca10b2&quot;,&quot;parentUUID&quot;:&quot;396b0a31-7f23-4399-9ca3-8e5cb01162e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a activity request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id Scenario 2: Get a activity request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownActivityId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:148:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;5f3df916-6d9b-4321-9e23-03b03f5e2da5&quot;,&quot;parentUUID&quot;:&quot;396b0a31-7f23-4399-9ca3-8e5cb01162e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id Scenario 3: Get a activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingActivity.activity_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6f4cb668-3409-4c72-af7b-641d2aadbc7d&quot;,&quot;parentUUID&quot;:&quot;396b0a31-7f23-4399-9ca3-8e5cb01162e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6f4cb668-3409-4c72-af7b-641d2aadbc7d&quot;],&quot;failures&quot;:[&quot;1d142d5d-1e9a-40b7-bbc0-37e30aca10b2&quot;,&quot;5f3df916-6d9b-4321-9e23-03b03f5e2da5&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f5f7054b-7f04-4954-ad81-c28ae0a90612&quot;,&quot;title&quot;:&quot;GET /activities/:id/attendees&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get an activity&#x27;s attendees request successful&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 1: Get an activity&#x27;s attendees request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivity.activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].activity_id).to.be.equal(existingActivity.activity_id); // should match initially sent id\nexpect(resBody[0]).to.include.keys([&#x27;student_erp&#x27;, &#x27;first_name&#x27;,\n    &#x27;last_name&#x27;, &#x27;profile_picture_url&#x27;, &#x27;involvement_type&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:175:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;fdbeaeb7-8d26-4c78-a9f1-d647cacc7548&quot;,&quot;parentUUID&quot;:&quot;f5f7054b-7f04-4954-ad81-c28ae0a90612&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get an activity&#x27;s attendees request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 2: Get an activity&#x27;s attendees request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst involvement_type = &#x27;going&#x27;;\nconst query = `involvement_type=${involvement_type}`;\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivity.activity_id}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].involvement_type).to.be.equal(involvement_type);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:193:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;df0309f5-50a8-4ed3-8b67-a05867457b75&quot;,&quot;parentUUID&quot;:&quot;f5f7054b-7f04-4954-ad81-c28ae0a90612&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get an activity&#x27;s attendees request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 3: Get an activity&#x27;s attendees request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownActivityId}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:207:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;8878a0ce-f97f-44cc-802c-137b684d3e17&quot;,&quot;parentUUID&quot;:&quot;f5f7054b-7f04-4954-ad81-c28ae0a90612&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get an activity&#x27;s attendees request is unsuccessful due to zero attendees&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 4: Get an activity&#x27;s attendees request is unsuccessful due to zero attendees&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:625,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ActivityModel = require(&#x27;../../src/models/activity.model&#x27;);\nconst modelStub = sinon.stub(ActivityModel, &#x27;findAllAttendeesByActivity&#x27;).callsFake(() =&gt; []); // return empty activity attendees list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingActivity.activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;0110bee0-8e8e-422d-a4ee-b6ac2daa0431&quot;,&quot;parentUUID&quot;:&quot;f5f7054b-7f04-4954-ad81-c28ae0a90612&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get an activity&#x27;s attendees is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API GET /activities/:id/attendees Scenario 5: Get an activity&#x27;s attendees is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingActivity.activity_id}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8c13dc3a-77c7-4d0a-b248-9a7150947794&quot;,&quot;parentUUID&quot;:&quot;f5f7054b-7f04-4954-ad81-c28ae0a90612&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8c13dc3a-77c7-4d0a-b248-9a7150947794&quot;],&quot;failures&quot;:[&quot;fdbeaeb7-8d26-4c78-a9f1-d647cacc7548&quot;,&quot;df0309f5-50a8-4ed3-8b67-a05867457b75&quot;,&quot;8878a0ce-f97f-44cc-802c-137b684d3e17&quot;,&quot;0110bee0-8e8e-422d-a4ee-b6ac2daa0431&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:660,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;5dfb1242-6718-47ad-8dd5-ce50f40a6bc6&quot;,&quot;title&quot;:&quot;POST /activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create an activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 1: Create an activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newActivity.organizer_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;activity_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// affirm\nconst newId = res.body.body.activity_id;\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\ndelete res.body.body.happens_at;\ndelete data.happens_at;\nexpect(res.body.body).to.be.eql({\n    activity_id: newId,\n    num_of_attendees: 0,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:262:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;667ee856-7fca-4a4d-bdd5-3f784283ad04&quot;,&quot;parentUUID&quot;:&quot;5dfb1242-6718-47ad-8dd5-ce50f40a6bc6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create an activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 2: Create an activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // admin to create other&#x27;s activities i.e. token erp != newActivity.organizer_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;activity_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// affirm\nconst newId = res.body.body.activity_id;\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\ndelete res.body.body.happens_at;\ndelete data.happens_at;\nexpect(res.body.body).to.be.eql({\n    activity_id: newId,\n    num_of_attendees: 0,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:305:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;5372941b-46e6-4426-9cb3-1ddf60c43bed&quot;,&quot;parentUUID&quot;:&quot;5dfb1242-6718-47ad-8dd5-ce50f40a6bc6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create an activity request is unsuccessful due to unknown activity_type_id&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 3: Create an activity request is unsuccessful due to unknown activity_type_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.activity_type_id = unknownActivityTypeId; // &lt;-- non-existent activity_type_id\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_type_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:349:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;6f6ba81e-306c-4cf0-b331-e68691e5ae88&quot;,&quot;parentUUID&quot;:&quot;5dfb1242-6718-47ad-8dd5-ce50f40a6bc6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create an activity request is unsuccessful due to unknown activity_status_id&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 4: Create an activity request is unsuccessful due to unknown activity_status_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.activity_status_id = unknownActivityStatusId; // &lt;-- non-existent activity_status_id\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_status_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:372:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;8e152676-e1b1-41e0-867f-6a21b8cd36a9&quot;,&quot;parentUUID&quot;:&quot;5dfb1242-6718-47ad-8dd5-ce50f40a6bc6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create an activity request is unsuccessful due to unknown campus_spot_id&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 5: Create an activity request is unsuccessful due to unknown campus_spot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.campus_spot_id = unknownCampusSpotId; // &lt;-- non-existent campus_spot_id\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;campus_spot_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:395:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;3848f567-ef9c-4454-90db-3f13784f96e3&quot;,&quot;parentUUID&quot;:&quot;5dfb1242-6718-47ad-8dd5-ce50f40a6bc6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create an activity request is unsuccessful due to unknown organizer_erp&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 6: Create an activity request is unsuccessful due to unknown organizer_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.organizer_erp = unknownOrganizerERP; // &lt;-- non-existent organizer_erp\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;organizer_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:418:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;001790f8-e8d7-405f-b734-3a6a538ae710&quot;,&quot;parentUUID&quot;:&quot;5dfb1242-6718-47ad-8dd5-ce50f40a6bc6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Create an activity request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 7: Create an activity request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_numbersfd: newActivityMonth // &lt;-- a valid param is &#x27;month_number&#x27; &amp; &#x27;group_size&#x27; is required\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;month_number&#x27;, &#x27;group_size&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:438:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;68c6b358-b439-4271-b226-484751ca7701&quot;,&quot;parentUUID&quot;:&quot;5dfb1242-6718-47ad-8dd5-ce50f40a6bc6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Create an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 8: Create an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst invalidActivity = {...newActivity};\ninvalidActivity.organizer_erp = adminERP; // &lt;-- can be any other non-admin ERP as well, just different from userToken erp\nconst data = {\n    ...invalidActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t create others activities unless admin i.e. token erp != invalidActivity.organizer_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:462:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;e8767307-f9e9-4c4a-9688-45eddbe35d7f&quot;,&quot;parentUUID&quot;:&quot;5dfb1242-6718-47ad-8dd5-ce50f40a6bc6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Create an activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API POST /activities Scenario 9: Create an activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6a52b5f8-1690-4ab1-bc21-9f2a0269b607&quot;,&quot;parentUUID&quot;:&quot;5dfb1242-6718-47ad-8dd5-ce50f40a6bc6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6a52b5f8-1690-4ab1-bc21-9f2a0269b607&quot;],&quot;failures&quot;:[&quot;667ee856-7fca-4a4d-bdd5-3f784283ad04&quot;,&quot;5372941b-46e6-4426-9cb3-1ddf60c43bed&quot;,&quot;6f6ba81e-306c-4cf0-b331-e68691e5ae88&quot;,&quot;8e152676-e1b1-41e0-867f-6a21b8cd36a9&quot;,&quot;3848f567-ef9c-4454-90db-3f13784f96e3&quot;,&quot;001790f8-e8d7-405f-b734-3a6a538ae710&quot;,&quot;68c6b358-b439-4271-b226-484751ca7701&quot;,&quot;e8767307-f9e9-4c4a-9688-45eddbe35d7f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:95,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;67c74c67-54cd-41a1-b132-fed64273d80d&quot;,&quot;title&quot;:&quot;PATCH /activities/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update an activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 1: Update an activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingActivity.organizer_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.month_number).to.be.equal(newActivityMonth);\n\n// cleanup\ndata.month_number = existingActivity.month_number;\nres = await request(app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:504:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;83cafef5-2c3a-44e9-91d4-6d085612e464&quot;,&quot;parentUUID&quot;:&quot;67c74c67-54cd-41a1-b132-fed64273d80d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update an activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 2: Update an activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // admin to edit other profiles i.e. token erp != existingActivity.organizer_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.month_number).to.be.equal(newActivityMonth);\n\n// cleanup\ndata.month_number = existingActivity.month_number;\nres = await request(app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:538:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;bc5876ad-a396-49a4-a83c-7f708c094efc&quot;,&quot;parentUUID&quot;:&quot;67c74c67-54cd-41a1-b132-fed64273d80d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update an activity request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 3: Update an activity request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // use admin token for no permission side effects\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:571:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;1b5ca5f4-d77a-49ab-9293-f98db229c66c&quot;,&quot;parentUUID&quot;:&quot;67c74c67-54cd-41a1-b132-fed64273d80d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update an activity request is unsuccessful due to unknown activity_type_id&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 4: Update an activity request is unsuccessful due to unknown activity_type_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type_id: unknownActivityTypeId }; // &lt;-- Non-existent activity_type_id\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // use admin token for no permission side effects\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_type_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:588:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;e21d3786-8c9d-45b3-9fc7-d5aae1682aca&quot;,&quot;parentUUID&quot;:&quot;67c74c67-54cd-41a1-b132-fed64273d80d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update an activity request is unsuccessful due to unknown activity_status_id&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 5: Update an activity request is unsuccessful due to unknown activity_status_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status_id: unknownActivityStatusId }; // &lt;-- Non-existent activity_status_id\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // use admin token for no permission side effects\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_status_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:605:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;0a4eae5a-d53e-4ffd-8764-f66d69fd7e21&quot;,&quot;parentUUID&quot;:&quot;67c74c67-54cd-41a1-b132-fed64273d80d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update an activity request is unsuccessful due to unknown campus_spot_id&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 6: Update an activity request is unsuccessful due to unknown campus_spot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot_id: unknownCampusSpotId }; // &lt;-- Non-existent campus_spot_id\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // use admin token for no permission side effects\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;campus_spot_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:622:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;62d388d4-f5ee-4c00-96db-494ff0245b51&quot;,&quot;parentUUID&quot;:&quot;67c74c67-54cd-41a1-b132-fed64273d80d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Update an activity request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 7: Update an activity request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    month_numbersds: newActivityMonth, // &lt;-- an valid parameter name should be &#x27;month_number&#x27;\n    group_size: -2 // &lt;-- a valid &#x27;group_size&#x27; has to be positive only\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;group_size&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:642:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;879675dd-d39e-4580-aa19-72c1831adabb&quot;,&quot;parentUUID&quot;:&quot;67c74c67-54cd-41a1-b132-fed64273d80d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Update an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 8: Update an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedActivityId}`) // &lt;-- has a different organizer_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others activities i.e. token erp != unOwnedActivity.organizer_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:662:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;7828b625-66e9-409f-94c1-b56be86c1bdf&quot;,&quot;parentUUID&quot;:&quot;67c74c67-54cd-41a1-b132-fed64273d80d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Update an activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API PATCH /activities/:id Scenario 9: Update an activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { month_number: newActivityMonth };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivity.activity_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2bccccfd-845f-4ca4-80cc-fd9f4f87b669&quot;,&quot;parentUUID&quot;:&quot;67c74c67-54cd-41a1-b132-fed64273d80d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2bccccfd-845f-4ca4-80cc-fd9f4f87b669&quot;],&quot;failures&quot;:[&quot;83cafef5-2c3a-44e9-91d4-6d085612e464&quot;,&quot;bc5876ad-a396-49a4-a83c-7f708c094efc&quot;,&quot;1b5ca5f4-d77a-49ab-9293-f98db229c66c&quot;,&quot;e21d3786-8c9d-45b3-9fc7-d5aae1682aca&quot;,&quot;0a4eae5a-d53e-4ffd-8764-f66d69fd7e21&quot;,&quot;62d388d4-f5ee-4c00-96db-494ff0245b51&quot;,&quot;879675dd-d39e-4580-aa19-72c1831adabb&quot;,&quot;7828b625-66e9-409f-94c1-b56be86c1bdf&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:66,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d03be89f-ab63-4e03-b7ba-31d0c9f806f8&quot;,&quot;title&quot;:&quot;DELETE /activities/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete an activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 1: Delete an activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.activity_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // using his own token i.e. token erp == newActivity.organizer_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:704:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;e9e99253-bff9-4d2f-b60d-8d0675e33acf&quot;,&quot;parentUUID&quot;:&quot;d03be89f-ab63-4e03-b7ba-31d0c9f806f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete an activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 2: Delete an activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    ...newActivity,\n    month_number: newActivityMonth,\n    group_size: newActivityGroupSize\n};\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.activity_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // admin can delete other&#x27;s activities even if token erp != newActivity.organizer_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:743:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;8d2db609-5374-44b5-980c-2d80fda9bf6c&quot;,&quot;parentUUID&quot;:&quot;d03be89f-ab63-4e03-b7ba-31d0c9f806f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete an activity request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 3: Delete an activity request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:775:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;8424d161-2bca-444e-a246-63381debc4aa&quot;,&quot;parentUUID&quot;:&quot;d03be89f-ab63-4e03-b7ba-31d0c9f806f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 4: Delete an activity request is forbidden (Unowned Organizer ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unOwnedActivityId}`) // &lt;-- has a different organizer_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user can&#x27;t delete others activities i.e. token erp != unOwnedActivity.organizer_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activity.test.js:788:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;5e035077-0dfa-4406-8737-395978619ef7&quot;,&quot;parentUUID&quot;:&quot;d03be89f-ab63-4e03-b7ba-31d0c9f806f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete an activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activities API DELETE /activities/:id Scenario 5: Delete an activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivity.activity_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;71522f7f-d13f-4a2f-b77e-400505f3bd77&quot;,&quot;parentUUID&quot;:&quot;d03be89f-ab63-4e03-b7ba-31d0c9f806f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;71522f7f-d13f-4a2f-b77e-400505f3bd77&quot;],&quot;failures&quot;:[&quot;e9e99253-bff9-4d2f-b60d-8d0675e33acf&quot;,&quot;8d2db609-5374-44b5-980c-2d80fda9bf6c&quot;,&quot;8424d161-2bca-444e-a246-63381debc4aa&quot;,&quot;5e035077-0dfa-4406-8737-395978619ef7&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:29,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;2dc36b87-ba89-41cf-a1be-068762d3d0ed&quot;,&quot;title&quot;:&quot;Activity Attendees API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityAttendee.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityAttendee.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Activity Attendees API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API \&quot;before each\&quot; hook in \&quot;Activity Attendees API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6a9bd97b-8cb3-49ca-a4c7-5628d9ad8132&quot;,&quot;parentUUID&quot;:&quot;2dc36b87-ba89-41cf-a1be-068762d3d0ed&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5e77f9f7-f53b-489a-876d-e4d010e4bea5&quot;,&quot;title&quot;:&quot;POST /activities/:id/attendees&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityAttendee.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityAttendee.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create an activity attendee request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 1: Create an activity attendee request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_erp, involvement_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n// affirm\nconst query = `involvement_type=${involvement_type}`;\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkStudentERP = activity =&gt; activity.student_erp === data.student_erp;\nexpect(res.body.body.some(checkStudentERP)).to.be.true;\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${activity_id}/${subRoute}/${data.student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:45:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;f0d8b693-9966-4136-8e0b-a7a20a66cf85&quot;,&quot;parentUUID&quot;:&quot;5e77f9f7-f53b-489a-876d-e4d010e4bea5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create an activity attendee request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 2: Create an activity attendee request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_erp: unknownStudentERP, involvement_type }; // &lt;-- Non-existent student_erp\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;student_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:78:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;98562511-d3b1-4ead-b1bf-88b0921563a1&quot;,&quot;parentUUID&quot;:&quot;5e77f9f7-f53b-489a-876d-e4d010e4bea5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create an activity attendee request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 3: Create an activity attendee request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    involvement_type: &#x27;not going&#x27;, // &lt;-- not a valid involvement_type\n    erp: &#x27;12345&#x27; // &lt;-- a valid parameter name should be &#x27;student_erp&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;involvement_type&#x27;, &#x27;student_erp&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:98:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;c2bbff6e-981b-4b49-aca1-a41e51d5f051&quot;,&quot;parentUUID&quot;:&quot;5e77f9f7-f53b-489a-876d-e4d010e4bea5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create an activity attendee request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 4: Create an activity attendee request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_erp: adminERP, involvement_type }; // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:116:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;65d5bfa5-1b8c-4016-bc8e-587874bd75f7&quot;,&quot;parentUUID&quot;:&quot;5e77f9f7-f53b-489a-876d-e4d010e4bea5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create an activity attendee request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API POST /activities/:id/attendees Scenario 5: Create an activity attendee request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_erp, involvement_type };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1cb00e45-a0db-4575-9d5b-8f59694de25e&quot;,&quot;parentUUID&quot;:&quot;5e77f9f7-f53b-489a-876d-e4d010e4bea5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1cb00e45-a0db-4575-9d5b-8f59694de25e&quot;],&quot;failures&quot;:[&quot;f0d8b693-9966-4136-8e0b-a7a20a66cf85&quot;,&quot;98562511-d3b1-4ead-b1bf-88b0921563a1&quot;,&quot;c2bbff6e-981b-4b49-aca1-a41e51d5f051&quot;,&quot;65d5bfa5-1b8c-4016-bc8e-587874bd75f7&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:29,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;bc10f720-81b2-4fa2-990a-5b614c821e05&quot;,&quot;title&quot;:&quot;PATCH /activities/:id/attendees/:student_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityAttendee.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityAttendee.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update an activity attendee request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 1: Update an activity attendee request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- userToken.erp == student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nconst query = `involvement_type=${involvement_type}`;\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst studentERPs = res.body.body.map(o =&gt; (o.student_erp));\nexpect(studentERPs).to.include(student_erp);\n\n// cleanup\ndata.involvement_type = existingActivityAttendee.involvement_type;\nres = await request(app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:156:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;4002fbb1-d397-4068-8fd8-e649e99f8dcf&quot;,&quot;parentUUID&quot;:&quot;bc10f720-81b2-4fa2-990a-5b614c821e05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update an activity attendee request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 2: Update an activity attendee request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nconst query = `involvement_type=${involvement_type}`;\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst studentERPs = res.body.body.map(o =&gt; (o.student_erp));\nexpect(studentERPs).to.include(student_erp);\n\n// cleanup\ndata.involvement_type = existingActivityAttendee.involvement_type;\nres = await request(app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:192:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;4926cdef-38bd-4044-a483-73e439b3bab9&quot;,&quot;parentUUID&quot;:&quot;bc10f720-81b2-4fa2-990a-5b614c821e05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update an activity attendee request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 3: Update an activity attendee request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownActivityId}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:227:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;0158e942-7f26-4b78-999c-ab2f1612e07e&quot;,&quot;parentUUID&quot;:&quot;bc10f720-81b2-4fa2-990a-5b614c821e05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update an activity attendee request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 4: Update an activity attendee request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${unknownStudentERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:244:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;edcb9910-2a3b-4133-921a-ce0195580b75&quot;,&quot;parentUUID&quot;:&quot;bc10f720-81b2-4fa2-990a-5b614c821e05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update an activity attendee request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 5: Update an activity attendee request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    involvement_type: &#x27;not going&#x27;, // &lt;-- not a valid involvement_type\n    erp: &#x27;12345&#x27; // &lt;-- an invalid update parameter i.e. not allowed\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;involvement_type&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include.members([&#x27;Invalid updates!&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:264:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;57b81078-217a-4f5f-87b3-11445efc5b51&quot;,&quot;parentUUID&quot;:&quot;bc10f720-81b2-4fa2-990a-5b614c821e05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update an activity attendee request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 6: Update an activity attendee request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${adminERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:284:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;79380438-5521-48e2-8cf8-fb94a02dd65f&quot;,&quot;parentUUID&quot;:&quot;bc10f720-81b2-4fa2-990a-5b614c821e05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Update an activity attendee request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API PATCH /activities/:id/attendees/:student_erp Scenario 7: Update an activity attendee request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { involvement_type };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5d1b1493-e73a-45b4-8384-26a355e49977&quot;,&quot;parentUUID&quot;:&quot;bc10f720-81b2-4fa2-990a-5b614c821e05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5d1b1493-e73a-45b4-8384-26a355e49977&quot;],&quot;failures&quot;:[&quot;4002fbb1-d397-4068-8fd8-e649e99f8dcf&quot;,&quot;4926cdef-38bd-4044-a483-73e439b3bab9&quot;,&quot;0158e942-7f26-4b78-999c-ab2f1612e07e&quot;,&quot;edcb9910-2a3b-4133-921a-ce0195580b75&quot;,&quot;57b81078-217a-4f5f-87b3-11445efc5b51&quot;,&quot;79380438-5521-48e2-8cf8-fb94a02dd65f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:55,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0172f01f-b3d7-46e8-91ee-5eff5dc915b4&quot;,&quot;title&quot;:&quot;DELETE /activities/:id/attendees/:student_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityAttendee.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityAttendee.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete an activity attendee request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 1: Delete an activity attendee request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { student_erp, involvement_type };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp == student_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:323:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;a4fd1041-da67-4acb-8db1-7d5564675f6a&quot;,&quot;parentUUID&quot;:&quot;0172f01f-b3d7-46e8-91ee-5eff5dc915b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete an activity attendee request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 2: Delete an activity attendee request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { student_erp, involvement_type };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${activity_id}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp != student_erp but still bypass ownerCheck\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${activity_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:356:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;b795442f-1dce-41e3-ad52-274c8c9a2539&quot;,&quot;parentUUID&quot;:&quot;0172f01f-b3d7-46e8-91ee-5eff5dc915b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete an activity attendee request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 3: Delete an activity attendee request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownActivityId}/${subRoute}/${student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:386:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;b34ef2f2-7ede-4e2f-a1de-d2d363978128&quot;,&quot;parentUUID&quot;:&quot;0172f01f-b3d7-46e8-91ee-5eff5dc915b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete an activity attendee request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 4: Delete an activity attendee request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityId}/${subRoute}/${unknownStudentERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity attendee not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:399:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;642cf825-8d76-42fc-9c0b-f96b0f7b518a&quot;,&quot;parentUUID&quot;:&quot;0172f01f-b3d7-46e8-91ee-5eff5dc915b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete an activity attendee request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 5: Delete an activity attendee request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityId}/${subRoute}/${adminERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityAttendee.test.js:412:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;f3f20e93-e30a-4f7d-9f27-29e61cce43b1&quot;,&quot;parentUUID&quot;:&quot;0172f01f-b3d7-46e8-91ee-5eff5dc915b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Delete an activity attendee request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Attendees API DELETE /activities/:id/attendees/:student_erp Scenario 6: Delete an activity attendee request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityId}/${subRoute}/${student_erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4744db8a-c81a-4f2c-a476-0a307b92a13b&quot;,&quot;parentUUID&quot;:&quot;0172f01f-b3d7-46e8-91ee-5eff5dc915b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4744db8a-c81a-4f2c-a476-0a307b92a13b&quot;],&quot;failures&quot;:[&quot;a4fd1041-da67-4acb-8db1-7d5564675f6a&quot;,&quot;b795442f-1dce-41e3-ad52-274c8c9a2539&quot;,&quot;b34ef2f2-7ede-4e2f-a1de-d2d363978128&quot;,&quot;642cf825-8d76-42fc-9c0b-f96b0f7b518a&quot;,&quot;f3f20e93-e30a-4f7d-9f27-29e61cce43b1&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b64c20b6-8ac3-41a9-84c7-f131c7bac15f&quot;,&quot;title&quot;:&quot;Activity Statuses API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Activity Statuses API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API \&quot;before each\&quot; hook in \&quot;Activity Statuses API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f4bf4ea0-1785-43b8-87a9-7d77e1326c8e&quot;,&quot;parentUUID&quot;:&quot;b64c20b6-8ac3-41a9-84c7-f131c7bac15f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6928dd82-d501-409b-9817-0a5e7ae356ba&quot;,&quot;title&quot;:&quot;GET /activity-statuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all activity statuses request successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses Scenario 1: Get all activity statuses request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;activity_status_id&#x27;, &#x27;activity_status&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:34:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;ee006096-3c03-4f9f-97b3-2538ad5d288f&quot;,&quot;parentUUID&quot;:&quot;6928dd82-d501-409b-9817-0a5e7ae356ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all activity statuses request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses Scenario 2: Get all activity statuses request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:520,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ActivityStatusModel = require(&#x27;../../src/models/activityStatus.model&#x27;);\nconst modelStub = sinon.stub(ActivityStatusModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty activity_status list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity statuses not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;542f00b0-a2ae-47ee-a828-1117af35439f&quot;,&quot;parentUUID&quot;:&quot;6928dd82-d501-409b-9817-0a5e7ae356ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;ee006096-3c03-4f9f-97b3-2538ad5d288f&quot;,&quot;542f00b0-a2ae-47ee-a828-1117af35439f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:528,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b5b76bae-c234-4175-8ae1-dcf69c72b8eb&quot;,&quot;title&quot;:&quot;GET /activity-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a activity status request successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses/:id Scenario 1: Get a activity status request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;activity_status_id&#x27;, &#x27;activity_status&#x27;]);\nexpect(resBody.activity_status_id).to.be.eql(existingActivityStatus.activity_status_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:69:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;3b06602e-9656-488c-bdbe-bd3b96635f99&quot;,&quot;parentUUID&quot;:&quot;b5b76bae-c234-4175-8ae1-dcf69c72b8eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a activity status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses/:id Scenario 2: Get a activity status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownActivityStatusId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity status not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:83:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;1ceb6373-2fca-49b1-822f-9aa8a82fd8d9&quot;,&quot;parentUUID&quot;:&quot;b5b76bae-c234-4175-8ae1-dcf69c72b8eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a activity status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API GET /activity-statuses/:id Scenario 3: Get a activity status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingActivityStatus.activity_status_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1120b653-4ab3-41c1-8049-9221e5005586&quot;,&quot;parentUUID&quot;:&quot;b5b76bae-c234-4175-8ae1-dcf69c72b8eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1120b653-4ab3-41c1-8049-9221e5005586&quot;],&quot;failures&quot;:[&quot;3b06602e-9656-488c-bdbe-bd3b96635f99&quot;,&quot;1ceb6373-2fca-49b1-822f-9aa8a82fd8d9&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:19,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;afb2dbcf-3bf6-42e9-89e7-be0209b4eb2a&quot;,&quot;title&quot;:&quot;POST /activity-statuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a activity status request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API POST /activity-statuses Scenario 1: Create a activity status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;activity_status_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.activity_status_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    activity_status_id: newId,\n    activity_status: activity_status\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:116:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;4132d582-1939-40f7-8f09-e669e19e4e67&quot;,&quot;parentUUID&quot;:&quot;afb2dbcf-3bf6-42e9-89e7-be0209b4eb2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a activity status request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API POST /activity-statuses Scenario 2: Create a activity status request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    activity_statuses: activity_status // &lt;-- a valid parameter name should be &#x27;activity_status&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;activity_status&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:153:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;d646aa39-a8e3-4f05-82a0-0d9e33c1ddf2&quot;,&quot;parentUUID&quot;:&quot;afb2dbcf-3bf6-42e9-89e7-be0209b4eb2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a activity status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API POST /activity-statuses Scenario 3: Create a activity status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:171:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;29dfedfb-10cf-4703-b981-aa0e31933f33&quot;,&quot;parentUUID&quot;:&quot;afb2dbcf-3bf6-42e9-89e7-be0209b4eb2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a activity status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API POST /activity-statuses Scenario 4: Create a activity status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;93a01e18-5973-4782-bddb-922edeaa5a06&quot;,&quot;parentUUID&quot;:&quot;afb2dbcf-3bf6-42e9-89e7-be0209b4eb2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;93a01e18-5973-4782-bddb-922edeaa5a06&quot;],&quot;failures&quot;:[&quot;4132d582-1939-40f7-8f09-e669e19e4e67&quot;,&quot;d646aa39-a8e3-4f05-82a0-0d9e33c1ddf2&quot;,&quot;29dfedfb-10cf-4703-b981-aa0e31933f33&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:36,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ccc92015-2ecd-4a71-954d-1c578b05890b&quot;,&quot;title&quot;:&quot;PATCH /activity-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a activity status request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 1: Update a activity status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status: newActivityStatus };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    activity_status_id: existingActivityStatus.activity_status_id,\n    activity_status: newActivityStatus\n});\n\n// cleanup\ndata.activity_status = existingActivityStatus.activity_status;\nres = await request(app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:209:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;a08762a5-4db8-4d37-8e76-c9210c6e3604&quot;,&quot;parentUUID&quot;:&quot;ccc92015-2ecd-4a71-954d-1c578b05890b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a activity status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 2: Update a activity status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status: newActivityStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownActivityStatusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity status not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:245:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;cd3dd7fa-fc34-4695-9632-a2751bc3bb2f&quot;,&quot;parentUUID&quot;:&quot;ccc92015-2ecd-4a71-954d-1c578b05890b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a activity status request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 3: Update a activity status request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    activity_statuses: newActivityStatus // &lt;-- a valid parameter name should be &#x27;activity_status&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;activity_status&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:264:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;dde55f9f-ba9b-497d-84a3-3032529cdd94&quot;,&quot;parentUUID&quot;:&quot;ccc92015-2ecd-4a71-954d-1c578b05890b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a activity status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 4: Update a activity status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status: newActivityStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:282:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;c1caa9f5-83dd-4c33-92f0-749356ee9e25&quot;,&quot;parentUUID&quot;:&quot;ccc92015-2ecd-4a71-954d-1c578b05890b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a activity status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API PATCH /activity-statuses/:id Scenario 5: Update a activity status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_status: newActivityStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ab6ca7ea-1402-4db6-bcae-5267dda164e4&quot;,&quot;parentUUID&quot;:&quot;ccc92015-2ecd-4a71-954d-1c578b05890b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ab6ca7ea-1402-4db6-bcae-5267dda164e4&quot;],&quot;failures&quot;:[&quot;a08762a5-4db8-4d37-8e76-c9210c6e3604&quot;,&quot;cd3dd7fa-fc34-4695-9632-a2751bc3bb2f&quot;,&quot;dde55f9f-ba9b-497d-84a3-3032529cdd94&quot;,&quot;c1caa9f5-83dd-4c33-92f0-749356ee9e25&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;2d2d76fa-6d4a-455c-89b8-412e71d0b8e6&quot;,&quot;title&quot;:&quot;DELETE /activity-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a activity status request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API DELETE /activity-statuses/:id Scenario 1: Delete a activity status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { activity_status };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.activity_status_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity status has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:318:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;fdc8f965-3f50-411e-933f-c48850663722&quot;,&quot;parentUUID&quot;:&quot;2d2d76fa-6d4a-455c-89b8-412e71d0b8e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a activity status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API DELETE /activity-statuses/:id Scenario 2: Delete a activity status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownActivityStatusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity status not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:350:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;31fd0d66-c8dd-4ec2-bca0-e52909f7f4f2&quot;,&quot;parentUUID&quot;:&quot;2d2d76fa-6d4a-455c-89b8-412e71d0b8e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a activity status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API DELETE /activity-statuses/:id Scenario 3: Delete a activity status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityStatus.activity_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityStatus.test.js:363:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;71c68a12-97a2-4cf0-8afe-d54ff24add30&quot;,&quot;parentUUID&quot;:&quot;2d2d76fa-6d4a-455c-89b8-412e71d0b8e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a activity status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Statuses API DELETE /activity-statuses/:id Scenario 4: Delete a activity status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityStatus.activity_status_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c94dd14e-12f8-429f-9414-56a1c500ccd3&quot;,&quot;parentUUID&quot;:&quot;2d2d76fa-6d4a-455c-89b8-412e71d0b8e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c94dd14e-12f8-429f-9414-56a1c500ccd3&quot;],&quot;failures&quot;:[&quot;fdc8f965-3f50-411e-933f-c48850663722&quot;,&quot;31fd0d66-c8dd-4ec2-bca0-e52909f7f4f2&quot;,&quot;71c68a12-97a2-4cf0-8afe-d54ff24add30&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9942c9f3-8c22-4969-b121-0e14e32ae75a&quot;,&quot;title&quot;:&quot;Activity Types API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Activity Types API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Types API \&quot;before each\&quot; hook in \&quot;Activity Types API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;29bb5335-f295-456e-a078-e7d7d9ab0712&quot;,&quot;parentUUID&quot;:&quot;9942c9f3-8c22-4969-b121-0e14e32ae75a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a8cb490e-56ae-47b3-847e-07b7f04fb1ee&quot;,&quot;title&quot;:&quot;GET /activity-types&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all activity types request successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types Scenario 1: Get all activity types request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;activity_type_id&#x27;, &#x27;activity_type&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:34:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;d178a5c1-d287-4c39-816f-c351eba3fedf&quot;,&quot;parentUUID&quot;:&quot;a8cb490e-56ae-47b3-847e-07b7f04fb1ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all activity types request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types Scenario 2: Get all activity types request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:547,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ActivityTypeModel = require(&#x27;../../src/models/activityType.model&#x27;);\nconst modelStub = sinon.stub(ActivityTypeModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty activity_type list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity types not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;304763b2-03d7-46ef-9ea3-2cf698be7a4c&quot;,&quot;parentUUID&quot;:&quot;a8cb490e-56ae-47b3-847e-07b7f04fb1ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;d178a5c1-d287-4c39-816f-c351eba3fedf&quot;,&quot;304763b2-03d7-46ef-9ea3-2cf698be7a4c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:552,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6a6f40c4-90c7-4a25-8baa-52680f504d81&quot;,&quot;title&quot;:&quot;GET /activity-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a activity type request successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types/:id Scenario 1: Get a activity type request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;activity_type_id&#x27;, &#x27;activity_type&#x27;]);\nexpect(resBody.activity_type_id).to.be.eql(existingActivityType.activity_type_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:69:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;eade2f27-a5bd-49ab-b16c-24e861aa44d3&quot;,&quot;parentUUID&quot;:&quot;6a6f40c4-90c7-4a25-8baa-52680f504d81&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a activity type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types/:id Scenario 2: Get a activity type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownActivityTypeId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity type not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:83:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;b2b76d4d-196e-426b-99b2-0a691b9161e3&quot;,&quot;parentUUID&quot;:&quot;6a6f40c4-90c7-4a25-8baa-52680f504d81&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a activity type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Types API GET /activity-types/:id Scenario 3: Get a activity type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingActivityType.activity_type_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dff4bc32-6fbf-4e42-ac0a-f715c2f5bd72&quot;,&quot;parentUUID&quot;:&quot;6a6f40c4-90c7-4a25-8baa-52680f504d81&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;dff4bc32-6fbf-4e42-ac0a-f715c2f5bd72&quot;],&quot;failures&quot;:[&quot;eade2f27-a5bd-49ab-b16c-24e861aa44d3&quot;,&quot;b2b76d4d-196e-426b-99b2-0a691b9161e3&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ed525ba9-8e12-4b6d-ad6f-b83cfb8f82fd&quot;,&quot;title&quot;:&quot;POST /activity-types&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a activity type request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API POST /activity-types Scenario 1: Create a activity type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;activity_type_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.activity_type_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    activity_type_id: newId,\n    activity_type: activity_type\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:116:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;ea2aaae0-592a-4706-882f-2f0973f7b962&quot;,&quot;parentUUID&quot;:&quot;ed525ba9-8e12-4b6d-ad6f-b83cfb8f82fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a activity type request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Types API POST /activity-types Scenario 2: Create a activity type request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    activity_types: activity_type // &lt;-- a valid parameter name should be &#x27;activity_type&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;activity_type&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:153:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;e0163195-a8f9-48e1-8796-4109ddb7586b&quot;,&quot;parentUUID&quot;:&quot;ed525ba9-8e12-4b6d-ad6f-b83cfb8f82fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a activity type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Types API POST /activity-types Scenario 3: Create a activity type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:171:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;82ef9fb8-064d-4b15-b0a0-21522db2eb54&quot;,&quot;parentUUID&quot;:&quot;ed525ba9-8e12-4b6d-ad6f-b83cfb8f82fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a activity type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Types API POST /activity-types Scenario 4: Create a activity type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9aa4533b-024b-4840-815f-ad8f9aa09447&quot;,&quot;parentUUID&quot;:&quot;ed525ba9-8e12-4b6d-ad6f-b83cfb8f82fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9aa4533b-024b-4840-815f-ad8f9aa09447&quot;],&quot;failures&quot;:[&quot;ea2aaae0-592a-4706-882f-2f0973f7b962&quot;,&quot;e0163195-a8f9-48e1-8796-4109ddb7586b&quot;,&quot;82ef9fb8-064d-4b15-b0a0-21522db2eb54&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7c6aa447-404b-4adc-9462-f9f59fc823a2&quot;,&quot;title&quot;:&quot;PATCH /activity-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a activity type request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 1: Update a activity type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type: newActivityType };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    activity_type_id: existingActivityType.activity_type_id,\n    activity_type: newActivityType\n});\n\n// cleanup\ndata.activity_type = existingActivityType.activity_type;\nres = await request(app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:209:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;ebd3afe9-5c8f-4a5c-8748-a645a3207ec5&quot;,&quot;parentUUID&quot;:&quot;7c6aa447-404b-4adc-9462-f9f59fc823a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a activity type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 2: Update a activity type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type: newActivityType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownActivityTypeId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity type not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:245:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;cf631292-79ea-4c28-bd1b-a3d4f1a0fad5&quot;,&quot;parentUUID&quot;:&quot;7c6aa447-404b-4adc-9462-f9f59fc823a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a activity type request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 3: Update a activity type request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    activity_types: newActivityType // &lt;-- a valid parameter name should be &#x27;activity_type&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;activity_type&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:264:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;8c19308c-06d8-4213-83ad-b0460d8a83d8&quot;,&quot;parentUUID&quot;:&quot;7c6aa447-404b-4adc-9462-f9f59fc823a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a activity type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 4: Update a activity type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type: newActivityType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:282:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;922dcce5-75b4-43ec-8baf-d375770f340f&quot;,&quot;parentUUID&quot;:&quot;7c6aa447-404b-4adc-9462-f9f59fc823a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a activity type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Types API PATCH /activity-types/:id Scenario 5: Update a activity type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_type: newActivityType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;baeaedfd-a712-46f4-aab1-8c23c475fba1&quot;,&quot;parentUUID&quot;:&quot;7c6aa447-404b-4adc-9462-f9f59fc823a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;baeaedfd-a712-46f4-aab1-8c23c475fba1&quot;],&quot;failures&quot;:[&quot;ebd3afe9-5c8f-4a5c-8748-a645a3207ec5&quot;,&quot;cf631292-79ea-4c28-bd1b-a3d4f1a0fad5&quot;,&quot;8c19308c-06d8-4213-83ad-b0460d8a83d8&quot;,&quot;922dcce5-75b4-43ec-8baf-d375770f340f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;374ecd73-f264-4b56-b79c-93237da9bf15&quot;,&quot;title&quot;:&quot;DELETE /activity-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\activityType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\activityType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a activity type request is successful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API DELETE /activity-types/:id Scenario 1: Delete a activity type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { activity_type };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.activity_type_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity type has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:318:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;59858e5e-5e96-4fc8-888e-0b72ceb0f4cc&quot;,&quot;parentUUID&quot;:&quot;374ecd73-f264-4b56-b79c-93237da9bf15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a activity type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Activity Types API DELETE /activity-types/:id Scenario 2: Delete a activity type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownActivityTypeId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Activity type not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:350:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;ec1118c6-f025-4eb3-837d-0728c3d6ed08&quot;,&quot;parentUUID&quot;:&quot;374ecd73-f264-4b56-b79c-93237da9bf15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a activity type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Activity Types API DELETE /activity-types/:id Scenario 3: Delete a activity type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityType.activity_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\activityType.test.js:363:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;1164b858-750c-4847-b356-c8cc3b14a9ef&quot;,&quot;parentUUID&quot;:&quot;374ecd73-f264-4b56-b79c-93237da9bf15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a activity type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Activity Types API DELETE /activity-types/:id Scenario 4: Delete a activity type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingActivityType.activity_type_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b730430a-9760-424e-b558-223438bfebff&quot;,&quot;parentUUID&quot;:&quot;374ecd73-f264-4b56-b79c-93237da9bf15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b730430a-9760-424e-b558-223438bfebff&quot;],&quot;failures&quot;:[&quot;59858e5e-5e96-4fc8-888e-0b72ceb0f4cc&quot;,&quot;ec1118c6-f025-4eb3-837d-0728c3d6ed08&quot;,&quot;1164b858-750c-4847-b356-c8cc3b14a9ef&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0988bacc-ffa9-4d7a-99e1-c19689d6906e&quot;,&quot;title&quot;:&quot;Authentication API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Authentication API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API \&quot;before each\&quot; hook in \&quot;Authentication API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: done() called multiple times in hook &lt;Authentication API \&quot;before each\&quot; hook in \&quot;Authentication API\&quot;&gt; of file D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js; in addition, done() received error: DatabaseException [Database Error]: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21) {\n  isOperational: false,\n  code: &#x27;DatabaseException&#x27;,\n  status: 500,\n  data: undefined,\n  uncaught: true\n}&quot;,&quot;estack&quot;:&quot;Error: done() called multiple times in hook &lt;Authentication API \&quot;before each\&quot; hook in \&quot;Authentication API\&quot;&gt; of file D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js; in addition, done() received error: DatabaseException [Database Error]: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21) {\n  isOperational: false,\n  code: &#x27;DatabaseException&#x27;,\n  status: 500,\n  data: undefined,\n  uncaught: true\n}\n    at process.emit (node:events:539:35)\n    at processEmit [as emit] (node_modules\\signal-exit\\index.js:199:34)\n    at process._fatalException (node:internal/process/execution:167:25)&quot;},&quot;uuid&quot;:&quot;c42939bc-6ffd-4445-971a-53ac0d6fae7d&quot;,&quot;parentUUID&quot;:&quot;0988bacc-ffa9-4d7a-99e1-c19689d6906e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bd0eba8e-25f5-4a3c-984a-45cf6f386cd3&quot;,&quot;title&quot;:&quot;POST /auth/register&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;POST /auth/register\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register \&quot;before each\&quot; hook in \&quot;POST /auth/register\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;studentBody = {\n    erp: newERP,\n    first_name: \&quot;Abdur Rafay\&quot;,\n    last_name: \&quot;Saleem\&quot;,\n    gender: \&quot;male\&quot;,\n    contact: \&quot;+923009999999\&quot;,\n    birthday: \&quot;1999-09-18\&quot;,\n    password: \&quot;123\&quot;,\n    profile_picture_url: \&quot;https://i.pinimg.com/564x/8d/e3/89/8de389c84e919d3577f47118e2627d95.jpg\&quot;,\n    graduation_year: 2022,\n    uni_email: newEmail,\n    campus_id: 1,\n    program_id: 1,\n    is_active: 1\n};&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;976f6b5e-ddfe-4caa-86d2-bf7e0893ae73&quot;,&quot;parentUUID&quot;:&quot;bd0eba8e-25f5-4a3c-984a-45cf6f386cd3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Register request is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register Scenario 1: Register request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nstudentBody.erp = newERP;\nstudentBody.uni_email = newEmail;\nconst app = this.app;\n// act\nlet res = await request(app).post(`${baseRoute}/register`).send(studentBody);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.token).to.exist;\nexpect(resBody.role).to.be.equal(&#x27;api_user&#x27;);\ndelete studentBody.password; // omit token and password\nconst studentFields = Object.keys(studentBody);\nconst studentFieldsCheck = field =&gt; resBody[field] === studentBody[field]; // deep compare two objects\nexpect(studentFields.every(studentFieldsCheck)).to.be.true;\n// cleanup\nconst deleteRoute = `/api/${Config.API_VERSION}/students/${studentBody.erp}`;\nconst adminToken = jwt.sign({erp: adminERP}, Config.SECRET_JWT);\nres = await request(app)\n    .delete(deleteRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:55:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;d49cac81-bb53-4e1c-9cc5-d0fa1220fe94&quot;,&quot;parentUUID&quot;:&quot;bd0eba8e-25f5-4a3c-984a-45cf6f386cd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Register request is unsuccessful due to duplicate student&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register Scenario 2: Register request is unsuccessful due to duplicate student&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nstudentBody.erp = existingERP;\nstudentBody.uni_email = existingEmail;\n// act\nconst res = await request(this.app).post(`${baseRoute}/register`).send(studentBody);\n    \n// assert\nexpect(res.status).to.be.equal(409);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DuplicateEntryException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 409&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 409\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:83:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;409&quot;}]},&quot;uuid&quot;:&quot;72c5d120-2a71-4507-9295-3b9ecf659324&quot;,&quot;parentUUID&quot;:&quot;bd0eba8e-25f5-4a3c-984a-45cf6f386cd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Register request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register Scenario 3: Register request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nstudentBody.erp = &#x27;abdfe&#x27;;\n// act\nconst res = await request(this.app).post(`${baseRoute}/register`).send(studentBody);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;043ade0e-f6b8-4ea0-ba95-03d5a57b25b4&quot;,&quot;parentUUID&quot;:&quot;bd0eba8e-25f5-4a3c-984a-45cf6f386cd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;043ade0e-f6b8-4ea0-ba95-03d5a57b25b4&quot;],&quot;failures&quot;:[&quot;d49cac81-bb53-4e1c-9cc5-d0fa1220fe94&quot;,&quot;72c5d120-2a71-4507-9295-3b9ecf659324&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:110,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;03c21c83-a7ba-4eca-bd36-71f0709e3c47&quot;,&quot;title&quot;:&quot;POST /auth/register-admin&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;POST /auth/register-admin\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register-admin \&quot;before each\&quot; hook in \&quot;POST /auth/register-admin\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminBody = {\n    erp: newERP,\n    first_name: \&quot;Abdur Rafay\&quot;,\n    last_name: \&quot;Saleem\&quot;,\n    gender: \&quot;male\&quot;,\n    contact: \&quot;+923009999999\&quot;,\n    birthday: \&quot;1999-09-18\&quot;,\n    password: \&quot;123\&quot;,\n    profile_picture_url: \&quot;https://i.pinimg.com/564x/8d/e3/89/8de389c84e919d3577f47118e2627d95.jpg\&quot;,\n    graduation_year: 2022,\n    uni_email: newEmail,\n    campus_id: 1,\n    program_id: 1,\n    is_active: 1\n};&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;010a3e8a-e961-49dd-95ad-dbdeadef2dd9&quot;,&quot;parentUUID&quot;:&quot;03c21c83-a7ba-4eca-bd36-71f0709e3c47&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Register request is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register-admin Scenario 1: Register request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nadminBody.erp = newERP;\nadminBody.uni_email = newEmail;\nconst app = this.app;\n// act\nlet res = await request(app).post(`${baseRoute}/register-admin`).send(adminBody);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.token).to.exist;\nexpect(resBody.role).to.be.equal(&#x27;admin&#x27;);\ndelete adminBody.password; // omit token, role and password\nconst adminFields = Object.keys(adminBody);\nconst adminFieldsCheck = field =&gt; resBody[field] === adminBody[field]; // deep compare two objects\nexpect(adminFields.every(adminFieldsCheck)).to.be.true;\n// cleanup\nconst deleteRoute = `/api/${Config.API_VERSION}/students/${adminBody.erp}`;\nconst adminToken = jwt.sign({erp: adminERP}, Config.SECRET_JWT);\nres = await request(app)\n    .delete(deleteRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:135:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;c9947333-0360-4bb4-9dfa-0621d1b51f2b&quot;,&quot;parentUUID&quot;:&quot;03c21c83-a7ba-4eca-bd36-71f0709e3c47&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Register request is unsuccessful due to duplicate student&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register-admin Scenario 2: Register request is unsuccessful due to duplicate student&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nadminBody.erp = existingERP;\nadminBody.uni_email = existingEmail;\n// act\nconst res = await request(this.app).post(`${baseRoute}/register-admin`).send(adminBody);\n    \n// assert\nexpect(res.status).to.be.equal(409);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DuplicateEntryException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 409&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 409\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:163:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;409&quot;}]},&quot;uuid&quot;:&quot;071ca599-e330-4415-801d-11bd44c5ebad&quot;,&quot;parentUUID&quot;:&quot;03c21c83-a7ba-4eca-bd36-71f0709e3c47&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Register request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/register-admin Scenario 3: Register request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nadminBody.erp = &#x27;abdfe&#x27;;\n// act\nconst res = await request(this.app).post(`${baseRoute}/register-admin`).send(adminBody);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b73b47ff-b482-487f-a05b-50910619e1a9&quot;,&quot;parentUUID&quot;:&quot;03c21c83-a7ba-4eca-bd36-71f0709e3c47&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b73b47ff-b482-487f-a05b-50910619e1a9&quot;],&quot;failures&quot;:[&quot;c9947333-0360-4bb4-9dfa-0621d1b51f2b&quot;,&quot;071ca599-e330-4415-801d-11bd44c5ebad&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:70,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;82d04c26-bdb8-4b40-b4dc-b5f2308417ca&quot;,&quot;title&quot;:&quot;POST /auth/login&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Login request is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/login Scenario 1: Login request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst studentBody = {\n    erp: existingERP,\n    first_name: \&quot;Abdur Rafay\&quot;,\n    last_name: \&quot;Saleem\&quot;,\n    gender: \&quot;male\&quot;,\n    contact: \&quot;+923009999999\&quot;,\n    email: &#x27;arafaysaleem@gmail.com&#x27;,\n    birthday: \&quot;1999-09-18\&quot;,\n    profile_picture_url: \&quot;https://i.pinimg.com/564x/8d/e3/89/8de389c84e919d3577f47118e2627d95.jpg\&quot;,\n    graduation_year: 2022,\n    uni_email: existingEmail,\n    hobbies: [1, 2, 3],\n    interests: [1, 2, 3],\n    campus_id: 1,\n    program_id: 1,\n    favourite_campus_hangout_spot: \&quot;CED\&quot;,\n    favourite_campus_activity: \&quot;Lifting\&quot;,\n    current_status: 1,\n    is_active: 1,\n    role: \&quot;api_user\&quot;\n};\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;\n};\n// act\nlet res = await request(this.app).post(`${baseRoute}/login`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys(&#x27;token&#x27;);\ndelete resBody.token;\nexpect(resBody).to.be.eql(studentBody);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:217:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;66f5c698-fc78-4929-af4e-d0ba74faecc0&quot;,&quot;parentUUID&quot;:&quot;82d04c26-bdb8-4b40-b4dc-b5f2308417ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Login request is unsuccessful due to missing student&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/login Scenario 2: Login request is unsuccessful due to missing student&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    password: &#x27;123&#x27;\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/login`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:236:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;df930274-a62a-4f95-a521-e23fa259b693&quot;,&quot;parentUUID&quot;:&quot;82d04c26-bdb8-4b40-b4dc-b5f2308417ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Login request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/login Scenario 3: Login request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    email: existingEmail, // &lt;-- email is an unrecognized parameter\n    password: &#x27;123&#x27;\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/login`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;54945a9b-4cee-4d83-a892-a46622aa87a6&quot;,&quot;parentUUID&quot;:&quot;82d04c26-bdb8-4b40-b4dc-b5f2308417ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;54945a9b-4cee-4d83-a892-a46622aa87a6&quot;],&quot;failures&quot;:[&quot;66f5c698-fc78-4929-af4e-d0ba74faecc0&quot;,&quot;df930274-a62a-4f95-a521-e23fa259b693&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c3f2c892-c018-457b-af0d-474d3e278c01&quot;,&quot;title&quot;:&quot;POST /auth/refresh-token&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Refresh token is successful and return a new token&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 1: Refresh token is successful and return a new token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst secretKey = Config.SECRET_JWT;\nconst old_token = jwt.sign({ erp: existingERP }, secretKey, {\n    expiresIn: \&quot;1\&quot; // &lt;-- immediately expire the token (in 1ms)\n});\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;,\n    old_token: old_token\n};\n// wait for token to expire (in 1ms)\nawait sleep(1);\n// act\nlet res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.token).to.exist;\nexpect(res.body.body.token).to.be.not.equal(old_token);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:280:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;59852205-969b-44a6-89b1-c657b7458e9d&quot;,&quot;parentUUID&quot;:&quot;c3f2c892-c018-457b-af0d-474d3e278c01&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Refresh token is successful and returns same token&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 2: Refresh token is successful and returns same token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst secretKey = Config.SECRET_JWT;\nconst old_token = jwt.sign({ erp: existingERP }, secretKey); // &lt;-- unexpired token\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;,\n    old_token: old_token\n};\n// act\nlet res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.token).to.exist;\nexpect(res.body.body.token).to.be.equal(old_token);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:300:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;1fa8fb83-5ff0-42fd-a9ec-bc3378d3a6e3&quot;,&quot;parentUUID&quot;:&quot;c3f2c892-c018-457b-af0d-474d3e278c01&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Refresh token is unsuccessful due to unregisted erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 3: Refresh token is unsuccessful due to unregisted erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    password: &#x27;123&#x27;,\n    old_token: \&quot;e.e.e\&quot; // &lt;-- token doesn&#x27;t matter if erp is unregistered\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;ERP not registered&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:318:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;f7377d1b-da23-4010-83e2-8bc3c5690878&quot;,&quot;parentUUID&quot;:&quot;c3f2c892-c018-457b-af0d-474d3e278c01&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Refresh token is unsuccessful due to incorrect password&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 4: Refresh token is unsuccessful due to incorrect password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;incOrr3ct&#x27;, // &lt;-- incorrect password\n    old_token: \&quot;e.e.e\&quot; // &lt;-- token doesn&#x27;t matter if password is incorrect\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;Incorrect password&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:337:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;f847d37d-fa55-46f9-ba2f-df376ad65663&quot;,&quot;parentUUID&quot;:&quot;c3f2c892-c018-457b-af0d-474d3e278c01&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Refresh token is unsuccessful due to incorrect old token&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 5: Refresh token is unsuccessful due to incorrect old token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// This test performs the same if the token has a valid format, but is\n// signed for a different erp\n// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;,\n    old_token: \&quot;e.e.e\&quot; // &lt;-- incorrect token\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;TokenVerificationException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;Invalid Token&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:359:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;7a4a9df8-e6cb-45b2-a05d-072c96060f49&quot;,&quot;parentUUID&quot;:&quot;c3f2c892-c018-457b-af0d-474d3e278c01&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Refresh token request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API POST /auth/refresh-token Scenario 6: Refresh token request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;,\n    token: \&quot;e.e.e\&quot; // &lt;-- a valid parameter name should be &#x27;old_token&#x27;\n};\n// act\nconst res = await request(this.app).post(`${baseRoute}/refresh-token`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;old_token&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8e3e661d-8ae7-4a57-aac9-eb461ba95d79&quot;,&quot;parentUUID&quot;:&quot;c3f2c892-c018-457b-af0d-474d3e278c01&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8e3e661d-8ae7-4a57-aac9-eb461ba95d79&quot;],&quot;failures&quot;:[&quot;59852205-969b-44a6-89b1-c657b7458e9d&quot;,&quot;1fa8fb83-5ff0-42fd-a9ec-bc3378d3a6e3&quot;,&quot;f7377d1b-da23-4010-83e2-8bc3c5690878&quot;,&quot;f847d37d-fa55-46f9-ba2f-df376ad65663&quot;,&quot;7a4a9df8-e6cb-45b2-a05d-072c96060f49&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:58,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;4c808eb2-c027-4149-a91a-9fd59aacacd4&quot;,&quot;title&quot;:&quot;PATCH /auth/change-password&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Change password is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API PATCH /auth/change-password Scenario 1: Change password is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nlet app = this.app;\nconst data = {\n    erp: existingERP,\n    old_password,\n    new_password\n};\n// act\nlet res = await request(app).patch(`${baseRoute}/change-password`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// cleanup\ndata.old_password = new_password;\ndata.new_password = old_password;\nres = await request(app).patch(`${baseRoute}/change-password`).send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:403:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;4cb7fc63-6212-4f7e-b84a-9eaf7e96fb80&quot;,&quot;parentUUID&quot;:&quot;4c808eb2-c027-4149-a91a-9fd59aacacd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Change password is unsuccessful due to unregisted erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API PATCH /auth/change-password Scenario 2: Change password is unsuccessful due to unregisted erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    old_password,\n    new_password\n};\n// act\nconst res = await request(this.app).patch(`${baseRoute}/change-password`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;ERP not registered&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:427:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;183af752-7841-45ab-8c33-99e7dec9f8b4&quot;,&quot;parentUUID&quot;:&quot;4c808eb2-c027-4149-a91a-9fd59aacacd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Change password is unsuccessful due to incorrect old password&quot;,&quot;fullTitle&quot;:&quot;Authentication API PATCH /auth/change-password Scenario 3: Change password is unsuccessful due to incorrect old password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    old_password: &#x27;incOrr3ct&#x27;, // &lt;-- incorrect password\n    new_password\n};\n// act\nconst res = await request(this.app).patch(`${baseRoute}/change-password`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;Incorrect old password&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:446:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;b4e1b11d-3600-4582-81af-17c9610785f2&quot;,&quot;parentUUID&quot;:&quot;4c808eb2-c027-4149-a91a-9fd59aacacd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Change password request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API PATCH /auth/change-password Scenario 6: Change password request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;123&#x27;, // &lt;-- a valid parameter name should be &#x27;old_password&#x27;\n    new_password\n};\n// act\nconst res = await request(this.app).patch(`${baseRoute}/change-password`).send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;old_password&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;64937190-1ef1-422c-96d4-cc5d18227ed2&quot;,&quot;parentUUID&quot;:&quot;4c808eb2-c027-4149-a91a-9fd59aacacd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;64937190-1ef1-422c-96d4-cc5d18227ed2&quot;],&quot;failures&quot;:[&quot;4cb7fc63-6212-4f7e-b84a-9eaf7e96fb80&quot;,&quot;183af752-7841-45ab-8c33-99e7dec9f8b4&quot;,&quot;b4e1b11d-3600-4582-81af-17c9610785f2&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;16f384a4-3127-4e6a-bf53-8960ec217b72&quot;,&quot;title&quot;:&quot;ENDPOINT /auth/forgot/&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;27953a1c-c44e-4e41-86f0-a9098af22d1a&quot;,&quot;title&quot;:&quot;POST /send-otp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;POST /send-otp\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp \&quot;before all\&quot; hook in \&quot;POST /send-otp\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:504,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;decache(&#x27;../../src/server&#x27;);\nconst sendgrid = require(&#x27;../../src/utils/sendgrid.utils&#x27;);\nsendOTPEmailStub = sinon.stub(sendgrid, &#x27;sendOTPEmail&#x27;).callsFake((_, __) =&gt; {});\nconst authRepository = require(&#x27;../../src/repositories/auth.repository&#x27;);\ngenerateOTPStub = sinon.stub(authRepository, &#x27;generateOTP&#x27;).callsFake(() =&gt; otp);\napp = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;64f38f0f-bed0-4f85-8b33-93df426f9988&quot;,&quot;parentUUID&quot;:&quot;27953a1c-c44e-4e41-86f0-a9098af22d1a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;POST /send-otp\&quot;&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp \&quot;after all\&quot; hook in \&quot;POST /send-otp\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sendOTPEmailStub.restore();\ngenerateOTPStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;94cf7233-22a1-41eb-908c-c8550610d45f&quot;,&quot;parentUUID&quot;:&quot;27953a1c-c44e-4e41-86f0-a9098af22d1a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Forgot password is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp Scenario 1: Forgot password is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP\n};\n    \n// act\nlet res = await request(app).post(`${baseRoute}/forgot/send-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;OTP generated and sent via email&#x27;);\nexpect(generateOTPStub.calledOnce).to.be.true;\nexpect(sendOTPEmailStub.calledOnce).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:504:42)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;29b3e8f9-0d5d-43dc-9d76-2da73e50bcfa&quot;,&quot;parentUUID&quot;:&quot;27953a1c-c44e-4e41-86f0-a9098af22d1a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Forgot password is unsuccessful due to unregisted erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp Scenario 2: Forgot password is unsuccessful due to unregisted erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP // &lt;-- no account registered on this erp\n};\n    \n// act\nconst res = await request(app).post(`${baseRoute}/forgot/send-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;ERP not registered&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:521:42)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;3b38bd78-d431-49d3-9824-9408fb586277&quot;,&quot;parentUUID&quot;:&quot;27953a1c-c44e-4e41-86f0-a9098af22d1a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Forgot password request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /send-otp Scenario 3: Forgot password request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    esrp: existingERP // &lt;-- a valid parameter name should be &#x27;erp&#x27;\n};\n    \n// act\nconst res = await request(app).post(`${baseRoute}/forgot/send-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2fe6b23f-1051-45e3-83e7-6ceb10b8bc07&quot;,&quot;parentUUID&quot;:&quot;27953a1c-c44e-4e41-86f0-a9098af22d1a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2fe6b23f-1051-45e3-83e7-6ceb10b8bc07&quot;],&quot;failures&quot;:[&quot;29b3e8f9-0d5d-43dc-9d76-2da73e50bcfa&quot;,&quot;3b38bd78-d431-49d3-9824-9408fb586277&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:49,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;41a232dd-8e95-48cd-9b3c-7732a4c2f7a0&quot;,&quot;title&quot;:&quot;POST /verify-otp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Verify OTP is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 1: Verify OTP is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    otp\n};\n    \n// act\nlet res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;OTP verified succesfully&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:559:42)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;986cf680-1cc5-413c-855a-bddf7c66de8d&quot;,&quot;parentUUID&quot;:&quot;41a232dd-8e95-48cd-9b3c-7732a4c2f7a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Verify OTP is unsuccessful due to invalid otp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 2: Verify OTP is unsuccessful due to invalid otp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst authRepository = require(&#x27;../../src/repositories/auth.repository&#x27;);\nawait authRepository.saveOTP(existingERP, otp, 1);\n\nconst data = {\n    erp: existingERP,\n    otp: 5678 // &lt;-- Invalid OTP code, should be &#x27;1234&#x27;\n};\n    \n// act\nconst res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;OTPVerificationException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;OTP verification failed&#x27;);\n// cleanup\nawait authRepository.removeExpiredOTP(existingERP);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error&quot;,&quot;estack&quot;:&quot;Database Error\n    at DatabaseService.#handleUnknownErrors (src\\db\\db-service.js:3:1946)\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:3:1450\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\n    at async OTPModel.create (src\\models\\otp.model.js:4:514)\n    at async AuthRepository.saveOTP (src\\repositories\\auth.repository.js:10:1136)\n    at async Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:567:17)&quot;},&quot;uuid&quot;:&quot;c0f722e5-1d39-4b87-9fd5-c589528cde8b&quot;,&quot;parentUUID&quot;:&quot;41a232dd-8e95-48cd-9b3c-7732a4c2f7a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Verify OTP is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 3: Verify OTP is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    otp: otp\n};\n    \n// act\nconst res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;OTPVerificationException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;No OTP found for this ERP&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:599:42)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;8d60308e-4e83-4539-995a-ec1f7fdc12f3&quot;,&quot;parentUUID&quot;:&quot;41a232dd-8e95-48cd-9b3c-7732a4c2f7a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Verify OTP is unsuccessful due to expired otp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 4: Verify OTP is unsuccessful due to expired otp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst authRepository = require(&#x27;../../src/repositories/auth.repository&#x27;);\nawait authRepository.saveOTP(existingERP, otp, -1); // create expired otp\n\nconst data = {\n    erp: existingERP,\n    otp: otp\n};\n    \n// act\nconst res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;OTPExpiredException&#x27;);\n// cleanup\nawait authRepository.removeExpiredOTP(existingERP);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error&quot;,&quot;estack&quot;:&quot;Database Error\n    at DatabaseService.#handleUnknownErrors (src\\db\\db-service.js:3:1946)\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:3:1450\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\n    at async OTPModel.create (src\\models\\otp.model.js:4:514)\n    at async AuthRepository.saveOTP (src\\repositories\\auth.repository.js:10:1136)\n    at async Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:609:17)&quot;},&quot;uuid&quot;:&quot;87fc95c9-bdbc-4c45-8c12-5477c431a23f&quot;,&quot;parentUUID&quot;:&quot;41a232dd-8e95-48cd-9b3c-7732a4c2f7a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Verify OTP request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /verify-otp Scenario 5: Verify OTP request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    otp: &#x27;12345678&#x27; // &lt;-- otp should be 4 digits in length\n};\n    \n// act\nconst res = await request(this.app).post(`${baseRoute}/forgot/verify-otp`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;otp&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;29959b2e-acab-4fc0-95e4-afec1e6af27b&quot;,&quot;parentUUID&quot;:&quot;41a232dd-8e95-48cd-9b3c-7732a4c2f7a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;29959b2e-acab-4fc0-95e4-afec1e6af27b&quot;],&quot;failures&quot;:[&quot;986cf680-1cc5-413c-855a-bddf7c66de8d&quot;,&quot;c0f722e5-1d39-4b87-9fd5-c589528cde8b&quot;,&quot;8d60308e-4e83-4539-995a-ec1f7fdc12f3&quot;,&quot;87fc95c9-bdbc-4c45-8c12-5477c431a23f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:100,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;3d95e0c5-12e5-4b50-87e8-fdd4041ad172&quot;,&quot;title&quot;:&quot;POST /reset-password&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\auth.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\auth.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Reset Password is successful&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /reset-password Scenario 1: Reset Password is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst app = this.app;\nconst old_password = &#x27;123&#x27;;\nconst new_password = &#x27;256&#x27;;\nconst data = {\n    erp: existingERP,\n    new_password\n};\n    \n// act\nlet res = await request(app).patch(`${baseRoute}/forgot/reset-password`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Password reset successfully&#x27;);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// cleanup\ndata.new_password = old_password;\nres = await request(app).patch(`${baseRoute}/forgot/reset-password`).send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:664:42)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;5f4e88e0-06cc-408a-b773-03290f30dfee&quot;,&quot;parentUUID&quot;:&quot;3d95e0c5-12e5-4b50-87e8-fdd4041ad172&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Reset Password is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /reset-password Scenario 2: Reset Password is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: unregisteredERP, // &lt;-- no account registered on this erp\n    new_password: &#x27;---&#x27; // &lt;-- doesnn&#x27;t matter since if erp is unregistered\n};\n    \n// act\nconst res = await request(this.app).patch(`${baseRoute}/forgot/reset-password`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(401);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidCredentialsException&#x27;);\nexpect(resHeaders.message).to.be.equal(&#x27;ERP not registered&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 401&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 401\n    at Context.&lt;anonymous&gt; (test\\integration\\auth.test.js:687:42)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;401&quot;}]},&quot;uuid&quot;:&quot;a99f5f7f-8884-4b1f-9a12-0e0ec9d06ff3&quot;,&quot;parentUUID&quot;:&quot;3d95e0c5-12e5-4b50-87e8-fdd4041ad172&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Reset Password request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Authentication API ENDPOINT /auth/forgot/ POST /reset-password Scenario 3: Reset Password request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    erp: existingERP,\n    password: &#x27;12345678&#x27; // &lt;-- correct paramter name should be &#x27;new_password&#x27;\n};\n    \n// act\nconst res = await request(this.app).patch(`${baseRoute}/forgot/reset-password`).send(data);\n        \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;new_password&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;70b9032d-a3fe-4dfe-8cf0-10c795d1288e&quot;,&quot;parentUUID&quot;:&quot;3d95e0c5-12e5-4b50-87e8-fdd4041ad172&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;70b9032d-a3fe-4dfe-8cf0-10c795d1288e&quot;],&quot;failures&quot;:[&quot;5f4e88e0-06cc-408a-b773-03290f30dfee&quot;,&quot;a99f5f7f-8884-4b1f-9a12-0e0ec9d06ff3&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:63,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1dce573a-e1bc-48ee-857a-fc34a68c6176&quot;,&quot;title&quot;:&quot;Campuses API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Campuses API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Campuses API \&quot;before each\&quot; hook in \&quot;Campuses API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;271814ed-3c27-4441-96f9-09bdb7da2dcb&quot;,&quot;parentUUID&quot;:&quot;1dce573a-e1bc-48ee-857a-fc34a68c6176&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0a7ddf68-cb0f-4705-af12-11df66b77b23&quot;,&quot;title&quot;:&quot;GET /campuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all campuses request successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses Scenario 1: Get all campuses request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;campus_id&#x27;, &#x27;campus&#x27;, &#x27;location_url&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:35:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;165f0173-6325-439f-b5fc-758b711981d8&quot;,&quot;parentUUID&quot;:&quot;0a7ddf68-cb0f-4705-af12-11df66b77b23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all campuses request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses Scenario 2: Get all campuses request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:492,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst CampusModel = require(&#x27;../../src/models/campus.model&#x27;);\nconst modelStub = sinon.stub(CampusModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty campus list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campuses not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;4d223c2b-f6da-433c-887b-a0b983bd2bea&quot;,&quot;parentUUID&quot;:&quot;0a7ddf68-cb0f-4705-af12-11df66b77b23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;165f0173-6325-439f-b5fc-758b711981d8&quot;,&quot;4d223c2b-f6da-433c-887b-a0b983bd2bea&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:499,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;5a63a8f5-2017-4efa-8f42-cd077e1c3f96&quot;,&quot;title&quot;:&quot;GET /campuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a campus request successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses/:id Scenario 1: Get a campus request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;campus_id&#x27;, &#x27;campus&#x27;, &#x27;location_url&#x27;]);\nexpect(resBody.campus_id).to.be.eql(existingCampus.campus_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:70:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;090f7e70-725f-44dd-b362-15843d79c71a&quot;,&quot;parentUUID&quot;:&quot;5a63a8f5-2017-4efa-8f42-cd077e1c3f96&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a campus request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses/:id Scenario 2: Get a campus request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownCampusId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:84:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;9a1b30ca-a13b-4477-931b-d03979321ca4&quot;,&quot;parentUUID&quot;:&quot;5a63a8f5-2017-4efa-8f42-cd077e1c3f96&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a campus request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campuses API GET /campuses/:id Scenario 3: Get a campus request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingCampus.campus_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;85569cbe-d3de-46d8-8ab8-2c60a1172f31&quot;,&quot;parentUUID&quot;:&quot;5a63a8f5-2017-4efa-8f42-cd077e1c3f96&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;85569cbe-d3de-46d8-8ab8-2c60a1172f31&quot;],&quot;failures&quot;:[&quot;090f7e70-725f-44dd-b362-15843d79c71a&quot;,&quot;9a1b30ca-a13b-4477-931b-d03979321ca4&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:25,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;66b210f9-70c4-481b-9831-146ef19d89dc&quot;,&quot;title&quot;:&quot;POST /campuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a campus request is successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API POST /campuses Scenario 1: Create a campus request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus, location_url };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;campus_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.campus_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    campus_id: newId,\n    campus: campus,\n    location_url: location_url\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:118:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;b9f747f1-a898-4b3c-9871-5dcb9b61fe23&quot;,&quot;parentUUID&quot;:&quot;66b210f9-70c4-481b-9831-146ef19d89dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a campus request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Campuses API POST /campuses Scenario 2: Create a campus request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    campuses: campus, // &lt;-- a valid parameter name should be &#x27;campus&#x27;\n    location_url: &#x27;https://maps.app.goo.gl/LvH61VeZZVfyggHw6&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;campus&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:157:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;6e9c166f-ce41-447d-9632-74d5e96d7cd3&quot;,&quot;parentUUID&quot;:&quot;66b210f9-70c4-481b-9831-146ef19d89dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a campus request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campuses API POST /campuses Scenario 3: Create a campus request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus, location_url };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:175:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;be0b2ddf-a138-4ebe-9faa-9edd3429c314&quot;,&quot;parentUUID&quot;:&quot;66b210f9-70c4-481b-9831-146ef19d89dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a campus request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campuses API POST /campuses Scenario 4: Create a campus request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus, location_url };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;75dadfbc-b115-49ea-8026-9ab83f1b8d95&quot;,&quot;parentUUID&quot;:&quot;66b210f9-70c4-481b-9831-146ef19d89dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;75dadfbc-b115-49ea-8026-9ab83f1b8d95&quot;],&quot;failures&quot;:[&quot;b9f747f1-a898-4b3c-9871-5dcb9b61fe23&quot;,&quot;6e9c166f-ce41-447d-9632-74d5e96d7cd3&quot;,&quot;be0b2ddf-a138-4ebe-9faa-9edd3429c314&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:40,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;866127e9-00d3-421d-b0b1-ec5277699e89&quot;,&quot;title&quot;:&quot;PATCH /campuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a campus request is successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 1: Update a campus request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus: newCampus };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    campus_id: existingCampus.campus_id,\n    campus: newCampus,\n    location_url: existingCampus.location_url\n});\n\n// cleanup\ndata.campus = existingCampus.campus;\nres = await request(app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:213:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;da8854fa-6e05-42b0-af89-4664e9d7ecf4&quot;,&quot;parentUUID&quot;:&quot;866127e9-00d3-421d-b0b1-ec5277699e89&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a campus request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 2: Update a campus request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus: newCampus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownCampusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:251:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;3a66afd7-c479-4b0f-b230-068ccfd06fcf&quot;,&quot;parentUUID&quot;:&quot;866127e9-00d3-421d-b0b1-ec5277699e89&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a campus request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 3: Update a campus request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    campuses: newCampus // &lt;-- an valid parameter name should be &#x27;campus&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectParams).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:270:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;26662f26-fc6f-4f95-84ab-4a46d14e4a3c&quot;,&quot;parentUUID&quot;:&quot;866127e9-00d3-421d-b0b1-ec5277699e89&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a campus request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 4: Update a campus request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus: newCampus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:288:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;d2c523fa-5b14-4b5c-b16a-90baf91a3905&quot;,&quot;parentUUID&quot;:&quot;866127e9-00d3-421d-b0b1-ec5277699e89&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a campus request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campuses API PATCH /campuses/:id Scenario 5: Update a campus request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus: newCampus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampus.campus_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0e62cce6-1e69-42f1-bf53-3babc5be65fb&quot;,&quot;parentUUID&quot;:&quot;866127e9-00d3-421d-b0b1-ec5277699e89&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0e62cce6-1e69-42f1-bf53-3babc5be65fb&quot;],&quot;failures&quot;:[&quot;da8854fa-6e05-42b0-af89-4664e9d7ecf4&quot;,&quot;3a66afd7-c479-4b0f-b230-068ccfd06fcf&quot;,&quot;26662f26-fc6f-4f95-84ab-4a46d14e4a3c&quot;,&quot;d2c523fa-5b14-4b5c-b16a-90baf91a3905&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:43,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;598dbdbf-1699-42f5-8e21-bdb3a5fe2c2a&quot;,&quot;title&quot;:&quot;DELETE /campuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a campus request is successful&quot;,&quot;fullTitle&quot;:&quot;Campuses API DELETE /campuses/:id Scenario 1: Delete a campus request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { campus, location_url };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.campus_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:325:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;d36c03b8-df53-49c5-b043-13f28cefbb08&quot;,&quot;parentUUID&quot;:&quot;598dbdbf-1699-42f5-8e21-bdb3a5fe2c2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a campus request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campuses API DELETE /campuses/:id Scenario 2: Delete a campus request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownCampusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:357:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;dd6aca14-efaf-4b6c-adc9-780cea99e758&quot;,&quot;parentUUID&quot;:&quot;598dbdbf-1699-42f5-8e21-bdb3a5fe2c2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a campus request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campuses API DELETE /campuses/:id Scenario 3: Delete a campus request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingCampus.campus_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\campus.test.js:370:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;51edc7ee-c72c-4570-b674-5588cb78e227&quot;,&quot;parentUUID&quot;:&quot;598dbdbf-1699-42f5-8e21-bdb3a5fe2c2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a campus request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campuses API DELETE /campuses/:id Scenario 4: Delete a campus request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingCampus.campus_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;57fd95f2-4f70-4f95-8913-c74da098dac1&quot;,&quot;parentUUID&quot;:&quot;598dbdbf-1699-42f5-8e21-bdb3a5fe2c2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;57fd95f2-4f70-4f95-8913-c74da098dac1&quot;],&quot;failures&quot;:[&quot;d36c03b8-df53-49c5-b043-13f28cefbb08&quot;,&quot;dd6aca14-efaf-4b6c-adc9-780cea99e758&quot;,&quot;51edc7ee-c72c-4570-b674-5588cb78e227&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:52,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d31d71ce-48b0-41bf-a664-8b96e5369b05&quot;,&quot;title&quot;:&quot;Campus Spots API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Campus Spots API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API \&quot;before each\&quot; hook in \&quot;Campus Spots API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5ea62347-b3b9-424f-b779-4d5347b315e8&quot;,&quot;parentUUID&quot;:&quot;d31d71ce-48b0-41bf-a664-8b96e5369b05&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;32c429f5-1067-4e10-bc27-84b9667aa672&quot;,&quot;title&quot;:&quot;GET /campus-spots&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all campus spots request successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots Scenario 1: Get all campus spots request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;campus_spot_id&#x27;, &#x27;campus_spot&#x27;, &#x27;campus_id&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:36:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;1ebe62b7-89b7-4866-b1ab-3a65dfa168a3&quot;,&quot;parentUUID&quot;:&quot;32c429f5-1067-4e10-bc27-84b9667aa672&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all campus spots request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots Scenario 2: Get all campus spots request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:493,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst CampusSpotModel = require(&#x27;../../src/models/campusSpot.model&#x27;);\nconst modelStub = sinon.stub(CampusSpotModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty campus_spot list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spots not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;2232d8a7-8e0d-4e57-a349-8f9e7a01fb96&quot;,&quot;parentUUID&quot;:&quot;32c429f5-1067-4e10-bc27-84b9667aa672&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;1ebe62b7-89b7-4866-b1ab-3a65dfa168a3&quot;,&quot;2232d8a7-8e0d-4e57-a349-8f9e7a01fb96&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:498,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c2e61f48-6ff3-4077-ba3d-ea3b66f602b4&quot;,&quot;title&quot;:&quot;GET /campus-spots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a campus spot request successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots/:id Scenario 1: Get a campus spot request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;campus_spot_id&#x27;, &#x27;campus_spot&#x27;, &#x27;campus_id&#x27;]);\nexpect(resBody.campus_spot_id).to.be.equal(existingCampusSpot.campus_spot_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:71:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;287dba91-ebd2-4c7b-a11f-ebd073cd1f66&quot;,&quot;parentUUID&quot;:&quot;c2e61f48-6ff3-4077-ba3d-ea3b66f602b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a campus spot request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots/:id Scenario 2: Get a campus spot request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownCampusSpotId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spot not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:85:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;f1f51eb1-283f-4a24-982b-09cf28d3aa04&quot;,&quot;parentUUID&quot;:&quot;c2e61f48-6ff3-4077-ba3d-ea3b66f602b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a campus spot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API GET /campus-spots/:id Scenario 3: Get a campus spot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingCampusSpot.campus_spot_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;56a32290-0b64-4695-a2a5-eceaf1c51a01&quot;,&quot;parentUUID&quot;:&quot;c2e61f48-6ff3-4077-ba3d-ea3b66f602b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;56a32290-0b64-4695-a2a5-eceaf1c51a01&quot;],&quot;failures&quot;:[&quot;287dba91-ebd2-4c7b-a11f-ebd073cd1f66&quot;,&quot;f1f51eb1-283f-4a24-982b-09cf28d3aa04&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;66c68e94-51ce-4ae8-937b-8398d1befe6d&quot;,&quot;title&quot;:&quot;POST /campus-spots&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a campus spot request is successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 1: Create a campus spot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot, campus_id };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;campus_spot_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.campus_spot_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    campus_spot_id: newId,\n    campus_spot,\n    campus_id\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:119:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;404547d2-da8e-407b-aa1c-f9b36ff9b0a8&quot;,&quot;parentUUID&quot;:&quot;66c68e94-51ce-4ae8-937b-8398d1befe6d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a campus spot request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 2: Create a campus spot request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot, campus_id: unknownCampusId }; // &lt;-- Non-existent campus_id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;campus_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:155:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;5cf61a8d-a551-4227-aa8c-6d69aa98f092&quot;,&quot;parentUUID&quot;:&quot;66c68e94-51ce-4ae8-937b-8398d1befe6d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a campus spot request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 3: Create a campus spot request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    campus_spots: campus_spot // &lt;-- a valid parameter name should be &#x27;campus_spot&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;campus_spot&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:174:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;20430624-6ca6-40f8-aa36-af15049f06de&quot;,&quot;parentUUID&quot;:&quot;66c68e94-51ce-4ae8-937b-8398d1befe6d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a campus spot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 4: Create a campus spot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot, campus_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:192:38)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;102325f0-202f-4162-bbb7-93ef87ca6750&quot;,&quot;parentUUID&quot;:&quot;66c68e94-51ce-4ae8-937b-8398d1befe6d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a campus spot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API POST /campus-spots Scenario 5: Create a campus spot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot, campus_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;84c33af9-e275-4353-898f-753610e438e6&quot;,&quot;parentUUID&quot;:&quot;66c68e94-51ce-4ae8-937b-8398d1befe6d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;84c33af9-e275-4353-898f-753610e438e6&quot;],&quot;failures&quot;:[&quot;404547d2-da8e-407b-aa1c-f9b36ff9b0a8&quot;,&quot;5cf61a8d-a551-4227-aa8c-6d69aa98f092&quot;,&quot;20430624-6ca6-40f8-aa36-af15049f06de&quot;,&quot;102325f0-202f-4162-bbb7-93ef87ca6750&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:48,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;8e1c4ce2-efa3-4ac1-ab61-3a2072ff458b&quot;,&quot;title&quot;:&quot;PATCH /campus-spots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a campus spot request is successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 1: Update a campus spot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot: newCampusSpot };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    campus_spot_id: existingCampusSpot.campus_spot_id,\n    campus_id: existingCampusSpot.campus_id,\n    campus_spot: newCampusSpot\n});\n\n// cleanup\ndata.campus_spot = existingCampusSpot.campus_spot;\nres = await request(app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:230:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;418bcff0-9900-40a1-a5aa-f31976cd4324&quot;,&quot;parentUUID&quot;:&quot;8e1c4ce2-efa3-4ac1-ab61-3a2072ff458b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a campus spot request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 2: Update a campus spot request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot: newCampusSpot };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownCampusSpotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spot not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:267:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;40794c8a-6f59-4e7e-b72e-de05d28b32e1&quot;,&quot;parentUUID&quot;:&quot;8e1c4ce2-efa3-4ac1-ab61-3a2072ff458b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a campus spot request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 3: Update a campus spot request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    campus_spots: newCampusSpot // &lt;-- a valid parameter name should be &#x27;campus_spot&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;campus_spot&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:286:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;96fdb8de-6374-493e-b16d-2739abc9dae3&quot;,&quot;parentUUID&quot;:&quot;8e1c4ce2-efa3-4ac1-ab61-3a2072ff458b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a campus spot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 4: Update a campus spot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot: newCampusSpot };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:304:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;587d2732-c030-4bcb-b97e-3af4e319b96e&quot;,&quot;parentUUID&quot;:&quot;8e1c4ce2-efa3-4ac1-ab61-3a2072ff458b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a campus spot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API PATCH /campus-spots/:id Scenario 5: Update a campus spot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_spot: newCampusSpot };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;651beeba-44f9-41cd-bc2d-a90d5c2e43c0&quot;,&quot;parentUUID&quot;:&quot;8e1c4ce2-efa3-4ac1-ab61-3a2072ff458b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;651beeba-44f9-41cd-bc2d-a90d5c2e43c0&quot;],&quot;failures&quot;:[&quot;418bcff0-9900-40a1-a5aa-f31976cd4324&quot;,&quot;40794c8a-6f59-4e7e-b72e-de05d28b32e1&quot;,&quot;96fdb8de-6374-493e-b16d-2739abc9dae3&quot;,&quot;587d2732-c030-4bcb-b97e-3af4e319b96e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:44,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;3e09e176-7369-4fd5-b2a3-59eb4e52d149&quot;,&quot;title&quot;:&quot;DELETE /campus-spots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\campusSpot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\campusSpot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a campus spot request is successful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API DELETE /campus-spots/:id Scenario 1: Delete a campus spot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { campus_spot, campus_id };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.campus_spot_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spot has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:341:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;1f53288f-f6e7-4a69-ba11-52fc9f013a5c&quot;,&quot;parentUUID&quot;:&quot;3e09e176-7369-4fd5-b2a3-59eb4e52d149&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a campus spot request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API DELETE /campus-spots/:id Scenario 2: Delete a campus spot request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownCampusSpotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Campus spot not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:373:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;b9a59b68-37a1-4193-86f6-2001e3f60e86&quot;,&quot;parentUUID&quot;:&quot;3e09e176-7369-4fd5-b2a3-59eb4e52d149&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a campus spot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API DELETE /campus-spots/:id Scenario 3: Delete a campus spot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingCampusSpot.campus_spot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\campusSpot.test.js:386:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;bfb6531c-7a01-4b31-86a8-c3874652d614&quot;,&quot;parentUUID&quot;:&quot;3e09e176-7369-4fd5-b2a3-59eb4e52d149&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a campus spot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Campus Spots API DELETE /campus-spots/:id Scenario 4: Delete a campus spot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingCampusSpot.campus_spot_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e828fff4-4cc7-43b7-9518-934dedf6bf57&quot;,&quot;parentUUID&quot;:&quot;3e09e176-7369-4fd5-b2a3-59eb4e52d149&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e828fff4-4cc7-43b7-9518-934dedf6bf57&quot;],&quot;failures&quot;:[&quot;1f53288f-f6e7-4a69-ba11-52fc9f013a5c&quot;,&quot;b9a59b68-37a1-4193-86f6-2001e3f60e86&quot;,&quot;bfb6531c-7a01-4b31-86a8-c3874652d614&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:28,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;37c4e937-0db4-4425-9c20-c2adcfe607eb&quot;,&quot;title&quot;:&quot;Classes API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Classes API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Classes API \&quot;before each\&quot; hook in \&quot;Classes API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aeb11610-d73d-412c-937c-b058c2c2a3bc&quot;,&quot;parentUUID&quot;:&quot;37c4e937-0db4-4425-9c20-c2adcfe607eb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a702077b-39ae-4ede-8f2f-cf3459adde66&quot;,&quot;title&quot;:&quot;GET /classes&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all classes request successful&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 1: Get all classes request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingClass)); // contain all params\nconst exampleClass = resBody[0];\nexpect(exampleClass.classroom).to.not.be.undefined;\nexpect(exampleClass.classroom).to.include.all.keys(Object.keys(existingClass.classroom)); // contain all params\n\nexpect(exampleClass.classroom.campus).to.not.be.undefined;\nexpect(exampleClass.classroom.campus).to.include.all.keys(Object.keys(existingClass.classroom.campus)); // contain all params\nexpect(exampleClass.subject).to.not.be.undefined;\nexpect(exampleClass.subject).to.include.all.keys(Object.keys(existingClass.subject)); // contain all params\nexpect(exampleClass.teacher).to.not.be.undefined;\nexpect(exampleClass.teacher).to.include.all.keys(Object.keys(existingClass.teacher)); // contain all params\nexpect(exampleClass.timeslot_1).to.not.be.undefined;\nexpect(exampleClass.timeslot_1).to.include.all.keys(Object.keys(existingClass.timeslot_1)); // contain all params\nexpect(exampleClass.timeslot_2).to.not.be.undefined;\nexpect(exampleClass.timeslot_2).to.include.all.keys(Object.keys(existingClass.timeslot_2)); // contain all params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:73:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;1cca5578-58d6-47e9-94d4-aac342b62a04&quot;,&quot;parentUUID&quot;:&quot;a702077b-39ae-4ede-8f2f-cf3459adde66&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all classes request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 2: Get all classes request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst subject_code = &#x27;HUM201&#x27;;\nconst term_id = 2;\nlet res = await request(this.app)\n    .get(`${baseRoute}?term_id=${term_id}&amp;subject_code=${subject_code}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst termCheck = (t_id) =&gt; term_id === t_id;\nconst subjectCheck = (s_code) =&gt; subject_code === s_code;\nconst queryCheck = (classRow) =&gt; termCheck(classRow.term_id) &amp;&amp; subjectCheck(classRow.subject.subject_code);\nexpect(resBody.every(queryCheck)).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:109:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;5a732bd0-536d-4887-9174-9b41b76357a4&quot;,&quot;parentUUID&quot;:&quot;a702077b-39ae-4ede-8f2f-cf3459adde66&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all classes request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 3: Get all classes request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:486,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst PostModel = require(&#x27;../../src/models/class.model&#x27;);\nconst modelStub = sinon.stub(PostModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty class list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classes not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;75fffaff-4b64-49af-973f-d386522c51ca&quot;,&quot;parentUUID&quot;:&quot;a702077b-39ae-4ede-8f2f-cf3459adde66&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all classes request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 4: Get all classes request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst term_id = &#x27;Spring 2021&#x27;; // &lt;-- invalid term_id value\nlet res = await request(this.app)\n    .get(`${baseRoute}?term_id=${term_id}&amp;campus=MAIN`) // &lt;-- `campus` is an incorrect query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;term_id&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:147:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;9bbe0c8c-9d6b-414e-b55b-85afec2c2792&quot;,&quot;parentUUID&quot;:&quot;a702077b-39ae-4ede-8f2f-cf3459adde66&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all classes request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes Scenario 5: Get all classes request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f4436554-530b-4e2f-a355-d4d586a553d0&quot;,&quot;parentUUID&quot;:&quot;a702077b-39ae-4ede-8f2f-cf3459adde66&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f4436554-530b-4e2f-a355-d4d586a553d0&quot;],&quot;failures&quot;:[&quot;1cca5578-58d6-47e9-94d4-aac342b62a04&quot;,&quot;5a732bd0-536d-4887-9174-9b41b76357a4&quot;,&quot;75fffaff-4b64-49af-973f-d386522c51ca&quot;,&quot;9bbe0c8c-9d6b-414e-b55b-85afec2c2792&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:514,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d2bdfa1a-ae19-4224-b683-0e8f7ade9033&quot;,&quot;title&quot;:&quot;GET /classes/:term_id/:class_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a class request successful&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes/:term_id/:class_erp Scenario 1: Get a class request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.class_erp).to.be.eql(existingClass.class_erp); // should match initially sent id\nexpect(resBody).to.include.all.keys(Object.keys(existingClass)); // contain all params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:178:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;2ef18405-b3d5-4284-8f99-9765b018bcc2&quot;,&quot;parentUUID&quot;:&quot;d2bdfa1a-ae19-4224-b683-0e8f7ade9033&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a class request is unsuccessful due to unknown class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes/:term_id/:class_erp Scenario 2: Get a class request is unsuccessful due to unknown class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}/${unknownClassERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:192:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;61a71ef9-418a-4943-a800-c4a627adcf29&quot;,&quot;parentUUID&quot;:&quot;d2bdfa1a-ae19-4224-b683-0e8f7ade9033&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a class request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes/:term_id/:class_erp Scenario 3: Get a class request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTermId}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:205:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;8ce5b910-bcfd-4559-9beb-9a5aa4868ab8&quot;,&quot;parentUUID&quot;:&quot;d2bdfa1a-ae19-4224-b683-0e8f7ade9033&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a class request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API GET /classes/:term_id/:class_erp Scenario 3: Get a class request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${subRoute}/${existingClass.class_erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5725cc4c-6d57-4a6d-ab0a-217a6eea3ce0&quot;,&quot;parentUUID&quot;:&quot;d2bdfa1a-ae19-4224-b683-0e8f7ade9033&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5725cc4c-6d57-4a6d-ab0a-217a6eea3ce0&quot;],&quot;failures&quot;:[&quot;2ef18405-b3d5-4284-8f99-9765b018bcc2&quot;,&quot;61a71ef9-418a-4943-a800-c4a627adcf29&quot;,&quot;8ce5b910-bcfd-4559-9beb-9a5aa4868ab8&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:28,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;dbb04444-4f8a-4113-86a6-f9a234d91ea7&quot;,&quot;title&quot;:&quot;POST /classes&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a class request is successful&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 1: Create a class request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newClass };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = data.class_erp;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${data.term_id}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.class_erp).to.be.equal(newId);\nexpect(res.body.body.term_id).to.be.equal(data.term_id);\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${data.term_id}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:249:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;7abee88e-1688-4c7f-8f95-7c2d6c2d3639&quot;,&quot;parentUUID&quot;:&quot;dbb04444-4f8a-4113-86a6-f9a234d91ea7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a class request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 2: Create a class request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newClass };\ndelete data.term_id; // term_id is required\ndata.subject_code = &#x27;000&#x27;; // &lt;-- a valid subject code should be &#x27;XXX999&#x27;\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;term_id&#x27;, &#x27;subject_code&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:284:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;a578330e-8f2a-4437-958b-722d5702e539&quot;,&quot;parentUUID&quot;:&quot;dbb04444-4f8a-4113-86a6-f9a234d91ea7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a class request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 3: Create a class request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.term_id = unknownTermId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;term_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:303:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;6a258d7f-8037-4723-a91e-6150b2a7b0a7&quot;,&quot;parentUUID&quot;:&quot;dbb04444-4f8a-4113-86a6-f9a234d91ea7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a class request is unsuccessful due to unknown subject_code&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 4: Create a class request is unsuccessful due to unknown subject_code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.subject_code = unknownSubjectCode; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;subject_code&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:321:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;ad7f0c0a-620b-4677-b2c2-27d4cf615090&quot;,&quot;parentUUID&quot;:&quot;dbb04444-4f8a-4113-86a6-f9a234d91ea7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a class request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 5: Create a class request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.teacher_id = unknownTeacherId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;teacher_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:339:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;be70940b-a26b-46e1-87ea-49e9a962c201&quot;,&quot;parentUUID&quot;:&quot;dbb04444-4f8a-4113-86a6-f9a234d91ea7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a class request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 6: Create a class request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.classroom_id = unknownClassroomId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;classroom_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:357:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;026471ac-2f48-4c48-9fa7-c42e916190b5&quot;,&quot;parentUUID&quot;:&quot;dbb04444-4f8a-4113-86a6-f9a234d91ea7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Create a class request is unsuccessful due to unknown timeslot_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 7: Create a class request is unsuccessful due to unknown timeslot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.timeslot_1 = unknownTimeslotId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;timeslot_1&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:375:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;20653bb0-80ac-4056-a8b8-9c2f5b7afb02&quot;,&quot;parentUUID&quot;:&quot;dbb04444-4f8a-4113-86a6-f9a234d91ea7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Create a class request is unsuccessful due to unknown parent_class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 8: Create a class request is unsuccessful due to unknown parent_class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {...newClass};\ndata.parent_class_erp = unknownClassERP; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;parent_class_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:393:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;6f88159b-cfe2-48ee-a6de-78c2845d0e84&quot;,&quot;parentUUID&quot;:&quot;dbb04444-4f8a-4113-86a6-f9a234d91ea7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Create a class request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 9: Create a class request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newClass };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:410:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;9051fb6a-4bbd-43c7-8177-5246633423a4&quot;,&quot;parentUUID&quot;:&quot;dbb04444-4f8a-4113-86a6-f9a234d91ea7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Create a class request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes Scenario 10: Create a class request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newClass };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ac38d9ce-4f22-402e-9fce-a9deb67af1d8&quot;,&quot;parentUUID&quot;:&quot;dbb04444-4f8a-4113-86a6-f9a234d91ea7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ac38d9ce-4f22-402e-9fce-a9deb67af1d8&quot;],&quot;failures&quot;:[&quot;7abee88e-1688-4c7f-8f95-7c2d6c2d3639&quot;,&quot;a578330e-8f2a-4437-958b-722d5702e539&quot;,&quot;6a258d7f-8037-4723-a91e-6150b2a7b0a7&quot;,&quot;ad7f0c0a-620b-4677-b2c2-27d4cf615090&quot;,&quot;be70940b-a26b-46e1-87ea-49e9a962c201&quot;,&quot;026471ac-2f48-4c48-9fa7-c42e916190b5&quot;,&quot;20653bb0-80ac-4056-a8b8-9c2f5b7afb02&quot;,&quot;6f88159b-cfe2-48ee-a6de-78c2845d0e84&quot;,&quot;9051fb6a-4bbd-43c7-8177-5246633423a4&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:78,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c14854da-cb0d-4e78-8ac6-d2284878202a&quot;,&quot;title&quot;:&quot;POST /classes/bulk&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;POST /classes/bulk\&quot;&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk \&quot;before each\&quot; hook in \&quot;POST /classes/bulk\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;newClasses = [\n    {\n        class_erp: &#x27;8996&#x27;,\n        semester: \&quot;CS-3\&quot;,\n        classroom_id: 1,\n        subject_code: \&quot;CSE555\&quot;,\n        teacher_id: 5,\n        timeslot_1: 2,\n        timeslot_2: 2,\n        day_1: \&quot;monday\&quot;,\n        day_2: \&quot;wednesday\&quot;,\n        term_id: 1,\n        parent_class_erp: \&quot;\&quot;\n    },\n    {\n        class_erp: &#x27;8997&#x27;,\n        semester: \&quot;CS-3\&quot;,\n        classroom_id: 4,\n        subject_code: \&quot;CSE555\&quot;,\n        teacher_id: 5,\n        timeslot_1: 3,\n        timeslot_2: 3,\n        day_1: \&quot;monday\&quot;,\n        day_2: \&quot;wednesday\&quot;,\n        term_id: 1,\n        parent_class_erp: \&quot;8996\&quot;\n    },\n    {\n        class_erp: &#x27;8998&#x27;,\n        semester: \&quot;ACF-2\&quot;,\n        classroom_id: 3,\n        subject_code: \&quot;HUM201\&quot;,\n        teacher_id: 1,\n        timeslot_1: 2,\n        timeslot_2: 2,\n        day_1: \&quot;tuesday\&quot;,\n        day_2: \&quot;thursday\&quot;,\n        term_id: 1,\n        parent_class_erp: \&quot;\&quot;\n    },\n    {\n        class_erp: &#x27;8999&#x27;,\n        semester: \&quot;ECO-2\&quot;,\n        classroom_id: 5,\n        subject_code: \&quot;HUM201\&quot;,\n        teacher_id: 2,\n        timeslot_1: 2,\n        timeslot_2: 2,\n        day_1: \&quot;tuesday\&quot;,\n        day_2: \&quot;thursday\&quot;,\n        term_id: 1,\n        parent_class_erp: \&quot;\&quot;\n    }\n];&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3a544603-7ab7-4849-bec9-145d4b76782b&quot;,&quot;parentUUID&quot;:&quot;c14854da-cb0d-4e78-8ac6-d2284878202a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create many classes request is successful&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 1: Create many classes request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classes: [...newClasses] };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(newClasses.length); // as many affected as classes sent\nconst term_id = data.classes[0].term_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}?term_id=${term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nconst classERPs = data.classes.map(classRow =&gt; (classRow.class_erp));\nconst responseERPs = res.body.body.map(classRow =&gt; (classRow.class_erp));\nexpect(responseERPs).to.include.all.members(classERPs);\n// cleanup\nfor (const class_erp of classERPs.reverse()) { // reversing so that FK references get removed first\n    res = await request(app)\n        .delete(`${baseRoute}/${term_id}/${class_erp}`)\n        .auth(adminToken, { type: &#x27;bearer&#x27; });\n    expect(res.status).to.be.equal(200);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:506:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;d4fd4965-ef82-4955-9664-26fdeed3a5d6&quot;,&quot;parentUUID&quot;:&quot;c14854da-cb0d-4e78-8ac6-d2284878202a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create many classes request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 2: Create many classes request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classes: [...newClasses] };\ndelete data.classes[0].term_id; // term_id is required\ndata.classes[0].subject_code = &#x27;000&#x27;; // &lt;-- a valid subject code should be &#x27;XXX999&#x27;\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param.split(&#x27;.&#x27;)[1]));\nexpect(incorrectParams).to.include.all.members([&#x27;term_id&#x27;, &#x27;subject_code&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:544:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;c63bcf1d-5346-4201-9054-0469989c518b&quot;,&quot;parentUUID&quot;:&quot;c14854da-cb0d-4e78-8ac6-d2284878202a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create many classes request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 3: Create many classes request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].term_id = unknownTermId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;term_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:563:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;3cc697dc-de24-4dd9-b0ee-0f444f3df36f&quot;,&quot;parentUUID&quot;:&quot;c14854da-cb0d-4e78-8ac6-d2284878202a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create many classes request is unsuccessful due to unknown subject_code&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 4: Create many classes request is unsuccessful due to unknown subject_code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].subject_code = unknownSubjectCode; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;subject_code&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:581:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;a19939e5-3fe6-4e32-9269-7107ec880fe0&quot;,&quot;parentUUID&quot;:&quot;c14854da-cb0d-4e78-8ac6-d2284878202a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create many classes request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 5: Create many classes request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].teacher_id = unknownTeacherId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;teacher_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:599:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;c7db565c-6315-40db-b445-9b2e3dd7e106&quot;,&quot;parentUUID&quot;:&quot;c14854da-cb0d-4e78-8ac6-d2284878202a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create many classes request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 6: Create many classes request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].classroom_id = unknownClassroomId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;classroom_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:617:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;e9a0d17e-db22-4ea9-ae7a-f1318eb6cd25&quot;,&quot;parentUUID&quot;:&quot;c14854da-cb0d-4e78-8ac6-d2284878202a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Create many classes request is unsuccessful due to unknown timeslot_id&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 7: Create many classes request is unsuccessful due to unknown timeslot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].timeslot_1 = unknownTimeslotId; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;timeslot_1&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:635:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;ddb1499b-757b-4491-81ac-b6e16488e599&quot;,&quot;parentUUID&quot;:&quot;c14854da-cb0d-4e78-8ac6-d2284878202a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Create many classes request is unsuccessful due to unknown parent_class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 8: Create many classes request is unsuccessful due to unknown parent_class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\ndata.classes[0].parent_class_erp = unknownClassERP; // &lt;-- non-existent id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;parent_class_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:653:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;b54d8657-7129-473e-a01e-ad83d408a5a3&quot;,&quot;parentUUID&quot;:&quot;c14854da-cb0d-4e78-8ac6-d2284878202a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Create many classes request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 9: Create many classes request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:670:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;7342e7ba-e1f3-4c7d-9533-1fc9ae2f8170&quot;,&quot;parentUUID&quot;:&quot;c14854da-cb0d-4e78-8ac6-d2284878202a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Create many classes request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API POST /classes/bulk Scenario 10: Create many classes request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {classes: [...newClasses]};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c24c1ccf-c927-4a2f-b36b-61937d98bc80&quot;,&quot;parentUUID&quot;:&quot;c14854da-cb0d-4e78-8ac6-d2284878202a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c24c1ccf-c927-4a2f-b36b-61937d98bc80&quot;],&quot;failures&quot;:[&quot;d4fd4965-ef82-4955-9664-26fdeed3a5d6&quot;,&quot;c63bcf1d-5346-4201-9054-0469989c518b&quot;,&quot;3cc697dc-de24-4dd9-b0ee-0f444f3df36f&quot;,&quot;a19939e5-3fe6-4e32-9269-7107ec880fe0&quot;,&quot;c7db565c-6315-40db-b445-9b2e3dd7e106&quot;,&quot;e9a0d17e-db22-4ea9-ae7a-f1318eb6cd25&quot;,&quot;ddb1499b-757b-4491-81ac-b6e16488e599&quot;,&quot;b54d8657-7129-473e-a01e-ad83d408a5a3&quot;,&quot;7342e7ba-e1f3-4c7d-9533-1fc9ae2f8170&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:66,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0148a47b-38fc-488c-90b8-eddf7db8960f&quot;,&quot;title&quot;:&quot;PATCH /classes/:term_id/:class_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a class request is successful&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 1: Update a class request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.classroom.classroom_id).to.be.equal(newClassroom);\n\n// cleanup\ndata.classroom_id = existingClass.classroom.classroom_id;\nres = await request(app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:709:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;4a1036e2-522b-42dc-9965-7344d4f35a81&quot;,&quot;parentUUID&quot;:&quot;0148a47b-38fc-488c-90b8-eddf7db8960f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a class request is unsuccessful due to unknown class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 2: Update a class request is unsuccessful due to unknown class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${unknownClassERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:742:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;ff07b776-be5f-490b-b37d-175dfcc72cc0&quot;,&quot;parentUUID&quot;:&quot;0148a47b-38fc-488c-90b8-eddf7db8960f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a class request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 3: Update a class request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTermId}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:759:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;ce7f5252-db81-4559-84e8-3dba80eb4ccb&quot;,&quot;parentUUID&quot;:&quot;0148a47b-38fc-488c-90b8-eddf7db8960f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a class request is unsuccessful due to unknown subject_code&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 4: Update a class request is unsuccessful due to unknown subject_code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject_code: unknownSubjectCode };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;subject_code&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:776:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;56e7f791-162f-4fc3-9d94-6c3469ee9b0f&quot;,&quot;parentUUID&quot;:&quot;0148a47b-38fc-488c-90b8-eddf7db8960f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a class request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 5: Update a class request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { teacher_id: unknownTeacherId };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;teacher_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:793:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;f4ed5cab-8d83-4629-a9eb-10d0acec10ad&quot;,&quot;parentUUID&quot;:&quot;0148a47b-38fc-488c-90b8-eddf7db8960f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a class request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 6: Update a class request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: unknownClassroomId };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;classroom_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:810:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;bcf41f78-a6c3-41e3-81f6-e61454805a29&quot;,&quot;parentUUID&quot;:&quot;0148a47b-38fc-488c-90b8-eddf7db8960f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Update a class request is unsuccessful due to unknown timeslot_id&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 7: Update a class request is unsuccessful due to unknown timeslot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { timeslot_1: unknownTimeslotId };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;timeslot_1&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:827:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;a61b949f-b06b-4172-b7de-e10a2286b216&quot;,&quot;parentUUID&quot;:&quot;0148a47b-38fc-488c-90b8-eddf7db8960f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Update a class request is unsuccessful due to unknown parent_class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 8: Update a class request is unsuccessful due to unknown parent_class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { parent_class_erp: unknownClassERP };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;parent_class_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:844:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;6522b7ca-3357-4c52-b396-2e04da4361a2&quot;,&quot;parentUUID&quot;:&quot;0148a47b-38fc-488c-90b8-eddf7db8960f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Update a class request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 9: Update a class request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    classroom: newClassroom, // &lt;-- an valid parameter name should be &#x27;classroom_id&#x27;\n    subject_code: &#x27;123&#x27; // &lt;-- a valid &#x27;subject_code&#x27; follows format &#x27;XXX999&#x27; only\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;subject_code&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:864:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;fc5f0ae2-cabe-4899-9179-9c10a6fd63b8&quot;,&quot;parentUUID&quot;:&quot;0148a47b-38fc-488c-90b8-eddf7db8960f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Update a class request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 10: Update a class request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\n\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change classes\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:884:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;11fd135e-59b5-4ba9-b68a-abfb4b82cc4b&quot;,&quot;parentUUID&quot;:&quot;0148a47b-38fc-488c-90b8-eddf7db8960f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 11: Update a class request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API PATCH /classes/:term_id/:class_erp Scenario 11: Update a class request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom_id: newClassroom };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8992491c-f317-4877-84fd-01a606e040dd&quot;,&quot;parentUUID&quot;:&quot;0148a47b-38fc-488c-90b8-eddf7db8960f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8992491c-f317-4877-84fd-01a606e040dd&quot;],&quot;failures&quot;:[&quot;4a1036e2-522b-42dc-9965-7344d4f35a81&quot;,&quot;ff07b776-be5f-490b-b37d-175dfcc72cc0&quot;,&quot;ce7f5252-db81-4559-84e8-3dba80eb4ccb&quot;,&quot;56e7f791-162f-4fc3-9d94-6c3469ee9b0f&quot;,&quot;f4ed5cab-8d83-4629-a9eb-10d0acec10ad&quot;,&quot;bcf41f78-a6c3-41e3-81f6-e61454805a29&quot;,&quot;a61b949f-b06b-4172-b7de-e10a2286b216&quot;,&quot;6522b7ca-3357-4c52-b396-2e04da4361a2&quot;,&quot;fc5f0ae2-cabe-4899-9179-9c10a6fd63b8&quot;,&quot;11fd135e-59b5-4ba9-b68a-abfb4b82cc4b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:87,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;00a639d8-7256-4e03-88fc-b54945862913&quot;,&quot;title&quot;:&quot;DELETE /classes/:term_id/:class_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\class.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\class.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a subject request is successful&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 1: Delete a subject request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { ...newClass };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = data.class_erp;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${subRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${subRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:932:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;26cf8215-91c1-4107-87f5-0df94233ec09&quot;,&quot;parentUUID&quot;:&quot;00a639d8-7256-4e03-88fc-b54945862913&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a subject request is unsuccessful due to unknown class_erp&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 2: Delete a subject request is unsuccessful due to unknown class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${subRoute}/${unknownClassERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:964:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;84ce6642-5b50-495c-9faf-f3e82e541055&quot;,&quot;parentUUID&quot;:&quot;00a639d8-7256-4e03-88fc-b54945862913&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a subject request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 3: Delete a subject request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTermId}/${existingClass.class_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Class not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:977:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;104fbf14-f4a0-4448-bdcc-9bd549ee48f4&quot;,&quot;parentUUID&quot;:&quot;00a639d8-7256-4e03-88fc-b54945862913&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 4: Delete a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${subRoute}/${existingClass.class_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\class.test.js:990:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;f0281609-f3c1-4278-af2c-f7f45dd19957&quot;,&quot;parentUUID&quot;:&quot;00a639d8-7256-4e03-88fc-b54945862913&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classes API DELETE /classes/:term_id/:class_erp Scenario 5: Delete a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${subRoute}/${existingClass.class_erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0e68417c-ffae-4b3a-bc9d-c79360cc8c63&quot;,&quot;parentUUID&quot;:&quot;00a639d8-7256-4e03-88fc-b54945862913&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0e68417c-ffae-4b3a-bc9d-c79360cc8c63&quot;],&quot;failures&quot;:[&quot;26cf8215-91c1-4107-87f5-0df94233ec09&quot;,&quot;84ce6642-5b50-495c-9faf-f3e82e541055&quot;,&quot;104fbf14-f4a0-4448-bdcc-9bd549ee48f4&quot;,&quot;f0281609-f3c1-4278-af2c-f7f45dd19957&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:66,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ebea688d-cae6-4517-ab17-b5810178972e&quot;,&quot;title&quot;:&quot;Classrooms API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Classrooms API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Classrooms API \&quot;before each\&quot; hook in \&quot;Classrooms API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f8f29591-06b8-47f6-a265-42c5f4fd95a2&quot;,&quot;parentUUID&quot;:&quot;ebea688d-cae6-4517-ab17-b5810178972e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;61889b98-29a3-4515-a5a5-2e2d0b31cb23&quot;,&quot;title&quot;:&quot;GET /classrooms&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all classrooms request successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms Scenario 1: Get all classrooms request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingClassroom));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:36:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;696785ff-1c0a-4edb-a99c-163843056ca8&quot;,&quot;parentUUID&quot;:&quot;61889b98-29a3-4515-a5a5-2e2d0b31cb23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all classrooms request unsuccessful due to zero classrooms&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms Scenario 2: Get all classrooms request unsuccessful due to zero classrooms&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:496,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ClassroomModel = require(&#x27;../../src/models/classroom.model&#x27;);\nconst modelStub = sinon.stub(ClassroomModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty classroom list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classrooms not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;8a778165-b005-4821-9b6d-8f8d4c338d0e&quot;,&quot;parentUUID&quot;:&quot;61889b98-29a3-4515-a5a5-2e2d0b31cb23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms Scenario 3: Get a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:70:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;4f80557e-29c6-4bfb-a176-5e895f71221e&quot;,&quot;parentUUID&quot;:&quot;61889b98-29a3-4515-a5a5-2e2d0b31cb23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all classrooms request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms Scenario 4: Get all classrooms request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;95559968-f83d-48b8-8feb-610506581863&quot;,&quot;parentUUID&quot;:&quot;61889b98-29a3-4515-a5a5-2e2d0b31cb23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;95559968-f83d-48b8-8feb-610506581863&quot;],&quot;failures&quot;:[&quot;696785ff-1c0a-4edb-a99c-163843056ca8&quot;,&quot;8a778165-b005-4821-9b6d-8f8d4c338d0e&quot;,&quot;4f80557e-29c6-4bfb-a176-5e895f71221e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:522,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;40ebfc95-cd71-4068-bef7-bcda8a7fcf28&quot;,&quot;title&quot;:&quot;GET /classrooms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a classroom request successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms/:id Scenario 1: Get a classroom request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingClassroom));\nexpect(resBody.classroom_id).to.be.equal(existingClassroom.classroom_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:96:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;6f27ac14-4837-4e5f-b6bc-20ba4bcb1d35&quot;,&quot;parentUUID&quot;:&quot;40ebfc95-cd71-4068-bef7-bcda8a7fcf28&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms/:id Scenario 2: Get a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownClassroomId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classroom not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:110:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;ff3b8166-f18f-4212-a2e6-cb7dfa8d07e9&quot;,&quot;parentUUID&quot;:&quot;40ebfc95-cd71-4068-bef7-bcda8a7fcf28&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms/:id Scenario 3: Get a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:123:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;4a951ca3-ce7c-4e3b-854b-b5d574ea15f8&quot;,&quot;parentUUID&quot;:&quot;40ebfc95-cd71-4068-bef7-bcda8a7fcf28&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a classroom request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API GET /classrooms/:id Scenario 4: Get a classroom request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingClassroom.classroom_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b098305e-3f91-4ada-9079-7d6eb7460eb1&quot;,&quot;parentUUID&quot;:&quot;40ebfc95-cd71-4068-bef7-bcda8a7fcf28&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b098305e-3f91-4ada-9079-7d6eb7460eb1&quot;],&quot;failures&quot;:[&quot;6f27ac14-4837-4e5f-b6bc-20ba4bcb1d35&quot;,&quot;ff3b8166-f18f-4212-a2e6-cb7dfa8d07e9&quot;,&quot;4a951ca3-ce7c-4e3b-854b-b5d574ea15f8&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:32,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;fc008c93-6e5d-408a-a4ea-373a964ded7f&quot;,&quot;title&quot;:&quot;POST /classrooms&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a classroom request is successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 1: Create a classroom request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom, campus_id };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;classroom_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.classroom_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    classroom_id: newId,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:157:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;27cf45b7-d70a-48dc-978d-abc96ca44e39&quot;,&quot;parentUUID&quot;:&quot;fc008c93-6e5d-408a-a4ea-373a964ded7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a classroom request is unsuccessful due to unknown campus_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 2: Create a classroom request is unsuccessful due to unknown campus_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom, campus_id: unknownCampusId };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;campus_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:192:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;becf97d0-faf6-417a-9b1d-21922014b0a2&quot;,&quot;parentUUID&quot;:&quot;fc008c93-6e5d-408a-a4ea-373a964ded7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a classroom request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 3: Create a classroom request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    classrooms: classroom, // &lt;-- a valid parameter name is &#x27;classroom&#x27;\n    campus_id\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;classroom&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:212:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;4be89623-c0b8-42a8-9f40-09ebeee6da87&quot;,&quot;parentUUID&quot;:&quot;fc008c93-6e5d-408a-a4ea-373a964ded7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 4: Create a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom, campus_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:230:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;5f433e60-3c70-47eb-9698-2f8041bf3c8a&quot;,&quot;parentUUID&quot;:&quot;fc008c93-6e5d-408a-a4ea-373a964ded7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a classroom request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API POST /classrooms Scenario 5: Create a classroom request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom, campus_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;927efd73-59df-4a55-b48d-225e390163d7&quot;,&quot;parentUUID&quot;:&quot;fc008c93-6e5d-408a-a4ea-373a964ded7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;927efd73-59df-4a55-b48d-225e390163d7&quot;],&quot;failures&quot;:[&quot;27cf45b7-d70a-48dc-978d-abc96ca44e39&quot;,&quot;becf97d0-faf6-417a-9b1d-21922014b0a2&quot;,&quot;4be89623-c0b8-42a8-9f40-09ebeee6da87&quot;,&quot;5f433e60-3c70-47eb-9698-2f8041bf3c8a&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:72,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0f4cf95b-3f63-4fc2-acff-7c748759bba3&quot;,&quot;title&quot;:&quot;PATCH /classrooms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a classroom request is successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 1: Update a classroom request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom: newClassroomName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    classroom_id: existingClassroom.classroom_id,\n    classroom: newClassroomName,\n    campus_id: existingClassroom.campus_id\n});\n\n// cleanup\ndata.classroom = existingClassroom.classroom;\nres = await request(app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:268:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;50571da6-3f8a-4d32-b633-39549b0528f8&quot;,&quot;parentUUID&quot;:&quot;0f4cf95b-3f63-4fc2-acff-7c748759bba3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 2: Update a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom: newClassroomName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownClassroomId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classroom not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:306:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;5cce0602-df0c-4130-a59a-ffc79a71ebf0&quot;,&quot;parentUUID&quot;:&quot;0f4cf95b-3f63-4fc2-acff-7c748759bba3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a classroom request is unsuccessful due to unknown campus_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 3: Update a classroom request is unsuccessful due to unknown campus_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { campus_id: unknownCampusId };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;campus_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:323:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;15251bf6-b8ec-4074-9451-0cbf5331e71e&quot;,&quot;parentUUID&quot;:&quot;0f4cf95b-3f63-4fc2-acff-7c748759bba3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a classroom request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 4: Update a classroom request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    classrooms: newClassroomName // &lt;-- a invalid update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:342:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;92a3a473-d00f-43a3-a29a-005a73f372bb&quot;,&quot;parentUUID&quot;:&quot;0f4cf95b-3f63-4fc2-acff-7c748759bba3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 5: Update a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom: newClassroomName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:360:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;fb47a760-4164-4747-ace1-4c97ecbfbfa5&quot;,&quot;parentUUID&quot;:&quot;0f4cf95b-3f63-4fc2-acff-7c748759bba3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a classroom request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API PATCH /classrooms/:id Scenario 6: Update a classroom request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { classroom: newClassroomName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7b141f62-a24f-4a27-a506-742f2f9c95fa&quot;,&quot;parentUUID&quot;:&quot;0f4cf95b-3f63-4fc2-acff-7c748759bba3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7b141f62-a24f-4a27-a506-742f2f9c95fa&quot;],&quot;failures&quot;:[&quot;50571da6-3f8a-4d32-b633-39549b0528f8&quot;,&quot;5cce0602-df0c-4130-a59a-ffc79a71ebf0&quot;,&quot;15251bf6-b8ec-4074-9451-0cbf5331e71e&quot;,&quot;92a3a473-d00f-43a3-a29a-005a73f372bb&quot;,&quot;fb47a760-4164-4747-ace1-4c97ecbfbfa5&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;104de26f-a153-4500-8e95-c8eabc9e28ff&quot;,&quot;title&quot;:&quot;DELETE /classrooms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\classroom.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\classroom.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a classroom request is successful&quot;,&quot;fullTitle&quot;:&quot;Classrooms API DELETE /classrooms/:id Scenario 1: Delete a classroom request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { classroom, campus_id };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.classroom_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classroom has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:397:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;249bc93f-0171-4e9c-8a9e-4f0a5ad9b4d2&quot;,&quot;parentUUID&quot;:&quot;104de26f-a153-4500-8e95-c8eabc9e28ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;fullTitle&quot;:&quot;Classrooms API DELETE /classrooms/:id Scenario 2: Delete a classroom request is unsuccessful due to unknown classroom_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownClassroomId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Classroom not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:429:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;c869bcc4-14d2-495c-bbc0-e4d18f8eb43b&quot;,&quot;parentUUID&quot;:&quot;104de26f-a153-4500-8e95-c8eabc9e28ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a classroom request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Classrooms API DELETE /classrooms/:id Scenario 3: Delete a classroom request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingClassroom.classroom_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\classroom.test.js:442:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;21ebeeaf-c08a-4b57-8033-b19d5024c329&quot;,&quot;parentUUID&quot;:&quot;104de26f-a153-4500-8e95-c8eabc9e28ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a classroom request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Classrooms API DELETE /classrooms/:id Scenario 4: Delete a classroom request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingClassroom.classroom_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ff98cfc9-3db6-45fa-99fb-d3a66d9de556&quot;,&quot;parentUUID&quot;:&quot;104de26f-a153-4500-8e95-c8eabc9e28ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ff98cfc9-3db6-45fa-99fb-d3a66d9de556&quot;],&quot;failures&quot;:[&quot;249bc93f-0171-4e9c-8a9e-4f0a5ad9b4d2&quot;,&quot;c869bcc4-14d2-495c-bbc0-e4d18f8eb43b&quot;,&quot;21ebeeaf-c08a-4b57-8033-b19d5024c329&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:15,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b8111fd2-dc2c-4a65-ae4f-310e7f00c119&quot;,&quot;title&quot;:&quot;Hangout requests API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Hangout requests API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API \&quot;before each\&quot; hook in \&quot;Hangout requests API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b59d4be6-bf36-4f15-a3ef-3d557cd33db2&quot;,&quot;parentUUID&quot;:&quot;b8111fd2-dc2c-4a65-ae4f-310e7f00c119&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e77763e4-12ae-400c-ba9e-0db581729da1&quot;,&quot;title&quot;:&quot;GET /hangout-requests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all hangout requests is successful (Sent)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 1: Get all hangout requests is successful (Sent)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // userToken.erp === sender_erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = hangoutRequest =&gt; hangoutRequest.sender.erp === sender_erp;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([\n    &#x27;hangout_request_id&#x27;,\n    &#x27;sender&#x27;,\n    &#x27;receiver&#x27;,\n    &#x27;purpose&#x27;,\n    &#x27;request_status&#x27;,\n    &#x27;meetup_at&#x27;,\n    &#x27;meetup_spot_id&#x27;,\n    &#x27;accepted_at&#x27;\n]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingHangoutRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingHangoutRequest.receiver));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:58:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;e09324ee-87c3-4b0f-9c99-cd1662bbdbef&quot;,&quot;parentUUID&quot;:&quot;e77763e4-12ae-400c-ba9e-0db581729da1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all hangout requests is successful (Receiver)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 2: Get all hangout requests is successful (Receiver)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = adminERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?receiver_erp=${receiver_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // adminToken.erp === receiver_erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = hangoutRequest =&gt; hangoutRequest.receiver.erp === receiver_erp;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([\n    &#x27;hangout_request_id&#x27;,\n    &#x27;sender&#x27;,\n    &#x27;receiver&#x27;,\n    &#x27;purpose&#x27;,\n    &#x27;request_status&#x27;,\n    &#x27;meetup_at&#x27;,\n    &#x27;meetup_spot_id&#x27;,\n    &#x27;accepted_at&#x27;\n]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingHangoutRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingHangoutRequest.receiver));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:88:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;62285a45-f950-4504-9ebb-db3df05ef22a&quot;,&quot;parentUUID&quot;:&quot;e77763e4-12ae-400c-ba9e-0db581729da1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all hangout requests unsuccessful due to no (sent) hangout requests&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 3: Get all hangout requests unsuccessful due to no (sent) hangout requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = user2ERP;\nconst fakeToken = jwt.sign({erp: sender_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}`)\n    .auth(fakeToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:119:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;d7a114de-bad0-4365-83f2-141b2de7d876&quot;,&quot;parentUUID&quot;:&quot;e77763e4-12ae-400c-ba9e-0db581729da1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all hangout requests unsuccessful due to no (received) hangout requests&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 4: Get all hangout requests unsuccessful due to no (received) hangout requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = user2ERP;\nconst fakeToken = jwt.sign({erp: receiver_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?receiver_erp=${receiver_erp}`)\n    .auth(fakeToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:134:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;1d1c3a2a-60a5-43f7-940b-e96167178a19&quot;,&quot;parentUUID&quot;:&quot;e77763e4-12ae-400c-ba9e-0db581729da1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all hangout requests is incorrect due to multiple query params&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 5: Get all hangout requests is incorrect due to multiple query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\nconst receiver_erp = user2ERP;\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}&amp;receiver_erp=${receiver_erp}`) // &lt;-- can&#x27;t specify both sender_erp and receiver_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;receiver_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Can\\&#x27;t specify both sender and receiver erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:149:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;56a98863-87f5-499f-a9fe-594e5238f4ec&quot;,&quot;parentUUID&quot;:&quot;e77763e4-12ae-400c-ba9e-0db581729da1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get all hangout requests is incorrect due to no query params&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 6: Get all hangout requests is incorrect due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}`) // &lt;-- either specify sender_erp or receiver_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Either sender or receiver erp is required&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:165:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;1c65ab21-a0b6-4a02-b6f9-dc91680a44c4&quot;,&quot;parentUUID&quot;:&quot;e77763e4-12ae-400c-ba9e-0db581729da1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Get all hangout requests is incorrect due to unknown query params&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 7: Get all hangout requests is incorrect due to unknown query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = &#x27;123&#x27;; // a valid erp is 5 digits\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}&amp;request_status=accepted`) // &lt;-- &#x27;request_status&#x27; is invalid query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;sender_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:182:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;196b4e29-ed8e-4228-b2ca-3d5af69a6af1&quot;,&quot;parentUUID&quot;:&quot;e77763e4-12ae-400c-ba9e-0db581729da1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Get request is forbidden due to querying other&#x27;s sent hangout requests&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 8: Get request is forbidden due to querying other&#x27;s sent hangout requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?sender_erp=${sender_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp !== sender_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:201:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;78164d48-ac17-4023-88e7-837d9f2620ed&quot;,&quot;parentUUID&quot;:&quot;e77763e4-12ae-400c-ba9e-0db581729da1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Get request is forbidden due to querying other&#x27;s received hangout requests&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 9: Get request is forbidden due to querying other&#x27;s received hangout requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?receiver_erp=${receiver_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp !== receiver_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:217:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;d68b303d-e072-4e79-ad1d-759db4e49b6d&quot;,&quot;parentUUID&quot;:&quot;e77763e4-12ae-400c-ba9e-0db581729da1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Get all hangout requests is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API GET /hangout-requests Scenario 10: Get all hangout requests is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e32f7523-bc96-4cbe-ae44-5e09387cc4c3&quot;,&quot;parentUUID&quot;:&quot;e77763e4-12ae-400c-ba9e-0db581729da1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e32f7523-bc96-4cbe-ae44-5e09387cc4c3&quot;],&quot;failures&quot;:[&quot;e09324ee-87c3-4b0f-9c99-cd1662bbdbef&quot;,&quot;62285a45-f950-4504-9ebb-db3df05ef22a&quot;,&quot;d7a114de-bad0-4365-83f2-141b2de7d876&quot;,&quot;1d1c3a2a-60a5-43f7-940b-e96167178a19&quot;,&quot;56a98863-87f5-499f-a9fe-594e5238f4ec&quot;,&quot;1c65ab21-a0b6-4a02-b6f9-dc91680a44c4&quot;,&quot;196b4e29-ed8e-4228-b2ca-3d5af69a6af1&quot;,&quot;78164d48-ac17-4023-88e7-837d9f2620ed&quot;,&quot;d68b303d-e072-4e79-ad1d-759db4e49b6d&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:47,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;8c197bbb-c725-48d1-a3f3-0f9e5cb28700&quot;,&quot;title&quot;:&quot;POST /hangout-requests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a hangout request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 1: Create a hangout request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp, receiver_erp, purpose, meetup_at, meetup_spot_id };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // token erp === sender_erp in body\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.hangout_request_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // token erp === sender_erp in body\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.hangout_request_id).to.be.equal(newId);\nexpect(res.body.body.sender.erp).to.be.equal(data.sender_erp);\nexpect(res.body.body.receiver.erp).to.be.equal(data.receiver_erp);\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // sender deletes it\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:254:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;d0a08d12-cad6-445f-902e-3c58c473296d&quot;,&quot;parentUUID&quot;:&quot;8c197bbb-c725-48d1-a3f3-0f9e5cb28700&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a hangout request is unsuccessful due to unknown receiver_erp&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 2: Create a hangout request is unsuccessful due to unknown receiver_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: existingHangoutRequest.sender.erp,\n    receiver_erp: unknownStudentERP,\n    purpose,\n    meetup_at,\n    meetup_spot_id\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === existingHangoutRequest.sender.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;receiver_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:293:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;6f6b939c-0cf9-4658-aeda-4a73ffadd3f6&quot;,&quot;parentUUID&quot;:&quot;8c197bbb-c725-48d1-a3f3-0f9e5cb28700&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a hangout request is incorrect due to wrong key name in the body&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 3: Create a hangout request is incorrect due to wrong key name in the body&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { // missing receiver_erp,\n    meetup_at: &#x27;not going&#x27;, // &lt;-- not a valid meetup_at\n    purpose,\n    meetup_spot_id,\n    send_erp: &#x27;12345&#x27; // &lt;-- a valid parameter name should be &#x27;sender_erp&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;receiver_erp&#x27;, &#x27;meetup_at&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:315:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;38db57d3-80fc-4644-96c7-24c4cde6c4d5&quot;,&quot;parentUUID&quot;:&quot;8c197bbb-c725-48d1-a3f3-0f9e5cb28700&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a hangout request is incorrect due to hangout request to oneself&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 4: Create a hangout request is incorrect due to hangout request to oneself&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: sender_erp,\n    receiver_erp: sender_erp,\n    purpose,\n    meetup_at,\n    meetup_spot_id\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === data.sender_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;receiver_erp&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Sender and receiver ERP can\\&#x27;t be the same&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:339:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;c31fc6b4-026e-4b0b-a53a-cc549babad61&quot;,&quot;parentUUID&quot;:&quot;8c197bbb-c725-48d1-a3f3-0f9e5cb28700&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a hangout request is forbidden due to unowned hangout request&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 5: Create a hangout request is forbidden due to unowned hangout request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp: adminERP, receiver_erp, purpose, meetup_at, meetup_spot_id }; // adminERP instead of userERP\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- data.sender_erp !== userToken.erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:359:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;5b3309bb-b810-4071-a455-5ce553b7dd88&quot;,&quot;parentUUID&quot;:&quot;8c197bbb-c725-48d1-a3f3-0f9e5cb28700&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a hangout request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API POST /hangout-requests Scenario 6: Create a hangout request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp, receiver_erp, purpose, meetup_at, meetup_spot_id };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c342523c-c5f7-46b8-8930-c469bdc1d270&quot;,&quot;parentUUID&quot;:&quot;8c197bbb-c725-48d1-a3f3-0f9e5cb28700&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c342523c-c5f7-46b8-8930-c469bdc1d270&quot;],&quot;failures&quot;:[&quot;d0a08d12-cad6-445f-902e-3c58c473296d&quot;,&quot;6f6b939c-0cf9-4658-aeda-4a73ffadd3f6&quot;,&quot;38db57d3-80fc-4644-96c7-24c4cde6c4d5&quot;,&quot;c31fc6b4-026e-4b0b-a53a-cc549babad61&quot;,&quot;5b3309bb-b810-4071-a455-5ce553b7dd88&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9fc7e2f6-f11b-4676-b7c5-e5ad15c65c5c&quot;,&quot;title&quot;:&quot;PATCH /hangout-requests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a hangout request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API PATCH /hangout-requests/:id Scenario 1: Update a hangout request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { request_status, accepted_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminToken.erp == existingHangoutRequest.receiver.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${hangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst hangoutRequest = {\n    ...existingHangoutRequest\n};\nhangoutRequest.accepted_at = data.accepted_at;\nhangoutRequest.request_status = data.request_status;\nexpect(res.body.body).to.be.eql(hangoutRequest);\n\n// cleanup\ndata.request_status = existingHangoutRequest.request_status;\ndata.accepted_at = existingHangoutRequest.accepted_at;\nres = await request(app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminToken.erp == existingHangoutRequest.receiver.erp\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:399:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;e7c72a93-5eef-4002-842c-0b58a9f5b5ad&quot;,&quot;parentUUID&quot;:&quot;9fc7e2f6-f11b-4676-b7c5-e5ad15c65c5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a hangout request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API PATCH /hangout-requests/:id Scenario 2: Update a hangout request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    request_status: &#x27;ignored&#x27;, // &lt;-- not a valid request_status\n    accepted_at, // can&#x27;t specify accepted at unless request_status === &#x27;accepted/reject&#x27;\n    sender_erp: &#x27;12345&#x27; // &lt;-- an invalid update parameter i.e. not allowed\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;request_status&#x27;, &#x27;accepted_at&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include.members([&#x27;Invalid updates!&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:442:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;d72522fb-9fdf-406b-85db-cdbc26a00f40&quot;,&quot;parentUUID&quot;:&quot;9fc7e2f6-f11b-4676-b7c5-e5ad15c65c5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a hangout request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API PATCH /hangout-requests/:id Scenario 3: Update a hangout request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { request_status, accepted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- userToken.erp !== existingHangoutRequest.receiver.erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:462:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;1601fc89-e446-43a9-bb2f-90f54cbb9655&quot;,&quot;parentUUID&quot;:&quot;9fc7e2f6-f11b-4676-b7c5-e5ad15c65c5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a hangout request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API PATCH /hangout-requests/:id Scenario 4: Update a hangout request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { request_status, accepted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${hangoutRequestId}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;df7ec667-1982-42a8-a3c7-e8aaf571d094&quot;,&quot;parentUUID&quot;:&quot;9fc7e2f6-f11b-4676-b7c5-e5ad15c65c5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;df7ec667-1982-42a8-a3c7-e8aaf571d094&quot;],&quot;failures&quot;:[&quot;e7c72a93-5eef-4002-842c-0b58a9f5b5ad&quot;,&quot;d72522fb-9fdf-406b-85db-cdbc26a00f40&quot;,&quot;1601fc89-e446-43a9-bb2f-90f54cbb9655&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;4c5db2a3-f194-4147-85f1-69964373546f&quot;,&quot;title&quot;:&quot;DELETE /hangout-requests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hangoutRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hangoutRequest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a hangout request is successful (Sender cancels)&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API DELETE /hangout-requests/:id Scenario 1: Delete a hangout request is successful (Sender cancels)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { sender_erp, receiver_erp, purpose, meetup_at, meetup_spot_id };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\nconst newId = res.body.body.hangout_request_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp === sender_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hangout request has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hangout request not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:503:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;62ec4de8-5a93-4b9e-b896-79fa9944f0cb&quot;,&quot;parentUUID&quot;:&quot;4c5db2a3-f194-4147-85f1-69964373546f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a hangout request is unsuccessful due to unknown id&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API DELETE /hangout-requests/:id Scenario 2: Delete a hangout request is unsuccessful due to unknown id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownHangoutRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hangout request not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:536:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;22f1764e-98e9-4406-83e9-957d57cb6f28&quot;,&quot;parentUUID&quot;:&quot;4c5db2a3-f194-4147-85f1-69964373546f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a hangout request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API DELETE /hangout-requests/:id Scenario 3: Delete a hangout request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst forbiddenToken = jwt.sign({erp: receiver_erp}, Config.SECRET_JWT);\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${hangoutRequestId}`)\n    .auth(forbiddenToken, { type: &#x27;bearer&#x27; }); // forbiddenToken.erp !== receiver_erp or sender_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hangoutRequest.test.js:552:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;4707e830-acdc-4ede-bc00-128f38609a30&quot;,&quot;parentUUID&quot;:&quot;4c5db2a3-f194-4147-85f1-69964373546f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a hangout request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hangout requests API DELETE /hangout-requests/:id Scenario 4: Delete a hangout request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${hangoutRequestId}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e6f08c11-e61f-4dc7-a78d-2f5af2546451&quot;,&quot;parentUUID&quot;:&quot;4c5db2a3-f194-4147-85f1-69964373546f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e6f08c11-e61f-4dc7-a78d-2f5af2546451&quot;],&quot;failures&quot;:[&quot;62ec4de8-5a93-4b9e-b896-79fa9944f0cb&quot;,&quot;22f1764e-98e9-4406-83e9-957d57cb6f28&quot;,&quot;4707e830-acdc-4ede-bc00-128f38609a30&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;fadcd593-5b57-4a6e-96c5-5509a4f35f55&quot;,&quot;title&quot;:&quot;Healthcheck&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\healthCheck.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\healthCheck.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Healthcheck\&quot;&quot;,&quot;fullTitle&quot;:&quot;Healthcheck \&quot;before each\&quot; hook in \&quot;Healthcheck\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;originalDateNow = Date.now;\nDate.now = () =&gt; { return now; };&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ec42c4a0-e6fa-4d6a-a15c-6ae3f0fa312b&quot;,&quot;parentUUID&quot;:&quot;fadcd593-5b57-4a6e-96c5-5509a4f35f55&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Healthcheck\&quot;&quot;,&quot;fullTitle&quot;:&quot;Healthcheck \&quot;after each\&quot; hook in \&quot;Healthcheck\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;Date.now = originalDateNow;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e50eaa5b-8778-442a-bbde-dc8a46f85b06&quot;,&quot;parentUUID&quot;:&quot;fadcd593-5b57-4a6e-96c5-5509a4f35f55&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns OK, uptime and timestamp, if server is healthy&quot;,&quot;fullTitle&quot;:&quot;Healthcheck returns OK, uptime and timestamp, if server is healthy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const res = await request(app).get(`/api/${Config.API_VERSION}/health`, null);\n// status check\nexpect(res.status).to.be.equal(200);\n// error check\nexpect(res.body.headers.error).to.be.equal(0);\n\n// params check\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys(\&quot;health\&quot;, \&quot;uptime\&quot;, \&quot;timestamp\&quot;);\n// health check\nexpect(resBody.health).to.be.equal(&#x27;OK&#x27;);\n// uptime check\nconst uptime = Number.parseFloat(resBody.uptime);\nexpect(uptime).to.be.gt(0);\n// timestamp check\nconst timestamp = new Date(now).toJSON();\nexpect(resBody.timestamp).to.be.equal(timestamp);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ee583078-719a-4000-ba49-3cd74119c1b1&quot;,&quot;parentUUID&quot;:&quot;fadcd593-5b57-4a6e-96c5-5509a4f35f55&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ee583078-719a-4000-ba49-3cd74119c1b1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;93b46787-c5f5-4f07-ba32-079e7c66b1f7&quot;,&quot;title&quot;:&quot;Hobbies API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Hobbies API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Hobbies API \&quot;before each\&quot; hook in \&quot;Hobbies API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;97f36315-92ea-4cbc-9aeb-c4ffdb16d042&quot;,&quot;parentUUID&quot;:&quot;93b46787-c5f5-4f07-ba32-079e7c66b1f7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3a6d25e4-7c66-45f4-8da8-78b100d21081&quot;,&quot;title&quot;:&quot;GET /hobbies&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all hobbies request successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies Scenario 1: Get all hobbies request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;hobby_id&#x27;, &#x27;hobby&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:34:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;27e22869-132a-4585-ba55-6774acf28904&quot;,&quot;parentUUID&quot;:&quot;3a6d25e4-7c66-45f4-8da8-78b100d21081&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all hobbies request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies Scenario 2: Get all hobbies request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:484,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst HobbyModel = require(&#x27;../../src/models/hobby.model&#x27;);\nconst modelStub = sinon.stub(HobbyModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty hobby list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobbies not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;36bdbf9f-77c6-449f-a9a8-052a471ea7c7&quot;,&quot;parentUUID&quot;:&quot;3a6d25e4-7c66-45f4-8da8-78b100d21081&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;27e22869-132a-4585-ba55-6774acf28904&quot;,&quot;36bdbf9f-77c6-449f-a9a8-052a471ea7c7&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:492,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f68197c7-3212-4bdf-a12d-e6adb7edb46d&quot;,&quot;title&quot;:&quot;GET /hobbies/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a hobby request successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies/:id Scenario 1: Get a hobby request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;hobby_id&#x27;, &#x27;hobby&#x27;]);\nexpect(resBody.hobby_id).to.be.eql(existingHobby.hobby_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:70:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;04bba051-0317-4098-94d9-978507ecbd32&quot;,&quot;parentUUID&quot;:&quot;f68197c7-3212-4bdf-a12d-e6adb7edb46d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a hobby request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies/:id Scenario 2: Get a hobby request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownHobbyId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobby not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:84:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;82086ddb-07c9-4b6b-8ed3-ed875d5bae6f&quot;,&quot;parentUUID&quot;:&quot;f68197c7-3212-4bdf-a12d-e6adb7edb46d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a hobby request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hobbies API GET /hobbies/:id Scenario 3: Get a hobby request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingHobby.hobby_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0d008f55-75d8-4e57-a260-46c2286dd97c&quot;,&quot;parentUUID&quot;:&quot;f68197c7-3212-4bdf-a12d-e6adb7edb46d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0d008f55-75d8-4e57-a260-46c2286dd97c&quot;],&quot;failures&quot;:[&quot;04bba051-0317-4098-94d9-978507ecbd32&quot;,&quot;82086ddb-07c9-4b6b-8ed3-ed875d5bae6f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:25,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;33ec8d76-19c0-4c78-83ad-7846c299f14c&quot;,&quot;title&quot;:&quot;POST /hobbies&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a hobby request is successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API POST /hobbies Scenario 1: Create a hobby request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;hobby_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.hobby_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    hobby_id: newId,\n    hobby: hobby\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:117:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;794bbe28-9ad3-4942-a65c-68e0da896f04&quot;,&quot;parentUUID&quot;:&quot;33ec8d76-19c0-4c78-83ad-7846c299f14c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a hobby request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Hobbies API POST /hobbies Scenario 2: Create a hobby request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    hobbies: hobby // &lt;-- a valid parameter name should be &#x27;hobby&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;hobby&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;2b7da326-674a-4389-baf0-967257ca7a37&quot;,&quot;parentUUID&quot;:&quot;33ec8d76-19c0-4c78-83ad-7846c299f14c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a hobby request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hobbies API POST /hobbies Scenario 3: Create a hobby request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:172:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;cc792c43-3704-4e7a-af23-7d7b489cae25&quot;,&quot;parentUUID&quot;:&quot;33ec8d76-19c0-4c78-83ad-7846c299f14c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a hobby request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hobbies API POST /hobbies Scenario 4: Create a hobby request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;85016200-f454-469f-8d94-33105029fc00&quot;,&quot;parentUUID&quot;:&quot;33ec8d76-19c0-4c78-83ad-7846c299f14c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;85016200-f454-469f-8d94-33105029fc00&quot;],&quot;failures&quot;:[&quot;794bbe28-9ad3-4942-a65c-68e0da896f04&quot;,&quot;2b7da326-674a-4389-baf0-967257ca7a37&quot;,&quot;cc792c43-3704-4e7a-af23-7d7b489cae25&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:41,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;89c910ac-d736-4238-b5de-44ffe2492081&quot;,&quot;title&quot;:&quot;PATCH /hobbies/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a hobby request is successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 1: Update a hobby request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby: newHobby };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    hobby_id: existingHobby.hobby_id,\n    hobby: newHobby\n});\n\n// cleanup\ndata.hobby = existingHobby.hobby;\nres = await request(app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:210:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;61838fc5-e45d-450e-a41a-18148597d1ae&quot;,&quot;parentUUID&quot;:&quot;89c910ac-d736-4238-b5de-44ffe2492081&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a hobby request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 2: Update a hobby request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby: newHobby };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownHobbyId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobby not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:247:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;76c825ad-fbaa-4500-a284-e463be6fb946&quot;,&quot;parentUUID&quot;:&quot;89c910ac-d736-4238-b5de-44ffe2492081&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a hobby request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 3: Update a hobby request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    hobbies: newHobby // &lt;-- a valid parameter name should be &#x27;hobby&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;hobby&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:266:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;6722ec26-c4aa-4b9c-b29e-738ac0b3ac8c&quot;,&quot;parentUUID&quot;:&quot;89c910ac-d736-4238-b5de-44ffe2492081&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a hobby request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 4: Update a hobby request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby: newHobby };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:284:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;5c0aaf11-53ed-47cc-af74-99244d0dd902&quot;,&quot;parentUUID&quot;:&quot;89c910ac-d736-4238-b5de-44ffe2492081&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a hobby request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hobbies API PATCH /hobbies/:id Scenario 5: Update a hobby request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { hobby: newHobby };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingHobby.hobby_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7a45f973-ba58-48bf-b9a5-36616c64e809&quot;,&quot;parentUUID&quot;:&quot;89c910ac-d736-4238-b5de-44ffe2492081&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7a45f973-ba58-48bf-b9a5-36616c64e809&quot;],&quot;failures&quot;:[&quot;61838fc5-e45d-450e-a41a-18148597d1ae&quot;,&quot;76c825ad-fbaa-4500-a284-e463be6fb946&quot;,&quot;6722ec26-c4aa-4b9c-b29e-738ac0b3ac8c&quot;,&quot;5c0aaf11-53ed-47cc-af74-99244d0dd902&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:47,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;504910ca-02a4-4f6e-90af-58eb7a02edf5&quot;,&quot;title&quot;:&quot;DELETE /hobbies/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\hobby.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\hobby.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a hobby request is successful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API DELETE /hobbies/:id Scenario 1: Delete a hobby request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { hobby };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.hobby_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobby has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:320:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;eafd85ec-44dc-4da1-ad2d-082c2bfb93d1&quot;,&quot;parentUUID&quot;:&quot;504910ca-02a4-4f6e-90af-58eb7a02edf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a hobby request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Hobbies API DELETE /hobbies/:id Scenario 2: Delete a hobby request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownHobbyId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Hobby not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:352:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;9a395f9b-d998-4f16-b425-29288e1f2150&quot;,&quot;parentUUID&quot;:&quot;504910ca-02a4-4f6e-90af-58eb7a02edf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a hobby request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Hobbies API DELETE /hobbies/:id Scenario 3: Delete a hobby request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingHobby.hobby_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\hobby.test.js:365:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;8894860c-7d5b-416b-ad34-dd9fd9a61bed&quot;,&quot;parentUUID&quot;:&quot;504910ca-02a4-4f6e-90af-58eb7a02edf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a hobby request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Hobbies API DELETE /hobbies/:id Scenario 4: Delete a hobby request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingHobby.hobby_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;084468ec-678e-46ec-83cc-17f84dd23580&quot;,&quot;parentUUID&quot;:&quot;504910ca-02a4-4f6e-90af-58eb7a02edf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;084468ec-678e-46ec-83cc-17f84dd23580&quot;],&quot;failures&quot;:[&quot;eafd85ec-44dc-4da1-ad2d-082c2bfb93d1&quot;,&quot;9a395f9b-d998-4f16-b425-29288e1f2150&quot;,&quot;8894860c-7d5b-416b-ad34-dd9fd9a61bed&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:32,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7f263613-e5c3-4d0e-a351-6473a77afa3a&quot;,&quot;title&quot;:&quot;Interests API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Interests API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Interests API \&quot;before each\&quot; hook in \&quot;Interests API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e7f5824d-58b6-496f-9c89-d507b6a3bbb5&quot;,&quot;parentUUID&quot;:&quot;7f263613-e5c3-4d0e-a351-6473a77afa3a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e3a307b2-690c-43ef-a2da-df9a471f43f4&quot;,&quot;title&quot;:&quot;GET /interests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all interests request successful&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests Scenario 1: Get all interests request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;interest_id&#x27;, &#x27;interest&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:34:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;e1ef68ec-f1c2-4c99-838b-edfe849ff4d7&quot;,&quot;parentUUID&quot;:&quot;e3a307b2-690c-43ef-a2da-df9a471f43f4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all interests request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests Scenario 2: Get all interests request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:514,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst InterestModel = require(&#x27;../../src/models/interest.model&#x27;);\nconst modelStub = sinon.stub(InterestModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty interest list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interests not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;55d07f95-e72a-4b9d-bde9-6b98f89e928f&quot;,&quot;parentUUID&quot;:&quot;e3a307b2-690c-43ef-a2da-df9a471f43f4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;e1ef68ec-f1c2-4c99-838b-edfe849ff4d7&quot;,&quot;55d07f95-e72a-4b9d-bde9-6b98f89e928f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:521,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9080fa19-51dd-424e-99c3-e7a7c3221752&quot;,&quot;title&quot;:&quot;GET /interests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a interest request successful&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests/:id Scenario 1: Get a interest request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;interest_id&#x27;, &#x27;interest&#x27;]);\nexpect(resBody.interest_id).to.be.eql(existingInterest.interest_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:70:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;ef3df6f6-93cb-422e-813a-f206a8950518&quot;,&quot;parentUUID&quot;:&quot;9080fa19-51dd-424e-99c3-e7a7c3221752&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a interest request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests/:id Scenario 2: Get a interest request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownInterestId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interest not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:84:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;ff4e4738-0093-499c-8e3d-aa516e34a14d&quot;,&quot;parentUUID&quot;:&quot;9080fa19-51dd-424e-99c3-e7a7c3221752&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a interest request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Interests API GET /interests/:id Scenario 3: Get a interest request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingInterest.interest_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aa664907-3098-4212-a18b-2f2aad8eee15&quot;,&quot;parentUUID&quot;:&quot;9080fa19-51dd-424e-99c3-e7a7c3221752&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;aa664907-3098-4212-a18b-2f2aad8eee15&quot;],&quot;failures&quot;:[&quot;ef3df6f6-93cb-422e-813a-f206a8950518&quot;,&quot;ff4e4738-0093-499c-8e3d-aa516e34a14d&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;373008fc-31e2-4269-b8ca-fafa3fa26fc3&quot;,&quot;title&quot;:&quot;POST /interests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a interest request is successful&quot;,&quot;fullTitle&quot;:&quot;Interests API POST /interests Scenario 1: Create a interest request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;interest_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.interest_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    interest_id: newId,\n    interest: interest\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:117:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;08dfe23c-ce52-4822-bc0f-fff4f5efc01c&quot;,&quot;parentUUID&quot;:&quot;373008fc-31e2-4269-b8ca-fafa3fa26fc3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a interest request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Interests API POST /interests Scenario 2: Create a interest request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    interests: interest // &lt;-- a valid parameter name should be &#x27;interest&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;interest&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;7752a137-8999-4eb1-8ac2-01d800836bfd&quot;,&quot;parentUUID&quot;:&quot;373008fc-31e2-4269-b8ca-fafa3fa26fc3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a interest request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Interests API POST /interests Scenario 3: Create a interest request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:172:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;0253b831-e118-4739-ac64-11a968cffed4&quot;,&quot;parentUUID&quot;:&quot;373008fc-31e2-4269-b8ca-fafa3fa26fc3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a interest request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Interests API POST /interests Scenario 4: Create a interest request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5643f8f7-7112-4941-9c93-c65edfb9f6fc&quot;,&quot;parentUUID&quot;:&quot;373008fc-31e2-4269-b8ca-fafa3fa26fc3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5643f8f7-7112-4941-9c93-c65edfb9f6fc&quot;],&quot;failures&quot;:[&quot;08dfe23c-ce52-4822-bc0f-fff4f5efc01c&quot;,&quot;7752a137-8999-4eb1-8ac2-01d800836bfd&quot;,&quot;0253b831-e118-4739-ac64-11a968cffed4&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:43,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;3fbaa007-dc17-4be9-a829-22651f607778&quot;,&quot;title&quot;:&quot;PATCH /interests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a interest request is successful&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 1: Update a interest request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest: newInterest };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    interest_id: existingInterest.interest_id,\n    interest: newInterest\n});\n\n// cleanup\ndata.interest = existingInterest.interest;\nres = await request(app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:210:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;a822ec20-26a8-499c-b4ca-e8350a86005a&quot;,&quot;parentUUID&quot;:&quot;3fbaa007-dc17-4be9-a829-22651f607778&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a interest request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 2: Update a interest request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest: newInterest };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownInterestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interest not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:247:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;27b09a09-a8d5-42a7-8f99-ef604f8f2b62&quot;,&quot;parentUUID&quot;:&quot;3fbaa007-dc17-4be9-a829-22651f607778&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a interest request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 3: Update a interest request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    interests: newInterest // &lt;-- a valid parameter name should be &#x27;interest&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;interest&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:266:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;d42cb367-598b-4e3d-8bd0-27d942034c76&quot;,&quot;parentUUID&quot;:&quot;3fbaa007-dc17-4be9-a829-22651f607778&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a interest request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 4: Update a interest request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest: newInterest };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:284:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;c881d49b-f9e0-4f11-888c-28d6107cf175&quot;,&quot;parentUUID&quot;:&quot;3fbaa007-dc17-4be9-a829-22651f607778&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a interest request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Interests API PATCH /interests/:id Scenario 5: Update a interest request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { interest: newInterest };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingInterest.interest_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e9bd7fa8-ae2a-4b12-b538-e8b447fe0b11&quot;,&quot;parentUUID&quot;:&quot;3fbaa007-dc17-4be9-a829-22651f607778&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e9bd7fa8-ae2a-4b12-b538-e8b447fe0b11&quot;],&quot;failures&quot;:[&quot;a822ec20-26a8-499c-b4ca-e8350a86005a&quot;,&quot;27b09a09-a8d5-42a7-8f99-ef604f8f2b62&quot;,&quot;d42cb367-598b-4e3d-8bd0-27d942034c76&quot;,&quot;c881d49b-f9e0-4f11-888c-28d6107cf175&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:46,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;2d3ddc24-1d64-454f-9fa1-2e4f07285f99&quot;,&quot;title&quot;:&quot;DELETE /interests/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\interest.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\interest.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a interest request is successful&quot;,&quot;fullTitle&quot;:&quot;Interests API DELETE /interests/:id Scenario 1: Delete a interest request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { interest };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.interest_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interest has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:320:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;66ef6b68-6cdc-455e-a680-ecfb5d680dda&quot;,&quot;parentUUID&quot;:&quot;2d3ddc24-1d64-454f-9fa1-2e4f07285f99&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a interest request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Interests API DELETE /interests/:id Scenario 2: Delete a interest request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownInterestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Interest not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:352:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;8f5a015c-99de-466d-bec7-8d59e4f374b3&quot;,&quot;parentUUID&quot;:&quot;2d3ddc24-1d64-454f-9fa1-2e4f07285f99&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a interest request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Interests API DELETE /interests/:id Scenario 3: Delete a interest request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingInterest.interest_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\interest.test.js:365:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;b1368c77-19b0-4241-9028-8dbe68f0bfe0&quot;,&quot;parentUUID&quot;:&quot;2d3ddc24-1d64-454f-9fa1-2e4f07285f99&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a interest request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Interests API DELETE /interests/:id Scenario 4: Delete a interest request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingInterest.interest_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;75681b57-84cd-405d-918f-04f93e30c590&quot;,&quot;parentUUID&quot;:&quot;2d3ddc24-1d64-454f-9fa1-2e4f07285f99&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;75681b57-84cd-405d-918f-04f93e30c590&quot;],&quot;failures&quot;:[&quot;66ef6b68-6cdc-455e-a680-ecfb5d680dda&quot;,&quot;8f5a015c-99de-466d-bec7-8d59e4f374b3&quot;,&quot;b1368c77-19b0-4241-9028-8dbe68f0bfe0&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;230d6321-d89c-4f43-b518-b93de60f0982&quot;,&quot;title&quot;:&quot;Posts API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Posts API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Posts API \&quot;before each\&quot; hook in \&quot;Posts API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0bd42ceb-5d75-495b-8822-f79dae138587&quot;,&quot;parentUUID&quot;:&quot;230d6321-d89c-4f43-b518-b93de60f0982&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7109ee40-747f-4f72-8a22-034304f30be2&quot;,&quot;title&quot;:&quot;GET /posts&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all posts request successful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 1: Get all posts request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingPost)); // contain all params\nconst examplePost = resBody[0];\nexpect(examplePost.author).to.include.all.keys(Object.keys(existingPost.author));\nexpect(examplePost.resources).to.be.an(&#x27;array&#x27;);\nexpect(examplePost.resources[0]).to.include.all.keys(Object.keys(existingPost.resources[0])); // contain all params\n\nexpect(examplePost.top_3_reactions).to.be.an(&#x27;array&#x27;);\nexpect(examplePost.top_3_reactions[0]).to.include.all.keys(Object.keys(existingPost.top_3_reactions[0])); // contain all params\n        \nconst noReactionOrResourceCheck = post =&gt; post.resources === null &amp;&amp; post.top_3_reactions === null;\nexpect(resBody.some(noReactionOrResourceCheck)).to.be.true; // match atleast one post like this&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:63:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;8a597b7a-7015-49be-a0bc-1b0b5985990e&quot;,&quot;parentUUID&quot;:&quot;7109ee40-747f-4f72-8a22-034304f30be2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all posts request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 2: Get all posts request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst author_erp = userERP;\nlet res = await request(this.app)\n    .get(`${baseRoute}?author_erp=${author_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].author).to.include.all.keys(Object.keys(existingPost.author));\nexpect(resBody[0].author.erp).to.be.equal(author_erp);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:91:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;22e3674e-f6a0-465f-9819-db7a2eb608ac&quot;,&quot;parentUUID&quot;:&quot;7109ee40-747f-4f72-8a22-034304f30be2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all posts request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 3: Get all posts request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:493,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst PostModel = require(&#x27;../../src/models/post.model&#x27;);\nconst modelStub = sinon.stub(PostModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty post list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;ac376fb6-943b-4c51-aeab-3d9d36eb7db9&quot;,&quot;parentUUID&quot;:&quot;7109ee40-747f-4f72-8a22-034304f30be2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all posts request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 4: Get all posts request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;all&#x27;; // &lt;-- invalid privacy value\nlet res = await request(this.app)\n    .get(`${baseRoute}?privacy=${privacy}&amp;week=2`) // &lt;-- `week` is an incorrect query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;privacy&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:125:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;6236cd22-b0f5-4119-9d7d-11f11937ce03&quot;,&quot;parentUUID&quot;:&quot;7109ee40-747f-4f72-8a22-034304f30be2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all posts request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts Scenario 5: Get all posts request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;eca94759-e09c-4456-9291-e0a74515d68e&quot;,&quot;parentUUID&quot;:&quot;7109ee40-747f-4f72-8a22-034304f30be2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;eca94759-e09c-4456-9291-e0a74515d68e&quot;],&quot;failures&quot;:[&quot;8a597b7a-7015-49be-a0bc-1b0b5985990e&quot;,&quot;22e3674e-f6a0-465f-9819-db7a2eb608ac&quot;,&quot;ac376fb6-943b-4c51-aeab-3d9d36eb7db9&quot;,&quot;6236cd22-b0f5-4119-9d7d-11f11937ce03&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:530,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a46a1d17-cb9c-4638-8a59-d9987a60dd02&quot;,&quot;title&quot;:&quot;GET /posts/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a post request successful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id Scenario 1: Get a post request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingPost.post_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.post_id).to.be.equal(existingPost.post_id); // should match initially sent id\nexpect(resBody).to.include.all.keys(Object.keys(existingPost)); // contain all params\nexpect(resBody.author).to.include.all.keys(Object.keys(existingPost.author));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;d4711201-94d9-4dda-bb1e-172c20281135&quot;,&quot;parentUUID&quot;:&quot;a46a1d17-cb9c-4638-8a59-d9987a60dd02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a post request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id Scenario 2: Get a post request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownPostId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:169:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;112a8950-a40a-4c4b-985d-fe51d5bcb002&quot;,&quot;parentUUID&quot;:&quot;a46a1d17-cb9c-4638-8a59-d9987a60dd02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a post request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id Scenario 3: Get a post request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingPost.post_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d2d7a14f-575f-4f83-80ba-730c0b3615c7&quot;,&quot;parentUUID&quot;:&quot;a46a1d17-cb9c-4638-8a59-d9987a60dd02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d2d7a14f-575f-4f83-80ba-730c0b3615c7&quot;],&quot;failures&quot;:[&quot;d4711201-94d9-4dda-bb1e-172c20281135&quot;,&quot;112a8950-a40a-4c4b-985d-fe51d5bcb002&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;3a84e303-3aa3-467d-9863-609d3871644b&quot;,&quot;title&quot;:&quot;GET /posts/:id/reactions&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a post&#x27;s reactions request successful&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id/reactions Scenario 1: Get a post&#x27;s reactions request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingPost.post_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys([&#x27;post_id&#x27;, &#x27;reaction_type_id&#x27;, &#x27;student_erp&#x27;, &#x27;reacted_at&#x27;]);\nexpect(resBody[0].post_id).to.be.equal(existingPost.post_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:197:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;88463e76-794a-4006-8ef4-173dd466d337&quot;,&quot;parentUUID&quot;:&quot;3a84e303-3aa3-467d-9863-609d3871644b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a post&#x27;s reactions request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id/reactions Scenario 2: Get a post&#x27;s reactions request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownPostId}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:212:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;a3e60cf4-ab3c-4ca3-a430-6650e85f710f&quot;,&quot;parentUUID&quot;:&quot;3a84e303-3aa3-467d-9863-609d3871644b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a post&#x27;s reactions request is unsuccessful due to zero reactions&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id/reactions Scenario 3: Get a post&#x27;s reactions request is unsuccessful due to zero reactions&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:538,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst PostModel = require(&#x27;../../src/models/post.model&#x27;);\nconst modelStub = sinon.stub(PostModel, &#x27;findAllReactionsByPost&#x27;).callsFake(() =&gt; []); // return empty post reactions list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingPost.post_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;34feaa3c-a7ca-445e-8a62-bdf84b9a3c22&quot;,&quot;parentUUID&quot;:&quot;3a84e303-3aa3-467d-9863-609d3871644b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a post&#x27;s reactions is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API GET /posts/:id/reactions Scenario 4: Get a post&#x27;s reactions is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingPost.post_id}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7d30dfe3-a96a-4143-a65a-8d695d9465e5&quot;,&quot;parentUUID&quot;:&quot;3a84e303-3aa3-467d-9863-609d3871644b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7d30dfe3-a96a-4143-a65a-8d695d9465e5&quot;],&quot;failures&quot;:[&quot;88463e76-794a-4006-8ef4-173dd466d337&quot;,&quot;a3e60cf4-ab3c-4ca3-a430-6650e85f710f&quot;,&quot;34feaa3c-a7ca-445e-8a62-bdf84b9a3c22&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:563,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;846c1e2c-5993-43ff-ab5a-a1d327bae0c0&quot;,&quot;title&quot;:&quot;POST /posts&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a post request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Posts API POST /posts Scenario 1: Create a post request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newPost.author_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;post_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// affirm\nconst newId = res.body.body.post_id;\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nconst resBody = res.body.body;\nresBody.resources = resBody.resources.map(resource =&gt; (\n    {\n        resource_url: resource.resource_url,\n        resource_type: resource.resource_type\n    }\n));\nexpect(resBody.author.erp).to.be.equal(data.author_erp);\ndelete resBody.author;\ndelete data.author_erp;\nexpect(resBody).to.be.eql({\n    post_id: newId,\n    top_3_reactions: null,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:266:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;540a0827-f2eb-4fe2-b9d6-be3ff00a05e0&quot;,&quot;parentUUID&quot;:&quot;846c1e2c-5993-43ff-ab5a-a1d327bae0c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a post request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Posts API POST /posts Scenario 2: Create a post request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst {resources, ...post} = newPost;\nconst data = {\n    ...post,\n    resourcessfd: resources // &lt;-- a valid param is &#x27;resources&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newPost.author_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;resources&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:318:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;64f4f9de-925b-41dd-8e01-23da05775bcb&quot;,&quot;parentUUID&quot;:&quot;846c1e2c-5993-43ff-ab5a-a1d327bae0c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a post request is forbidden (Unowned Author ERP)&quot;,&quot;fullTitle&quot;:&quot;Posts API POST /posts Scenario 3: Create a post request is forbidden (Unowned Author ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\ndata.author_erp = adminERP; // &lt;-- can be any other non-admin ERP as well, just different from userToken erp\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t create others posts i.e. token erp != newPost.author_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:337:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;cb65eb49-c372-4799-a608-195ba9b6ccc0&quot;,&quot;parentUUID&quot;:&quot;846c1e2c-5993-43ff-ab5a-a1d327bae0c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a post request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API POST /posts Scenario 4: Create a post request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d65deea8-ac17-46c8-a09d-1b5a31c0c7af&quot;,&quot;parentUUID&quot;:&quot;846c1e2c-5993-43ff-ab5a-a1d327bae0c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d65deea8-ac17-46c8-a09d-1b5a31c0c7af&quot;],&quot;failures&quot;:[&quot;540a0827-f2eb-4fe2-b9d6-be3ff00a05e0&quot;,&quot;64f4f9de-925b-41dd-8e01-23da05775bcb&quot;,&quot;cb65eb49-c372-4799-a608-195ba9b6ccc0&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;36fcde94-b1eb-42dc-98e8-70628a418a85&quot;,&quot;title&quot;:&quot;PATCH /posts/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a post request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 1: Update a post request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { body: updatedPostBody };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingPost.post_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingPost.author_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingPost.post_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.body).to.be.equal(updatedPostBody);\n\n// cleanup\ndata.body = existingPost.body;\nres = await request(app)\n    .patch(`${baseRoute}/${existingPost.post_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:375:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;f988eb3d-cb6c-41fc-979a-8086c693643a&quot;,&quot;parentUUID&quot;:&quot;36fcde94-b1eb-42dc-98e8-70628a418a85&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a post request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 2: Update a post request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { body: updatedPostBody };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownPostId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:408:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;71e330e7-5d8d-40f3-9090-f644d62da198&quot;,&quot;parentUUID&quot;:&quot;36fcde94-b1eb-42dc-98e8-70628a418a85&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a post request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 3: Update a post request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    bodysds: updatedPostBody, // &lt;-- an valid parameter name should be &#x27;body&#x27;\n    privacy: \&quot;all\&quot; // &lt;-- an invalid &#x27;privacy&#x27; value\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingPost.post_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;privacy&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:428:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;74ae3e24-be02-43c2-98b6-9db97a983133&quot;,&quot;parentUUID&quot;:&quot;36fcde94-b1eb-42dc-98e8-70628a418a85&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a post request is forbidden (Unowned Author ERP)&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 4: Update a post request is forbidden (Unowned Author ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { body: updatedPostBody };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedPostId}`) // &lt;-- has a different author_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others posts i.e. token erp != unOwnedPost.author_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:448:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;725b3020-7886-4cce-ad73-f8e5832b67e8&quot;,&quot;parentUUID&quot;:&quot;36fcde94-b1eb-42dc-98e8-70628a418a85&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a post request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API PATCH /posts/:id Scenario 5: Update a post request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { body: updatedPostBody };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingPost.post_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3ac9d500-b1e4-41d3-9210-df36d2c69ab3&quot;,&quot;parentUUID&quot;:&quot;36fcde94-b1eb-42dc-98e8-70628a418a85&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3ac9d500-b1e4-41d3-9210-df36d2c69ab3&quot;],&quot;failures&quot;:[&quot;f988eb3d-cb6c-41fc-979a-8086c693643a&quot;,&quot;71e330e7-5d8d-40f3-9090-f644d62da198&quot;,&quot;74ae3e24-be02-43c2-98b6-9db97a983133&quot;,&quot;725b3020-7886-4cce-ad73-f8e5832b67e8&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:40,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9373d3dd-b3ac-4c92-880b-26bd545990dc&quot;,&quot;title&quot;:&quot;DELETE /posts/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\post.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\post.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a post request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 1: Delete a post request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.post_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // using his own token i.e. token erp == newPost.author_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:489:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;e90d0c06-925b-473b-bf35-b5b775de6f20&quot;,&quot;parentUUID&quot;:&quot;9373d3dd-b3ac-4c92-880b-26bd545990dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a post request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 2: Delete a post request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPost };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.post_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // admin can delete other&#x27;s posts even if token erp != newPost.author_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:524:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;80079d6b-4985-45c8-8deb-11c3b81b6791&quot;,&quot;parentUUID&quot;:&quot;9373d3dd-b3ac-4c92-880b-26bd545990dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a post request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 3: Delete a post request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownPostId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:556:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;9dbff104-25e0-4be3-bc2f-197ee5734f35&quot;,&quot;parentUUID&quot;:&quot;9373d3dd-b3ac-4c92-880b-26bd545990dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a post request is forbidden (Unowned Author ERP)&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 4: Delete a post request is forbidden (Unowned Author ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unOwnedPostId}`) // &lt;-- has a different author_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user can&#x27;t delete others posts i.e. token erp != unOwnedPost.author_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\post.test.js:569:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;be06fd53-5505-4f22-80e0-f6d333cfab44&quot;,&quot;parentUUID&quot;:&quot;9373d3dd-b3ac-4c92-880b-26bd545990dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a post request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Posts API DELETE /posts/:id Scenario 5: Delete a post request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingPost.post_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dab32758-6d29-4570-9412-a784c9cd794e&quot;,&quot;parentUUID&quot;:&quot;9373d3dd-b3ac-4c92-880b-26bd545990dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;dab32758-6d29-4570-9412-a784c9cd794e&quot;],&quot;failures&quot;:[&quot;e90d0c06-925b-473b-bf35-b5b775de6f20&quot;,&quot;80079d6b-4985-45c8-8deb-11c3b81b6791&quot;,&quot;9dbff104-25e0-4be3-bc2f-197ee5734f35&quot;,&quot;be06fd53-5505-4f22-80e0-f6d333cfab44&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:43,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6691c9b5-1f00-474f-a33b-b4d878061ef3&quot;,&quot;title&quot;:&quot;Post Reactions API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\postReaction.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\postReaction.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Post Reactions API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API \&quot;before each\&quot; hook in \&quot;Post Reactions API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e6c5838f-08e4-4cb6-8d41-be0c096a3ee6&quot;,&quot;parentUUID&quot;:&quot;6691c9b5-1f00-474f-a33b-b4d878061ef3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7107c633-507a-49e2-9237-70b808b66a4d&quot;,&quot;title&quot;:&quot;POST /posts/:id/reactions&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\postReaction.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\postReaction.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a post reaction request is successful&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 1: Create a post reaction request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkStudentERP = reaction =&gt; reaction.student_erp === data.student_erp;\nexpect(res.body.body.some(checkStudentERP)).to.be.true;\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:44:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;42f14afe-6523-4f66-b92c-e09c503faa66&quot;,&quot;parentUUID&quot;:&quot;7107c633-507a-49e2-9237-70b808b66a4d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a post reaction request is unsuccessful due to unknown post id&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 2: Create a post reaction request is unsuccessful due to unknown post id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${unknownPostId}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;post_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:76:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;4351ab64-af11-4eaf-b484-4b6d458e8dcd&quot;,&quot;parentUUID&quot;:&quot;7107c633-507a-49e2-9237-70b808b66a4d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a post reaction request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 3: Create a post reaction request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\ndata.reaction_type_id = &#x27;not going&#x27;; // &lt;-- not a valid reaction_type_id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;reaction_type_id&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:94:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;fdd7b827-7b03-4c61-85de-7dcc51d5ba69&quot;,&quot;parentUUID&quot;:&quot;7107c633-507a-49e2-9237-70b808b66a4d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a post reaction request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 4: Create a post reaction request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\ndata.student_erp = adminERP; // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:113:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;39a9657f-558f-40b2-ae44-cbe70c1024ab&quot;,&quot;parentUUID&quot;:&quot;7107c633-507a-49e2-9237-70b808b66a4d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a post reaction request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API POST /posts/:id/reactions Scenario 5: Create a post reaction request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newPostReaction };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;22a7b541-eedd-43f4-95af-e0c6226b783b&quot;,&quot;parentUUID&quot;:&quot;7107c633-507a-49e2-9237-70b808b66a4d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;22a7b541-eedd-43f4-95af-e0c6226b783b&quot;],&quot;failures&quot;:[&quot;42f14afe-6523-4f66-b92c-e09c503faa66&quot;,&quot;4351ab64-af11-4eaf-b484-4b6d458e8dcd&quot;,&quot;fdd7b827-7b03-4c61-85de-7dcc51d5ba69&quot;,&quot;39a9657f-558f-40b2-ae44-cbe70c1024ab&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:38,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;857d0cca-0afb-41f3-ad33-6fd750d91adf&quot;,&quot;title&quot;:&quot;PATCH /posts/:id/reactions/:student_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\postReaction.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\postReaction.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a post reaction request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 1: Update a post reaction request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type_id, reacted_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- userToken.erp == student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${post_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkStudentERP = reaction =&gt; reaction.student_erp === student_erp;\nconst reaction = res.body.body.filter(checkStudentERP)[0];\nexpect(reaction).to.be.eql({\n    post_id,\n    student_erp,\n    ...data\n});\n// cleanup\ndata.reaction_type_id = existingPostReaction.reaction_type_id;\ndata.reacted_at = existingPostReaction.reacted_at;\nres = await request(app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;ee8030c4-b313-4e99-aa56-c0a11498b871&quot;,&quot;parentUUID&quot;:&quot;857d0cca-0afb-41f3-ad33-6fd750d91adf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a post reaction request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 2: Update a post reaction request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type_id, reacted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownPostId}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:194:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;b91d57c5-89eb-4a26-8029-d21fa679270a&quot;,&quot;parentUUID&quot;:&quot;857d0cca-0afb-41f3-ad33-6fd750d91adf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a post reaction request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 3: Update a post reaction request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { // missing reqd parameter reacted_at\n    reaction_type_id: &#x27;not going&#x27;, // &lt;-- not a valid reaction_type_id\n    erp: &#x27;12345&#x27; // &lt;-- an invalid update parameter i.e. not allowed\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;reaction_type_id&#x27;, &#x27;reacted_at&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include.members([&#x27;Invalid updates!&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:214:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;d3ac8732-e94b-4f8e-bae1-44772a5e5c83&quot;,&quot;parentUUID&quot;:&quot;857d0cca-0afb-41f3-ad33-6fd750d91adf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a post reaction request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 4: Update a post reaction request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type_id, reacted_at };\nconst user2ERP = &#x27;17619&#x27;;\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${user2ERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user2ERP != userToken.erp, can be any other different erp as well\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:235:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;e3909fc7-3220-4258-bc38-ea2d1ea0db11&quot;,&quot;parentUUID&quot;:&quot;857d0cca-0afb-41f3-ad33-6fd750d91adf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a post reaction request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API PATCH /posts/:id/reactions/:student_erp Scenario 5: Update a post reaction request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type_id, reacted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${post_id}/${subRoute}/${student_erp}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;deb50b31-9cd5-4a70-9095-498a78cfda59&quot;,&quot;parentUUID&quot;:&quot;857d0cca-0afb-41f3-ad33-6fd750d91adf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;deb50b31-9cd5-4a70-9095-498a78cfda59&quot;],&quot;failures&quot;:[&quot;ee8030c4-b313-4e99-aa56-c0a11498b871&quot;,&quot;b91d57c5-89eb-4a26-8029-d21fa679270a&quot;,&quot;d3ac8732-e94b-4f8e-bae1-44772a5e5c83&quot;,&quot;e3909fc7-3220-4258-bc38-ea2d1ea0db11&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d0c5a65a-4f0d-4d87-ab44-8e7ea6f903c0&quot;,&quot;title&quot;:&quot;DELETE /posts/:id/reactions/:student_erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\postReaction.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\postReaction.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a post reaction request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 1: Delete a post reaction request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { ...newPostReaction };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp == data.student_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:271:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;b2e95cff-10f5-4a64-9da1-021df420dd10&quot;,&quot;parentUUID&quot;:&quot;d0c5a65a-4f0d-4d87-ab44-8e7ea6f903c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a post reaction request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 2: Delete a post reaction request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { ...newPostReaction };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${postIdWithoutReactions}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp != data.student_erp but still bypass\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .delete(`${baseRoute}/${postIdWithoutReactions}/${subRoute}/${data.student_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:306:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;3fe0bc5b-6cb4-4bb3-96c9-d3697e3319b0&quot;,&quot;parentUUID&quot;:&quot;d0c5a65a-4f0d-4d87-ab44-8e7ea6f903c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a post reaction request is unsuccessful due to unknown post_id&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 3: Delete a post reaction request is unsuccessful due to unknown post_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownPostId}/${subRoute}/${newPostReaction.student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:338:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;f8733a35-6840-4402-b429-231df4b7533b&quot;,&quot;parentUUID&quot;:&quot;d0c5a65a-4f0d-4d87-ab44-8e7ea6f903c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a post reaction request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 4: Delete a post reaction request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingPostReaction.post_id}/${subRoute}/${unknownStudentERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Post reaction not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:351:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;0dccff77-373f-4e99-890d-2aa69ceda3d7&quot;,&quot;parentUUID&quot;:&quot;d0c5a65a-4f0d-4d87-ab44-8e7ea6f903c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a post reaction request is forbidden (Unowned Post Reaction)&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 5: Delete a post reaction request is forbidden (Unowned Post Reaction)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst user2ERP = &#x27;17619&#x27;;\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingPostReaction.post_id}/${subRoute}/${user2ERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user2ERP != userToken.erp, can be any other different erp as well\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\postReaction.test.js:367:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;8c49705e-fcf1-4c1e-b1f6-a56699447c29&quot;,&quot;parentUUID&quot;:&quot;d0c5a65a-4f0d-4d87-ab44-8e7ea6f903c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Delete a post reaction request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Post Reactions API DELETE /posts/:id/reactions/:student_erp Scenario 6: Delete a post reaction request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingPostReaction.post_id}/${subRoute}/${existingPostReaction.student_erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;46c5be59-34c4-4c7e-9c7b-6feafda76a02&quot;,&quot;parentUUID&quot;:&quot;d0c5a65a-4f0d-4d87-ab44-8e7ea6f903c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;46c5be59-34c4-4c7e-9c7b-6feafda76a02&quot;],&quot;failures&quot;:[&quot;b2e95cff-10f5-4a64-9da1-021df420dd10&quot;,&quot;3fe0bc5b-6cb4-4bb3-96c9-d3697e3319b0&quot;,&quot;f8733a35-6840-4402-b429-231df4b7533b&quot;,&quot;0dccff77-373f-4e99-890d-2aa69ceda3d7&quot;,&quot;8c49705e-fcf1-4c1e-b1f6-a56699447c29&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;30f2b214-0150-4f8b-a575-3716b26a747e&quot;,&quot;title&quot;:&quot;Programs API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Programs API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Programs API \&quot;before each\&quot; hook in \&quot;Programs API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;122db16d-63b9-4d24-8767-4879b9429467&quot;,&quot;parentUUID&quot;:&quot;30f2b214-0150-4f8b-a575-3716b26a747e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4a7eb947-1c1c-41e6-9344-1dda09556042&quot;,&quot;title&quot;:&quot;GET /programs&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all programs request successful&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs Scenario 1: Get all programs request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;program_id&#x27;, &#x27;program&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:34:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;283998f0-0da7-4c41-bb29-3dae800f2f01&quot;,&quot;parentUUID&quot;:&quot;4a7eb947-1c1c-41e6-9344-1dda09556042&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all programs request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs Scenario 2: Get all programs request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:534,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ProgramModel = require(&#x27;../../src/models/program.model&#x27;);\nconst modelStub = sinon.stub(ProgramModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty program list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Programs not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;95a903e9-facf-4ce9-a61c-34c26151caab&quot;,&quot;parentUUID&quot;:&quot;4a7eb947-1c1c-41e6-9344-1dda09556042&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;283998f0-0da7-4c41-bb29-3dae800f2f01&quot;,&quot;95a903e9-facf-4ce9-a61c-34c26151caab&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:542,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;2306dbfe-debb-4f0a-8d31-82cecec085b8&quot;,&quot;title&quot;:&quot;GET /programs/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a program request successful&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs/:id Scenario 1: Get a program request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;program_id&#x27;, &#x27;program&#x27;]);\nexpect(resBody.program_id).to.be.eql(existingProgram.program_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:69:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;0072d18e-7327-4018-893f-145d9bfc1e73&quot;,&quot;parentUUID&quot;:&quot;2306dbfe-debb-4f0a-8d31-82cecec085b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a program request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs/:id Scenario 2: Get a program request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownProgramId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Program not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:83:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;a62f3e36-958b-4509-8882-7c59e8470cd5&quot;,&quot;parentUUID&quot;:&quot;2306dbfe-debb-4f0a-8d31-82cecec085b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a program request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Programs API GET /programs/:id Scenario 3: Get a program request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingProgram.program_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dce5d2e3-4502-4b77-b575-8bdc224fdae0&quot;,&quot;parentUUID&quot;:&quot;2306dbfe-debb-4f0a-8d31-82cecec085b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;dce5d2e3-4502-4b77-b575-8bdc224fdae0&quot;],&quot;failures&quot;:[&quot;0072d18e-7327-4018-893f-145d9bfc1e73&quot;,&quot;a62f3e36-958b-4509-8882-7c59e8470cd5&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:25,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ecc870ab-8c6f-473a-88a0-70c0c2ab4a1b&quot;,&quot;title&quot;:&quot;POST /programs&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a program request is successful&quot;,&quot;fullTitle&quot;:&quot;Programs API POST /programs Scenario 1: Create a program request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;program_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.program_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    program_id: newId,\n    program: program\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:116:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;a4e7141a-081d-4e65-bc31-fddcbca92859&quot;,&quot;parentUUID&quot;:&quot;ecc870ab-8c6f-473a-88a0-70c0c2ab4a1b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a program request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Programs API POST /programs Scenario 2: Create a program request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    programs: program // &lt;-- a valid parameter name should be &#x27;program&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;program&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:153:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;f40a544d-e253-4a11-b048-1e307f3f97f9&quot;,&quot;parentUUID&quot;:&quot;ecc870ab-8c6f-473a-88a0-70c0c2ab4a1b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a program request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Programs API POST /programs Scenario 3: Create a program request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:171:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;27c900c6-64c1-4029-945b-0db03e4f86c3&quot;,&quot;parentUUID&quot;:&quot;ecc870ab-8c6f-473a-88a0-70c0c2ab4a1b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a program request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Programs API POST /programs Scenario 4: Create a program request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d120a224-8442-4517-802f-a98107ea6085&quot;,&quot;parentUUID&quot;:&quot;ecc870ab-8c6f-473a-88a0-70c0c2ab4a1b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d120a224-8442-4517-802f-a98107ea6085&quot;],&quot;failures&quot;:[&quot;a4e7141a-081d-4e65-bc31-fddcbca92859&quot;,&quot;f40a544d-e253-4a11-b048-1e307f3f97f9&quot;,&quot;27c900c6-64c1-4029-945b-0db03e4f86c3&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:44,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;707bca8d-8a68-46be-bbd7-abe59aa0c3c8&quot;,&quot;title&quot;:&quot;PATCH /programs/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a program request is successful&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 1: Update a program request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program: newProgram };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    program_id: existingProgram.program_id,\n    program: newProgram\n});\n\n// cleanup\ndata.program = existingProgram.program;\nres = await request(app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:209:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;b31ec45e-3ee1-4a50-89ff-aaa5c05849b3&quot;,&quot;parentUUID&quot;:&quot;707bca8d-8a68-46be-bbd7-abe59aa0c3c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a program request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 2: Update a program request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program: newProgram };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownProgramId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Program not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:246:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;d77dbbac-d2c1-4acf-926b-61e54977da2f&quot;,&quot;parentUUID&quot;:&quot;707bca8d-8a68-46be-bbd7-abe59aa0c3c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a program request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 3: Update a program request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    programs: newProgram // &lt;-- a valid parameter name should be &#x27;program&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;program&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:265:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;c1741bbc-8af1-46af-8f41-5eff3c1f5173&quot;,&quot;parentUUID&quot;:&quot;707bca8d-8a68-46be-bbd7-abe59aa0c3c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a program request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 4: Update a program request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program: newProgram };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:283:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;bd38678e-209e-4d12-ae2f-71048ce2e54b&quot;,&quot;parentUUID&quot;:&quot;707bca8d-8a68-46be-bbd7-abe59aa0c3c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a program request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Programs API PATCH /programs/:id Scenario 5: Update a program request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { program: newProgram };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingProgram.program_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f8dc34d9-c356-4f76-b782-780c01a38f30&quot;,&quot;parentUUID&quot;:&quot;707bca8d-8a68-46be-bbd7-abe59aa0c3c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f8dc34d9-c356-4f76-b782-780c01a38f30&quot;],&quot;failures&quot;:[&quot;b31ec45e-3ee1-4a50-89ff-aaa5c05849b3&quot;,&quot;d77dbbac-d2c1-4acf-926b-61e54977da2f&quot;,&quot;c1741bbc-8af1-46af-8f41-5eff3c1f5173&quot;,&quot;bd38678e-209e-4d12-ae2f-71048ce2e54b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:46,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;bee9475f-683f-4c35-90ad-bcdc91fa05d1&quot;,&quot;title&quot;:&quot;DELETE /programs/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\program.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\program.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a program request is successful&quot;,&quot;fullTitle&quot;:&quot;Programs API DELETE /programs/:id Scenario 1: Delete a program request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { program };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.program_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Program has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:319:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;4c839766-23d6-4e18-8f69-e01951101814&quot;,&quot;parentUUID&quot;:&quot;bee9475f-683f-4c35-90ad-bcdc91fa05d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a program request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Programs API DELETE /programs/:id Scenario 2: Delete a program request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownProgramId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Program not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:351:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;17b10f20-ec43-4e2d-9c04-8b7c325157ec&quot;,&quot;parentUUID&quot;:&quot;bee9475f-683f-4c35-90ad-bcdc91fa05d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a program request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Programs API DELETE /programs/:id Scenario 3: Delete a program request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingProgram.program_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\program.test.js:364:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;f1caa5fb-d1af-4bb6-889c-aaadccf233a1&quot;,&quot;parentUUID&quot;:&quot;bee9475f-683f-4c35-90ad-bcdc91fa05d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a program request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Programs API DELETE /programs/:id Scenario 4: Delete a program request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingProgram.program_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;98c4a2b7-fc89-4974-a6a2-8f441fd95bc2&quot;,&quot;parentUUID&quot;:&quot;bee9475f-683f-4c35-90ad-bcdc91fa05d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;98c4a2b7-fc89-4974-a6a2-8f441fd95bc2&quot;],&quot;failures&quot;:[&quot;4c839766-23d6-4e18-8f69-e01951101814&quot;,&quot;17b10f20-ec43-4e2d-9c04-8b7c325157ec&quot;,&quot;f1caa5fb-d1af-4bb6-889c-aaadccf233a1&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;25f93e18-01ba-43c6-9ac7-c445e21638e8&quot;,&quot;title&quot;:&quot;Reaction Types API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Reaction Types API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API \&quot;before each\&quot; hook in \&quot;Reaction Types API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f90e9f45-a5a6-4e0a-9fee-76e9d7d2e757&quot;,&quot;parentUUID&quot;:&quot;25f93e18-01ba-43c6-9ac7-c445e21638e8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b65d6726-ee02-45e7-a6e0-55097b0a54dd&quot;,&quot;title&quot;:&quot;GET /reaction-types&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all reaction types request successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types Scenario 1: Get all reaction types request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys([&#x27;reaction_type_id&#x27;, &#x27;reaction_type&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:34:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;24e8067f-d224-4684-b2c4-dfbf8aa9ef0b&quot;,&quot;parentUUID&quot;:&quot;b65d6726-ee02-45e7-a6e0-55097b0a54dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all reaction types request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types Scenario 2: Get all reaction types request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:523,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst ReactionTypeModel = require(&#x27;../../src/models/reactionType.model&#x27;);\nconst modelStub = sinon.stub(ReactionTypeModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty reaction_type list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction types not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;540caa1a-dd5d-46b7-819a-8e378482b256&quot;,&quot;parentUUID&quot;:&quot;b65d6726-ee02-45e7-a6e0-55097b0a54dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;24e8067f-d224-4684-b2c4-dfbf8aa9ef0b&quot;,&quot;540caa1a-dd5d-46b7-819a-8e378482b256&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:532,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;542c8e83-2766-4870-9caf-19b71b213ed1&quot;,&quot;title&quot;:&quot;GET /reaction-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a reaction type request successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types/:id Scenario 1: Get a reaction type request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys([&#x27;reaction_type_id&#x27;, &#x27;reaction_type&#x27;]);\nexpect(resBody.reaction_type_id).to.be.equal(existingReactionType.reaction_type_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:70:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;ef63776f-c5c6-4a5e-be93-8445799bcd05&quot;,&quot;parentUUID&quot;:&quot;542c8e83-2766-4870-9caf-19b71b213ed1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a reaction type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types/:id Scenario 2: Get a reaction type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownReactionTypeId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction type not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:84:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;ae39fa0b-2f4a-4eb7-bf76-09ecf75512c2&quot;,&quot;parentUUID&quot;:&quot;542c8e83-2766-4870-9caf-19b71b213ed1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a reaction type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API GET /reaction-types/:id Scenario 3: Get a reaction type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingReactionType.reaction_type_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2471cb43-5579-4506-ae7c-1d10cbaf73de&quot;,&quot;parentUUID&quot;:&quot;542c8e83-2766-4870-9caf-19b71b213ed1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2471cb43-5579-4506-ae7c-1d10cbaf73de&quot;],&quot;failures&quot;:[&quot;ef63776f-c5c6-4a5e-be93-8445799bcd05&quot;,&quot;ae39fa0b-2f4a-4eb7-bf76-09ecf75512c2&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1feb728b-bf51-4151-b3b4-b99ce6f10559&quot;,&quot;title&quot;:&quot;POST /reaction-types&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a reaction type request is successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API POST /reaction-types Scenario 1: Create a reaction type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;reaction_type_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.reaction_type_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    reaction_type_id: newId,\n    reaction_type: reaction_type\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:117:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;a301f786-e5de-407e-96aa-4df4236c72b3&quot;,&quot;parentUUID&quot;:&quot;1feb728b-bf51-4151-b3b4-b99ce6f10559&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a reaction type request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API POST /reaction-types Scenario 2: Create a reaction type request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    reaction_types: reaction_type // &lt;-- a valid parameter name should be &#x27;reaction_type&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;reaction_type&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;d952979f-a54c-447c-ba93-9578accf4cde&quot;,&quot;parentUUID&quot;:&quot;1feb728b-bf51-4151-b3b4-b99ce6f10559&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a reaction type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API POST /reaction-types Scenario 3: Create a reaction type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:172:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;205f6899-4dd2-40b5-b3bb-069194461144&quot;,&quot;parentUUID&quot;:&quot;1feb728b-bf51-4151-b3b4-b99ce6f10559&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a reaction type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API POST /reaction-types Scenario 4: Create a reaction type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;692f9a7d-b851-4d50-bade-e1fe3bdd140e&quot;,&quot;parentUUID&quot;:&quot;1feb728b-bf51-4151-b3b4-b99ce6f10559&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;692f9a7d-b851-4d50-bade-e1fe3bdd140e&quot;],&quot;failures&quot;:[&quot;a301f786-e5de-407e-96aa-4df4236c72b3&quot;,&quot;d952979f-a54c-447c-ba93-9578accf4cde&quot;,&quot;205f6899-4dd2-40b5-b3bb-069194461144&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;e885e81c-e6ae-4924-bdbb-9679d7546b97&quot;,&quot;title&quot;:&quot;PATCH /reaction-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a reaction type request is successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 1: Update a reaction type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type: newReactionType };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    reaction_type_id: existingReactionType.reaction_type_id,\n    reaction_type: newReactionType\n});\n\n// cleanup\ndata.reaction_type = existingReactionType.reaction_type;\nres = await request(app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:210:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;d306588a-53d9-48cb-91d4-ad4247cecb1e&quot;,&quot;parentUUID&quot;:&quot;e885e81c-e6ae-4924-bdbb-9679d7546b97&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a reaction type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 2: Update a reaction type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type: newReactionType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownReactionTypeId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction type not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:246:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;c5ade230-be1e-4619-9b6b-034e183719a6&quot;,&quot;parentUUID&quot;:&quot;e885e81c-e6ae-4924-bdbb-9679d7546b97&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a reaction type request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 3: Update a reaction type request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    reaction_types: newReactionType // &lt;-- a valid parameter name should be &#x27;reaction_type&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;reaction_type&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:265:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;8c2b42f7-e78b-4413-ab76-a256fe38650c&quot;,&quot;parentUUID&quot;:&quot;e885e81c-e6ae-4924-bdbb-9679d7546b97&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a reaction type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 4: Update a reaction type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type: newReactionType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:283:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;86680a44-949c-4326-a8b3-a44fe39ca794&quot;,&quot;parentUUID&quot;:&quot;e885e81c-e6ae-4924-bdbb-9679d7546b97&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a reaction type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API PATCH /reaction-types/:id Scenario 5: Update a reaction type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { reaction_type: newReactionType };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;78a8e49f-cf9a-49d7-b7a7-49dddba45993&quot;,&quot;parentUUID&quot;:&quot;e885e81c-e6ae-4924-bdbb-9679d7546b97&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;78a8e49f-cf9a-49d7-b7a7-49dddba45993&quot;],&quot;failures&quot;:[&quot;d306588a-53d9-48cb-91d4-ad4247cecb1e&quot;,&quot;c5ade230-be1e-4619-9b6b-034e183719a6&quot;,&quot;8c2b42f7-e78b-4413-ab76-a256fe38650c&quot;,&quot;86680a44-949c-4326-a8b3-a44fe39ca794&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f2b94ff3-513a-49f2-baa7-e2c1920758ce&quot;,&quot;title&quot;:&quot;DELETE /reaction-types/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\reactionType.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\reactionType.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a reaction type request is successful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API DELETE /reaction-types/:id Scenario 1: Delete a reaction type request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { reaction_type };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.reaction_type_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction type has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:319:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;44190901-bc4c-4f57-9ccc-09c8d28c56f0&quot;,&quot;parentUUID&quot;:&quot;f2b94ff3-513a-49f2-baa7-e2c1920758ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a reaction type request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API DELETE /reaction-types/:id Scenario 2: Delete a reaction type request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownReactionTypeId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Reaction type not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:351:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;438b4b74-cbed-4d31-b8ba-095b6e6116bb&quot;,&quot;parentUUID&quot;:&quot;f2b94ff3-513a-49f2-baa7-e2c1920758ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a reaction type request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API DELETE /reaction-types/:id Scenario 3: Delete a reaction type request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingReactionType.reaction_type_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\reactionType.test.js:364:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;84ca7abb-9691-4758-a299-5e607d2e591a&quot;,&quot;parentUUID&quot;:&quot;f2b94ff3-513a-49f2-baa7-e2c1920758ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a reaction type request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Reaction Types API DELETE /reaction-types/:id Scenario 4: Delete a reaction type request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingReactionType.reaction_type_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5652f0bf-12ea-411a-9af9-5a0994061e96&quot;,&quot;parentUUID&quot;:&quot;f2b94ff3-513a-49f2-baa7-e2c1920758ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5652f0bf-12ea-411a-9af9-5a0994061e96&quot;],&quot;failures&quot;:[&quot;44190901-bc4c-4f57-9ccc-09c8d28c56f0&quot;,&quot;438b4b74-cbed-4d31-b8ba-095b6e6116bb&quot;,&quot;84ca7abb-9691-4758-a299-5e607d2e591a&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:28,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;deb4e045-f586-4506-a834-80eeb344328f&quot;,&quot;title&quot;:&quot;Saved Activities API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\savedActivity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\savedActivity.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Saved Activities API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API \&quot;before each\&quot; hook in \&quot;Saved Activities API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9b1c5b01-f9ee-4ec3-abf9-2329279e7cb2&quot;,&quot;parentUUID&quot;:&quot;deb4e045-f586-4506-a834-80eeb344328f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a501e3c8-d349-42fc-aa21-450076d3d681&quot;,&quot;title&quot;:&quot;POST /students/:erp/saved-activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\savedActivity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\savedActivity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a saved activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 1: Create a saved activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: unSavedActivityId, saved_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${userERP}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${userERP}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkActivityId = activity =&gt; activity.activity_id === data.activity_id;\nexpect(res.body.body.some(checkActivityId)).to.be.true;\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${userERP}/${subRoute}/${data.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:45:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;714772ff-952a-4c18-b7e7-ea410a57eeb0&quot;,&quot;parentUUID&quot;:&quot;a501e3c8-d349-42fc-aa21-450076d3d681&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 1: Create a saved activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 1: Create a saved activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: savedActivityId, saved_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst checkActivityId = activity =&gt; activity.activity_id === data.activity_id;\nexpect(res.body.body.some(checkActivityId)).to.be.true;\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}/${data.activity_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:78:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;1831802c-66fc-4380-b516-588c7b506d84&quot;,&quot;parentUUID&quot;:&quot;a501e3c8-d349-42fc-aa21-450076d3d681&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a saved activity request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 2: Create a saved activity request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: savedActivityId, saved_at };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${unknownStudentERP}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;student_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:110:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;f28808d9-aae5-48b6-8943-db11e52d96e5&quot;,&quot;parentUUID&quot;:&quot;a501e3c8-d349-42fc-aa21-450076d3d681&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a saved activity request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 3: Create a saved activity request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: unknownActivityId, saved_at }; // &lt;-- Non-existent activity_id\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;activity_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:127:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;b06b8d43-6486-4104-ad56-8103d12330d5&quot;,&quot;parentUUID&quot;:&quot;a501e3c8-d349-42fc-aa21-450076d3d681&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a saved activity request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 4: Create a saved activity request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    id: 1, // &lt;-- a valid parameter name should be &#x27;activity_id&#x27;\n    saved_at: &#x27;not going&#x27; // &lt;-- not a valid saved_at\n};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;saved_at&#x27;, &#x27;activity_id&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:147:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;a0def80f-fafa-475e-b514-37e352b0c1ec&quot;,&quot;parentUUID&quot;:&quot;a501e3c8-d349-42fc-aa21-450076d3d681&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a saved activity request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 5: Create a saved activity request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: savedActivityId, saved_at };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${adminERP}/${subRoute}`) // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:165:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;2da4f882-a171-408f-b27d-7f20010cefe6&quot;,&quot;parentUUID&quot;:&quot;a501e3c8-d349-42fc-aa21-450076d3d681&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a saved activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API POST /students/:erp/saved-activities Scenario 6: Create a saved activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { activity_id: savedActivityId, saved_at };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a4d3ec78-e7d0-45fd-8b25-547d8ea40aa6&quot;,&quot;parentUUID&quot;:&quot;a501e3c8-d349-42fc-aa21-450076d3d681&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a4d3ec78-e7d0-45fd-8b25-547d8ea40aa6&quot;],&quot;failures&quot;:[&quot;714772ff-952a-4c18-b7e7-ea410a57eeb0&quot;,&quot;1831802c-66fc-4380-b516-588c7b506d84&quot;,&quot;f28808d9-aae5-48b6-8943-db11e52d96e5&quot;,&quot;b06b8d43-6486-4104-ad56-8103d12330d5&quot;,&quot;a0def80f-fafa-475e-b514-37e352b0c1ec&quot;,&quot;2da4f882-a171-408f-b27d-7f20010cefe6&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:36,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b5921102-2326-4712-983f-fc338536418b&quot;,&quot;title&quot;:&quot;DELETE /students/:erp/saved-activities/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\savedActivity.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\savedActivity.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a saved activity request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 1: Delete a saved activity request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { activity_id: savedActivityId, saved_at };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}/${savedActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp == student_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Saved activity has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No saved activities found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:203:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;53278fce-9fa7-454f-ae10-96f90d1fdefc&quot;,&quot;parentUUID&quot;:&quot;b5921102-2326-4712-983f-fc338536418b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a saved activity request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 2: Delete a saved activity request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { activity_id: savedActivityId, saved_at };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}/${savedActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp != student_erp but still bypass ownerCheck\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Saved activity has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${ERPwithoutSavedActivities}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No saved activities found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:238:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;8a2cf033-5aa0-4b2d-a163-e3dfc8fab00a&quot;,&quot;parentUUID&quot;:&quot;b5921102-2326-4712-983f-fc338536418b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a saved activity request is unsuccessful due to unknown student_erp&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 3: Delete a saved activity request is unsuccessful due to unknown student_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownStudentERP}/${subRoute}/${savedActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Saved activity not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:270:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;33eafe75-c070-4d4e-81e4-ec8c49f05329&quot;,&quot;parentUUID&quot;:&quot;b5921102-2326-4712-983f-fc338536418b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a saved activity request is unsuccessful due to unknown activity_id&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 4: Delete a saved activity request is unsuccessful due to unknown activity_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudentERP}/${subRoute}/${unknownActivityId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Saved activity not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:283:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;cb9b4408-314e-4690-9781-026b00df3523&quot;,&quot;parentUUID&quot;:&quot;b5921102-2326-4712-983f-fc338536418b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a saved activity request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 5: Delete a saved activity request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${adminERP}/${subRoute}/${savedActivityId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminERP != userToken.erp, can be any other different erp as well\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\savedActivity.test.js:296:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;844f912a-561c-4d0b-83e2-e155dea13f7c&quot;,&quot;parentUUID&quot;:&quot;b5921102-2326-4712-983f-fc338536418b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Delete a saved activity request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Saved Activities API DELETE /students/:erp/saved-activities/:id Scenario 6: Delete a saved activity request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudentERP}/${subRoute}/${savedActivityId}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a11af735-7f2b-4392-87b6-86004816efc4&quot;,&quot;parentUUID&quot;:&quot;b5921102-2326-4712-983f-fc338536418b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a11af735-7f2b-4392-87b6-86004816efc4&quot;],&quot;failures&quot;:[&quot;53278fce-9fa7-454f-ae10-96f90d1fdefc&quot;,&quot;8a2cf033-5aa0-4b2d-a163-e3dfc8fab00a&quot;,&quot;33eafe75-c070-4d4e-81e4-ec8c49f05329&quot;,&quot;cb9b4408-314e-4690-9781-026b00df3523&quot;,&quot;844f912a-561c-4d0b-83e2-e155dea13f7c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;39707121-f541-4117-9215-d4f3662014ce&quot;,&quot;title&quot;:&quot;Students API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Students API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Students API \&quot;before each\&quot; hook in \&quot;Students API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cf4303ed-1e8b-4807-af45-f470157451ad&quot;,&quot;parentUUID&quot;:&quot;39707121-f541-4117-9215-d4f3662014ce&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7c9befb5-7ce0-4980-a2dc-30f2b50420a0&quot;,&quot;title&quot;:&quot;GET /students&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all students request successful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students Scenario 1: Get all students request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\n// contain all params along with connection details\nexpect(resBody[0]).to.include.all.keys([...Object.keys(existingStudent), &#x27;student_connection&#x27;]);\nconst studentsWithConnection = resBody.filter(o =&gt; o.student_connection !== null);\n// connection details should have these\nexpect(studentsWithConnection[0].student_connection).to.include.all.keys([\n    &#x27;student_connection_id&#x27;,\n    &#x27;sender_erp&#x27;,\n    &#x27;receiver_erp&#x27;,\n    &#x27;connection_status&#x27;,\n    &#x27;sent_at&#x27;,\n    &#x27;accepted_at&#x27;\n]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:52:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;c62f8791-f785-47af-89c5-3982aac8cc7c&quot;,&quot;parentUUID&quot;:&quot;7c9befb5-7ce0-4980-a2dc-30f2b50420a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all students request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students Scenario 2: Get all students request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?first_name=${existingStudent.first_name}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].first_name).to.be.equal(existingStudent.first_name);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:79:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;783283a0-6d84-4819-ade5-2204a412541c&quot;,&quot;parentUUID&quot;:&quot;7c9befb5-7ce0-4980-a2dc-30f2b50420a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all students request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students Scenario 3: Get all students request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:484,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentModel = require(&#x27;../../src/models/student.model&#x27;);\nconst modelStub = sinon.stub(StudentModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty student list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;80417d6a-0785-4d49-8a8d-984eb862cdaf&quot;,&quot;parentUUID&quot;:&quot;7c9befb5-7ce0-4980-a2dc-30f2b50420a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all students request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students Scenario 4: Get all students request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0079bf86-2624-4372-8d34-8a394c38cbe6&quot;,&quot;parentUUID&quot;:&quot;7c9befb5-7ce0-4980-a2dc-30f2b50420a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0079bf86-2624-4372-8d34-8a394c38cbe6&quot;],&quot;failures&quot;:[&quot;c62f8791-f785-47af-89c5-3982aac8cc7c&quot;,&quot;783283a0-6d84-4819-ade5-2204a412541c&quot;,&quot;80417d6a-0785-4d49-8a8d-984eb862cdaf&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:500,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;bc3438db-7ae6-4291-8578-4e7502a370b1&quot;,&quot;title&quot;:&quot;GET /students/:erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student request successful (Profile)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp Scenario 1: Get a student request successful (Profile)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // userToken.erp === existingStudent.erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.erp).to.be.equal(existingStudent.erp); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:124:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;223b5977-5692-4a76-9378-d93c4dd8466f&quot;,&quot;parentUUID&quot;:&quot;bc3438db-7ae6-4291-8578-4e7502a370b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student request successful (Others)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp Scenario 2: Get a student request successful (Others)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${adminERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // userToken.erp !== adminERP\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.erp).to.be.equal(adminERP); // should match initially sent id\nexpect(resBody.student_connection).to.exist; // should contain connection details&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:137:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;fedd28e7-38e7-4d4f-b794-ae3cb1f37dde&quot;,&quot;parentUUID&quot;:&quot;bc3438db-7ae6-4291-8578-4e7502a370b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp Scenario 3: Get a student request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unregisteredERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:151:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;be04ad70-6010-4724-9d80-3625b96c35ff&quot;,&quot;parentUUID&quot;:&quot;bc3438db-7ae6-4291-8578-4e7502a370b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a student request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp Scenario 4: Get a student request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudent.erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;51967755-0c48-4583-be71-22ca07eeb650&quot;,&quot;parentUUID&quot;:&quot;bc3438db-7ae6-4291-8578-4e7502a370b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;51967755-0c48-4583-be71-22ca07eeb650&quot;],&quot;failures&quot;:[&quot;223b5977-5692-4a76-9378-d93c4dd8466f&quot;,&quot;fedd28e7-38e7-4d4f-b794-ae3cb1f37dde&quot;,&quot;be04ad70-6010-4724-9d80-3625b96c35ff&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:32,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;668c343b-8e12-4eef-b3ed-2595f16f8c02&quot;,&quot;title&quot;:&quot;GET /students/:erp/organized-activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student&#x27;s organized activities request successful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 1: Get a student&#x27;s organized activities request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst organizerCheck = activity =&gt; activity.organizer_erp === existingStudent.erp;\nexpect(resBody.every(organizerCheck)).to.be.true; // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:179:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;d2e1b929-480a-471c-92af-c8a51561a8b1&quot;,&quot;parentUUID&quot;:&quot;668c343b-8e12-4eef-b3ed-2595f16f8c02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student&#x27;s organized activities request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 2: Get a student&#x27;s organized activities request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst frequency = &#x27;one_time&#x27;;\nconst query = `frequency=${frequency}`;\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = activity =&gt; activity.frequency === frequency;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:196:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;5f6db715-685c-4357-b607-37d716011277&quot;,&quot;parentUUID&quot;:&quot;668c343b-8e12-4eef-b3ed-2595f16f8c02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student&#x27;s organized activities request is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 3: Get a student&#x27;s organized activities request is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unregisteredERP}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No organized activities found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:211:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;eb4dd3d1-8cb8-4305-b185-3157928c1d87&quot;,&quot;parentUUID&quot;:&quot;668c343b-8e12-4eef-b3ed-2595f16f8c02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a student&#x27;s organized activities request is unsuccessful due to no organized activities&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 4: Get a student&#x27;s organized activities request is unsuccessful due to no organized activities&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:501,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentModel = require(&#x27;../../src/models/student.model&#x27;);\nconst modelStub = sinon.stub(StudentModel, &#x27;findAllOrganizedActivitiesByStudent&#x27;).callsFake(() =&gt; []); // return empty organized activities list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No organized activities found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;7bb5e3a6-b6f0-4377-839b-987d36d2fdfa&quot;,&quot;parentUUID&quot;:&quot;668c343b-8e12-4eef-b3ed-2595f16f8c02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get a student&#x27;s organized activities request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 5: Get a student&#x27;s organized activities request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;all&#x27;; // &lt;-- invalid privacy value\nconst invalidQueryParams = `privacy=${privacy}&amp;week=2`; // &lt;-- `week` is an incorrect query param\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${invalidQueryParams}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(422);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParamCheck = o =&gt; o.param === &#x27;privacy&#x27;;\nexpect(resHeaders.data.some(incorrectParamCheck)).to.be.true;\nconst incorrectMsgCheck = o =&gt; o.msg === &#x27;Invalid query params!&#x27;;\nexpect(resHeaders.data.some(incorrectMsgCheck)).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:246:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;bfd4ff7d-8bb2-4e3f-8987-8b11e0486581&quot;,&quot;parentUUID&quot;:&quot;668c343b-8e12-4eef-b3ed-2595f16f8c02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get a student&#x27;s organized activities is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/organized-activities Scenario 6: Get a student&#x27;s organized activities is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudent.erp}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2fe4cf5e-9385-4715-88f3-572b28a3091c&quot;,&quot;parentUUID&quot;:&quot;668c343b-8e12-4eef-b3ed-2595f16f8c02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2fe4cf5e-9385-4715-88f3-572b28a3091c&quot;],&quot;failures&quot;:[&quot;d2e1b929-480a-471c-92af-c8a51561a8b1&quot;,&quot;5f6db715-685c-4357-b607-37d716011277&quot;,&quot;eb4dd3d1-8cb8-4305-b185-3157928c1d87&quot;,&quot;7bb5e3a6-b6f0-4377-839b-987d36d2fdfa&quot;,&quot;bfd4ff7d-8bb2-4e3f-8987-8b11e0486581&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:553,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6211a438-d501-495f-a5a3-e90db70033a1&quot;,&quot;title&quot;:&quot;GET /students/:erp/attended-activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student&#x27;s attended activities request successful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 1: Get a student&#x27;s attended activities request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst attendeeCheck = activity =&gt; activity.student_erp === existingStudent.erp;\nexpect(resBody.every(attendeeCheck)).to.be.true; // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:278:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;75df3ee1-560c-45b3-a449-6607b4e1cdd1&quot;,&quot;parentUUID&quot;:&quot;6211a438-d501-495f-a5a3-e90db70033a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student&#x27;s attended activities request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 2: Get a student&#x27;s attended activities request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst involvement_type = &#x27;going&#x27;;\nconst query = `involvement_type=${involvement_type}`;\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst attendeeCheck = activity =&gt; activity.student_erp === existingStudent.erp;\nexpect(resBody.every(attendeeCheck)).to.be.true; // should match initially sent id\nconst queryCheck = activity =&gt; activity.involvement_type === involvement_type;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:295:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;b424af26-f32f-488e-967f-bf87776b13d5&quot;,&quot;parentUUID&quot;:&quot;6211a438-d501-495f-a5a3-e90db70033a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student&#x27;s attended activities request is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 3: Get a student&#x27;s attended activities request is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unregisteredERP}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No interacted activities found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:312:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;e1a49896-51f1-4040-8bc0-5bd65c691cc3&quot;,&quot;parentUUID&quot;:&quot;6211a438-d501-495f-a5a3-e90db70033a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a student&#x27;s attended activities request is unsuccessful due to no attended activities&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 4: Get a student&#x27;s attended activities request is unsuccessful due to no attended activities&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:505,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentModel = require(&#x27;../../src/models/student.model&#x27;);\nconst modelStub = sinon.stub(StudentModel, &#x27;findAllAttendedActivitiesByStudent&#x27;).callsFake(() =&gt; []); // return empty attended activities list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No interacted activities found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;5fb7f9ee-f7fa-40fe-96a4-0c8884322126&quot;,&quot;parentUUID&quot;:&quot;6211a438-d501-495f-a5a3-e90db70033a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get a student&#x27;s attended activities request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 5: Get a student&#x27;s attended activities request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst involvement_type = &#x27;not going&#x27;; // &lt;-- invalid involvement type value\nconst invalidQueryParams = `involvement_type=${involvement_type}&amp;week=2`; // &lt;-- `week` is an incorrect query param\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${invalidQueryParams}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(422);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParamCheck = o =&gt; o.param === &#x27;involvement_type&#x27;;\nexpect(resHeaders.data.some(incorrectParamCheck)).to.be.true;\nconst incorrectMsgCheck = o =&gt; o.msg === &#x27;Invalid query params!&#x27;;\nexpect(resHeaders.data.some(incorrectMsgCheck)).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:347:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;603e6f16-91b6-44a3-9bdc-6d94391d711b&quot;,&quot;parentUUID&quot;:&quot;6211a438-d501-495f-a5a3-e90db70033a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get a student&#x27;s attended activities is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/attended-activities Scenario 6: Get a student&#x27;s attended activities is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudent.erp}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;727ed8b2-f787-49bf-ab76-d2e685a8231a&quot;,&quot;parentUUID&quot;:&quot;6211a438-d501-495f-a5a3-e90db70033a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;727ed8b2-f787-49bf-ab76-d2e685a8231a&quot;],&quot;failures&quot;:[&quot;75df3ee1-560c-45b3-a449-6607b4e1cdd1&quot;,&quot;b424af26-f32f-488e-967f-bf87776b13d5&quot;,&quot;e1a49896-51f1-4040-8bc0-5bd65c691cc3&quot;,&quot;5fb7f9ee-f7fa-40fe-96a4-0c8884322126&quot;,&quot;603e6f16-91b6-44a3-9bdc-6d94391d711b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:546,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;785e5fb5-e408-4bcf-b775-f7fa323fe8b9&quot;,&quot;title&quot;:&quot;GET /students/:erp/saved-activities&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student&#x27;s saved activities request successful&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 1: Get a student&#x27;s saved activities request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst studentERPCheck = activity =&gt; activity.student_erp === existingStudent.erp;\nexpect(resBody.every(studentERPCheck)).to.be.true; // should match initially sent erp&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:379:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;248b8d73-1e9c-4b62-8088-124637f98c9d&quot;,&quot;parentUUID&quot;:&quot;785e5fb5-e408-4bcf-b775-f7fa323fe8b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student&#x27;s saved activities request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 2: Get a student&#x27;s saved activities request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst frequency = &#x27;daily&#x27;;\nconst query = `frequency=${frequency}`;\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${query}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = activity =&gt; activity.frequency === frequency;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:396:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;6f6133ac-4662-4071-aa18-5a7fd717162f&quot;,&quot;parentUUID&quot;:&quot;785e5fb5-e408-4bcf-b775-f7fa323fe8b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student&#x27;s saved activities request is unsuccessful due to unknown erp&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 3: Get a student&#x27;s saved activities request is unsuccessful due to unknown erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unregisteredERP}/${subRoute}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No saved activities found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:411:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;a9dd5933-5d14-4434-ac07-5696d7ed98a4&quot;,&quot;parentUUID&quot;:&quot;785e5fb5-e408-4bcf-b775-f7fa323fe8b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a student&#x27;s saved activities request is unsuccessful due to no saved activities&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 4: Get a student&#x27;s saved activities request is unsuccessful due to no saved activities&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:496,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentModel = require(&#x27;../../src/models/student.model&#x27;);\nconst modelStub = sinon.stub(StudentModel, &#x27;findAllSavedActivitiesByStudent&#x27;).callsFake(() =&gt; []); // return empty saved activities list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;No saved activities found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;72ee780c-d18a-4f22-811d-aee33cc89346&quot;,&quot;parentUUID&quot;:&quot;785e5fb5-e408-4bcf-b775-f7fa323fe8b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get a student&#x27;s saved activities request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 5: Get a student&#x27;s saved activities request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst privacy = &#x27;all&#x27;; // &lt;-- invalid privacy value\nconst invalidQueryParams = `privacy=${privacy}&amp;week=2`; // &lt;-- `week` is an incorrect query param\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudent.erp}/${subRoute}?${invalidQueryParams}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(422);\nconst resHeaders = res.body.headers;\nexpect(resHeaders.error).to.be.equal(1);\nexpect(resHeaders.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParamCheck = o =&gt; o.param === &#x27;privacy&#x27;;\nexpect(resHeaders.data.some(incorrectParamCheck)).to.be.true;\nconst incorrectMsgCheck = o =&gt; o.msg === &#x27;Invalid query params!&#x27;;\nexpect(resHeaders.data.some(incorrectMsgCheck)).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:446:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;a2a10dd5-e8ce-48d5-999b-7f71c1e3a402&quot;,&quot;parentUUID&quot;:&quot;785e5fb5-e408-4bcf-b775-f7fa323fe8b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get a student&#x27;s saved activities request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 6: Get a student&#x27;s saved activities request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const res = await request(this.app)\n    .get(`${baseRoute}/${adminERP}/${subRoute}`) // token erp != adminERP\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user can&#x27;t view others saved activities\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:462:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;1a34e992-9d47-4b34-8bb0-f5379047df4e&quot;,&quot;parentUUID&quot;:&quot;785e5fb5-e408-4bcf-b775-f7fa323fe8b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Get a student&#x27;s saved activities is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API GET /students/:erp/saved-activities Scenario 7: Get a student&#x27;s saved activities is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudent.erp}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d82dda94-f801-4b7f-b1bc-e2ddf0ffa6be&quot;,&quot;parentUUID&quot;:&quot;785e5fb5-e408-4bcf-b775-f7fa323fe8b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d82dda94-f801-4b7f-b1bc-e2ddf0ffa6be&quot;],&quot;failures&quot;:[&quot;248b8d73-1e9c-4b62-8088-124637f98c9d&quot;,&quot;6f6133ac-4662-4071-aa18-5a7fd717162f&quot;,&quot;a9dd5933-5d14-4434-ac07-5696d7ed98a4&quot;,&quot;72ee780c-d18a-4f22-811d-aee33cc89346&quot;,&quot;a2a10dd5-e8ce-48d5-999b-7f71c1e3a402&quot;,&quot;1a34e992-9d47-4b34-8bb0-f5379047df4e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:546,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;28dac31e-2c7c-43c7-a1c0-fb3c566ba08a&quot;,&quot;title&quot;:&quot;PATCH /students/:erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a student request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 1: Update a student request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingStudent.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.last_name).to.be.equal(newStudentLastName);\n\n// cleanup\ndata.last_name = existingStudent.last_name;\nres = await request(app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:495:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;78e10e6a-6742-4666-a8e2-fc9bf571de43&quot;,&quot;parentUUID&quot;:&quot;28dac31e-2c7c-43c7-a1c0-fb3c566ba08a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a student request is successful (Admin)&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 2: Update a student request is successful (Admin)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // admin to edit other profiles i.e. token erp != existingStudent.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.last_name).to.be.equal(newStudentLastName);\n\n// cleanup\ndata.last_name = existingStudent.last_name;\nres = await request(app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:530:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;ab751b5a-89cd-4d44-b5e1-0716bf1bc058&quot;,&quot;parentUUID&quot;:&quot;28dac31e-2c7c-43c7-a1c0-fb3c566ba08a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a student request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 3: Update a student request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unregisteredERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:564:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;909bba6e-8002-44c8-a81f-568d836cd29e&quot;,&quot;parentUUID&quot;:&quot;28dac31e-2c7c-43c7-a1c0-fb3c566ba08a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a student request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 4: Update a student request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    last_namesds: newStudentLastName, // &lt;-- an valid parameter name should be &#x27;last_name&#x27;\n    first_name: &#x27;test-user%&#x27; // &lt;-- a valid &#x27;first_name&#x27; contains alphabets only\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;first_name&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:584:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;1b62a0d9-edcd-424b-80d2-ab2fc52d216e&quot;,&quot;parentUUID&quot;:&quot;28dac31e-2c7c-43c7-a1c0-fb3c566ba08a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a student request is forbidden (Unowned ERP)&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 5: Update a student request is forbidden (Unowned ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\nconst unOwnedERP = adminERP; // &lt;-- can be any other non-admin ERP as well, just different from existingStudent.erp\n\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedERP}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others profile i.e. token erp != otherERP\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:605:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;fa891590-6689-4903-ba42-b972c8f9953c&quot;,&quot;parentUUID&quot;:&quot;28dac31e-2c7c-43c7-a1c0-fb3c566ba08a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a student request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API PATCH /students/:erp Scenario 6: Update a student request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { last_name: newStudentLastName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudent.erp}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c7c3839e-d87f-495a-a3bf-21e1f510389a&quot;,&quot;parentUUID&quot;:&quot;28dac31e-2c7c-43c7-a1c0-fb3c566ba08a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c7c3839e-d87f-495a-a3bf-21e1f510389a&quot;],&quot;failures&quot;:[&quot;78e10e6a-6742-4666-a8e2-fc9bf571de43&quot;,&quot;ab751b5a-89cd-4d44-b5e1-0716bf1bc058&quot;,&quot;909bba6e-8002-44c8-a81f-568d836cd29e&quot;,&quot;1b62a0d9-edcd-424b-80d2-ab2fc52d216e&quot;,&quot;fa891590-6689-4903-ba42-b972c8f9953c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:61,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c86eedff-5ed8-4902-ad87-3a275687fa26&quot;,&quot;title&quot;:&quot;DELETE /students/:erp&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\student.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\student.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a student request is successful&quot;,&quot;fullTitle&quot;:&quot;Students API DELETE /students/:erp Scenario 1: Delete a student request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst student = {\n    erp: newERP,\n    password: &#x27;123&#x27;,\n    uni_email: newEmail,\n    first_name: existingStudent.first_name,\n    last_name: existingStudent.last_name,\n    gender: existingStudent.gender,\n    contact: existingStudent.contact,\n    birthday: existingStudent.birthday,\n    profile_picture_url: existingStudent.profile_picture_url,\n    graduation_year: existingStudent.graduation_year,\n    campus_id: existingStudent.campus_id,\n    program_id: existingStudent.program_id,\n    is_active: existingStudent.is_active\n};\nconst registerRoute = `/api/${Config.API_VERSION}/auth/register`;\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(registerRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(student);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.erp;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:655:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;28ecdbf9-0cc2-424d-88a9-6724b2f0c3d9&quot;,&quot;parentUUID&quot;:&quot;c86eedff-5ed8-4902-ad87-3a275687fa26&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a student request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Students API DELETE /students/:erp Scenario 2: Delete a student request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unregisteredERP}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:687:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;cce5e0bb-be1f-4bcd-90fe-f1817e8844ba&quot;,&quot;parentUUID&quot;:&quot;c86eedff-5ed8-4902-ad87-3a275687fa26&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a student request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Students API DELETE /students/:erp Scenario 3: Delete a student request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudent.erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\student.test.js:700:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;dd7bcb19-3aee-4d64-a42b-67c131cfa6ae&quot;,&quot;parentUUID&quot;:&quot;c86eedff-5ed8-4902-ad87-3a275687fa26&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a student request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Students API DELETE /students/:erp Scenario 4: Delete a student request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudent.erp}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f5d950a2-acbc-4ebe-b43f-8ce4561c6e3d&quot;,&quot;parentUUID&quot;:&quot;c86eedff-5ed8-4902-ad87-3a275687fa26&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f5d950a2-acbc-4ebe-b43f-8ce4561c6e3d&quot;],&quot;failures&quot;:[&quot;28ecdbf9-0cc2-424d-88a9-6724b2f0c3d9&quot;,&quot;cce5e0bb-be1f-4bcd-90fe-f1817e8844ba&quot;,&quot;dd7bcb19-3aee-4d64-a42b-67c131cfa6ae&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:94,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b680e14e-8002-403b-b537-d3008fed9727&quot;,&quot;title&quot;:&quot;Connection Requests API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Connection Requests API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API \&quot;before each\&quot; hook in \&quot;Connection Requests API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;024fda6b-cff6-4b52-aca2-5d31b6094081&quot;,&quot;parentUUID&quot;:&quot;b680e14e-8002-403b-b537-d3008fed9727&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ad1f3b50-4868-4dbf-92c8-588b4d26c7e6&quot;,&quot;title&quot;:&quot;GET /student-connections&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all friend connections is successful&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 1: Get all friend connections is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst erp = adminERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?erp=${erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // adminToken.erp === erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst studentCheck = studentConn =&gt; studentConn.sender.erp === erp || studentConn.receiver.erp === erp;\nconst connectionStatusCheck = studentConn =&gt; studentConn.connection_status === &#x27;friends&#x27;;\nconst queryCheck = studentConn =&gt; studentCheck(studentConn) &amp;&amp; connectionStatusCheck(studentConn);\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([&#x27;student_connection_id&#x27;, &#x27;sender&#x27;, &#x27;receiver&#x27;, &#x27;connection_status&#x27;, &#x27;sent_at&#x27;, &#x27;accepted_at&#x27;]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingConnectionRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingConnectionRequest.receiver));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:55:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;68dd0e5d-4059-49fc-97a6-fbbcc84f7d35&quot;,&quot;parentUUID&quot;:&quot;ad1f3b50-4868-4dbf-92c8-588b4d26c7e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all student connections unsuccessful due to no friend connections&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 2: Get all student connections unsuccessful due to no friend connections&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?erp=${erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:78:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;cef508fc-745d-48af-8957-8ffba39f8175&quot;,&quot;parentUUID&quot;:&quot;ad1f3b50-4868-4dbf-92c8-588b4d26c7e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all others&#x27; friends connections is successful&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 3: Get all others&#x27; friends connections is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst erp = adminERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}?erp=${erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp !== erp\n\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst studentCheck = studentConn =&gt; studentConn.sender.erp === erp || studentConn.receiver.erp === erp;\nconst connectionStatusCheck = studentConn =&gt; studentConn.connection_status === &#x27;friends&#x27;;\nconst queryCheck = studentConn =&gt; studentCheck(studentConn) &amp;&amp; connectionStatusCheck(studentConn);\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([&#x27;student_connection_id&#x27;, &#x27;sender&#x27;, &#x27;receiver&#x27;, &#x27;connection_status&#x27;, &#x27;sent_at&#x27;, &#x27;accepted_at&#x27;]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingConnectionRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingConnectionRequest.receiver));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:92:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;e9e0cd17-7897-42e9-8792-9acce9eb99a6&quot;,&quot;parentUUID&quot;:&quot;ad1f3b50-4868-4dbf-92c8-588b4d26c7e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all student connections is incorrect due to no query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 4: Get all student connections is incorrect due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute) // &lt;-- must specify erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParam = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParam).to.include(&#x27;erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:112:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;de71202a-67f7-4dcc-8837-5ac6161e2222&quot;,&quot;parentUUID&quot;:&quot;ad1f3b50-4868-4dbf-92c8-588b4d26c7e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all student connections is incorrect due to unknown query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 5: Get all student connections is incorrect due to unknown query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst erp = &#x27;123&#x27;; // a valid erp is 5 digits\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?erp=${erp}&amp;connection_status=friends`) // &lt;-- &#x27;connection_status&#x27; is invalid query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:129:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;9aa2fe56-6812-4c3f-bc21-6288781e6779&quot;,&quot;parentUUID&quot;:&quot;ad1f3b50-4868-4dbf-92c8-588b4d26c7e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get all student connections is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections Scenario 6: Get all student connections is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7673b4f9-b7c1-4732-8f31-23f93b2f9501&quot;,&quot;parentUUID&quot;:&quot;ad1f3b50-4868-4dbf-92c8-588b4d26c7e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7673b4f9-b7c1-4732-8f31-23f93b2f9501&quot;],&quot;failures&quot;:[&quot;68dd0e5d-4059-49fc-97a6-fbbcc84f7d35&quot;,&quot;cef508fc-745d-48af-8957-8ffba39f8175&quot;,&quot;e9e0cd17-7897-42e9-8792-9acce9eb99a6&quot;,&quot;de71202a-67f7-4dcc-8837-5ac6161e2222&quot;,&quot;9aa2fe56-6812-4c3f-bc21-6288781e6779&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;3e87f873-dd64-4ef7-a2c3-9e57c618b4e6&quot;,&quot;title&quot;:&quot;GET /student-connections/requests&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all connection requests is successful (Sent)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 1: Get all connection requests is successful (Sent)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // userToken.erp === sender_erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = studentConnection =&gt; studentConnection.sender.erp === sender_erp;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([&#x27;student_connection_id&#x27;, &#x27;sender&#x27;, &#x27;receiver&#x27;, &#x27;connection_status&#x27;, &#x27;sent_at&#x27;]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingConnectionRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingConnectionRequest.receiver));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:163:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;cf37b647-1298-4a9c-a2f9-e33ca9515d47&quot;,&quot;parentUUID&quot;:&quot;3e87f873-dd64-4ef7-a2c3-9e57c618b4e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all connection requests is successful (Receiver)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 2: Get all connection requests is successful (Receiver)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = adminERP;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?receiver_erp=${receiver_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // adminToken.erp === sender_erp\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst queryCheck = studentConnection =&gt; studentConnection.receiver.erp === receiver_erp;\nexpect(resBody.every(queryCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys([&#x27;student_connection_id&#x27;, &#x27;sender&#x27;, &#x27;receiver&#x27;, &#x27;connection_status&#x27;, &#x27;sent_at&#x27;]);\nexpect(resBody[0].sender).to.include.all.keys(Object.keys(existingConnectionRequest.sender));\nexpect(resBody[0].receiver).to.include.all.keys(Object.keys(existingConnectionRequest.receiver));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:184:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;5472774b-aea7-4a61-b7ea-85c6ac591cad&quot;,&quot;parentUUID&quot;:&quot;3e87f873-dd64-4ef7-a2c3-9e57c618b4e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all connection requests unsuccessful due to no (sent) connection requests&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 3: Get all connection requests unsuccessful due to no (sent) connection requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = user2ERP;\nconst fakeToken = jwt.sign({erp: sender_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}`)\n    .auth(fakeToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:206:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;7b7c7444-d91b-45e7-8c4f-ea7c4e001c4b&quot;,&quot;parentUUID&quot;:&quot;3e87f873-dd64-4ef7-a2c3-9e57c618b4e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all connection requests unsuccessful due to no (received) connection requests&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 4: Get all connection requests unsuccessful due to no (received) connection requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = user2ERP;\nconst fakeToken = jwt.sign({erp: receiver_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?receiver_erp=${receiver_erp}`)\n    .auth(fakeToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:221:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;a7142642-d40a-415c-ade3-67b709196b60&quot;,&quot;parentUUID&quot;:&quot;3e87f873-dd64-4ef7-a2c3-9e57c618b4e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all connection requests is incorrect due to multiple query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 5: Get all connection requests is incorrect due to multiple query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\nconst receiver_erp = user2ERP;\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}&amp;receiver_erp=${receiver_erp}`) // &lt;-- can&#x27;t specify both sender_erp and receiver_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;receiver_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Can\\&#x27;t specify both sender and receiver erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:236:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;8951a49b-3b28-46d7-8f34-012fc1709c5e&quot;,&quot;parentUUID&quot;:&quot;3e87f873-dd64-4ef7-a2c3-9e57c618b4e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get all connection requests is incorrect due to no query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 6: Get all connection requests is incorrect due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}`) // &lt;-- either specify sender_erp or receiver_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Either sender or receiver erp is required&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:252:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;1d850671-b8af-4d80-a32a-15c5c54da2c6&quot;,&quot;parentUUID&quot;:&quot;3e87f873-dd64-4ef7-a2c3-9e57c618b4e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Get all connection requests is incorrect due to unknown query params&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 7: Get all connection requests is incorrect due to unknown query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = &#x27;123&#x27;; // a valid erp is 5 digits\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}&amp;connection_status=friends`) // &lt;-- &#x27;connection_status&#x27; is invalid query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;sender_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:269:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;e340fb1b-57dd-450e-b23d-e4b2ba1ae4ea&quot;,&quot;parentUUID&quot;:&quot;3e87f873-dd64-4ef7-a2c3-9e57c618b4e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Get request is forbidden due to querying other&#x27;s sent connection requests&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 8: Get request is forbidden due to querying other&#x27;s sent connection requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst sender_erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?sender_erp=${sender_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp !== sender_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:288:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;42f32f2b-3de4-4c57-ad4c-13b4b8a3821b&quot;,&quot;parentUUID&quot;:&quot;3e87f873-dd64-4ef7-a2c3-9e57c618b4e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 9: Get request is forbidden due to querying other&#x27;s received connection requests&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 9: Get request is forbidden due to querying other&#x27;s received connection requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst receiver_erp = userERP;\n// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${subRoute}?receiver_erp=${receiver_erp}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }); // &lt;-- adminToken.erp !== receiver_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:304:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;4289a816-1d02-41da-9030-1846b0d8826d&quot;,&quot;parentUUID&quot;:&quot;3e87f873-dd64-4ef7-a2c3-9e57c618b4e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 10: Get all connection requests is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API GET /student-connections/requests Scenario 10: Get all connection requests is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${subRoute}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2d699bf4-ddd4-4d36-8545-a621e3c6b9e2&quot;,&quot;parentUUID&quot;:&quot;3e87f873-dd64-4ef7-a2c3-9e57c618b4e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2d699bf4-ddd4-4d36-8545-a621e3c6b9e2&quot;],&quot;failures&quot;:[&quot;cf37b647-1298-4a9c-a2f9-e33ca9515d47&quot;,&quot;5472774b-aea7-4a61-b7ea-85c6ac591cad&quot;,&quot;7b7c7444-d91b-45e7-8c4f-ea7c4e001c4b&quot;,&quot;a7142642-d40a-415c-ade3-67b709196b60&quot;,&quot;8951a49b-3b28-46d7-8f34-012fc1709c5e&quot;,&quot;1d850671-b8af-4d80-a32a-15c5c54da2c6&quot;,&quot;e340fb1b-57dd-450e-b23d-e4b2ba1ae4ea&quot;,&quot;42f32f2b-3de4-4c57-ad4c-13b4b8a3821b&quot;,&quot;4289a816-1d02-41da-9030-1846b0d8826d&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:71,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ad411a5b-28c6-4ef9-92b3-e72fce521f38&quot;,&quot;title&quot;:&quot;POST /student-connections&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a connection request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 1: Create a connection request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp, receiver_erp, sent_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // token erp === sender_erp in body\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.student_connection_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // token erp === sender_erp in body\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    student_connection_id: newId,\n    ...data,\n    connection_status: existingConnectionRequest.connection_status,\n    accepted_at: null,\n    student_1_erp: data.receiver_erp, // 17619, bcz smaller\n    student_2_erp: data.sender_erp // 17855, bcz greater\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // sender deletes it\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:339:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;8cb5d19f-ac15-4ba3-8adb-09485459e052&quot;,&quot;parentUUID&quot;:&quot;ad411a5b-28c6-4ef9-92b3-e72fce521f38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a connection request is unsuccessful due to unknown receiver_erp&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 2: Create a connection request is unsuccessful due to unknown receiver_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: existingConnectionRequest.sender.erp,\n    receiver_erp: unknownStudentERP,\n    sent_at\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === existingStudentConnection.sender.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;receiver_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:381:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;b10235df-0696-4c7c-91f6-626102b9b593&quot;,&quot;parentUUID&quot;:&quot;ad411a5b-28c6-4ef9-92b3-e72fce521f38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a connection request is unsuccessful due to already sent connection request&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 3: Create a connection request is unsuccessful due to already sent connection request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: existingConnectionRequest.sender.erp,\n    receiver_erp: existingConnectionRequest.receiver.erp,\n    sent_at\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === existingStudentConnection.sender.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(409);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DuplicateEntryException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 409&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 409\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:401:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;409&quot;}]},&quot;uuid&quot;:&quot;32b1539f-e5a9-4d5e-87dd-193050e80a9d&quot;,&quot;parentUUID&quot;:&quot;ad411a5b-28c6-4ef9-92b3-e72fce521f38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a connection request is unsuccessful due to already received connection request&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 4: Create a connection request is unsuccessful due to already received connection request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: existingConnectionRequest.receiver.erp,\n    receiver_erp: existingConnectionRequest.sender.erp, // flip receiver and sender\n    sent_at\n};\nconst senderToken = jwt.sign({erp: data.sender_erp}, Config.SECRET_JWT);\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(senderToken, { type: &#x27;bearer&#x27; }) // senderToken erp === data.sender_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(409);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DuplicateEntryException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 409&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 409\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:422:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;409&quot;}]},&quot;uuid&quot;:&quot;8765a00e-f23c-4dba-a78e-291109a34968&quot;,&quot;parentUUID&quot;:&quot;ad411a5b-28c6-4ef9-92b3-e72fce521f38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a connection request is incorrect due to wrong key name in the body&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 5: Create a connection request is incorrect due to wrong key name in the body&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { // missing receiver_erp\n    sent_at: &#x27;not going&#x27;, // &lt;-- not a valid sent_at\n    send_erp: &#x27;12345&#x27; // &lt;-- a valid parameter name should be &#x27;sender_erp&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;receiver_erp&#x27;, &#x27;sent_at&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:441:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;dfeaee2c-31f3-4f14-867a-34c17e7c9aed&quot;,&quot;parentUUID&quot;:&quot;ad411a5b-28c6-4ef9-92b3-e72fce521f38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a connection request is incorrect due to connection request to oneself&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 6: Create a connection request is incorrect due to connection request to oneself&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    sender_erp: sender_erp,\n    receiver_erp: sender_erp,\n    sent_at\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // userToken erp === data.sender_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;receiver_erp&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Sender and receiver ERP can\\&#x27;t be the same&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:463:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;2c090222-8eb9-4cb2-b441-603849add365&quot;,&quot;parentUUID&quot;:&quot;ad411a5b-28c6-4ef9-92b3-e72fce521f38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 7: Create a connection request is forbidden due to unowned connection request&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 7: Create a connection request is forbidden due to unowned connection request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp: adminERP, receiver_erp, sent_at }; // adminERP instead of userERP\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- data.sender_erp !== userToken.erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:483:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;fe54e7ba-34f2-4de4-abb2-f03568acc8b2&quot;,&quot;parentUUID&quot;:&quot;ad411a5b-28c6-4ef9-92b3-e72fce521f38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 8: Create a connection request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API POST /student-connections Scenario 8: Create a connection request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { sender_erp, receiver_erp, sent_at };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;04fb8664-6ded-4023-9bec-601ca9c53f5e&quot;,&quot;parentUUID&quot;:&quot;ad411a5b-28c6-4ef9-92b3-e72fce521f38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;04fb8664-6ded-4023-9bec-601ca9c53f5e&quot;],&quot;failures&quot;:[&quot;8cb5d19f-ac15-4ba3-8adb-09485459e052&quot;,&quot;b10235df-0696-4c7c-91f6-626102b9b593&quot;,&quot;32b1539f-e5a9-4d5e-87dd-193050e80a9d&quot;,&quot;8765a00e-f23c-4dba-a78e-291109a34968&quot;,&quot;dfeaee2c-31f3-4f14-867a-34c17e7c9aed&quot;,&quot;2c090222-8eb9-4cb2-b441-603849add365&quot;,&quot;fe54e7ba-34f2-4de4-abb2-f03568acc8b2&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:91,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;7c8d4e44-465d-43ed-b87f-f11f565d2957&quot;,&quot;title&quot;:&quot;PATCH /student-connections/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a connection request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API PATCH /student-connections/:id Scenario 1: Update a connection request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { connection_status, accepted_at };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminToken.erp == existingStudentConnection.receiver.erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${studentConnectionId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst {sender, receiver, ...studentConnection} = existingConnectionRequest;\n\nstudentConnection.sender_erp = existingConnectionRequest.sender.erp;\nstudentConnection.receiver_erp = existingConnectionRequest.receiver.erp; // 15030, bcz smaller\nstudentConnection.student_1_erp = existingConnectionRequest.receiver.erp; // 15030, bcz smaller\nstudentConnection.student_2_erp = existingConnectionRequest.sender.erp; // 17855, bcz greater\nstudentConnection.accepted_at = data.accepted_at;\nstudentConnection.connection_status = data.connection_status;\nexpect(res.body.body).to.be.eql(studentConnection);\n\n// cleanup\ndata.connection_status = existingConnectionRequest.connection_status;\ndata.accepted_at = existingConnectionRequest.accepted_at;\nres = await request(app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; }) // &lt;-- adminToken.erp == existingStudentConnection.receiver.erp\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:523:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;738835f9-4242-4d20-9da4-d6491d88ff90&quot;,&quot;parentUUID&quot;:&quot;7c8d4e44-465d-43ed-b87f-f11f565d2957&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a connection request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API PATCH /student-connections/:id Scenario 2: Update a connection request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    connection_status: &#x27;ignored&#x27;, // &lt;-- not a valid connection_status\n    accepted_at, // can&#x27;t specify accepted at unless connection_status === &#x27;friends&#x27;\n    sender_erp: &#x27;12345&#x27; // &lt;-- an invalid update parameter i.e. not allowed\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;connection_status&#x27;, &#x27;accepted_at&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include.members([&#x27;Invalid updates!&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:569:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;6708de4e-82cf-4359-987a-93edbc01950b&quot;,&quot;parentUUID&quot;:&quot;7c8d4e44-465d-43ed-b87f-f11f565d2957&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a connection request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API PATCH /student-connections/:id Scenario 3: Update a connection request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { connection_status, accepted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- userToken.erp !== existingStudentConnection.receiver.erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:589:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;84ec9fc6-3743-4406-9dd0-4c2d6f6a3efa&quot;,&quot;parentUUID&quot;:&quot;7c8d4e44-465d-43ed-b87f-f11f565d2957&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a connection request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API PATCH /student-connections/:id Scenario 4: Update a connection request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { connection_status, accepted_at };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${studentConnectionId}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5f00c413-ab59-4a33-941c-09974b2b581f&quot;,&quot;parentUUID&quot;:&quot;7c8d4e44-465d-43ed-b87f-f11f565d2957&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5f00c413-ab59-4a33-941c-09974b2b581f&quot;],&quot;failures&quot;:[&quot;738835f9-4242-4d20-9da4-d6491d88ff90&quot;,&quot;6708de4e-82cf-4359-987a-93edbc01950b&quot;,&quot;84ec9fc6-3743-4406-9dd0-4c2d6f6a3efa&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;974b2905-d73d-40c2-b104-c37304e48188&quot;,&quot;title&quot;:&quot;DELETE /student-connections/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentConnection.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentConnection.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a connection request is successful (Sender cancels)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 1: Delete a connection request is successful (Sender cancels)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { sender_erp, receiver_erp, sent_at };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\nconst newId = res.body.body.student_connection_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- userToken.erp === sender_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:628:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;90091cf6-7de8-48dc-b0b2-4d0fd1a78ca1&quot;,&quot;parentUUID&quot;:&quot;974b2905-d73d-40c2-b104-c37304e48188&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a connection request is successful (Receiver rejects)&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 2: Delete a connection request is successful (Receiver rejects)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { sender_erp, receiver_erp, sent_at };\nconst app = this.app;\nconst receiverToken = jwt.sign({erp: data.receiver_erp}, Config.SECRET_JWT);\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\nconst newId = res.body.body.student_connection_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(receiverToken, { type: &#x27;bearer&#x27; }); // &lt;-- receiverToken.erp === receiver_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:665:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;a732093f-fe66-41bf-a224-f5ec1fb808e7&quot;,&quot;parentUUID&quot;:&quot;974b2905-d73d-40c2-b104-c37304e48188&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a connection request is unsuccessful due to unknown id&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 3: Delete a connection request is unsuccessful due to unknown id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownConnectionRequestId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Connection request not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:698:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;d24f119c-1c6a-4a00-b2be-6c9291bbae0e&quot;,&quot;parentUUID&quot;:&quot;974b2905-d73d-40c2-b104-c37304e48188&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a connection request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 4: Delete a connection request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst forbiddenToken = jwt.sign({erp: receiver_erp}, Config.SECRET_JWT);\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${studentConnectionId}`)\n    .auth(forbiddenToken, { type: &#x27;bearer&#x27; }); // forbiddenToken.erp !== receiver_erp or sender_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentConnection.test.js:714:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;28e79831-324e-4295-9afa-79efd0844d2b&quot;,&quot;parentUUID&quot;:&quot;974b2905-d73d-40c2-b104-c37304e48188&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a connection request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Connection Requests API DELETE /student-connections/:id Scenario 5: Delete a connection request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${studentConnectionId}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;17e4f278-807a-40a1-9432-d364a227e97b&quot;,&quot;parentUUID&quot;:&quot;974b2905-d73d-40c2-b104-c37304e48188&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;17e4f278-807a-40a1-9432-d364a227e97b&quot;],&quot;failures&quot;:[&quot;90091cf6-7de8-48dc-b0b2-4d0fd1a78ca1&quot;,&quot;a732093f-fe66-41bf-a224-f5ec1fb808e7&quot;,&quot;d24f119c-1c6a-4a00-b2be-6c9291bbae0e&quot;,&quot;28e79831-324e-4295-9afa-79efd0844d2b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d9545962-11f8-4fa0-8f96-f01b7e4f0740&quot;,&quot;title&quot;:&quot;Student Statuses API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Student Statuses API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API \&quot;before each\&quot; hook in \&quot;Student Statuses API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;283abd1c-a51d-4e97-afba-7bee769c9d3e&quot;,&quot;parentUUID&quot;:&quot;d9545962-11f8-4fa0-8f96-f01b7e4f0740&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;589f8241-559c-4a90-8ce0-cfe62a3924e0&quot;,&quot;title&quot;:&quot;GET /student-statuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all student statuses request successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses Scenario 1: Get all student statuses request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.keys([&#x27;student_status_id&#x27;, &#x27;student_status&#x27;]); // deep compare two objects using &#x27;eql&#x27;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:34:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;d9d2bd4c-dbf3-4263-9d25-cf95ddc6fe5d&quot;,&quot;parentUUID&quot;:&quot;589f8241-559c-4a90-8ce0-cfe62a3924e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all student statuses request unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses Scenario 2: Get all student statuses request unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:498,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst StudentStatusModel = require(&#x27;../../src/models/studentStatus.model&#x27;);\nconst modelStub = sinon.stub(StudentStatusModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty student_status list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student statuses not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;20e00ee4-75bd-409c-8c2f-f21b50c20d4b&quot;,&quot;parentUUID&quot;:&quot;589f8241-559c-4a90-8ce0-cfe62a3924e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;d9d2bd4c-dbf3-4263-9d25-cf95ddc6fe5d&quot;,&quot;20e00ee4-75bd-409c-8c2f-f21b50c20d4b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:505,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;68a7218d-2d14-4118-8fb1-8b59f37b033a&quot;,&quot;title&quot;:&quot;GET /student-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a student status request successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses/:id Scenario 1: Get a student status request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.keys([&#x27;student_status_id&#x27;, &#x27;student_status&#x27;]);\nexpect(resBody.student_status_id).to.be.eql(existingStudentStatus.student_status_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:70:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;ffcafd67-26ef-49a9-b180-427c04dc6e94&quot;,&quot;parentUUID&quot;:&quot;68a7218d-2d14-4118-8fb1-8b59f37b033a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a student status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses/:id Scenario 2: Get a student status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownStudentStatusId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student status not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:84:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;2119fffc-4e6e-4ecb-af84-cacb0bd98c92&quot;,&quot;parentUUID&quot;:&quot;68a7218d-2d14-4118-8fb1-8b59f37b033a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a student status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API GET /student-statuses/:id Scenario 3: Get a student status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingStudentStatus.student_status_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e57e4a29-703a-46c0-a3e0-6c4220013998&quot;,&quot;parentUUID&quot;:&quot;68a7218d-2d14-4118-8fb1-8b59f37b033a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e57e4a29-703a-46c0-a3e0-6c4220013998&quot;],&quot;failures&quot;:[&quot;ffcafd67-26ef-49a9-b180-427c04dc6e94&quot;,&quot;2119fffc-4e6e-4ecb-af84-cacb0bd98c92&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;a74b62ad-f81f-452a-b01f-7a2f80f5c0a7&quot;,&quot;title&quot;:&quot;POST /student-statuses&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a student status request is successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API POST /student-statuses Scenario 1: Create a student status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;student_status_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.student_status_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    student_status_id: newId,\n    student_status: student_status\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:117:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;bcba55b6-da13-491a-a7ab-25f4db9a2369&quot;,&quot;parentUUID&quot;:&quot;a74b62ad-f81f-452a-b01f-7a2f80f5c0a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a student status request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API POST /student-statuses Scenario 2: Create a student status request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    student_statuses: student_status // &lt;-- a valid parameter name should be &#x27;student_status&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;student_status&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;168fc65e-61ea-4ddf-99fc-86114f62508a&quot;,&quot;parentUUID&quot;:&quot;a74b62ad-f81f-452a-b01f-7a2f80f5c0a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a student status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API POST /student-statuses Scenario 3: Create a student status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:172:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;44c52da2-7f59-4354-adbb-cbb8382f4afe&quot;,&quot;parentUUID&quot;:&quot;a74b62ad-f81f-452a-b01f-7a2f80f5c0a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a student status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API POST /student-statuses Scenario 4: Create a student status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;234b24ae-05a0-45b7-ae97-23db2a079603&quot;,&quot;parentUUID&quot;:&quot;a74b62ad-f81f-452a-b01f-7a2f80f5c0a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;234b24ae-05a0-45b7-ae97-23db2a079603&quot;],&quot;failures&quot;:[&quot;bcba55b6-da13-491a-a7ab-25f4db9a2369&quot;,&quot;168fc65e-61ea-4ddf-99fc-86114f62508a&quot;,&quot;44c52da2-7f59-4354-adbb-cbb8382f4afe&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:38,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;24171dae-7675-4164-8b64-16a97322ef74&quot;,&quot;title&quot;:&quot;PATCH /student-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a student status request is successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 1: Update a student status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status: newStudentStatus };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    student_status_id: existingStudentStatus.student_status_id,\n    student_status: newStudentStatus\n});\n\n// cleanup\ndata.student_status = existingStudentStatus.student_status;\nres = await request(app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:210:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;c477d540-f372-476f-a6b7-0e623bc2e7ab&quot;,&quot;parentUUID&quot;:&quot;24171dae-7675-4164-8b64-16a97322ef74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a student status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 2: Update a student status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status: newStudentStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownStudentStatusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student status not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:247:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;a0f98082-bb86-4209-9f27-306bf6752e1d&quot;,&quot;parentUUID&quot;:&quot;24171dae-7675-4164-8b64-16a97322ef74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a student status request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 3: Update a student status request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    student_statuses: newStudentStatus // &lt;-- a valid parameter name should be &#x27;student_status&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;student_status&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:266:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;1d362be8-4ffe-4ac4-8121-21565e932d13&quot;,&quot;parentUUID&quot;:&quot;24171dae-7675-4164-8b64-16a97322ef74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a student status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 4: Update a student status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status: newStudentStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:284:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;8b79fdc1-1f2c-470b-8716-80f93c585d40&quot;,&quot;parentUUID&quot;:&quot;24171dae-7675-4164-8b64-16a97322ef74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a student status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API PATCH /student-statuses/:id Scenario 5: Update a student status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { student_status: newStudentStatus };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ae702477-82f3-4c8c-82d1-2b9bd18a2f45&quot;,&quot;parentUUID&quot;:&quot;24171dae-7675-4164-8b64-16a97322ef74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ae702477-82f3-4c8c-82d1-2b9bd18a2f45&quot;],&quot;failures&quot;:[&quot;c477d540-f372-476f-a6b7-0e623bc2e7ab&quot;,&quot;a0f98082-bb86-4209-9f27-306bf6752e1d&quot;,&quot;1d362be8-4ffe-4ac4-8121-21565e932d13&quot;,&quot;8b79fdc1-1f2c-470b-8716-80f93c585d40&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:38,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1352cfb4-3191-4b80-8e20-cce3f3691b98&quot;,&quot;title&quot;:&quot;DELETE /student-statuses/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\studentStatus.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\studentStatus.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a student status request is successful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API DELETE /student-statuses/:id Scenario 1: Delete a student status request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { student_status };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.student_status_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student status has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:320:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;2c3fee89-809f-4076-88e9-1188786493e6&quot;,&quot;parentUUID&quot;:&quot;1352cfb4-3191-4b80-8e20-cce3f3691b98&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a student status request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API DELETE /student-statuses/:id Scenario 2: Delete a student status request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownStudentStatusId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Student status not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:352:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;737c2572-1215-4d28-b64b-51cfc955cd43&quot;,&quot;parentUUID&quot;:&quot;1352cfb4-3191-4b80-8e20-cce3f3691b98&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a student status request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API DELETE /student-statuses/:id Scenario 3: Delete a student status request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudentStatus.student_status_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\studentStatus.test.js:365:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;02e30e9b-1216-4500-a60d-2e9dc917755e&quot;,&quot;parentUUID&quot;:&quot;1352cfb4-3191-4b80-8e20-cce3f3691b98&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a student status request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Student Statuses API DELETE /student-statuses/:id Scenario 4: Delete a student status request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingStudentStatus.student_status_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d5671aff-782d-4e91-b3c6-66d4d77b215a&quot;,&quot;parentUUID&quot;:&quot;1352cfb4-3191-4b80-8e20-cce3f3691b98&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d5671aff-782d-4e91-b3c6-66d4d77b215a&quot;],&quot;failures&quot;:[&quot;2c3fee89-809f-4076-88e9-1188786493e6&quot;,&quot;737c2572-1215-4d28-b64b-51cfc955cd43&quot;,&quot;02e30e9b-1216-4500-a60d-2e9dc917755e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:25,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b0061797-b9f4-4009-8596-b0e3c4eec9ef&quot;,&quot;title&quot;:&quot;Subjects API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Subjects API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Subjects API \&quot;before each\&quot; hook in \&quot;Subjects API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aa8870c5-18ab-46ee-a6c0-5aa1f9e86dd1&quot;,&quot;parentUUID&quot;:&quot;b0061797-b9f4-4009-8596-b0e3c4eec9ef&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e577900f-eec0-4909-a98c-8c6e963be838&quot;,&quot;title&quot;:&quot;GET /subjects&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all subjects request successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects Scenario 1: Get all subjects request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys([&#x27;subject_code&#x27;, &#x27;subject&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:35:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;8832b8ab-0e7a-4e2a-a036-685710e167f2&quot;,&quot;parentUUID&quot;:&quot;e577900f-eec0-4909-a98c-8c6e963be838&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all subjects request unsuccessful due to zero subjects&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects Scenario 2: Get all subjects request unsuccessful due to zero subjects&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:489,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst SubjectModel = require(&#x27;../../src/models/subject.model&#x27;);\nconst modelStub = sinon.stub(SubjectModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty subject list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subjects not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;e24bb281-6a29-4d0c-acd3-cd2fead0de1d&quot;,&quot;parentUUID&quot;:&quot;e577900f-eec0-4909-a98c-8c6e963be838&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects Scenario 3: Get a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:69:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;47000052-abcc-4633-90c1-8ee2912a9a83&quot;,&quot;parentUUID&quot;:&quot;e577900f-eec0-4909-a98c-8c6e963be838&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all subjects request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects Scenario 4: Get all subjects request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;003dde13-b2c3-4f27-a8bb-58338dfc0a1f&quot;,&quot;parentUUID&quot;:&quot;e577900f-eec0-4909-a98c-8c6e963be838&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;003dde13-b2c3-4f27-a8bb-58338dfc0a1f&quot;],&quot;failures&quot;:[&quot;8832b8ab-0e7a-4e2a-a036-685710e167f2&quot;,&quot;e24bb281-6a29-4d0c-acd3-cd2fead0de1d&quot;,&quot;47000052-abcc-4633-90c1-8ee2912a9a83&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:520,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;3a226d1e-692c-48f9-8bf6-1e6d126c0cd9&quot;,&quot;title&quot;:&quot;GET /subjects/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a subject request successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects/:id Scenario 1: Get a subject request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys([&#x27;subject_code&#x27;, &#x27;subject&#x27;]);\nexpect(resBody.subject_code).to.be.equal(existingSubject.subject_code); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:95:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;3077035b-8179-476e-875f-71e1244f1806&quot;,&quot;parentUUID&quot;:&quot;3a226d1e-692c-48f9-8bf6-1e6d126c0cd9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a subject request is unsuccessful due to unknown subject&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects/:id Scenario 2: Get a subject request is unsuccessful due to unknown subject&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownSubjectId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subject not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:109:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;0bd185b3-e94f-4997-b5a5-795410ce4a40&quot;,&quot;parentUUID&quot;:&quot;3a226d1e-692c-48f9-8bf6-1e6d126c0cd9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects/:id Scenario 3: Get a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:122:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;1692fc92-a78f-428b-83f1-87018aeaecdc&quot;,&quot;parentUUID&quot;:&quot;3a226d1e-692c-48f9-8bf6-1e6d126c0cd9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API GET /subjects/:id Scenario 4: Get a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingSubject.subject_code}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c5e03738-ee98-42ce-87a7-501eebbb2615&quot;,&quot;parentUUID&quot;:&quot;3a226d1e-692c-48f9-8bf6-1e6d126c0cd9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c5e03738-ee98-42ce-87a7-501eebbb2615&quot;],&quot;failures&quot;:[&quot;3077035b-8179-476e-875f-71e1244f1806&quot;,&quot;0bd185b3-e94f-4997-b5a5-795410ce4a40&quot;,&quot;1692fc92-a78f-428b-83f1-87018aeaecdc&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:32,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;396dd964-fe3d-4483-92cd-bb6f608ccf05&quot;,&quot;title&quot;:&quot;POST /subjects&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a subject request is successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API POST /subjects Scenario 1: Create a subject request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject, subject_code };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = data.subject_code;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    subject_code: newId,\n    subject: subject\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:156:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;48b2b3e3-8bc5-45ad-926a-c676b90f8f73&quot;,&quot;parentUUID&quot;:&quot;396dd964-fe3d-4483-92cd-bb6f608ccf05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a subject request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Subjects API POST /subjects Scenario 2: Create a subject request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    subjects: subject // &lt;-- a valid parameter name should be &#x27;subject&#x27;\n    // subject_code is required\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;subject&#x27;, &#x27;subject_code&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:194:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;0a81189f-5430-484f-a72c-f07499e5fb37&quot;,&quot;parentUUID&quot;:&quot;396dd964-fe3d-4483-92cd-bb6f608ccf05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API POST /subjects Scenario 3: Create a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject, subject_code };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:212:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;9e7f44c1-28d8-4c4d-a4a1-c5521af3ae60&quot;,&quot;parentUUID&quot;:&quot;396dd964-fe3d-4483-92cd-bb6f608ccf05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API POST /subjects Scenario 4: Create a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject, subject_code };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6f915326-6f30-4904-9026-8fbd38905bc9&quot;,&quot;parentUUID&quot;:&quot;396dd964-fe3d-4483-92cd-bb6f608ccf05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6f915326-6f30-4904-9026-8fbd38905bc9&quot;],&quot;failures&quot;:[&quot;48b2b3e3-8bc5-45ad-926a-c676b90f8f73&quot;,&quot;0a81189f-5430-484f-a72c-f07499e5fb37&quot;,&quot;9e7f44c1-28d8-4c4d-a4a1-c5521af3ae60&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;15a172dc-b015-44b4-b885-b343b4f9c564&quot;,&quot;title&quot;:&quot;PATCH /subjects/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a subject request is successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 1: Update a subject request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject: newSubject };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    subject_code: existingSubject.subject_code,\n    subject: newSubject\n});\n\n// cleanup\ndata.subject = existingSubject.subject;\nres = await request(app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:250:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;11bdbe54-e714-4120-bc54-31309aac915a&quot;,&quot;parentUUID&quot;:&quot;15a172dc-b015-44b4-b885-b343b4f9c564&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a subject request is unsuccessful due to unknown subject code&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 2: Update a subject request is unsuccessful due to unknown subject code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject: newSubject };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownSubjectId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subject not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:287:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;f9fd967e-ecf6-4300-b612-3edc3624fcfc&quot;,&quot;parentUUID&quot;:&quot;15a172dc-b015-44b4-b885-b343b4f9c564&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a subject request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 3: Update a subject request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    subjects: newSubject // &lt;-- a valid parameter name should be &#x27;subject&#x27;\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;subject&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:306:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;1c6ad988-da16-4acb-8d31-136ccf803ccb&quot;,&quot;parentUUID&quot;:&quot;15a172dc-b015-44b4-b885-b343b4f9c564&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 4: Update a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject: newSubject };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:324:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;eeddb746-fd3a-4c39-b228-8fbb6c69bc02&quot;,&quot;parentUUID&quot;:&quot;15a172dc-b015-44b4-b885-b343b4f9c564&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API PATCH /subjects/:id Scenario 5: Update a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { subject: newSubject };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingSubject.subject_code}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c2934423-8013-4396-ae18-1a6f76a8d997&quot;,&quot;parentUUID&quot;:&quot;15a172dc-b015-44b4-b885-b343b4f9c564&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c2934423-8013-4396-ae18-1a6f76a8d997&quot;],&quot;failures&quot;:[&quot;11bdbe54-e714-4120-bc54-31309aac915a&quot;,&quot;f9fd967e-ecf6-4300-b612-3edc3624fcfc&quot;,&quot;1c6ad988-da16-4acb-8d31-136ccf803ccb&quot;,&quot;eeddb746-fd3a-4c39-b228-8fbb6c69bc02&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ae1013f1-00be-403d-a3ce-501e414ab7f3&quot;,&quot;title&quot;:&quot;DELETE /subjects/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\subject.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\subject.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a subject request is successful&quot;,&quot;fullTitle&quot;:&quot;Subjects API DELETE /subjects/:id Scenario 1: Delete a subject request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { subject, subject_code };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = data.subject_code;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subject has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:361:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;c0783729-31d4-494d-8dea-b13b267312e8&quot;,&quot;parentUUID&quot;:&quot;ae1013f1-00be-403d-a3ce-501e414ab7f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a subject request is unsuccessful due to unknown subject code&quot;,&quot;fullTitle&quot;:&quot;Subjects API DELETE /subjects/:id Scenario 2: Delete a subject request is unsuccessful due to unknown subject code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownSubjectId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Subject not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:393:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;ef752478-bd0e-40ed-9aef-830c340cea64&quot;,&quot;parentUUID&quot;:&quot;ae1013f1-00be-403d-a3ce-501e414ab7f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a subject request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Subjects API DELETE /subjects/:id Scenario 3: Delete a subject request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingSubject.subject_code}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\subject.test.js:406:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;9d76a69d-85e4-4415-a1f7-a4ff12273481&quot;,&quot;parentUUID&quot;:&quot;ae1013f1-00be-403d-a3ce-501e414ab7f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a subject request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Subjects API DELETE /subjects/:id Scenario 4: Delete a subject request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingSubject.subject_code}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;874f1780-f37c-44b8-8585-17b78021d028&quot;,&quot;parentUUID&quot;:&quot;ae1013f1-00be-403d-a3ce-501e414ab7f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;874f1780-f37c-44b8-8585-17b78021d028&quot;],&quot;failures&quot;:[&quot;c0783729-31d4-494d-8dea-b13b267312e8&quot;,&quot;ef752478-bd0e-40ed-9aef-830c340cea64&quot;,&quot;9d76a69d-85e4-4415-a1f7-a4ff12273481&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;26eaedf4-df19-486d-ab74-7ceaf8ca299f&quot;,&quot;title&quot;:&quot;Teachers API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Teachers API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Teachers API \&quot;before each\&quot; hook in \&quot;Teachers API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;01365941-70cc-4c11-b91e-39b3fb948ca3&quot;,&quot;parentUUID&quot;:&quot;26eaedf4-df19-486d-ab74-7ceaf8ca299f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4edaebbc-e359-4fef-8f25-438efa7ca7fc&quot;,&quot;title&quot;:&quot;GET /teachers&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all teachers request successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers Scenario 1: Get all teachers request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTeacher));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:36:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;747d3cb6-79e4-4b63-8136-eb46949e1f79&quot;,&quot;parentUUID&quot;:&quot;4edaebbc-e359-4fef-8f25-438efa7ca7fc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all teachers request unsuccessful due to zero teachers&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers Scenario 2: Get all teachers request unsuccessful due to zero teachers&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:605,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TeacherModel = require(&#x27;../../src/models/teacher.model&#x27;);\nconst modelStub = sinon.stub(TeacherModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty teacher list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;64461c28-32a7-4c02-bcf9-4c613544f1ce&quot;,&quot;parentUUID&quot;:&quot;4edaebbc-e359-4fef-8f25-438efa7ca7fc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers Scenario 3: Get a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:68:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;98c5ca4a-ce5e-4527-b445-c6869f5f76c2&quot;,&quot;parentUUID&quot;:&quot;4edaebbc-e359-4fef-8f25-438efa7ca7fc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all teachers request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers Scenario 4: Get all teachers request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;427d5970-af92-4c43-ae57-a3be843b72c4&quot;,&quot;parentUUID&quot;:&quot;4edaebbc-e359-4fef-8f25-438efa7ca7fc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;427d5970-af92-4c43-ae57-a3be843b72c4&quot;],&quot;failures&quot;:[&quot;747d3cb6-79e4-4b63-8136-eb46949e1f79&quot;,&quot;64461c28-32a7-4c02-bcf9-4c613544f1ce&quot;,&quot;98c5ca4a-ce5e-4527-b445-c6869f5f76c2&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:627,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ba0a349f-c8dd-4472-b8ae-427417aab1bd&quot;,&quot;title&quot;:&quot;GET /teachers/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a teacher request successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers/:id Scenario 1: Get a teacher request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingTeacher));\nexpect(resBody.teacher_id).to.be.equal(existingTeacher.teacher_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:94:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;7f0d81a9-56c7-4782-bcd7-1e3f9d8c3302&quot;,&quot;parentUUID&quot;:&quot;ba0a349f-c8dd-4472-b8ae-427417aab1bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers/:id Scenario 2: Get a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTeacherId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:108:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;14b072ff-1a5a-4df4-9a2a-a6290c092019&quot;,&quot;parentUUID&quot;:&quot;ba0a349f-c8dd-4472-b8ae-427417aab1bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers/:id Scenario 3: Get a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:121:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;093457c6-1587-4ebc-9455-0e6241b2cd27&quot;,&quot;parentUUID&quot;:&quot;ba0a349f-c8dd-4472-b8ae-427417aab1bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a teacher request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API GET /teachers/:id Scenario 4: Get a teacher request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTeacher.teacher_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;19e95c0b-13c3-4cea-a40a-a4b05646bc33&quot;,&quot;parentUUID&quot;:&quot;ba0a349f-c8dd-4472-b8ae-427417aab1bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;19e95c0b-13c3-4cea-a40a-a4b05646bc33&quot;],&quot;failures&quot;:[&quot;7f0d81a9-56c7-4782-bcd7-1e3f9d8c3302&quot;,&quot;14b072ff-1a5a-4df4-9a2a-a6290c092019&quot;,&quot;093457c6-1587-4ebc-9455-0e6241b2cd27&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:19,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;2dd542ed-aec6-4b09-bf54-1b79c8b6ba31&quot;,&quot;title&quot;:&quot;POST /teachers&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a teacher request is successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API POST /teachers Scenario 1: Create a teacher request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;teacher_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.teacher_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    teacher_id: newId,\n    average_rating: \&quot;0.000\&quot;,\n    total_reviews: 0,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;eb590fab-49c1-44f6-a865-3f7f90ca5fea&quot;,&quot;parentUUID&quot;:&quot;2dd542ed-aec6-4b09-bf54-1b79c8b6ba31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a teacher request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Teachers API POST /teachers Scenario 2: Create a teacher request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    full_names: full_name // &lt;-- a valid parameter name is &#x27;full_name&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;full_name&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:193:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;89144589-8f95-446a-9b0c-5483781b2239&quot;,&quot;parentUUID&quot;:&quot;2dd542ed-aec6-4b09-bf54-1b79c8b6ba31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API POST /teachers Scenario 3: Create a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:211:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;141d50d1-313e-41f7-8533-7ffab37a1322&quot;,&quot;parentUUID&quot;:&quot;2dd542ed-aec6-4b09-bf54-1b79c8b6ba31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a teacher request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API POST /teachers Scenario 4: Create a teacher request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c8d6d527-6574-4a92-b0a3-6335b1b0a30a&quot;,&quot;parentUUID&quot;:&quot;2dd542ed-aec6-4b09-bf54-1b79c8b6ba31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c8d6d527-6574-4a92-b0a3-6335b1b0a30a&quot;],&quot;failures&quot;:[&quot;eb590fab-49c1-44f6-a865-3f7f90ca5fea&quot;,&quot;89144589-8f95-446a-9b0c-5483781b2239&quot;,&quot;141d50d1-313e-41f7-8533-7ffab37a1322&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:31,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0c257af9-dc6d-4085-8583-ffac8dd0e711&quot;,&quot;title&quot;:&quot;PATCH /teachers/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a teacher request is successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 1: Update a teacher request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name: newTeacherName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    teacher_id: existingTeacher.teacher_id,\n    full_name: newTeacherName,\n    average_rating: existingTeacher.average_rating,\n    total_reviews: existingTeacher.total_reviews\n});\n\n// cleanup\ndata.full_name = existingTeacher.full_name;\nres = await request(app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:249:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;57ec425d-600c-4f65-a28f-b3a2c5b63b59&quot;,&quot;parentUUID&quot;:&quot;0c257af9-dc6d-4085-8583-ffac8dd0e711&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 2: Update a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name: newTeacherName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTeacherId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:288:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;99bdb19f-1dd4-430b-a328-93e0a54c15f3&quot;,&quot;parentUUID&quot;:&quot;0c257af9-dc6d-4085-8583-ffac8dd0e711&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a teacher request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 3: Update a teacher request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    full_names: newTeacherName // &lt;-- a invalid update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;full_name&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:307:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;bb1551f7-ec93-4bdf-86c1-176563205a73&quot;,&quot;parentUUID&quot;:&quot;0c257af9-dc6d-4085-8583-ffac8dd0e711&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 4: Update a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name: newTeacherName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:327:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;841ab895-abf9-4b0f-9486-942d849cb0b3&quot;,&quot;parentUUID&quot;:&quot;0c257af9-dc6d-4085-8583-ffac8dd0e711&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a teacher request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API PATCH /teachers/:id Scenario 5: Update a teacher request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { full_name: newTeacherName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7db907fc-23f6-4e49-9e29-17be2231d8a4&quot;,&quot;parentUUID&quot;:&quot;0c257af9-dc6d-4085-8583-ffac8dd0e711&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7db907fc-23f6-4e49-9e29-17be2231d8a4&quot;],&quot;failures&quot;:[&quot;57ec425d-600c-4f65-a28f-b3a2c5b63b59&quot;,&quot;99bdb19f-1dd4-430b-a328-93e0a54c15f3&quot;,&quot;bb1551f7-ec93-4bdf-86c1-176563205a73&quot;,&quot;841ab895-abf9-4b0f-9486-942d849cb0b3&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b975febd-62e8-42e3-90c4-68337bc91b1d&quot;,&quot;title&quot;:&quot;DELETE /teachers/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacher.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacher.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a teacher request is successful&quot;,&quot;fullTitle&quot;:&quot;Teachers API DELETE /teachers/:id Scenario 1: Delete a teacher request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { full_name };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.teacher_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:363:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;7525dda7-7b41-4541-bd5d-7a7be49b572b&quot;,&quot;parentUUID&quot;:&quot;b975febd-62e8-42e3-90c4-68337bc91b1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Teachers API DELETE /teachers/:id Scenario 2: Delete a teacher request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTeacherId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:395:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;c22cf870-75b0-4b73-a7fb-170aee3c522b&quot;,&quot;parentUUID&quot;:&quot;b975febd-62e8-42e3-90c4-68337bc91b1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a teacher request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teachers API DELETE /teachers/:id Scenario 3: Delete a teacher request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacher.teacher_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacher.test.js:408:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;0cbcfd76-55a5-43b4-b658-32ec1d1f52ea&quot;,&quot;parentUUID&quot;:&quot;b975febd-62e8-42e3-90c4-68337bc91b1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a teacher request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teachers API DELETE /teachers/:id Scenario 4: Delete a teacher request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacher.teacher_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f9dca692-3ee9-4a2f-814f-938b0e56e86c&quot;,&quot;parentUUID&quot;:&quot;b975febd-62e8-42e3-90c4-68337bc91b1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f9dca692-3ee9-4a2f-814f-938b0e56e86c&quot;],&quot;failures&quot;:[&quot;7525dda7-7b41-4541-bd5d-7a7be49b572b&quot;,&quot;c22cf870-75b0-4b73-a7fb-170aee3c522b&quot;,&quot;0cbcfd76-55a5-43b4-b658-32ec1d1f52ea&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9fb2e688-8106-4d29-b580-546a59c8bc1b&quot;,&quot;title&quot;:&quot;Teacher Reviews API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Teacher Reviews API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API \&quot;before each\&quot; hook in \&quot;Teacher Reviews API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b6d4d659-a497-47f7-9fd6-62ec194e462b&quot;,&quot;parentUUID&quot;:&quot;9fb2e688-8106-4d29-b580-546a59c8bc1b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ca0e25f1-7201-4d85-a27a-4381d20e85ee&quot;,&quot;title&quot;:&quot;GET /teacher-reviews&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all teacher reviews request successful&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 1: Get all teacher reviews request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst teacher_id = existingTeacherReview.teacher_id;\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?teacher_id=${teacher_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst reviewerCheck = review =&gt; review.teacher_id === teacher_id;\nexpect(resBody.every(reviewerCheck)).to.be.true; // should match initially sent query params\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTeacherReview));\nexpect(resBody[0].subject).to.include.all.keys(Object.keys(existingTeacherReview.subject));\nexpect(resBody[0].reviewed_by).to.include.all.keys(Object.keys(existingTeacherReview.reviewed_by));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:61:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;79352248-e745-460f-837d-21ba2288ba6d&quot;,&quot;parentUUID&quot;:&quot;ca0e25f1-7201-4d85-a27a-4381d20e85ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all teacher reviews request unsuccessful due to zero teacher reviews&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 2: Get all teacher reviews request unsuccessful due to zero teacher reviews&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:514,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TeacherReviewModel = require(&#x27;../../src/models/teacherReview.model&#x27;);\nconst modelStub = sinon.stub(TeacherReviewModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty teacher review list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(`${baseRoute}?teacher_id=${existingTeacherReview.teacher_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.an(&#x27;array&#x27;).that.is.empty;\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;4b3054aa-fc88-41c3-9a03-ad416893f564&quot;,&quot;parentUUID&quot;:&quot;ca0e25f1-7201-4d85-a27a-4381d20e85ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all teacher reviews is incorrect due to no query params&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 3: Get all teacher reviews is incorrect due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute) // needs teacher_id\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;TeacherID is required for the teacherReview&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:97:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;0d53a85f-dba8-47a7-88bf-b471f5b75ea8&quot;,&quot;parentUUID&quot;:&quot;ca0e25f1-7201-4d85-a27a-4381d20e85ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all teacher reviews is incorrect due to unknown query params&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 4: Get all teacher reviews is incorrect due to unknown query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst teacher_id = existingTeacherReview.teacher_id;\nconst subject_code = \&quot;MM22\&quot;; // a valid subject code is 6 characters\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?teacher_id=${teacher_id}&amp;subject_code=${subject_code}&amp;overall_rating=2.0`) // &lt;-- &#x27;overall_rating&#x27; is not a query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;subject_code&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:115:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;a9eb97f0-c61e-495b-a597-57cf4f02cfae&quot;,&quot;parentUUID&quot;:&quot;ca0e25f1-7201-4d85-a27a-4381d20e85ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all teacher reviews request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews Scenario 5: Get all teacher reviews request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;38e7227c-dc32-4715-95fa-426a0da08d48&quot;,&quot;parentUUID&quot;:&quot;ca0e25f1-7201-4d85-a27a-4381d20e85ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;38e7227c-dc32-4715-95fa-426a0da08d48&quot;],&quot;failures&quot;:[&quot;79352248-e745-460f-837d-21ba2288ba6d&quot;,&quot;4b3054aa-fc88-41c3-9a03-ad416893f564&quot;,&quot;0d53a85f-dba8-47a7-88bf-b471f5b75ea8&quot;,&quot;a9eb97f0-c61e-495b-a597-57cf4f02cfae&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:555,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;d818e523-0690-4853-bb37-4cf90b9036a7&quot;,&quot;title&quot;:&quot;GET /teacher-reviews/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a teacher review request successful&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews/:id Scenario 1: Get a teacher review request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTeacherReview.review_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingTeacherReview));\nexpect(resBody.review_id).to.be.equal(existingTeacherReview.review_id); // should match initially sent id\nexpect(resBody.subject).to.include.all.keys(Object.keys(existingTeacherReview.subject));\nexpect(resBody.reviewed_by).to.include.all.keys(Object.keys(existingTeacherReview.reviewed_by));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:144:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;f80b30ad-527f-4026-8839-224c784a73d8&quot;,&quot;parentUUID&quot;:&quot;d818e523-0690-4853-bb37-4cf90b9036a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a teacher review request is unsuccessful due to unknown review_id&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews/:id Scenario 2: Get a teacher review request is unsuccessful due to unknown review_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTeacherReviewId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher review not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:160:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;ce4af515-780a-4cc9-826c-c21b696395ea&quot;,&quot;parentUUID&quot;:&quot;d818e523-0690-4853-bb37-4cf90b9036a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a teacher review request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API GET /teacher-reviews/:id Scenario 3: Get a teacher review request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTeacherReview.review_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e7d76c5b-3454-408d-b1b8-b13df6cadcff&quot;,&quot;parentUUID&quot;:&quot;d818e523-0690-4853-bb37-4cf90b9036a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e7d76c5b-3454-408d-b1b8-b13df6cadcff&quot;],&quot;failures&quot;:[&quot;f80b30ad-527f-4026-8839-224c784a73d8&quot;,&quot;ce4af515-780a-4cc9-826c-c21b696395ea&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:18,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;b9e7156d-7128-4925-a8d1-a170d1c55d20&quot;,&quot;title&quot;:&quot;POST /teacher-reviews&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a teacher review request is successful&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 1: Create a teacher review request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;review_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// rearrange\nconst newId = res.body.body.review_id;\nconst { old_teacher_rating, old_total_reviews, ...reviewBody } = data;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nconst resBody = res.body.body;\nexpect(resBody.review_id).to.be.equal(newId);\nexpect(resBody.subject.subject_code).to.be.equal(data.subject_code);\nexpect(resBody.reviewed_by.erp).to.be.equal(data.reviewed_by_erp);\n// cleanup\nconst { overall_rating: review_rating } = resBody;\nconst TeacherReviewRepository = require(&#x27;../../src/repositories/teacherReview.repository&#x27;);\nconst newTeacherRating = TeacherReviewRepository.incrementTeacherRating(review_rating, old_teacher_rating, old_total_reviews);\nconst deleteData = {\n    teacher_id: reviewBody.teacher_id,\n    teacher_rating: newTeacherRating,\n    total_reviews: old_total_reviews + 1,\n    review_rating\n};\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(deleteData);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:205:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;21f706ab-5e41-4e24-b4d4-58d27f673f01&quot;,&quot;parentUUID&quot;:&quot;b9e7156d-7128-4925-a8d1-a170d1c55d20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a teacher review request is unsuccessful due to unknown teacher_id&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 2: Create a teacher review request is unsuccessful due to unknown teacher_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\ndata.teacher_id = unknownTeacherId; // non existing teacher_id\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;teacher_id&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:254:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;b4a280c0-722d-42d0-b521-29664a112ceb&quot;,&quot;parentUUID&quot;:&quot;b9e7156d-7128-4925-a8d1-a170d1c55d20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a teacher review request is unsuccessful due to unknown subject_code&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 3: Create a teacher review request is unsuccessful due to unknown subject_code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\ndata.subject_code = unknownSubjectCode; // non existing subject_code\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contains(&#x27;subject_code&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:272:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;2711a10b-3771-480a-acd8-101203f37b13&quot;,&quot;parentUUID&quot;:&quot;b9e7156d-7128-4925-a8d1-a170d1c55d20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a teacher review request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 4: Create a teacher review request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\ndelete data.old_teacher_rating; // make it missing\ndata.learning = 9; // should be between 1 and 5\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;old_teacher_rating&#x27;, &#x27;learning&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:291:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;9cbd224c-b3c5-4137-9072-16c738ce96f0&quot;,&quot;parentUUID&quot;:&quot;b9e7156d-7128-4925-a8d1-a170d1c55d20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a teacher review request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 5: Create a teacher review request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview }; // reviewed_by_erp === adminERP\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:309:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;f49062a4-c1c0-48bc-af86-b24d6f717835&quot;,&quot;parentUUID&quot;:&quot;b9e7156d-7128-4925-a8d1-a170d1c55d20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Create a teacher review request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API POST /teacher-reviews Scenario 6: Create a teacher review request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTeacherReview };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c0c1a0d6-52d1-439e-9959-3fb9871c8c68&quot;,&quot;parentUUID&quot;:&quot;b9e7156d-7128-4925-a8d1-a170d1c55d20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c0c1a0d6-52d1-439e-9959-3fb9871c8c68&quot;],&quot;failures&quot;:[&quot;21f706ab-5e41-4e24-b4d4-58d27f673f01&quot;,&quot;b4a280c0-722d-42d0-b521-29664a112ceb&quot;,&quot;2711a10b-3771-480a-acd8-101203f37b13&quot;,&quot;9cbd224c-b3c5-4137-9072-16c738ce96f0&quot;,&quot;f49062a4-c1c0-48bc-af86-b24d6f717835&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:71,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;6da37ddb-3eae-4ee7-a8bc-82b51d34d6d8&quot;,&quot;title&quot;:&quot;DELETE /teacher-reviews/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\teacherReview.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\teacherReview.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a teacher review request is successful&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 1: Delete a teacher review request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { ...newTeacherReview };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst {review_id: newId} = res.body.body;\nconst TeacherReviewRepository = require(&#x27;../../src/repositories/teacherReview.repository&#x27;);\nconst review_rating = TeacherReviewRepository.calculateAverageRating(data);\nconst newTeacherRating = TeacherReviewRepository.incrementTeacherRating(review_rating, data.old_teacher_rating, data.old_total_reviews);\nconst deleteData = {\n    teacher_id: data.teacher_id,\n    teacher_rating: newTeacherRating,\n    total_reviews: data.old_total_reviews + 1,\n    review_rating: review_rating.toFixed(3)\n};\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(deleteData);\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher review has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:357:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;805e912d-542c-40ee-af93-7a431b920181&quot;,&quot;parentUUID&quot;:&quot;6da37ddb-3eae-4ee7-a8bc-82b51d34d6d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a teacher review request is unsuccessful due to unknown review_id&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 2: Delete a teacher review request is unsuccessful due to unknown review_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst TeacherReviewRepository = require(&#x27;../../src/repositories/teacherReview.repository&#x27;);\nconst review_rating = TeacherReviewRepository.calculateAverageRating(newTeacherReview);\nconst deleteData = {\n    teacher_id: newTeacherReview.teacher_id,\n    teacher_rating: newTeacherReview.old_teacher_rating,\n    total_reviews: newTeacherReview.old_total_reviews,\n    review_rating: review_rating.toFixed(3)\n};\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTeacherReviewId}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; })\n    .send(deleteData);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Teacher review not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:410:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;43ca99e2-73a5-4464-8a02-1d2d0ece5f32&quot;,&quot;parentUUID&quot;:&quot;6da37ddb-3eae-4ee7-a8bc-82b51d34d6d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a teacher review request is incorrect due to inconsistent body params&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 3: Delete a teacher review request is incorrect due to inconsistent body params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst deleteData = {\n    teacher_id: unknownTeacherId, // not the same as the review being deleted\n    teacher_rating: newTeacherReview.old_teacher_rating,\n    total_reviews: newTeacherReview.old_total_reviews,\n    review_rating: \&quot;0.000\&quot; // not the same as the review being deleted\n};\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacherReview.review_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(deleteData);\n    \n// assert\nexpect(res.status).to.be.equal(500);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;DeleteFailedException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;InternalServerException&#x27; to equal &#x27;DeleteFailedException&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;InternalServerException&#x27; to equal &#x27;DeleteFailedException&#x27;\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:434:49)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;InternalServerException&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;DeleteFailedException&quot;}]},&quot;uuid&quot;:&quot;818d5eb9-cc38-42e1-881c-545fcc92c77e&quot;,&quot;parentUUID&quot;:&quot;6da37ddb-3eae-4ee7-a8bc-82b51d34d6d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a teacher review request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 4: Delete a teacher review request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst deleteData = {\n    teacher_id: existingTeacherReview.teacher_id,\n    teacher_rating: newTeacherReview.old_teacher_rating,\n    total_reviews: newTeacherReview.old_total_reviews,\n    review_rating: existingTeacherReview.overall_rating\n};\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacherReview.review_id}`)\n    .auth(user2Token, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(deleteData);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\teacherReview.test.js:453:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;d541a887-8ece-414d-8a0e-64a9c7628cce&quot;,&quot;parentUUID&quot;:&quot;6da37ddb-3eae-4ee7-a8bc-82b51d34d6d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a teacher review request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Teacher Reviews API DELETE /teacher-reviews/:id Scenario 5: Delete a teacher review request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst deleteData = {\n    teacher_id: newTeacherReview.teacher_id,\n    teacher_rating: newTeacherReview.old_teacher_rating,\n    total_reviews: newTeacherReview.old_total_reviews,\n    review_rating: \&quot;4.300\&quot;\n};\n\n// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTeacherReview.review_id}`)\n    .send(deleteData);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7445cd48-3fb4-4342-b951-784c4c3b7474&quot;,&quot;parentUUID&quot;:&quot;6da37ddb-3eae-4ee7-a8bc-82b51d34d6d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7445cd48-3fb4-4342-b951-784c4c3b7474&quot;],&quot;failures&quot;:[&quot;805e912d-542c-40ee-af93-7a431b920181&quot;,&quot;43ca99e2-73a5-4464-8a02-1d2d0ece5f32&quot;,&quot;818d5eb9-cc38-42e1-881c-545fcc92c77e&quot;,&quot;d541a887-8ece-414d-8a0e-64a9c7628cce&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;e4c46c1c-a6ce-478d-90ab-d17e795964fd&quot;,&quot;title&quot;:&quot;Terms API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Terms API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Terms API \&quot;before each\&quot; hook in \&quot;Terms API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b2436ef9-fed5-456d-85dc-6f929a4b97db&quot;,&quot;parentUUID&quot;:&quot;e4c46c1c-a6ce-478d-90ab-d17e795964fd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;53f736cb-ae52-40e8-b845-ea1ea97d13d2&quot;,&quot;title&quot;:&quot;GET /terms&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all terms request successful&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms Scenario 1: Get all terms request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTerm));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:34:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;6ddd5f25-3ed5-4e9c-b9ee-ee779b6ce314&quot;,&quot;parentUUID&quot;:&quot;53f736cb-ae52-40e8-b845-ea1ea97d13d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all terms request unsuccessful due to zero terms&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms Scenario 2: Get all terms request unsuccessful due to zero terms&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:492,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TermModel = require(&#x27;../../src/models/term.model&#x27;);\nconst modelStub = sinon.stub(TermModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty term list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Terms not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;8629ef06-e077-4c5e-afcb-fd3747e22f2c&quot;,&quot;parentUUID&quot;:&quot;53f736cb-ae52-40e8-b845-ea1ea97d13d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms Scenario 3: Get a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:68:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;4211a663-18fa-4bc0-b8f2-52a61ce18d14&quot;,&quot;parentUUID&quot;:&quot;53f736cb-ae52-40e8-b845-ea1ea97d13d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all terms request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms Scenario 4: Get all terms request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e3a9dc55-362c-428d-98c8-45273af72481&quot;,&quot;parentUUID&quot;:&quot;53f736cb-ae52-40e8-b845-ea1ea97d13d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e3a9dc55-362c-428d-98c8-45273af72481&quot;],&quot;failures&quot;:[&quot;6ddd5f25-3ed5-4e9c-b9ee-ee779b6ce314&quot;,&quot;8629ef06-e077-4c5e-afcb-fd3747e22f2c&quot;,&quot;4211a663-18fa-4bc0-b8f2-52a61ce18d14&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:513,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;5c6decee-ccc3-4411-a13b-7d326528c9ab&quot;,&quot;title&quot;:&quot;GET /terms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a term request successful&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms/:id Scenario 1: Get a term request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingTerm));\nexpect(resBody.term_id).to.be.equal(existingTerm.term_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:94:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;921714ee-4a4e-442a-b2c1-429a584c616f&quot;,&quot;parentUUID&quot;:&quot;5c6decee-ccc3-4411-a13b-7d326528c9ab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a term request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms/:id Scenario 2: Get a term request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTermId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Term not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:108:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;bff8203a-5a62-4b10-b2af-8aeaa271997d&quot;,&quot;parentUUID&quot;:&quot;5c6decee-ccc3-4411-a13b-7d326528c9ab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms/:id Scenario 3: Get a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:121:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;ebda2ea4-2824-41d1-a7e6-2fdc2df96b4d&quot;,&quot;parentUUID&quot;:&quot;5c6decee-ccc3-4411-a13b-7d326528c9ab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a term request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API GET /terms/:id Scenario 4: Get a term request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTerm.term_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2f130944-07fa-48cf-a956-15e4677cb380&quot;,&quot;parentUUID&quot;:&quot;5c6decee-ccc3-4411-a13b-7d326528c9ab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2f130944-07fa-48cf-a956-15e4677cb380&quot;],&quot;failures&quot;:[&quot;921714ee-4a4e-442a-b2c1-429a584c616f&quot;,&quot;bff8203a-5a62-4b10-b2af-8aeaa271997d&quot;,&quot;ebda2ea4-2824-41d1-a7e6-2fdc2df96b4d&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:32,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;50152bd2-467a-47df-9e81-221c9ac85f7f&quot;,&quot;title&quot;:&quot;POST /terms&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a term request is successful&quot;,&quot;fullTitle&quot;:&quot;Terms API POST /terms Scenario 1: Create a term request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;term_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.term_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    term_id: newId,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:154:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;c09b2eb8-87b0-4d7a-812b-f17d4613dadf&quot;,&quot;parentUUID&quot;:&quot;50152bd2-467a-47df-9e81-221c9ac85f7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a term request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Terms API POST /terms Scenario 2: Create a term request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    terms: term // &lt;-- a valid parameter name is &#x27;term&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;term&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:191:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;df7207dd-9a63-4dac-bcbb-4a2a56718f47&quot;,&quot;parentUUID&quot;:&quot;50152bd2-467a-47df-9e81-221c9ac85f7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API POST /terms Scenario 3: Create a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:209:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;95a56e0b-2b97-45c2-87b7-2e81fccbe7c2&quot;,&quot;parentUUID&quot;:&quot;50152bd2-467a-47df-9e81-221c9ac85f7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a term request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API POST /terms Scenario 4: Create a term request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cf90080b-104e-4cad-b542-6f2c20a0d21c&quot;,&quot;parentUUID&quot;:&quot;50152bd2-467a-47df-9e81-221c9ac85f7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cf90080b-104e-4cad-b542-6f2c20a0d21c&quot;],&quot;failures&quot;:[&quot;c09b2eb8-87b0-4d7a-812b-f17d4613dadf&quot;,&quot;df7207dd-9a63-4dac-bcbb-4a2a56718f47&quot;,&quot;95a56e0b-2b97-45c2-87b7-2e81fccbe7c2&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:46,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;76436d1c-d14a-4709-a4de-4627fccc29af&quot;,&quot;title&quot;:&quot;PATCH /terms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a term request is successful&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 1: Update a term request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term: newTermName };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    term_id: existingTerm.term_id,\n    term: newTermName\n});\n\n// cleanup\ndata.term = existingTerm.term;\nres = await request(app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:247:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;3d64ac2e-0478-46cb-8c62-e9ed5c58e69a&quot;,&quot;parentUUID&quot;:&quot;76436d1c-d14a-4709-a4de-4627fccc29af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a term request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 2: Update a term request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term: newTermName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTermId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Term not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:284:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;a3878cda-f37c-4716-b999-5a8e5585e834&quot;,&quot;parentUUID&quot;:&quot;76436d1c-d14a-4709-a4de-4627fccc29af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a term request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 3: Update a term request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    terms: newTermName // &lt;-- a invalid update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;term&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:303:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;188d2826-05f8-4706-86f2-311649cc93fa&quot;,&quot;parentUUID&quot;:&quot;76436d1c-d14a-4709-a4de-4627fccc29af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 4: Update a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term: newTermName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:323:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;343da11d-005b-4c0e-a693-f8da35185c43&quot;,&quot;parentUUID&quot;:&quot;76436d1c-d14a-4709-a4de-4627fccc29af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a term request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API PATCH /terms/:id Scenario 5: Update a term request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { term: newTermName };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTerm.term_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c4a60051-c801-4840-9d92-872b62167686&quot;,&quot;parentUUID&quot;:&quot;76436d1c-d14a-4709-a4de-4627fccc29af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c4a60051-c801-4840-9d92-872b62167686&quot;],&quot;failures&quot;:[&quot;3d64ac2e-0478-46cb-8c62-e9ed5c58e69a&quot;,&quot;a3878cda-f37c-4716-b999-5a8e5585e834&quot;,&quot;188d2826-05f8-4706-86f2-311649cc93fa&quot;,&quot;343da11d-005b-4c0e-a693-f8da35185c43&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:49,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1525f77e-188f-4f2b-a788-cf4e42073dcf&quot;,&quot;title&quot;:&quot;DELETE /terms/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\term.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\term.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a term request is successful&quot;,&quot;fullTitle&quot;:&quot;Terms API DELETE /terms/:id Scenario 1: Delete a term request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { term };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.term_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Term has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:359:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;2758538a-a9c4-490d-a3ee-682cbe8b0abf&quot;,&quot;parentUUID&quot;:&quot;1525f77e-188f-4f2b-a788-cf4e42073dcf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a term request is unsuccessful due to unknown term_id&quot;,&quot;fullTitle&quot;:&quot;Terms API DELETE /terms/:id Scenario 2: Delete a term request is unsuccessful due to unknown term_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTermId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Term not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:391:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;b6266055-bb92-4e10-b102-3135ba03d2e1&quot;,&quot;parentUUID&quot;:&quot;1525f77e-188f-4f2b-a788-cf4e42073dcf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a term request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Terms API DELETE /terms/:id Scenario 3: Delete a term request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTerm.term_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\term.test.js:404:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;abc05468-2efd-4e60-b190-30ceacc9eb1c&quot;,&quot;parentUUID&quot;:&quot;1525f77e-188f-4f2b-a788-cf4e42073dcf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a term request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Terms API DELETE /terms/:id Scenario 4: Delete a term request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTerm.term_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;19260b91-3812-4ff9-b1ab-4d91115f482a&quot;,&quot;parentUUID&quot;:&quot;1525f77e-188f-4f2b-a788-cf4e42073dcf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;19260b91-3812-4ff9-b1ab-4d91115f482a&quot;],&quot;failures&quot;:[&quot;2758538a-a9c4-490d-a3ee-682cbe8b0abf&quot;,&quot;b6266055-bb92-4e10-b102-3135ba03d2e1&quot;,&quot;abc05468-2efd-4e60-b190-30ceacc9eb1c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;68dcbb19-85bc-4f0f-ac92-2b38fae5d52f&quot;,&quot;title&quot;:&quot;Timeslots API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Timeslots API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Timeslots API \&quot;before each\&quot; hook in \&quot;Timeslots API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;24e2d90f-4d69-4321-ab92-50c966afa5f4&quot;,&quot;parentUUID&quot;:&quot;68dcbb19-85bc-4f0f-ac92-2b38fae5d52f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cb4012f6-f471-41e3-a0a7-6538a388946d&quot;,&quot;title&quot;:&quot;GET /timeslots&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all timeslots request successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots Scenario 1: Get all timeslots request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTimeslot));&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:37:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;e06ff79d-19f5-497e-879f-386728eefe92&quot;,&quot;parentUUID&quot;:&quot;cb4012f6-f471-41e3-a0a7-6538a388946d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all timeslots request unsuccessful due to zero timeslots&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots Scenario 2: Get all timeslots request unsuccessful due to zero timeslots&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:511,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TimeslotModel = require(&#x27;../../src/models/timeslot.model&#x27;);\nconst modelStub = sinon.stub(TimeslotModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty timeslot list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslots not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;0c76e118-44ed-4a4b-96cf-f172d4f89da1&quot;,&quot;parentUUID&quot;:&quot;cb4012f6-f471-41e3-a0a7-6538a388946d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;e06ff79d-19f5-497e-879f-386728eefe92&quot;,&quot;0c76e118-44ed-4a4b-96cf-f172d4f89da1&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:521,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ad612425-5d49-47c6-9fa0-2c2b7783610d&quot;,&quot;title&quot;:&quot;GET /timeslots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a timeslot request successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots/:id Scenario 1: Get a timeslot request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.include.all.keys(Object.keys(existingTimeslot));\nexpect(resBody.timeslot_id).to.be.equal(existingTimeslot.timeslot_id); // should match initially sent id&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:73:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;94fb94f8-2b91-4e1f-abfb-4b46ebdaeafe&quot;,&quot;parentUUID&quot;:&quot;ad612425-5d49-47c6-9fa0-2c2b7783610d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a timeslot request is unsuccessful due to unknown timeslot_id&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots/:id Scenario 2: Get a timeslot request is unsuccessful due to unknown timeslot_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTimeslotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:87:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;2acf21b4-f2df-434c-9dbb-45087aa44237&quot;,&quot;parentUUID&quot;:&quot;ad612425-5d49-47c6-9fa0-2c2b7783610d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get a timeslot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timeslots API GET /timeslots/:id Scenario 4: Get a timeslot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTimeslot.timeslot_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5e030175-ceb1-43b4-b1de-01bf6fd30212&quot;,&quot;parentUUID&quot;:&quot;ad612425-5d49-47c6-9fa0-2c2b7783610d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5e030175-ceb1-43b4-b1de-01bf6fd30212&quot;],&quot;failures&quot;:[&quot;94fb94f8-2b91-4e1f-abfb-4b46ebdaeafe&quot;,&quot;2acf21b4-f2df-434c-9dbb-45087aa44237&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:25,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;15d2f08f-fd51-493f-a8db-750e9386e2a0&quot;,&quot;title&quot;:&quot;POST /timeslots&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a timeslot request is successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 1: Create a timeslot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time, end_time, slot_number };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.all.keys([&#x27;timeslot_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\nconst newId = res.body.body.timeslot_id;\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    timeslot_id: newId,\n    ...data\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:122:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;f1c03b40-1a57-499e-bd7c-29aae5feb26f&quot;,&quot;parentUUID&quot;:&quot;15d2f08f-fd51-493f-a8db-750e9386e2a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a timeslot request is unsuccessful due to timeslot conflicts&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 2: Create a timeslot request is unsuccessful due to timeslot conflicts&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time: existingTimeslot.start_time, end_time, slot_number }; // start_time conflict\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(500);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;CreateFailedException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot conflicts found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;InternalServerException&#x27; to equal &#x27;CreateFailedException&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;InternalServerException&#x27; to equal &#x27;CreateFailedException&#x27;\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:159:49)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;InternalServerException&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;CreateFailedException&quot;}]},&quot;uuid&quot;:&quot;4f2f6b2a-2a95-42b1-ab51-586551fbca0f&quot;,&quot;parentUUID&quot;:&quot;15d2f08f-fd51-493f-a8db-750e9386e2a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a timeslot request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 3: Create a timeslot request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    timeslots: start_time, // &lt;-- a valid parameter name is &#x27;start_time&#x27;\n    end_time,\n    slot_number: &#x27;asb&#x27; // has to be an int\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;start_time&#x27;, &#x27;slot_number&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:178:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;28552fbd-c115-47aa-a9ce-3739138d4f12&quot;,&quot;parentUUID&quot;:&quot;15d2f08f-fd51-493f-a8db-750e9386e2a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a timeslot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 4: Create a timeslot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time, end_time, slot_number };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:196:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;9cde01c4-064a-4603-82d3-43b29a29642b&quot;,&quot;parentUUID&quot;:&quot;15d2f08f-fd51-493f-a8db-750e9386e2a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Create a timeslot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timeslots API POST /timeslots Scenario 5: Create a timeslot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time, end_time, slot_number };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;57fc771a-08bc-470d-a5c5-c70d0729bc2b&quot;,&quot;parentUUID&quot;:&quot;15d2f08f-fd51-493f-a8db-750e9386e2a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;57fc771a-08bc-470d-a5c5-c70d0729bc2b&quot;],&quot;failures&quot;:[&quot;f1c03b40-1a57-499e-bd7c-29aae5feb26f&quot;,&quot;4f2f6b2a-2a95-42b1-ab51-586551fbca0f&quot;,&quot;28552fbd-c115-47aa-a9ce-3739138d4f12&quot;,&quot;9cde01c4-064a-4603-82d3-43b29a29642b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:53,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;adaa0cd1-2e91-4008-b032-1f508ab4ab38&quot;,&quot;title&quot;:&quot;PATCH /timeslots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a timeslot request is successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 1: Update a timeslot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { slot_number: newTimeslotNumber };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(1);\nexpect(res.body.body.rows_changed).to.be.equal(1);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body).to.be.eql({\n    timeslot_id: existingTimeslot.timeslot_id,\n    start_time: existingTimeslot.start_time,\n    end_time: existingTimeslot.end_time,\n    slot_number: newTimeslotNumber\n});\n\n// cleanup\ndata.slot_number = existingTimeslot.slot_number;\nres = await request(app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:234:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;cbaacde1-4d19-454f-878a-9ef605463f07&quot;,&quot;parentUUID&quot;:&quot;adaa0cd1-2e91-4008-b032-1f508ab4ab38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a timeslot request is unsuccessful due to unknown timeslot code&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 2: Update a timeslot request is unsuccessful due to unknown timeslot code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { slot_number: newTimeslotNumber };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTimeslotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:273:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;088617f4-e382-4967-9e8e-c05f7212f7f6&quot;,&quot;parentUUID&quot;:&quot;adaa0cd1-2e91-4008-b032-1f508ab4ab38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a timeslot request is unsuccessful due to timeslot conflicts&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 3: Update a timeslot request is unsuccessful due to timeslot conflicts&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { start_time: existingTimeslot.end_time }; // can&#x27;t be the same time\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(500);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;UpdateFailedException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot conflicts found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;InternalServerException&#x27; to equal &#x27;UpdateFailedException&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;InternalServerException&#x27; to equal &#x27;UpdateFailedException&#x27;\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:292:49)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;InternalServerException&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;UpdateFailedException&quot;}]},&quot;uuid&quot;:&quot;fda91558-30c0-41e4-88df-8835a2e2ea02&quot;,&quot;parentUUID&quot;:&quot;adaa0cd1-2e91-4008-b032-1f508ab4ab38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a timeslot request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 4: Update a timeslot request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    timeslots: newTimeslotNumber // &lt;-- a invalid update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:309:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;88b10c86-c885-41ae-a427-edb3fc695b1f&quot;,&quot;parentUUID&quot;:&quot;adaa0cd1-2e91-4008-b032-1f508ab4ab38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a timeslot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 5: Update a timeslot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { slot_number: newTimeslotNumber };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- api_user token instead of admin token\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:327:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;a860a491-04e3-4181-8017-a89d1d02dd4f&quot;,&quot;parentUUID&quot;:&quot;adaa0cd1-2e91-4008-b032-1f508ab4ab38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a timeslot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timeslots API PATCH /timeslots/:id Scenario 6: Update a timeslot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { slot_number: newTimeslotNumber };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1b3c4377-d5df-456c-b257-6d16fce0462d&quot;,&quot;parentUUID&quot;:&quot;adaa0cd1-2e91-4008-b032-1f508ab4ab38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1b3c4377-d5df-456c-b257-6d16fce0462d&quot;],&quot;failures&quot;:[&quot;cbaacde1-4d19-454f-878a-9ef605463f07&quot;,&quot;088617f4-e382-4967-9e8e-c05f7212f7f6&quot;,&quot;fda91558-30c0-41e4-88df-8835a2e2ea02&quot;,&quot;88b10c86-c885-41ae-a427-edb3fc695b1f&quot;,&quot;a860a491-04e3-4181-8017-a89d1d02dd4f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:54,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;37614fe7-a4be-45c2-ad94-468bb44be2ec&quot;,&quot;title&quot;:&quot;DELETE /timeslots/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timeslot.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timeslot.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a timeslot request is successful&quot;,&quot;fullTitle&quot;:&quot;Timeslots API DELETE /timeslots/:id Scenario 1: Delete a timeslot request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// prepare\nconst data = { start_time, end_time, slot_number };\nconst app = this.app;\n// create dummy\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.timeslot_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:365:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;013375c1-c803-4c3d-a8ca-f03475691f9f&quot;,&quot;parentUUID&quot;:&quot;37614fe7-a4be-45c2-ad94-468bb44be2ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a timeslot request is unsuccessful due to unknown timeslot code&quot;,&quot;fullTitle&quot;:&quot;Timeslots API DELETE /timeslots/:id Scenario 2: Delete a timeslot request is unsuccessful due to unknown timeslot code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTimeslotId}`)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timeslot not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:397:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;403e2f45-0bfe-4ae4-959e-c19236dac89f&quot;,&quot;parentUUID&quot;:&quot;37614fe7-a4be-45c2-ad94-468bb44be2ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a timeslot request is forbidden&quot;,&quot;fullTitle&quot;:&quot;Timeslots API DELETE /timeslots/:id Scenario 3: Delete a timeslot request is forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTimeslot.timeslot_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- api_user token instead of admin token\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timeslot.test.js:410:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;2aff465e-6d5f-4b88-86fc-4aef57aca37f&quot;,&quot;parentUUID&quot;:&quot;37614fe7-a4be-45c2-ad94-468bb44be2ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Delete a timeslot request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timeslots API DELETE /timeslots/:id Scenario 4: Delete a timeslot request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTimeslot.timeslot_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e8e180c6-d63d-4e2f-b495-93599ce7ae44&quot;,&quot;parentUUID&quot;:&quot;37614fe7-a4be-45c2-ad94-468bb44be2ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e8e180c6-d63d-4e2f-b495-93599ce7ae44&quot;],&quot;failures&quot;:[&quot;013375c1-c803-4c3d-a8ca-f03475691f9f&quot;,&quot;403e2f45-0bfe-4ae4-959e-c19236dac89f&quot;,&quot;2aff465e-6d5f-4b88-86fc-4aef57aca37f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f8d24e3f-e4cf-4e7d-9880-4cda5bedd08e&quot;,&quot;title&quot;:&quot;Timetables API&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Timetables API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Timetables API \&quot;before each\&quot; hook in \&quot;Timetables API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.app = require(&#x27;../../src/server&#x27;).setup();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;235e0793-300e-461f-a602-ce05db6efbb7&quot;,&quot;parentUUID&quot;:&quot;f8d24e3f-e4cf-4e7d-9880-4cda5bedd08e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;698c28d4-6219-4802-8fcd-58dab8b9e01d&quot;,&quot;title&quot;:&quot;GET /timetables&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get all timetables request is successful (Admin Only)&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 1: Get all timetables request is successful (Admin Only)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0]).to.include.all.keys(Object.keys(existingTimetable)); // contain all params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:152:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;40c10a00-abcd-4fc2-badb-042f12cbac71&quot;,&quot;parentUUID&quot;:&quot;698c28d4-6219-4802-8fcd-58dab8b9e01d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get all timetables request successful (using query params)&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 2: Get all timetables request successful (using query params)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst student_erp = userERP;\nlet res = await request(this.app)\n    .get(`${baseRoute}?student_erp=${student_erp}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nexpect(resBody[0].student_erp).to.be.equal(student_erp);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:168:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;fad8f6a1-9134-4127-9796-ca30f2952138&quot;,&quot;parentUUID&quot;:&quot;698c28d4-6219-4802-8fcd-58dab8b9e01d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get all timetables request unsuccessful due to no student timetables&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 3: Get all timetables request unsuccessful due to no student timetables&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:477,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\ndecache(&#x27;../../src/server&#x27;);\nconst TimetableModel = require(&#x27;../../src/models/timetable.model&#x27;);\nconst modelStub = sinon.stub(TimetableModel, &#x27;findAll&#x27;).callsFake(() =&gt; []); // return empty timetable list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .get(baseRoute)\n    .auth(adminToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetables not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;df706273-b683-4f18-ad93-f62045304c73&quot;,&quot;parentUUID&quot;:&quot;698c28d4-6219-4802-8fcd-58dab8b9e01d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Get all timetables request is incorrect due to unknown query parameters&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 4: Get all timetables request is incorrect due to unknown query parameters&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst student_erp = &#x27;all&#x27;; // &lt;-- invalid student_erp value\n\n// act\nlet res = await request(this.app)\n    .get(`${baseRoute}?student_erp=${student_erp}&amp;year=2022`) // &lt;-- `year` is an incorrect query param\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;student_erp&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid query params!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:206:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;1a29bf05-1dc9-41ca-be0a-1d039cd41732&quot;,&quot;parentUUID&quot;:&quot;698c28d4-6219-4802-8fcd-58dab8b9e01d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Get all timetables request is forbidden due to no query params&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 5: Get all timetables request is forbidden due to no query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(baseRoute) // needs student_erp\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:222:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;2e878cfb-a128-4e29-b953-5c1a5f4c166d&quot;,&quot;parentUUID&quot;:&quot;698c28d4-6219-4802-8fcd-58dab8b9e01d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Get all timetables request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables Scenario 6: Get all timetables request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(baseRoute);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2bd6c2f2-1d23-47d7-beb2-2e85aebf9212&quot;,&quot;parentUUID&quot;:&quot;698c28d4-6219-4802-8fcd-58dab8b9e01d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2bd6c2f2-1d23-47d7-beb2-2e85aebf9212&quot;],&quot;failures&quot;:[&quot;40c10a00-abcd-4fc2-badb-042f12cbac71&quot;,&quot;fad8f6a1-9134-4127-9796-ca30f2952138&quot;,&quot;df706273-b683-4f18-ad93-f62045304c73&quot;,&quot;1a29bf05-1dc9-41ca-be0a-1d039cd41732&quot;,&quot;2e878cfb-a128-4e29-b953-5c1a5f4c166d&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:517,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;68a74b7e-9cab-45b1-8352-a18b0c31820b&quot;,&quot;title&quot;:&quot;GET /timetables/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Get a timetable request successful&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables/:id Scenario 1: Get a timetable request successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app)\n    .get(`${baseRoute}/${existingTimetable.timetable_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody.timetable_id).to.be.equal(existingTimetable.timetable_id); // should match initially sent id\nexpect(resBody).to.include.all.keys(Object.keys(existingTimetable)); // contain all params\nexpect(resBody.classes).to.be.an(&#x27;array&#x27;);\nexpect(resBody.classes[0]).to.include.all.keys(Object.keys(existingClass1)); // contain all params\nconst exampleClass = resBody.classes[0];\nexpect(exampleClass.classroom).to.not.be.undefined;\nexpect(exampleClass.classroom).to.include.all.keys(Object.keys(existingClass1.classroom)); // contain all params\n\nexpect(exampleClass.classroom.campus).to.not.be.undefined;\nexpect(exampleClass.classroom.campus).to.include.all.keys(Object.keys(existingClass1.classroom.campus)); // contain all params\nexpect(exampleClass.subject).to.not.be.undefined;\nexpect(exampleClass.subject).to.include.all.keys(Object.keys(existingClass1.subject)); // contain all params\nexpect(exampleClass.teacher).to.not.be.undefined;\nexpect(exampleClass.teacher).to.include.all.keys(Object.keys(existingClass1.teacher)); // contain all params\nexpect(exampleClass.timeslot_1).to.not.be.undefined;\nexpect(exampleClass.timeslot_1).to.include.all.keys(Object.keys(existingClass1.timeslot_1)); // contain all params\nexpect(exampleClass.timeslot_2).to.not.be.undefined;\nexpect(exampleClass.timeslot_2).to.include.all.keys(Object.keys(existingClass1.timeslot_2)); // contain all params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:248:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;7396d153-1876-433b-a9f6-98b5a53770ce&quot;,&quot;parentUUID&quot;:&quot;68a74b7e-9cab-45b1-8352-a18b0c31820b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Get a timetable request is unsuccessful&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables/:id Scenario 2: Get a timetable request is unsuccessful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .get(`${baseRoute}/${unknownTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:285:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;44356ba2-263e-4a83-bfcb-99931da88f50&quot;,&quot;parentUUID&quot;:&quot;68a74b7e-9cab-45b1-8352-a18b0c31820b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Get a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API GET /timetables/:id Scenario 3: Get a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nlet res = await request(this.app).get(`${baseRoute}/${existingTimetable.timetable_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;043ee8c4-a43d-40fb-846e-80c67b9b33d2&quot;,&quot;parentUUID&quot;:&quot;68a74b7e-9cab-45b1-8352-a18b0c31820b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;043ee8c4-a43d-40fb-846e-80c67b9b33d2&quot;],&quot;failures&quot;:[&quot;7396d153-1876-433b-a9f6-98b5a53770ce&quot;,&quot;44356ba2-263e-4a83-bfcb-99931da88f50&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;5136bfcf-59df-4bd4-b033-0d496216fe6c&quot;,&quot;title&quot;:&quot;POST /timetables&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Create a timetable request is successful&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables Scenario 1: Create a timetable request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTimetable };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(201);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body).to.include.keys([&#x27;timetable_id&#x27;, &#x27;affected_rows&#x27;]);\nexpect(res.body.body.affected_rows).to.be.equal(1);\n\n// affirm\nconst newId = res.body.body.timetable_id;\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);\nconst resBody = res.body.body;\n// check if all classes added to schedule\nconst resClasses = resBody.classes.map(classItem =&gt; classItem.class_erp);\nexpect(resClasses).to.include.all.members(data.classes);\n// check other properties\ndelete resBody.classes;\nexpect(resBody).to.be.eql({\n    timetable_id: newId,\n    student_erp: data.student_erp,\n    term_id: data.term_id,\n    is_active: data.is_active\n});\n// cleanup\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:324:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;00ba7703-f594-4742-ade2-d4e80244ac9d&quot;,&quot;parentUUID&quot;:&quot;5136bfcf-59df-4bd4-b033-0d496216fe6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Create a timetable request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables Scenario 2: Create a timetable request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst {classes, ...timetable} = newTimetable;\nconst data = {\n    ...timetable,\n    classessfd: classes // &lt;-- a valid param is &#x27;classes&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;classes&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:373:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;469c1d59-a055-4faf-a620-5ec93eba33bd&quot;,&quot;parentUUID&quot;:&quot;5136bfcf-59df-4bd4-b033-0d496216fe6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables Scenario 3: Create a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTimetable };\ndata.student_erp = adminERP; // &lt;-- can be any other non-admin ERP as well, just different from userToken erp\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t create others timetables i.e. token erp != newTimetable.student_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:392:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;a887bdb9-a446-4659-8ec6-3a3a8417799a&quot;,&quot;parentUUID&quot;:&quot;5136bfcf-59df-4bd4-b033-0d496216fe6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables Scenario 4: Create a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTimetable };\n// act\nconst res = await request(this.app)\n    .post(baseRoute)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c6a60bfb-fd9c-4118-977b-efe99cacfb43&quot;,&quot;parentUUID&quot;:&quot;5136bfcf-59df-4bd4-b033-0d496216fe6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c6a60bfb-fd9c-4118-977b-efe99cacfb43&quot;],&quot;failures&quot;:[&quot;00ba7703-f594-4742-ade2-d4e80244ac9d&quot;,&quot;469c1d59-a055-4faf-a620-5ec93eba33bd&quot;,&quot;a887bdb9-a446-4659-8ec6-3a3a8417799a&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:46,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ccaee67d-291f-4bf9-ac98-4f6db3f55570&quot;,&quot;title&quot;:&quot;POST /timetables/generate&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Generate timetables request is successful&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables/generate Scenario 1: Generate timetables request is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { num_of_subjects, classes: possibleClasses };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nconst resBody = res.body.body;\nexpect(resBody).to.be.an(&#x27;array&#x27;);\nconst exampleTimetable = resBody[0];\n\nexpect(exampleTimetable).to.include.all.keys([\&quot;term_id\&quot;, \&quot;is_active\&quot;, \&quot;classes\&quot;]); // contain all params\nexpect(exampleTimetable.classes).to.be.an(&#x27;array&#x27;);\nexpect(exampleTimetable.classes[0]).to.include.all.keys(Object.keys(existingClass1)); // contain all params\nconst exampleClass = exampleTimetable.classes[0];\nexpect(exampleClass.classroom).to.not.be.undefined;\nexpect(exampleClass.classroom).to.include.all.keys(Object.keys(existingClass1.classroom)); // contain all params\n\nexpect(exampleClass.classroom.campus).to.not.be.undefined;\nexpect(exampleClass.classroom.campus).to.include.all.keys(Object.keys(existingClass1.classroom.campus)); // contain all params\nexpect(exampleClass.subject).to.not.be.undefined;\nexpect(exampleClass.subject).to.include.all.keys(Object.keys(existingClass1.subject)); // contain all params\nexpect(exampleClass.teacher).to.not.be.undefined;\nexpect(exampleClass.teacher).to.include.all.keys(Object.keys(existingClass1.teacher)); // contain all params\nexpect(exampleClass.timeslot_1).to.not.be.undefined;\nexpect(exampleClass.timeslot_1).to.include.all.keys(Object.keys(existingClass1.timeslot_1)); // contain all params\nexpect(exampleClass.timeslot_2).to.not.be.undefined;\nexpect(exampleClass.timeslot_2).to.include.all.keys(Object.keys(existingClass1.timeslot_2)); // contain all params&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:432:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;01ba52b2-893e-442f-a193-4299b0bf00c7&quot;,&quot;parentUUID&quot;:&quot;ccaee67d-291f-4bf9-ac98-4f6db3f55570&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Generate timetables request is unsuccessful due to no possible timetables&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables/generate Scenario 2: Generate timetables request is unsuccessful due to no possible timetables&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:495,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { num_of_subjects, classes: possibleClasses };\ndecache(&#x27;../../src/server&#x27;);\nconst TimetableRepository = require(&#x27;../../src/repositories/timetable.repository&#x27;);\nconst modelStub = sinon.stub(TimetableRepository, &#x27;findScheduleClass&#x27;).callsFake(() =&gt; []); // return empty timetable list\nconst app = require(&#x27;../../src/server&#x27;).setup();\n// act\nconst res = await request(app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Possible timetables not found&#x27;);\nmodelStub.restore();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Database Error: Database connection was refused.&quot;,&quot;estack&quot;:&quot;Database Error: Database connection was refused.\n    at D:\\nodejs_projects\\UniPal-Backend\\src\\db\\db-service.js:2:1567\n    at D:\\nodejs_projects\\UniPal-Backend\\node_modules\\mysql2\\lib\\pool.js:60:18\n    at PoolConnection.&lt;anonymous&gt; (node_modules\\mysql2\\lib\\connection.js:775:13)\n    at Object.onceWrapper (node:events:642:26)\n    at PoolConnection.emit (node:events:539:35)\n    at PoolConnection.emit (node:domain:475:12)\n    at PoolConnection._notifyError (node_modules\\mysql2\\lib\\connection.js:236:12)\n    at PoolConnection._handleFatalError (node_modules\\mysql2\\lib\\connection.js:167:10)\n    at PoolConnection._handleNetworkError (node_modules\\mysql2\\lib\\connection.js:180:10)\n    at Socket.emit (node:events:527:28)\n    at Socket.emit (node:domain:475:12)\n    at emitErrorNT (node:internal/streams/destroy:157:8)\n    at emitErrorCloseNT (node:internal/streams/destroy:122:3)\n    at processTicksAndRejections (node:internal/process/task_queues:83:21)&quot;},&quot;uuid&quot;:&quot;a1f754d5-a18a-4989-b168-a3b7dcc8c792&quot;,&quot;parentUUID&quot;:&quot;ccaee67d-291f-4bf9-ac98-4f6db3f55570&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Create a timetable request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables/generate Scenario 3: Create a timetable request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    subjects: num_of_subjects, // &lt;-- a valid param is &#x27;num_of_subjects&#x27;\n    classes: [] // &lt;-- must specify atleast 1 &#x27;class&#x27;\n};\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == newTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.members([&#x27;num_of_subjects&#x27;, &#x27;classes&#x27;]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:501:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;760d82d0-39a1-43d7-b76e-674b09bf3107&quot;,&quot;parentUUID&quot;:&quot;ccaee67d-291f-4bf9-ac98-4f6db3f55570&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Create a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API POST /timetables/generate Scenario 4: Create a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { num_of_subjects, classes: possibleClasses };\n// act\nconst res = await request(this.app)\n    .post(`${baseRoute}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b22ac25b-3e41-471c-9cd0-54997b0b97a3&quot;,&quot;parentUUID&quot;:&quot;ccaee67d-291f-4bf9-ac98-4f6db3f55570&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b22ac25b-3e41-471c-9cd0-54997b0b97a3&quot;],&quot;failures&quot;:[&quot;01ba52b2-893e-442f-a193-4299b0bf00c7&quot;,&quot;a1f754d5-a18a-4989-b168-a3b7dcc8c792&quot;,&quot;760d82d0-39a1-43d7-b76e-674b09bf3107&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:524,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;833b21af-4d25-4ada-a51d-9cd76fb90233&quot;,&quot;title&quot;:&quot;PATCH /timetables/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a timetable request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 1: Update a timetable request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { is_active: updatedTimetableIsActive };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${inActiveTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_matched).to.be.equal(2); // 1 for inactive the previous, then active new\nexpect(res.body.body.rows_changed).to.be.equal(2); // 1 for inactive the previous, then active new\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${inActiveTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nexpect(res.body.body.is_active).to.be.equal(updatedTimetableIsActive);\n\n// cleanup\ndata.is_active = existingTimetable.is_active;\nres = await request(app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:540:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;985ff81f-cec9-4fea-8c8a-c9104ec461da&quot;,&quot;parentUUID&quot;:&quot;833b21af-4d25-4ada-a51d-9cd76fb90233&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 2: Update a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { is_active: updatedTimetableIsActive };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:573:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;60d863af-c832-4895-9709-1943336989c5&quot;,&quot;parentUUID&quot;:&quot;833b21af-4d25-4ada-a51d-9cd76fb90233&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a timetable request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 3: Update a timetable request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    bodysds: updatedTimetableIsActive, // &lt;-- an valid parameter name should be &#x27;is_active&#x27;\n    is_active: \&quot;all\&quot; // &lt;-- an invalid value for &#x27;is_active&#x27; parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include(&#x27;is_active&#x27;);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:593:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;db08b12e-4833-4dad-9bd9-456861475853&quot;,&quot;parentUUID&quot;:&quot;833b21af-4d25-4ada-a51d-9cd76fb90233&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 4: Update a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { is_active: updatedTimetableIsActive };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedTimetableId}`) // &lt;-- has a different student_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others timetables i.e. token erp != unOwnedTimetable.student_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:613:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;cc0b191c-7e0a-4f47-86ff-aacadda57c20&quot;,&quot;parentUUID&quot;:&quot;833b21af-4d25-4ada-a51d-9cd76fb90233&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id Scenario 5: Update a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { is_active: updatedTimetableIsActive };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${inActiveTimetableId}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4bb5b1e6-75c9-4f85-9023-35986444052f&quot;,&quot;parentUUID&quot;:&quot;833b21af-4d25-4ada-a51d-9cd76fb90233&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4bb5b1e6-75c9-4f85-9023-35986444052f&quot;],&quot;failures&quot;:[&quot;985ff81f-cec9-4fea-8c8a-c9104ec461da&quot;,&quot;60d863af-c832-4895-9709-1943336989c5&quot;,&quot;db08b12e-4833-4dad-9bd9-456861475853&quot;,&quot;cc0b191c-7e0a-4f47-86ff-aacadda57c20&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:40,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;83837e26-ba0f-4117-a8d2-cfaa6ceec05c&quot;,&quot;title&quot;:&quot;PATCH /timetables/:id/classes&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Update a timetable request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 1: Update a timetable request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added, removed };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // using his own token i.e. token erp == existingTimetable.student_erp\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.body.rows_added).to.be.equal(added.length);\nexpect(res.body.body.rows_removed).to.be.equal(removed.length);\n\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${existingTimetable.timetable_id}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n\nexpect(res.status).to.be.equal(200);\nconst classes = res.body.body.classes;\nconst classERPs = classes.map(classItem =&gt; classItem.class_erp);\nexpect(classERPs).to.include.all.members(added);\nexpect(classERPs).to.not.include.all.members(removed);\n\n// cleanup\ndata.added = [...removed];\ndata.removed = [...added];\nres = await request(app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 200&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 200\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:656:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;200&quot;}]},&quot;uuid&quot;:&quot;4b4a96ed-eb90-462f-b674-6829f148673b&quot;,&quot;parentUUID&quot;:&quot;83837e26-ba0f-4117-a8d2-cfaa6ceec05c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Update a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 2: Update a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added, removed };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unknownTimetableId}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:693:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;6f28b6c3-449d-4291-96bf-b0e5e697d709&quot;,&quot;parentUUID&quot;:&quot;83837e26-ba0f-4117-a8d2-cfaa6ceec05c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Update a timetable request is unsuccessful due to unknown class_erp&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 3: Update a timetable request is unsuccessful due to unknown class_erp&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added: [unknownClassERP] }; // adding an unknown class erp\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(512);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForeignKeyViolationException&#x27;);\nexpect(res.body.headers.message).to.contain(&#x27;class_erp&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 512&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 512\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:710:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;512&quot;}]},&quot;uuid&quot;:&quot;e0b47a6a-59c1-4e73-9e0d-3c1ba12561b7&quot;,&quot;parentUUID&quot;:&quot;83837e26-ba0f-4117-a8d2-cfaa6ceec05c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 4: Update a timetable request is incorrect&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 4: Update a timetable request is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = {\n    added: [], // &lt;-- &#x27;added&#x27; should be omitted if empty\n    removed: [\&quot;all\&quot;], // &lt;-- all values in the array should match the classERP format(4 or 5 digits)\n    same: [existingClass2.class_erp] // &lt;-- not an allowed update parameter\n};\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(422);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;InvalidPropertiesException&#x27;);\nconst incorrectParams = res.body.headers.data.map(o =&gt; (o.param));\nexpect(incorrectParams).to.include.all.members([&#x27;added&#x27;, &#x27;removed[0]&#x27;]);\nconst incorrectMsg = res.body.headers.data.map(o =&gt; (o.msg));\nexpect(incorrectMsg).to.include(&#x27;Invalid updates!&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 422&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 422\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:731:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;422&quot;}]},&quot;uuid&quot;:&quot;30335af2-6dfa-4167-9b87-28d0688fba51&quot;,&quot;parentUUID&quot;:&quot;83837e26-ba0f-4117-a8d2-cfaa6ceec05c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Update a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 5: Update a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added, removed };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${unOwnedTimetableId}/${subRoute}`) // &lt;-- has a different student_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }) // &lt;-- user can&#x27;t change others timetables i.e. token erp != unOwnedTimetable.student_erp\n    .send(data);\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:751:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;059f3f56-2f1d-431f-96dc-c2df0a770cce&quot;,&quot;parentUUID&quot;:&quot;83837e26-ba0f-4117-a8d2-cfaa6ceec05c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 6: Update a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API PATCH /timetables/:id/classes Scenario 6: Update a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { added, removed };\n// act\nconst res = await request(this.app)\n    .patch(`${baseRoute}/${existingTimetable.timetable_id}/${subRoute}`)\n    .send(data);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cf6bee08-7c96-43ca-86f4-b21cb9813c09&quot;,&quot;parentUUID&quot;:&quot;83837e26-ba0f-4117-a8d2-cfaa6ceec05c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cf6bee08-7c96-43ca-86f4-b21cb9813c09&quot;],&quot;failures&quot;:[&quot;4b4a96ed-eb90-462f-b674-6829f148673b&quot;,&quot;6f28b6c3-449d-4291-96bf-b0e5e697d709&quot;,&quot;e0b47a6a-59c1-4e73-9e0d-3c1ba12561b7&quot;,&quot;30335af2-6dfa-4167-9b87-28d0688fba51&quot;,&quot;059f3f56-2f1d-431f-96dc-c2df0a770cce&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:59,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;66b1e22c-8b83-4bb4-99ad-7e45f8bfcd00&quot;,&quot;title&quot;:&quot;DELETE /timetables/:id&quot;,&quot;fullFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\timetable.test.js&quot;,&quot;file&quot;:&quot;\\test\\integration\\timetable.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Scenario 1: Delete a timetable request is successful (Owner)&quot;,&quot;fullTitle&quot;:&quot;Timetables API DELETE /timetables/:id Scenario 1: Delete a timetable request is successful (Owner)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// arrange\nconst data = { ...newTimetable };\nconst app = this.app;\n// act\nlet res = await request(app)\n    .post(baseRoute)\n    .auth(userToken, { type: &#x27;bearer&#x27; })\n    .send(data);\nexpect(res.status).to.be.equal(201);\n// arrange\nconst newId = res.body.body.timetable_id;\n// act\nres = await request(app)\n    .delete(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // using his own token i.e. token erp == newTimetable.student_erp\n// assert\nexpect(res.status).to.be.equal(200);\nexpect(res.body.headers.error).to.be.equal(0);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable has been deleted&#x27;);\nexpect(res.body.body.rows_removed).to.be.equal(1);\n// affirm\nres = await request(app)\n    .get(`${baseRoute}/${newId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 201&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 201\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:793:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;201&quot;}]},&quot;uuid&quot;:&quot;abe98029-d660-4660-b9c7-70adf92ef74c&quot;,&quot;parentUUID&quot;:&quot;66b1e22c-8b83-4bb4-99ad-7e45f8bfcd00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 2: Delete a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;fullTitle&quot;:&quot;Timetables API DELETE /timetables/:id Scenario 2: Delete a timetable request is unsuccessful due to unknown timetable_id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unknownTimetableId}`)\n    .auth(userToken, { type: &#x27;bearer&#x27; });\n    \n// assert\nexpect(res.status).to.be.equal(404);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;NotFoundException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Timetable not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 404&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 404\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:825:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;404&quot;}]},&quot;uuid&quot;:&quot;64776c8d-f680-4e41-85cd-ff0a8df60a7a&quot;,&quot;parentUUID&quot;:&quot;66b1e22c-8b83-4bb4-99ad-7e45f8bfcd00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 3: Delete a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;fullTitle&quot;:&quot;Timetables API DELETE /timetables/:id Scenario 3: Delete a timetable request is forbidden (Unowned Student ERP)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${unOwnedTimetableId}`) // &lt;-- has a different student_erp than userToken erp\n    .auth(userToken, { type: &#x27;bearer&#x27; }); // &lt;-- user can&#x27;t delete others timetables i.e. token erp != unOwnedTimetable.student_erp\n\n// assert\nexpect(res.status).to.be.equal(403);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;ForbiddenException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;User unauthorized for action&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 500 to equal 403&quot;,&quot;estack&quot;:&quot;AssertionError: expected 500 to equal 403\n    at Context.&lt;anonymous&gt; (test\\integration\\timetable.test.js:838:38)\n    at runMicrotasks (&lt;anonymous&gt;)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)&quot;,&quot;diff&quot;:[{&quot;count&quot;:1,&quot;removed&quot;:true,&quot;value&quot;:&quot;500&quot;},{&quot;count&quot;:1,&quot;added&quot;:true,&quot;value&quot;:&quot;403&quot;}]},&quot;uuid&quot;:&quot;f50ca00e-27f0-42ba-bbbd-8f220b294e20&quot;,&quot;parentUUID&quot;:&quot;66b1e22c-8b83-4bb4-99ad-7e45f8bfcd00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Scenario 5: Delete a timetable request is unauthorized&quot;,&quot;fullTitle&quot;:&quot;Timetables API DELETE /timetables/:id Scenario 5: Delete a timetable request is unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// act\nconst res = await request(this.app)\n    .delete(`${baseRoute}/${existingTimetable.timetable_id}`);\n    \n// assert\nexpect(res.status).to.be.equal(401);\nexpect(res.body.headers.error).to.be.equal(1);\nexpect(res.body.headers.code).to.be.equal(&#x27;TokenMissingException&#x27;);\nexpect(res.body.headers.message).to.be.equal(&#x27;Access denied. No token credentials sent&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cb7d9431-db80-4bcc-935f-66bfbd516ef6&quot;,&quot;parentUUID&quot;:&quot;66b1e22c-8b83-4bb4-99ad-7e45f8bfcd00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cb7d9431-db80-4bcc-935f-66bfbd516ef6&quot;],&quot;failures&quot;:[&quot;abe98029-d660-4660-b9c7-70adf92ef74c&quot;,&quot;64776c8d-f680-4e41-85cd-ff0a8df60a7a&quot;,&quot;f50ca00e-27f0-42ba-bbbd-8f220b294e20&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:29,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:20000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.0.0&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;integration-tests-report&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:false,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:true,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;test/integration/report&quot;,&quot;reportFilename&quot;:&quot;integration-tests-report&quot;,&quot;json&quot;:&quot;false&quot;,&quot;autoOpen&quot;:&quot;true&quot;},&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;integration-tests-report&quot;,&quot;reportDir&quot;:&quot;test/integration/report&quot;,&quot;reportTitle&quot;:&quot;UniPal-Backend&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:true,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:false,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;test\\integration\\report\\assets&quot;,&quot;htmlFile&quot;:&quot;D:\\nodejs_projects\\UniPal-Backend\\test\\integration\\report\\integration-tests-report.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>